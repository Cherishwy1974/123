<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=1920, initial-scale=1.0">
    <title>ç¬¬ä¸€ç« ï¼šå¯¹æ•°å‡½æ•° - è™šæ‹Ÿäººæ•™å­¦ç³»ç»Ÿ</title>
    
    <!-- æœ¬åœ°èµ„æº -->
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Serif+SC:wght@400;600;700&display=swap" rel="stylesheet">
    
    <!-- D3.js -->
    <script src="https://d3js.org/d3.v7.min.js"></script>
    
    <!-- MathJaxé…ç½® -->
    <script>
        if (!window.MathJax) {
            window.MathJax = {
                tex: {
                    inlineMath: [['$', '$'], ['\\(', '\\)']],
                    displayMath: [['$$', '$$'], ['\\[', '\\]']],
                    processEscapes: true,
                    processEnvironments: true
                },
                svg: {
                    fontCache: 'global'
                },
                startup: {
                    pageReady: () => {
                        return MathJax.startup.defaultPageReady().then(() => {
                            console.log('MathJax is ready');
                        });
                    }
                }
            };
        }
    </script>
    <script id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    
    <style>
        :root {
            --chalkboard-bg: transparent;
            --chalk-text: #ecf0f1;
            --visualization-bg: #fdfdfd00;
            --primary-color: #3498db;
            --accent-color: #e67e22;
            --success-color: #2ecc71;
            --danger-color: #e74c3c;
            --warning-color: #f39c12;
            --info-color: #9b59b6;
            --text-color: #34495e;
            --heading-font: 'Noto Serif SC', serif;
            --handwriting-font: 'Noto Serif SC', serif;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        html, body {
            width: 100%;
            height: 100%;
            margin: 0;
            padding: 0;
        }

        body {
            font-family: var(--heading-font);
            background: #1a1a2e;
            overflow: hidden;
            height: 100vh;
            width: 100vw;
        }

        .blackboard {
            width: 100vw;
            height: 100vh;
            background: #1a1a2e;
            position: relative;
            border: 10px solid #795548;
            margin: 0;
        }

        /* è™šæ‹Ÿäººæ˜¾ç¤ºåŒºåŸŸ */
        .avatar-container {
            position: fixed;
            top: 60%; 
            left: 50%;
            transform: translate(-50%, -50%);
            width: 975px; 
            height: 1105px;
            overflow: hidden; 
            z-index: 50;
            pointer-events: none; 
            background: transparent;
        }
        
        .wrapper {
            width: 100%; 
            height: 100%;
            background: transparent; 
            pointer-events: auto;
        }

        .slide-container { 
            width: 100%; 
            height: 100%; 
            position: relative; 
        }
        
        .slide { 
            position: absolute; 
            top: 0; 
            left: 0; 
            width: 100%; 
            height: 100%; 
            opacity: 0; 
            visibility: hidden; 
            transition: opacity 0.6s ease-in-out; 
            display: flex; 
            justify-content: center; 
            align-items: center; 
            padding: 2rem; 
            background-color: transparent; 
        }
        
        .slide.active { 
            opacity: 1; 
            visibility: visible; 
        }
        
        .slide-content { 
            display: flex; 
            flex-direction: row; 
            gap: 2rem; 
            width: 100%; 
            width: 100%; 
            height: 95%; 
        }
        
        .blackboard-text {
            font-family: 'Noto Serif SC', serif;
            color: #e0e0e0;
            display: flex;
            flex-direction: column;
            justify-content: center;
            padding: 1.5rem;
        }
        
        .blackboard-text h1 { 
            color: #f1c40f; 
            text-shadow: 0 0 8px rgba(241, 196, 15, 0.5); 
        }
        
        .blackboard-text h2 { 
            color: #f1c40f; 
            border-bottom: 2px solid #f39c12;
            font-size: 22px;
            padding-bottom: 10px;
            margin-bottom: 20px;
        }
        
        .blackboard-text h3 { 
            color: #1abc9c;
            font-size: 20px;
            margin-top: 20px;
            margin-bottom: 10px;
        }
        
        .blackboard-text strong, .highlight { 
            color: #e74c3c; 
            font-weight: bold;
        }
        
        .blackboard-text .math-formula { 
            background-color: rgba(0,0,0,0.2); 
            padding: 15px; 
            border-radius: 5px; 
            border-left: 4px solid #f39c12; 
            font-size: 20px; 
            color: #1abc9c;
            text-align: center;
            margin: 15px 0;
            line-height: 1.5;
        }

        .formula-rule {
            font-size: 18px;
            color: #16a085;
            background: rgba(0,0,0,0.15);
            padding: 12px;
            border-radius: 5px;
            margin: 10px 0;
        }
        
        .animation-pane {
            position: relative;
            overflow: hidden;
            background: transparent;
        }

        /* å·¦ä¾§æ§åˆ¶æ  */
        .control-bar {
            position: fixed;
            left: -9999px;
            top: 50%;
            transform: translateY(-50%);
            width: 270px;
            height: auto;
            background: rgba(255, 255, 255, 0.15);
            backdrop-filter: blur(15px);
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            gap: 12px;
            z-index: 200;
            border-radius: 0 20px 20px 0;
            padding: 25px 20px;
            transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.2);
            border: 1px solid rgba(255, 255, 255, 0.2);
        }
        
        .control-bar:hover { 
            left: -9999px; 
            box-shadow: 0 12px 40px rgba(0,0,0,0.3); 
        }
        
        .control-bar::before {
            content: 'â–¶ï¸';
            position: absolute;
            top: 50%;
            right: -30px;
            transform: translateY(-50%);
            background: rgba(255, 255, 255, 0.2);
            backdrop-filter: blur(10px);
            padding: 12px 8px;
            border-radius: 0 15px 15px 0;
            font-size: 0.9rem;
            writing-mode: vertical-lr;
            border: 1px solid rgba(255, 255, 255, 0.1);
            color: #333;
        }
        
        .btn {
            padding: 14px 22px;
            background: rgba(255, 255, 255, 0.25);
            color: #333;
            border: 1px solid rgba(255, 255, 255, 0.3);
            border-radius: 12px;
            cursor: pointer;
            font-size: 14px;
            font-weight: 600;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            width: 100%;
            text-align: center;
            backdrop-filter: blur(5px);
            text-shadow: 0 1px 2px rgba(255,255,255,0.3);
        }
        
        .btn:hover { 
            background: rgba(255, 255, 255, 0.35); 
            transform: translateY(-3px); 
            box-shadow: 0 6px 20px rgba(0, 0, 0, 0.2); 
        }
        
        .btn.primary { 
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); 
            color: #fff; 
            text-shadow: 0 1px 2px rgba(0,0,0,0.3); 
        }
        
        .btn.primary:hover { 
            background: linear-gradient(135deg, #5a6fd8 0%, #6a4190 100%); 
            box-shadow: 0 8px 25px rgba(102,126,234,0.4); 
        }
        
        .btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
            transform: none;
        }

        /* å­—å¹•åŒºåŸŸ */
        .subtitle-area {
            position: absolute;
            bottom: 20px; 
            left: 50px; 
            right: 50px;
            height: auto;
            min-height: 50px;
            background: rgba(0,0,0,0.8);
            border-radius: 8px; 
            display: flex;
            align-items: center; 
            justify-content: center;
            z-index: 60; 
            color: white;
            font-size: 23px;
            text-align: center;
            padding: 15px 20px; 
            line-height: 1.4;
        }

        /* çŠ¶æ€æŒ‡ç¤ºå™¨ */
        .status-indicator {
            position: absolute;
            top: 10px; 
            right: 10px;
            padding: 5px 10px;
            background: rgba(0,0,0,0.5);
            color: white; 
            border-radius: 5px;
            font-size: 16px;
            z-index: 100;
            transition: opacity 0.3s ease;
            display: none;
        }
        
        .status-indicator.connected { 
            background: rgba(76, 175, 80, 0.8); 
            display: block;
        }
        
        .status-indicator.recording {
            background: rgba(244, 67, 54, 0.8);
            animation: pulse 1.5s infinite;
            display: block;
        }
        
        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }
        
        .status-indicator.error { 
            background: rgba(244, 67, 54, 0.8); 
            display: block;
        }
        
        .status-indicator.connecting { 
            background: rgba(255, 152, 0, 0.8); 
            display: block;
        }

        /* å½•åˆ¶æ¨¡å¼ä¸‹éšè—UIå…ƒç´  */
        .recording-mode .status-indicator {
            opacity: 0; 
            pointer-events: none;
        }
        
        .recording-mode .control-bar {
            left: -9999px; 
            transition: left 0.5s ease;
        }

        /* å¯¼èˆªæŒ‰é’® */
        .nav-btn { 
            background-color: rgba(255,255,255,0.1); 
            border: 1px solid rgba(255,255,255,0.2); 
            transition: all 0.3s ease; 
        }
        
        .nav-btn:hover { 
            background-color: rgba(255,255,255,0.2); 
            transform: translateY(-2px); 
        }
        
        .nav-btn:disabled { 
            opacity: 0.4; 
            cursor: not-allowed; 
        }

        .visualization {
            flex: 1;
            padding: 20px;
            display: flex;
            justify-content: center;
            align-items: center;
            overflow: hidden;
            background: linear-gradient(135deg, #f5f7fa 10%, #c3cfe2 100%);
            position: relative;
            box-sizing: border-box;
        }

        .visualization.full-width {
            background: linear-gradient(135deg, #0f0c29, #302b63, #24243e);
        }

        .visualization.white-bg {
            background: white;
        }

        .chalkboard {
            flex: 0 0 35%;
            background-color: transparent !important;
            background: transparent !important;
            color: var(--chalk-text);
            padding: 30px;
            display: flex;
            flex-direction: column;
            justify-content: center;
            border-right: 5px solid #bdc3c7;
            overflow-y: auto;
            box-sizing: border-box;
        }

        .chalkboard p, .chalkboard li {
            font-size: 18px;
            line-height: 1.7;
            margin-bottom: 15px;
        }

        .chalkboard ol {
            padding-left: 25px;
        }

        .chalkboard ul {
            list-style-type: 'â†’ ';
            padding-left: 20px;
        }

        /* å†å²é¡µé¢ç‰¹æ®Šæ ·å¼ */
        .main-title {
            position: absolute;
            top: 50px;
            left: 50%;
            transform: translateX(-50%);
            font-size: 36px;
            color: #ffd700;
            text-shadow: 0 0 20px rgba(255, 215, 0, 0.5);
            animation: glow 2s ease-in-out infinite alternate;
            z-index: 20;
        }

        @keyframes glow {
            from { text-shadow: 0 0 20px rgba(255, 215, 0, 0.5); }
            to { text-shadow: 0 0 30px rgba(255, 215, 0, 0.8), 0 0 40px rgba(255, 215, 0, 0.6); }
        }

        .clock-container {
            width: 600px;
            height: 600px;
            position: relative;
            margin: auto;
        }

        .event-marker {
            position: absolute;
            width: 120px;
            height: 120px;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            opacity: 0;
            transform: scale(0);
            transition: all 0.3s ease-out;
        }

        .event-marker.active {
            opacity: 1;
            transform: scale(1);
        }

        .event-icon {
            width: 70px;
            height: 70px;
            background: rgba(255, 255, 255, 0.1);
            border: 3px solid #ffd700;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 32px;
            margin-bottom: 12px;
            box-shadow: 0 0 20px rgba(255, 215, 0, 0.5);
        }

        .event-year {
            color: #ffd700;
            font-size: 16px;
            font-weight: bold;
        }

        .event-name {
            color: white;
            font-size: 14px;
            text-align: center;
            max-width: 140px;
        }

        .center-clock {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            width: 540px;
            height: 540px;
            border: 1px solid #ffd700;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 6px;
            color: #ffd700;
            background: rgba(0, 0, 0, 0);
            box-shadow: 0 0 50px rgba(255, 215, 0, 0.3);
        }

        .floating-quote {
            position: absolute;
            color: #ffd700;
            font-size: 18px;
            max-width: 350px;
            opacity: 0;
        }
    </style>
</head>
<body class="blackboard">

    <div id="statusIndicator" class="status-indicator">ç­‰å¾…è¿æ¥</div>
    
    <!-- è™šæ‹Ÿäººæ˜¾ç¤ºåŒºåŸŸ -->
    <div class="avatar-container">
        <div class="wrapper" id="avatarWrapper"></div>
    </div>

    <div id="slide-container" class="slide-container flex-grow">
        
        <!-- ç¬¬1é¡µï¼šå¯¹æ•°å†å²å‘å±• -->
        <div class="slide active">
            <div class="slide-content">
                <div class="visualization full-width" id="vis-log-history">
                    <div class="clock-container">
                        <!-- è½¨é“åœˆ -->
                        <div class="orbit" style="position: absolute; width: 550px; height: 550px; border: 1px dashed rgba(255, 255, 255, 0.1); border-radius: 50%; top: 50%; left: 50%; transform: translate(-50%, -50%);"></div>
                        <div class="orbit" style="position: absolute; width: 450px; height: 450px; border: 1px dashed rgba(255, 255, 255, 0.1); border-radius: 50%; top: 50%; left: 50%; transform: translate(-50%, -50%);"></div>
                        <div class="orbit" style="position: absolute; width: 350px; height: 350px; border: 1px dashed rgba(255, 255, 255, 0.1); border-radius: 50%; top: 50%; left: 50%; transform: translate(-50%, -50%);"></div>

                        <!-- ä¸­å¤®æ—¶é’Ÿ -->
                        <div class="center-clock pulse">
                            <span style="font-family: 'Times New Roman', serif;">âˆ</span>
                        </div>

                        <!-- äº‹ä»¶æ ‡è®° -->
                        <div class="event-marker" id="event1" style="top: 10px; left: 240px;">
                            <div class="event-icon">ğŸ“œ</div>
                            <div class="event-year">1614</div>
                            <div class="event-name">å¯¹æ•°è¯ç”Ÿ</div>
                        </div>

                        <div class="event-marker" id="event2" style="top: 80px; right: 10px;">
                            <div class="event-icon">ğŸ”­</div>
                            <div class="event-year">1619</div>
                            <div class="event-name">å¼€æ™®å‹’å®šå¾‹</div>
                        </div>

                        <div class="event-marker" id="event3" style="bottom: 100px; right: 20px;">
                            <div class="event-icon">âš“</div>
                            <div class="event-year">1620</div>
                            <div class="event-name">èˆªæµ·é©å‘½</div>
                        </div>

                        <div class="event-marker" id="event4" style="bottom: 120px; left: 20px;">
                            <div class="event-icon">ğŸ“</div>
                            <div class="event-year">1622</div>
                            <div class="event-name">è®¡ç®—å°ºå‘æ˜</div>
                        </div>

                        <div class="event-marker" id="event5" style="top: 120px; left: 10px;">
                            <div class="event-icon">ğŸš€</div>
                            <div class="event-year">1969</div>
                            <div class="event-name">äººç±»ç™»æœˆ</div>
                        </div>

                        <!-- æ¼‚æµ®å¼•è¨€ -->
                        <div class="floating-quote" id="quote1" style="top: 280px; right: -220px;">
                            "å¯¹æ•°çš„å‘æ˜ï¼Œè®©å¤©æ–‡å­¦å®¶çš„å¯¿å‘½å»¶é•¿äº†ä¸€å€"
                            <div style="text-align: right; font-size: 14px; margin-top: 12px;">- æ‹‰æ™®æ‹‰æ–¯</div>
                        </div>

                        <div class="floating-quote" id="quote2" style="bottom: 480px; left: -120px;">
                            "æ²¡æœ‰å¯¹æ•°è¡¨ï¼Œæˆ‘ä¸å¯èƒ½å®Œæˆè¡Œæ˜Ÿå®šå¾‹çš„è®¡ç®—"
                            <div style="text-align: right; font-size: 14px; margin-top: 12px;">- å¼€æ™®å‹’</div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- ç¬¬2é¡µï¼šå¯¹æ•°å®šä¹‰ -->
        <div class="slide">
            <div class="slide-content">
                <div class="chalkboard">
                    <h2>å¯¹æ•°</h2>
                    <p>å¯¹æ•°æ˜¯<strong>æŒ‡æ•°</strong>çš„é€†è¿ç®—ã€‚</p>
                    <p>å¦‚æœ $b^y = x$ï¼Œé‚£ä¹ˆ $\log_b(x) = y$</p>
                    <ul>
                        <li>$b$ æ˜¯åº•æ•°</li>
                        <li>$x$ æ˜¯çœŸæ•°</li>
                        <li>$y$ å°±æ˜¯ä»¥$b$ä¸ºåº•$x$çš„å¯¹æ•°</li>
                    </ul>
                    <p>å¯¹æ•° $y$ å›ç­”äº†ä¸€ä¸ªé—®é¢˜ï¼š"åº•æ•° $b$ éœ€è¦è‡ªèº«ç›¸ä¹˜å¤šå°‘æ¬¡æ‰èƒ½å¾—åˆ° $x$ï¼Ÿ"</p>
                    <p>å°†å¤æ‚çš„å¤§æ•°<strong>ä¹˜é™¤</strong>è¿ç®—ï¼Œè½¬åŒ–ä¸ºç®€å•çš„<strong>åŠ å‡</strong>è¿ç®—ã€‚</p>
                </div>
                <div class="visualization" id="vis-log-definition">
                    <svg id="animation2" width="100%" height="100%"></svg>
                </div>
            </div>
        </div>

        <!-- ç¬¬3é¡µï¼šå¯¹æ•°è¿ç®—æ³•åˆ™ -->
        <div class="slide">
            <div class="slide-content">
                <div class="visualization full-width white-bg" id="vis-log-operations">
                    <svg id="animation3" width="100%" height="100%"></svg>
                </div>
            </div>
        </div>

        <!-- ç¬¬4é¡µï¼šå¯¹æ•°æ€§è´¨ -->
        <div class="slide">
            <div class="slide-content">
                <div class="chalkboard">
                    <h3>ä¹˜ç§¯çš„å¯¹æ•°</h3>
                    <p>$\log_b(xy) = \log_b(x) + \log_b(y)$</p>
                    <p style="background: rgba(255,255,255,0.1); padding: 10px; border-radius: 5px;">
                        <strong>ä¾‹ï¼š</strong>$\log_2(8 \times 4) = \log_2(8) + \log_2(4) = 3 + 2 = 5$<br>
                        éªŒè¯ï¼š$2^5 = 32 = 8 \times 4$ âœ“
                    </p>

                    <h3>å•†çš„å¯¹æ•°</h3>
                    <p>$\log_b(\frac{x}{y}) = \log_b(x) - \log_b(y)$</p>
                    <p style="background: rgba(255,255,255,0.1); padding: 10px; border-radius: 5px;">
                        <strong>ä¾‹ï¼š</strong>$\log_2(\frac{16}{4}) = \log_2(16) - \log_2(4) = 4 - 2 = 2$<br>
                        éªŒè¯ï¼š$2^2 = 4 = \frac{16}{4}$ âœ“
                    </p>

                    <h3>å¹‚çš„å¯¹æ•°</h3>
                    <p>$\log_b(x^n) = n \cdot \log_b(x)$</p>
                    <p style="background: rgba(255,255,255,0.1); padding: 10px; border-radius: 5px;">
                        <strong>ä¾‹ï¼š</strong>$\log_2(8^3) = 3 \cdot \log_2(8) = 3 \times 3 = 9$<br>
                        éªŒè¯ï¼š$2^9 = 512 = 8^3$ âœ“
                    </p>

                    <h3>æ¢åº•å…¬å¼</h3>
                    <p>$\log_b(x) = \frac{\log_a(x)}{\log_a(b)}$</p>
                </div>
                <div class="visualization" id="vis-log-properties"></div>
            </div>
        </div>

        <!-- ç¬¬5é¡µï¼šå¸¸ç”¨å¯¹æ•°ç³»ç»Ÿ -->
        <div class="slide">
            <div class="slide-content">
                <div class="chalkboard">
                    <h3>å¸¸ç”¨å¯¹æ•°ç³»ç»Ÿ</h3>
                    <div style="margin: 20px 0;">
                        <h3 style="color: #e74c3c;">å¸¸ç”¨å¯¹æ•°ï¼ˆlgï¼‰</h3>
                        <p>ä»¥10ä¸ºåº•çš„å¯¹æ•°ï¼š$\lg(x) = \log_{10}(x)$</p>
                        <ul>
                            <li>$\lg(10) = 1$</li>
                            <li>$\lg(100) = 2$</li>
                            <li>$\lg(1000) = 3$</li>
                        </ul>
                    </div>
                    <div style="margin: 20px 0;">
                        <h3 style="color: #27ae60;">è‡ªç„¶å¯¹æ•°ï¼ˆlnï¼‰</h3>
                        <p>ä»¥$e$ä¸ºåº•çš„å¯¹æ•°ï¼š$\ln(x) = \log_e(x)$</p>
                        <p>å…¶ä¸­ $e \approx 2.718...$ï¼ˆæ¬§æ‹‰æ•°ï¼‰</p>
                        <ul>
                            <li>$\ln(e) = 1$</li>
                            <li>$\ln(e^2) = 2$</li>
                            <li>$\ln(1) = 0$</li>
                        </ul>
                    </div>
                </div>
                 <div class="visualization" id="vis-common-logs">
                      <svg id="animation5" width="100%" height="100%"></svg>
                </div>
            </div>
        </div>

    </div>

    <!-- å­—å¹•åŒºåŸŸ -->
    <div class="subtitle-area" id="subtitleArea">
        æ¬¢è¿å­¦ä¹ å¯¹æ•°å‡½æ•°ï¼ç‚¹å‡»å¼€å§‹è®²è¯¾å¯å¯åŠ¨è™šæ‹Ÿäººè®²å¸ˆã€‚
    </div>

    <!-- å·¦ä¾§æ§åˆ¶æ  -->
    <div class="control-bar">
        <div style="color: white; margin-bottom: 1rem; text-align: center; font-size: 16px; font-weight: bold;">
            ç¬¬ <span id="currentSlide">1</span> é¡µ / å…± <span id="totalSlides">5</span> é¡µ
        </div>
        <button class="btn" onclick="previousSlide()">â¬…ï¸ ä¸Šä¸€é¡µ</button>
        <button class="btn primary" onclick="startTeaching()" id="startBtn">ğŸ¤ å¼€å§‹è®²è¯¾</button>
        <button class="btn" onclick="nextSlide()">ä¸‹ä¸€é¡µ â¡ï¸</button>
        <button class="btn" onclick="restart()">ğŸ”„ é‡æ–°å¼€å§‹</button>
        <button class="btn" onclick="startAutoPlay()" id="autoPlayBtn" style="background: linear-gradient(135deg, #2196f3, #1976d2);">ğŸ¬ è‡ªåŠ¨æ’­æ”¾</button>
        <div style="color: #ffab40; margin-top: 0.5rem; text-align: center; font-size: 16px; font-weight: bold; line-height: 1.2;">
            ğŸ’¡ å½•åˆ¶æç¤ºï¼š<br>
            ç‚¹å‡»è‡ªåŠ¨æ’­æ”¾åç«‹å³å¼€å§‹å½•å±<br>
            ç³»ç»Ÿä¼šè‡ªåŠ¨å®Œæˆå…¨éƒ¨æ¼”ç¤º
        </div>
        <div style="color: #ccc; margin-top: 1rem; text-align: center; font-size: 16px; font-weight: bold;">
            ğŸ’¡ å¿«æ·é”®ï¼šç©ºæ ¼/â†’ä¸‹ä¸€é¡µ â†ä¸Šä¸€é¡µ Enteræ’­æ”¾
        </div>
    </div>

    <!-- è®¯é£å®˜æ–¹SDK -->
    <script type="module">
        // æ’­æ”¾å®Œæˆæ ‡è®°ï¼ˆä¾›OBSæ£€æµ‹ï¼‰
        window.playbackFinished = false;

        try {
            const { default: AvatarPlatform, SDKEvents, PlayerEvents, RecorderEvents, UserMedia } = await import('./avatar-sdk-web_3.1.2.1002/index.js');

            window.AvatarPlatform = AvatarPlatform;
            window.SDKEvents = SDKEvents;
            window.PlayerEvents = PlayerEvents;
            window.RecorderEvents = RecorderEvents;
            window.UserMedia = UserMedia;

            console.log('âœ… è®¯é£å®˜æ–¹SDKæ¨¡å—å·²åŠ è½½');
            console.log('SDKç‰ˆæœ¬:', AvatarPlatform.getVersion());

        } catch (error) {
            console.error('âŒ SDKæ¨¡å—åŠ è½½å¤±è´¥:', error);
        }

        window.dispatchEvent(new CustomEvent('sdkReady'));
    </script>

    <script>
        // === è™šæ‹Ÿäººç›¸å…³é…ç½® ===
        let avatarPlatform = null;
        let isConnected = false;
        let isTeaching = false;
        let currentSlide = 0;
        let isAutoPlaying = false;
        const totalSlides = 5;

        // === è‡ªåŠ¨æ’­æ”¾æ—¶é—´è®¾ç½® ===
        const getSlideDuration = (slideNum) => {
            const durations = {
                1: 28000,  // ç¬¬ä¸€é¡µï¼šå¯¹æ•°å†å²ï¼ˆå±•ç¤ºæ—¶é—´è¾ƒé•¿ï¼‰
                2: 32000,  // ç¬¬äºŒé¡µï¼šå¯¹æ•°å®šä¹‰
                3: 35000,  // ç¬¬ä¸‰é¡µï¼šå¯¹æ•°è¿ç®—æ³•åˆ™ï¼ˆåŠ¨ç”»è¾ƒå¤šï¼‰
                4: 30000,  // ç¬¬å››é¡µï¼šå¯¹æ•°æ€§è´¨
                5: 28000   // ç¬¬äº”é¡µï¼šå¸¸ç”¨å¯¹æ•°ç³»ç»Ÿ
            };
            return durations[slideNum] || 20000;
        };

        // === å­—å¹•è„šæœ¬è®¾ç½® ===
        const subtitleScript = {
            // ç¬¬ä¸€é¡µï¼šå¯¹æ•°å†å²
            1: `1614å¹´ï¼Œè‹æ ¼å…°æ•°å­¦å®¶çº³çš®å°”å‘æ˜äº†å¯¹æ•°ï¼Œè¿™æ˜¯æ•°å­¦å²ä¸Šçš„é‡å¤§çªç ´ã€‚å¯¹æ•°çš„å‡ºç°ï¼Œå°†å¤æ‚çš„ä¹˜é™¤è¿ç®—è½¬åŒ–ä¸ºç®€å•çš„åŠ å‡è¿ç®—ï¼Œæå¤§åœ°æ¨åŠ¨äº†ç§‘å­¦çš„å‘å±•ã€‚å¼€æ™®å‹’åˆ©ç”¨å¯¹æ•°å®Œæˆäº†è¡Œæ˜Ÿè¿åŠ¨å®šå¾‹çš„è®¡ç®—ï¼Œèˆªæµ·å®¶ä»¬ä½¿ç”¨å¯¹æ•°è¡¨è¿›è¡Œç²¾ç¡®å¯¼èˆªã€‚æ‹‰æ™®æ‹‰æ–¯æ›¾è¯´ï¼š"å¯¹æ•°çš„å‘æ˜ï¼Œè®©å¤©æ–‡å­¦å®¶çš„å¯¿å‘½å»¶é•¿äº†ä¸€å€"ã€‚ä»17ä¸–çºªçš„è®¡ç®—å°ºåˆ°20ä¸–çºªçš„ç™»æœˆå·¥ç¨‹ï¼Œå¯¹æ•°ä¸€ç›´åœ¨äººç±»æ–‡æ˜è¿›æ­¥ä¸­æ‰®æ¼”ç€é‡è¦è§’è‰²ã€‚`,

            // ç¬¬äºŒé¡µï¼šå¯¹æ•°å®šä¹‰è®²è§£
            2: `ç°åœ¨æˆ‘ä»¬æ¥ç†è§£å¯¹æ•°çš„æœ¬è´¨ã€‚å¯¹æ•°æ˜¯æŒ‡æ•°çš„é€†è¿ç®—ã€‚å¦‚æœbçš„yæ¬¡æ–¹ç­‰äºxï¼Œé‚£ä¹ˆä»¥bä¸ºåº•xçš„å¯¹æ•°å°±ç­‰äºyã€‚æ¯”å¦‚ï¼Œ2çš„3æ¬¡æ–¹ç­‰äº8ï¼Œé‚£ä¹ˆä»¥2ä¸ºåº•8çš„å¯¹æ•°å°±æ˜¯3ã€‚å¯¹æ•°å›ç­”äº†ä¸€ä¸ªé‡è¦é—®é¢˜ï¼šåº•æ•°éœ€è¦è‡ªä¹˜å¤šå°‘æ¬¡æ‰èƒ½å¾—åˆ°çœŸæ•°ï¼Ÿå³è¾¹çš„åŠ¨ç”»å±•ç¤ºäº†æŒ‡æ•°è¿‡ç¨‹å’Œå¯¹æ•°è¿‡ç¨‹çš„å…³ç³»ã€‚å¯¹æ•°æœ€ä¼Ÿå¤§çš„è´¡çŒ®æ˜¯å°†ä¹˜é™¤è¿ç®—è½¬åŒ–ä¸ºåŠ å‡è¿ç®—ï¼Œè¿™åœ¨æ²¡æœ‰è®¡ç®—å™¨çš„æ—¶ä»£å…·æœ‰é©å‘½æ€§æ„ä¹‰ã€‚`,

            // ç¬¬ä¸‰é¡µï¼šå¯¹æ•°è¿ç®—æ³•åˆ™è®²è§£
            3: `å¯¹æ•°è¿ç®—æœ‰ç€ä¼˜ç¾çš„æ³•åˆ™ã€‚è§‚å¯Ÿå³è¾¹çš„åŠ¨ç”»ï¼Œæˆ‘ä»¬å¯ä»¥çœ‹åˆ°å¯¹æ•°ä¸–ç•Œå’ŒæŒ‡æ•°ä¸–ç•Œçš„å¯¹åº”å…³ç³»ã€‚åœ¨æŒ‡æ•°ä¸–ç•Œä¸­çš„ä¹˜æ³•ï¼Œå¯¹åº”åˆ°å¯¹æ•°ä¸–ç•Œå°±å˜æˆäº†åŠ æ³•ã€‚åŒæ ·ï¼ŒæŒ‡æ•°ä¸–ç•Œçš„é™¤æ³•å˜æˆå¯¹æ•°ä¸–ç•Œçš„å‡æ³•ï¼ŒæŒ‡æ•°ä¸–ç•Œçš„å¹‚è¿ç®—å˜æˆå¯¹æ•°ä¸–ç•Œçš„ä¹˜æ³•ã€‚è¿™ç§è½¬æ¢è®©å¤æ‚çš„å¤§æ•°è¿ç®—å˜å¾—ç®€å•ã€‚æ¯”å¦‚è¦è®¡ç®—256ä¹˜ä»¥512ï¼Œåœ¨å¯¹æ•°ä¸–ç•Œä¸­åªéœ€è¦è®¡ç®—8åŠ 9ç­‰äº17ï¼Œç„¶ååæŸ¥å¾—åˆ°ç»“æœã€‚è¿™å°±æ˜¯å¯¹æ•°è¡¨åœ¨å†å²ä¸Šå¦‚æ­¤é‡è¦çš„åŸå› ã€‚`,

            // ç¬¬å››é¡µï¼šå¯¹æ•°æ€§è´¨è®²è§£
            4: `è®©æˆ‘ä»¬æ·±å…¥å­¦ä¹ å¯¹æ•°çš„è¿ç®—æ€§è´¨ã€‚ç¬¬ä¸€ä¸ªæ˜¯ä¹˜ç§¯çš„å¯¹æ•°ç­‰äºå¯¹æ•°çš„å’Œã€‚æ¯”å¦‚log2(8Ã—4)ç­‰äºlog2(8)åŠ log2(4)ï¼Œå³3åŠ 2ç­‰äº5ã€‚ç¬¬äºŒä¸ªæ˜¯å•†çš„å¯¹æ•°ç­‰äºå¯¹æ•°çš„å·®ã€‚ç¬¬ä¸‰ä¸ªæ˜¯å¹‚çš„å¯¹æ•°ç­‰äºæŒ‡æ•°ä¹˜ä»¥å¯¹æ•°ã€‚è¿™äº›æ€§è´¨ä¸æ˜¯å‡­ç©ºè€Œæ¥çš„ï¼Œå®ƒä»¬åæ˜ äº†æŒ‡æ•°è¿ç®—çš„æœ¬è´¨è§„å¾‹ã€‚æœ€åè¿˜æœ‰æ¢åº•å…¬å¼ï¼Œå®ƒè®©æˆ‘ä»¬èƒ½å¤Ÿåœ¨ä¸åŒåº•æ•°çš„å¯¹æ•°ä¹‹é—´è‡ªç”±è½¬æ¢ã€‚æŒæ¡è¿™äº›æ€§è´¨ï¼Œä½ å°±æŒæ¡äº†å¯¹æ•°è¿ç®—çš„ç²¾é«“ã€‚`,

            // ç¬¬äº”é¡µï¼šå¸¸ç”¨å¯¹æ•°ç³»ç»Ÿè®²è§£
            5: `æ•°å­¦ä¸­æœ‰ä¸¤ä¸ªæœ€é‡è¦çš„å¯¹æ•°ç³»ç»Ÿã€‚ç¬¬ä¸€ä¸ªæ˜¯å¸¸ç”¨å¯¹æ•°ï¼Œä»¥10ä¸ºåº•ï¼Œè®°ä½œlgã€‚å®ƒåœ¨ç§‘å­¦è®¡ç®—ä¸­åº”ç”¨å¹¿æ³›ï¼Œå› ä¸ºæˆ‘ä»¬çš„æ•°å­—ç³»ç»Ÿæ˜¯åè¿›åˆ¶çš„ã€‚lg(10)=1ï¼Œlg(100)=2ï¼Œlg(1000)=3ï¼Œéå¸¸ç›´è§‚ã€‚ç¬¬äºŒä¸ªæ˜¯è‡ªç„¶å¯¹æ•°ï¼Œä»¥eä¸ºåº•ï¼Œè®°ä½œlnã€‚eçº¦ç­‰äº2.718ï¼Œæ˜¯ä¸€ä¸ªç¥å¥‡çš„å¸¸æ•°ï¼Œåœ¨å¾®ç§¯åˆ†ã€å¤åˆ©è®¡ç®—ã€è‡ªç„¶å¢é•¿ç­‰é¢†åŸŸæ— å¤„ä¸åœ¨ã€‚å³è¾¹çš„å›¾åƒå±•ç¤ºäº†è¿™ä¸¤ä¸ªå‡½æ•°çš„æ›²çº¿ï¼Œå®ƒä»¬éƒ½ç»è¿‡ç‚¹(1,0)ï¼Œä½†å¢é•¿é€Ÿåº¦ä¸åŒã€‚æŒæ¡è¿™ä¸¤ä¸ªå¯¹æ•°ç³»ç»Ÿï¼Œå¯¹åç»­çš„æ•°å­¦å­¦ä¹ è‡³å…³é‡è¦ã€‚`
        };

        // æ›´æ–°å¹»ç¯ç‰‡ä¿¡æ¯
        function updateSlideInfo() {
            document.getElementById('currentSlide').textContent = currentSlide + 1;
            document.getElementById('totalSlides').textContent = totalSlides;
        }

        // æ˜¾ç¤ºæŒ‡å®šçš„å¹»ç¯ç‰‡
        function showSlide(index) {
            const slides = document.querySelectorAll('.slide');
            slides.forEach((slide, i) => {
                slide.classList.toggle('active', i === index);
            });
            
            // è¿è¡Œå¯¹åº”çš„å¯è§†åŒ–
            runVisualization(index);
            
            // æ¸²æŸ“æ•°å­¦å…¬å¼
            if (window.MathJax && window.MathJax.typesetPromise) {
                setTimeout(() => {
                    window.MathJax.typesetPromise([slides[index]]).catch((err) => console.log(err.message));
                }, 50);
            }
        }

        // ä¸‹ä¸€é¡µ
        function nextSlide() {
            if (currentSlide < totalSlides - 1) {
                currentSlide++;
                showSlide(currentSlide);
                updateSlideInfo();
                if (!isAutoPlaying) {
                    speakContent(currentSlide + 1);
                }
            }
        }

        // ä¸Šä¸€é¡µ
        function previousSlide() {
            if (currentSlide > 0) {
                currentSlide--;
                showSlide(currentSlide);
                updateSlideInfo();
                if (!isAutoPlaying) {
                    speakContent(currentSlide + 1);
                }
            }
        }

        // é‡æ–°å¼€å§‹
        function restart() {
            currentSlide = 0;
            showSlide(0);
            updateSlideInfo();
            if (!isAutoPlaying) {
                speakContent(1);
            }
        }

        // è™šæ‹Ÿäººç›¸å…³å‡½æ•°
        function updateStatus(message, type = 'normal') {
            const indicator = document.getElementById('statusIndicator');
            if (indicator) {
                indicator.textContent = message;
                indicator.className = 'status-indicator';
                if (type === 'connected') {
                    indicator.classList.add('connected');
                } else if (type === 'error') {
                    indicator.classList.add('error');
                } else if (type === 'connecting') {
                    indicator.classList.add('connecting');
                } else if (type === 'recording') {
                    indicator.classList.add('recording');
                }
            }
        }

        function waitForSDK() {
            return new Promise((resolve, reject) => {
                if (typeof AvatarPlatform !== 'undefined') {
                    resolve();
                    return;
                }
                
                const timeout = setTimeout(() => {
                    reject(new Error('SDKåŠ è½½è¶…æ—¶ï¼Œè¯·åˆ·æ–°é¡µé¢é‡è¯•'));
                }, 10000);
                
                window.addEventListener('sdkReady', function handler() {
                    clearTimeout(timeout);
                    window.removeEventListener('sdkReady', handler);
                    resolve();
                });
            });
        }

        async function startTeaching() {
            const startBtn = document.getElementById('startBtn');
            startBtn.textContent = 'ğŸ”„ å¯åŠ¨ä¸­...';
            startBtn.disabled = true;

            try {
                console.log('â³ ç­‰å¾…SDKæ¨¡å—åŠ è½½...');
                updateStatus('ç­‰å¾…SDKåŠ è½½...', 'connecting');
                await waitForSDK();
                
                console.log('âœ… è®¯é£å®˜æ–¹SDKå·²åŠ è½½');
                updateStatus('SDKå·²åŠ è½½', 'connecting');
                
                if(avatarPlatform) {
                    avatarPlatform.destroy();
                }

                avatarPlatform = new AvatarPlatform({
                    useInlinePlayer: true
                });

                avatarPlatform
                    .on('connected', (initResp) => {
                        console.log('ğŸ‰ è™šæ‹Ÿäººè¿æ¥æˆåŠŸï¼', initResp);
                        isConnected = true;
                        isTeaching = true;
                        updateStatus('å·²è¿æ¥', 'connected');
                        startBtn.textContent = 'ğŸ’– è™šæ‹Ÿäººå·²å°±ç»ª';
                        
                        setTimeout(() => {
                            speakContent(currentSlide + 1);
                        }, 1000);
                    })
                    .on('disconnected', (err) => {
                        console.log('ğŸ”Œ è™šæ‹Ÿäººè¿æ¥æ–­å¼€');
                        isConnected = false;
                        updateStatus('è¿æ¥æ–­å¼€', 'error');
                        if (err) {
                            console.error('âŒ è¿æ¥å¼‚å¸¸æ–­å¼€:', err);
                        }
                    })
                    .on('error', (error) => {
                        console.error('âŒ è™šæ‹Ÿäººé”™è¯¯:', error);
                        updateStatus('é”™è¯¯: ' + error.message, 'error');
                        startBtn.textContent = 'âŒ è¿æ¥å¤±è´¥';
                        startBtn.disabled = false;
                        isTeaching = false;
                    })
                    .on('frame_stop', (data) => {
                        console.log('âœ… è™šæ‹Ÿäººè®²è§£å®Œæˆ frame_stop:', data);
                        if (isAutoPlaying && currentSlide < totalSlides - 1) {
                            console.log(`ğŸ¬ è‡ªåŠ¨æ’­æ”¾: ç¬¬${currentSlide+1}é¡µè®²è§£å®Œæˆï¼Œå‡†å¤‡ç¿»é¡µåˆ°ç¬¬${currentSlide+2}é¡µ`);
                            setTimeout(() => {
                                if (isAutoPlaying) {
                                    currentSlide++;
                                    showSlide(currentSlide);
                                    updateSlideInfo();
                                    setTimeout(() => {
                                        if (isAutoPlaying) {
                                            speakContent(currentSlide + 1);
                                        }
                                    }, 800);
                                }
                            }, 1500);
                        }
                    });

                avatarPlatform.setApiInfo({
                    appId: 'e8c180ed',                                    // æ•°å­¦è®²è§£ AppID
                    apiKey: 'e0c44f0e2ef0f47582ffa7e864da0d9b',             // æ•°å­¦è®²è§£ APIå¯†é’¥
                    apiSecret: 'MDZkNDNiZWU4NDkzNWM5MDQzMTY4N2Nh',       // æ•°å­¦è®²è§£ APIå¯†é’¥
                    sceneId: '237415046114840576',                       // æ•°å­¦è®²è§£ åœºæ™¯ID
                    serverUrl: 'wss://avatar.cn-huadong-1.xf-yun.com/v1/interact'
                });

                avatarPlatform.setGlobalParams({
                    stream: {
                        protocol: 'xrtc',
                        alpha: 1,
                        bitrate: 1000000,
                        fps: 25
                    },
                    avatar: {
                        avatar_id: '110332017',    
                        width: 1920,
                        height: 1080,
                        scale: 1,
                        move_h: 0,
                        move_v: 0,
                        audio_format: 1
                    },
                    tts: {
                        vcn: 'x4_yiting',         
                        speed: 50,
                        pitch: 50,
                        volume: 100
                    },
                    avatar_dispatch: {
                        interactive_mode: 1,
                        content_analysis: 0
                    }
                });

                await avatarPlatform.start({
                    wrapper: document.getElementById('avatarWrapper')
                });

                console.log('ğŸ“ è™šæ‹Ÿäººæ•™å­¦ç³»ç»Ÿå¯åŠ¨å®Œæˆ');

            } catch (error) {
                console.error('âŒ å¯åŠ¨å¤±è´¥:', error);
                updateStatus('å¯åŠ¨å¤±è´¥', 'error');
                startBtn.textContent = 'ğŸ”„ é‡è¯•';
                startBtn.disabled = false;
                alert(`å¯åŠ¨å¤±è´¥ï¼š${error.message}\n\nè¯·æ£€æŸ¥æ§åˆ¶å°è·å–è¯¦ç»†é”™è¯¯ä¿¡æ¯ã€‚`);
            }
        }

        // === è™šæ‹ŸäººåŠ¨ä½œé…ç½® ===
        function getActionsForPage(slideNum) {
            const actionMap = {
                // ç¬¬ä¸€é¡µåŠ¨ä½œï¼šæ¬¢è¿å§¿åŠ¿ï¼Œä»‹ç»å†å²
                1: [{ type: 'action', value: 'A_RLH_welcome_O', wb: 2, we: 10 }],

                // ç¬¬äºŒé¡µåŠ¨ä½œï¼šå¾€å³å¼ºè°ƒï¼Œä»‹ç»å¯¹æ•°å®šä¹‰
                2: [{ type: 'action', value: 'A_RLH_emphasize_O', wb: 2, we: 8 }],

                // ç¬¬ä¸‰é¡µåŠ¨ä½œï¼šå·¦æ‰‹å¾€å³å¼•å¯¼ï¼Œè®²è§£è¿ç®—æ³•åˆ™åŠ¨ç”»
                3: [{ type: 'action', value: 'A_LH_please_O', wb: 2, we: 8 }],

                // ç¬¬å››é¡µåŠ¨ä½œï¼šå·¦æ‰‹ä»‹ç»ï¼Œè®²è§£å¯¹æ•°æ€§è´¨
                4: [{ type: 'action', value: 'A_LH_introduced_O', wb: 2, we: 8 }],

                // ç¬¬äº”é¡µåŠ¨ä½œï¼šå¾€å³å¼ºè°ƒï¼Œæ€»ç»“å¯¹æ•°ç³»ç»Ÿ
                5: [{ type: 'action', value: 'A_RLH_emphasize_O', wb: 2, we: 8 }]
            };
            return actionMap[slideNum] || [{ type: 'action', value: 'A_U_No_pointing_O', wb: 2, we: 5 }];
        }

        async function performVirtualAction(actionId) {
            if (!isTeaching || !isConnected || !avatarPlatform) {
                console.log('âš ï¸ è™šæ‹Ÿäººæœªè¿æ¥ï¼Œè·³è¿‡åŠ¨ä½œæ‰§è¡Œ');
                return;
            }

            try {
                await avatarPlatform.writeCmd("action", actionId);
                console.log(`âœ… æ‰§è¡ŒåŠ¨ä½œ: ${actionId}`);
            } catch (error) {
                console.error(`âŒ åŠ¨ä½œæ‰§è¡Œå¤±è´¥ (${actionId}):`, error);
            }
        }

        async function speakContent(slideNum) {
            if (!isTeaching || !isConnected || !avatarPlatform) {
                console.log('âš ï¸ è™šæ‹Ÿäººæœªè¿æ¥æˆ–æœªå¼€å§‹æ•™å­¦ï¼Œè·³è¿‡è¯­éŸ³æ’­æŠ¥');
                return;
            }

            const content = subtitleScript[slideNum];
            if (!content) return;

            try {
                const actions = getActionsForPage(slideNum);
                if (actions && actions[0]) {
                    await performVirtualAction(actions[0].value);
                }

                await avatarPlatform.writeText(content, {
                    nlp: false
                });
                
                console.log(`âœ… æ­£åœ¨è®²è§£ç¬¬${slideNum}é¡µ`);

                if (isAutoPlaying) {
                    updateAutoPlaySubtitle(slideNum, content);
                } else {
                    updateSubtitle(content);
                }
            } catch (error) {
                console.error('âŒ è™šæ‹Ÿäººè®²è§£å¤±è´¥:', error);
            }
        }

        function updateSubtitle(text) {
            const subtitleArea = document.getElementById('subtitleArea');
            if (subtitleArea) {
                subtitleArea.textContent = text;
            }
        }

        function updateAutoPlaySubtitle(slideNum, text) {
            const subtitleArea = document.getElementById('subtitleArea');
            if (subtitleArea && isAutoPlaying) {
                const prefix = `ã€ç¬¬${slideNum}é¡µ/${totalSlides}é¡µã€‘`;
                subtitleArea.textContent = prefix + text;
            } else if (subtitleArea) {
                subtitleArea.textContent = text;
            }
        }

        function getSlideTitle(slideNum) {
            const titles = {
                1: "å¯¹æ•°çš„å†å²å‘å±•",
                2: "å¯¹æ•°çš„å®šä¹‰",
                3: "å¯¹æ•°è¿ç®—æ³•åˆ™",
                4: "å¯¹æ•°çš„æ€§è´¨",
                5: "å¸¸ç”¨å¯¹æ•°ç³»ç»Ÿ"
            };
            return titles[slideNum] || `ç¬¬${slideNum}é¡µ`;
        }

        function switchToSlideSilent(slideNum) {
            if (slideNum < 1 || slideNum > totalSlides) {
                console.log(`âŒ é¡µé¢åˆ‡æ¢å¤±è´¥ï¼šé¡µç ${slideNum}è¶…å‡ºèŒƒå›´(1-${totalSlides})`);
                return;
            }
            showSlide(slideNum - 1);
            console.log(`âœ… æˆåŠŸåˆ‡æ¢åˆ°ç¬¬${slideNum}é¡µ`);
        }

        async function startAutoPlay() {
            if (isAutoPlaying) {
                stopAutoPlay();
                return;
            }

            try {
                console.log('ğŸ¬ å¼€å§‹è‡ªåŠ¨æ’­æ”¾å®Œæ•´è¯¾ç¨‹...');
                isAutoPlaying = true;

                const autoPlayBtn = document.getElementById('autoPlayBtn');
                autoPlayBtn.textContent = 'â¹ï¸ åœæ­¢æ’­æ”¾';
                autoPlayBtn.style.background = 'linear-gradient(135deg, #f44336, #d32f2f)';

                updateStatus(`ğŸ¬ è‡ªåŠ¨æ’­æ”¾å°†åœ¨ 1 ç§’åå¼€å§‹ï¼Œè¯·å‡†å¤‡å½•å±ï¼`, 'recording');
                await new Promise(resolve => setTimeout(resolve, 1000));

                updateStatus('ğŸ¬ è‡ªåŠ¨æ’­æ”¾å¼€å§‹ï¼', 'recording');
                document.body.classList.add('recording-mode');

                if (!isConnected) {
                    console.log('ğŸ¬ åå°å°è¯•è¿æ¥è™šæ‹Ÿäºº...');
                    startTeaching().catch(error => {
                        console.log('âš ï¸ è™šæ‹Ÿäººè¿æ¥å¤±è´¥ï¼Œç»§ç»­é¡µé¢æ’­æ”¾:', error);
                    });
                }

                for (let slide = 1; slide <= totalSlides; slide++) {
                    try {
                        if (!isAutoPlaying) {
                            console.log('ğŸ›‘ è‡ªåŠ¨æ’­æ”¾è¢«åœæ­¢');
                            break;
                        }

                        console.log(`\nğŸ¬ === å¼€å§‹æ’­æ”¾ç¬¬${slide}é¡µ/${totalSlides}é¡µ ===`);
                        switchToSlideSilent(slide);
                        updateStatus(`ğŸ“– ç¬¬${slide}é¡µ/${totalSlides}é¡µ - ${getSlideTitle(slide)}`, 'recording');

                        await new Promise(resolve => setTimeout(resolve, 800));

                        if (isConnected && isTeaching && avatarPlatform) {
                            try {
                                await speakContent(slide);
                                const slideTime = getSlideDuration(slide);
                                await new Promise(resolve => setTimeout(resolve, slideTime));
                            } catch (error) {
                                console.error(`âŒ ç¬¬${slide}é¡µè¯­éŸ³æ’­æ”¾å¤±è´¥:`, error);
                                const slideTime = getSlideDuration(slide);
                                await new Promise(resolve => setTimeout(resolve, slideTime));
                            }
                        } else {
                            const slideTime = getSlideDuration(slide);
                            await new Promise(resolve => setTimeout(resolve, slideTime));
                        }

                        const waitTime = slide === totalSlides ? 2000 : 1000;
                        await new Promise(resolve => setTimeout(resolve, waitTime));

                    } catch (error) {
                        console.error(`âŒ ç¬¬${slide}é¡µæ’­æ”¾è¿‡ç¨‹å‡ºé”™:`, error);
                        await new Promise(resolve => setTimeout(resolve, 2000));
                    }
                }

                if (isAutoPlaying) {
                    await new Promise(resolve => setTimeout(resolve, 3000));
                    stopAutoPlay();
                }

            } catch (error) {
                console.error('âŒ è‡ªåŠ¨æ’­æ”¾å¤±è´¥:', error);
                updateStatus('è‡ªåŠ¨æ’­æ”¾å¤±è´¥: ' + error.message, 'error');
                stopAutoPlay();
            }
        }

        function stopAutoPlay() {
            if (isAutoPlaying) {
                isAutoPlaying = false;
                window.playbackFinished = true;
                document.title = "PLAYBACK_FINISHED";
                console.log('ğŸ‰ æ’­æ”¾å®Œæˆï¼å·²ä¿®æ”¹æ ‡é¢˜ä¸º PLAYBACK_FINISHED');
                document.body.classList.remove('recording-mode');

                const autoPlayBtn = document.getElementById('autoPlayBtn');
                autoPlayBtn.textContent = 'ğŸ¬ è‡ªåŠ¨æ’­æ”¾';
                autoPlayBtn.style.background = 'linear-gradient(135deg, #2196f3, #1976d2)';

                console.log('â¹ï¸ è‡ªåŠ¨æ’­æ”¾å·²åœæ­¢');
                updateStatus('è‡ªåŠ¨æ’­æ”¾å·²åœæ­¢', 'normal');
            }
        }

        // é”®ç›˜æ§åˆ¶
        document.addEventListener('keydown', function(e) {
            switch(e.key) {
                case 'ArrowRight':
                case ' ':
                    e.preventDefault();
                    nextSlide();
                    break;
                case 'ArrowLeft':
                    e.preventDefault();
                    previousSlide();
                    break;
                case 'Enter':
                    e.preventDefault();
                    handleEnterKey();
                    break;
            }
        });

        function handleEnterKey() {
            if (!isTeaching) {
                startTeaching();
            } else if (isConnected) {
                speakContent(currentSlide + 1);
                console.log('ğŸµ Enteré”®è§¦å‘ï¼šé‡æ–°æ’­æ”¾å½“å‰é¡µå†…å®¹');
            } else {
                console.log('âš ï¸ è™šæ‹Ÿäººæœªè¿æ¥ï¼Œæ— æ³•æ’­æ”¾');
            }
        }

        window.addEventListener('beforeunload', function() {
            if (isAutoPlaying) {
                stopAutoPlay();
            }
            
            if (avatarPlatform && isConnected) {
                avatarPlatform.stop();
            }
        });

        // è¿è¡Œå¯è§†åŒ–å‡½æ•°
        function runVisualization(slideIndex) {
            switch (slideIndex) {
                case 0: visualizeLogHistory('vis-log-history'); break;
                case 1: visualizeLogDefinition('vis-log-definition'); break;
                case 2: visualizeLogOperations('vis-log-operations'); break;
                case 3: visualizeLogProperties('vis-log-properties'); break;
                case 4: visualizeCommonLogs('vis-common-logs'); break;
            }
        }

        // --- å¯è§†åŒ–å‡½æ•°å®ç°ï¼ˆä»åŸä»£æ•°é¡µé¢å¤åˆ¶ï¼‰ ---
        
        // å¯¹æ•°å†å²å¯è§†åŒ–
        function visualizeLogHistory(containerId) {
            function createStars() {
                const container = document.getElementById('vis-log-history');
                if (!container) return;
                container.querySelectorAll('.star').forEach(star => star.remove());
                for (let i = 0; i < 40; i++) {
                    const star = document.createElement('div');
                    star.className = 'star';
                    star.style.position = 'absolute';
                    star.style.width = '2px';
                    star.style.height = '2px';
                    star.style.background = '#fff';
                    star.style.borderRadius = '50%';
                    star.style.top = Math.random() * 100 + '%';
                    star.style.left = Math.random() * 100 + '%';
                    star.style.opacity = Math.random();
                    star.style.animation = `twinkle ${1 + Math.random() * 1.5}s infinite`;
                    star.style.zIndex = '1';
                    container.appendChild(star);
                }
            }

            function drawConnections() {
                d3.select('#vis-log-history .clock-container svg').remove();
                const svg = d3.select('#vis-log-history .clock-container')
                    .append('svg')
                    .attr('width', '600')
                    .attr('height', '600')
                    .style('position', 'absolute')
                    .style('top', '0')
                    .style('left', '0')
                    .style('pointer-events', 'none');
                const connections = [ 
                    {x1: 300, y1: 300, x2: 300, y2: 70}, 
                    {x1: 300, y1: 300, x2: 530, y2: 150}, 
                    {x1: 300, y1: 300, x2: 520, y2: 470}, 
                    {x1: 300, y1: 300, x2: 90, y2: 460}, 
                    {x1: 300, y1: 300, x2: 70, y2: 190} 
                ];
                connections.forEach((conn, i) => {
                    setTimeout(() => {
                        svg.append('line')
                            .attr('x1', conn.x1)
                            .attr('y1', conn.y1)
                            .attr('x2', conn.x1)
                            .attr('y2', conn.y1)
                            .attr('stroke', '#ffd700')
                            .attr('stroke-width', 2)
                            .attr('opacity', 0.4)
                            .transition()
                            .duration(400)
                            .attr('x2', conn.x2)
                            .attr('y2', conn.y2);
                    }, i * 100);
                });
            }

            createStars();
            setTimeout(() => document.getElementById('event1')?.classList.add('active'), 500);
            setTimeout(() => document.getElementById('event2')?.classList.add('active'), 1750);
            setTimeout(() => document.getElementById('event3')?.classList.add('active'), 3250);
            setTimeout(() => document.getElementById('event4')?.classList.add('active'), 4750);
            setTimeout(() => document.getElementById('event5')?.classList.add('active'), 6250);
            setTimeout(() => { 
                let q = document.getElementById('quote1'); 
                if(q) {
                    q.style.opacity = '1'; 
                    q.style.transition = 'opacity 0.6s';
                }
            }, 2000);
            setTimeout(() => { 
                let q = document.getElementById('quote2'); 
                if(q) {
                    q.style.opacity = '1'; 
                    q.style.transition = 'opacity 0.6s';
                }
            }, 4000);
            setTimeout(drawConnections, 7000);
        }

        // å¯¹æ•°å®šä¹‰å¯è§†åŒ–
        function visualizeLogDefinition(containerId) {
            const svg = d3.select("#animation2");
            if(svg.empty()) return;
            svg.selectAll("*").remove();
            const bounds = svg.node().getBoundingClientRect();
            const width = bounds.width, height = bounds.height;
            const centerX = width / 2;
            const base = 2, number = 8;
            const logResult = Math.log(number) / Math.log(base);

            svg.append("text")
                .attr("x", centerX)
                .attr("y", 50)
                .attr("text-anchor", "middle")
                .style("font-size", "20px")
                .text(`æ±‚ logâ‚‚(8) = ?`);
            
            svg.append("text")
                .attr("x", centerX)
                .attr("y", 80)
                .attr("text-anchor", "middle")
                .style("font-size", "16px")
                .text(`ä¹Ÿå°±æ˜¯ï¼Œéœ€è¦å¤šå°‘ä¸ª 2 ç›¸ä¹˜æ‰èƒ½å¾—åˆ° 8ï¼Ÿ`);

            const expGroup = svg.append("g");
            expGroup.append("text")
                .attr("x", 50)
                .attr("y", 150)
                .text("æŒ‡æ•°è¿‡ç¨‹:")
                .style("font-size", "16px")
                .style("font-weight", "bold");

            let pathData = "M 150 145";
            for (let i = 1; i <= logResult; i++) { 
                pathData += ` L ${150 + i * 50} 145`; 
            }

            const expPath = expGroup.append("path")
                .attr("d", pathData)
                .attr("stroke", "#3498db")
                .attr("stroke-width", 2)
                .attr("fill", "none");
            
            const totalLength = expPath.node().getTotalLength();

            expPath.attr("stroke-dasharray", `${totalLength} ${totalLength}`)
                .attr("stroke-dashoffset", totalLength)
                .transition()
                .duration(2000)
                .ease(d3.easeLinear)
                .attr("stroke-dashoffset", 0);

            for (let i = 0; i <= logResult; i++) {
                const val = Math.pow(base, i);
                const node = expGroup.append("g")
                    .attr("transform", `translate(${150 + i * 50}, 145)`)
                    .style("opacity", 0);
                
                node.append("circle")
                    .attr("r", 15)
                    .attr("fill", i === 0 ? "#e67e22" : "#3498db");
                
                node.append("text")
                    .text(val === 1 ? 'èµ·ç‚¹' : val)
                    .attr("y", 40)
                    .attr("text-anchor", "middle")
                    .style("fill", "#2c3e50");
                
                if (i > 0) {
                    expGroup.append("text")
                        .text(`Ã—${base}`)
                        .attr("x", 150 + (i - 1) * 50 + 25)
                        .attr("y", 125)
                        .attr("text-anchor", "middle")
                        .style("opacity", 0)
                        .transition()
                        .delay(1000 + i*500)
                        .duration(500)
                        .style("opacity", 1);
                }
                
                node.transition()
                    .delay(1000 + i * 500)
                    .duration(500)
                    .style("opacity", 1);
            }

            const logGroup = svg.append("g")
                .style("opacity", 0);
            
            logGroup.transition()
                .delay(4500)
                .duration(500)
                .style("opacity", 1);

            logGroup.append("text")
                .attr("x", 50)
                .attr("y", 300)
                .text("å¯¹æ•°è¿‡ç¨‹:")
                .style("font-size", "16px")
                .style("font-weight", "bold")
                .style("fill", "#000000");
            
            logGroup.append("text")
                .attr("x", centerX)
                .attr("y", 330)
                .text(`ä» 8 å¼€å§‹ï¼Œæ¯æ¬¡é™¤ä»¥ 2ï¼Œæ•°ä¸€ä¸‹é™¤äº†å‡ æ¬¡`)
                .attr("text-anchor", "middle")
                .style("font-size", "16px")
                .style("font-weight", "bold")
                .style("fill", "#000000");

            let count = 0;
            function animateDivision(val, step) {
                if (val < base) {
                    logGroup.append("text")
                        .attr("x", centerX)
                        .attr("y", 450)
                        .text(`æ€»å…±é™¤äº† ${count} æ¬¡, æ‰€ä»¥ logâ‚‚(8) = ${count}`)
                        .attr("text-anchor", "middle")
                        .style("font-size", "24px")
                        .style("fill", "#000000")
                        .style("font-weight", "bold")
                        .style("opacity", 0)
                        .transition()
                        .duration(500)
                        .style("opacity", 1);
                    return;
                }
                
                const startX = 150 + step * 100;
                const g = logGroup.append("g")
                    .style("opacity", 0);
                
                g.transition()
                    .delay(4500 + step * 1500 + 500)
                    .duration(500)
                    .style("opacity", 1);
                
                g.append("rect")
                    .attr("x", startX - 25)
                    .attr("y", 350)
                    .attr("width", 50)
                    .attr("height", 30)
                    .attr("fill", "#3498db")
                    .attr("rx", 5);
                
                g.append("text")
                    .text(val)
                    .attr("x", startX)
                    .attr("y", 370)
                    .attr("text-anchor", "middle")
                    .style("fill", "#000000")
                    .style("font-weight", "bold");
                
                g.append("text")
                    .text(`Ã·${base}`)
                    .attr("x", startX + 50)
                    .attr("y", 370)
                    .attr("text-anchor", "middle")
                    .style("font-weight", "bold");
                
                const nextVal = val / base;
                count++;
                
                const gNext = logGroup.append("g")
                    .style("opacity", 0);
                
                gNext.transition()
                    .delay(4500 + step * 1500 + 1500)
                    .duration(500)
                    .style("opacity", 1);
                
                gNext.append("rect")
                    .attr("x", startX + 75)
                    .attr("y", 350)
                    .attr("width", 50)
                    .attr("height", 30)
                    .attr("fill", "#2ecc71")
                    .attr("rx", 5);
                
                gNext.append("text")
                    .text(nextVal)
                    .attr("x", startX + 100)
                    .attr("y", 370)
                    .attr("text-anchor", "middle")
                    .style("fill", "#000000")
                    .style("font-weight", "bold");
                
                logGroup.append("text")
                    .text(`${count}æ¬¡`)
                    .attr("x", startX + 50)
                    .attr("y", 410)
                    .attr("text-anchor", "middle")
                    .style("fill", "#000000")
                    .style("font-weight", "bold")
                    .style("opacity", 0)
                    .transition()
                    .delay(4500 + step * 1500 + 1500)
                    .duration(500)
                    .style("opacity", 1);
                
                animateDivision(nextVal, step + 1);
            }
            
            animateDivision(number, 0);
        }

        // å¯¹æ•°è¿ç®—æ³•åˆ™å¯è§†åŒ–
        function visualizeLogOperations(containerId) {
            const svg = d3.select("#animation3");
            if(svg.empty()) return;
            svg.selectAll("*").remove();

            // è·å–å®¹å™¨å®é™…å°ºå¯¸
            const container = d3.select(`#${containerId}`);
            const containerRect = container.node().getBoundingClientRect();
            const width = containerRect.width || 1000;
            const height = containerRect.height || 500;
            
            // è®¾ç½®SVGå°ºå¯¸
            svg.attr("width", width).attr("height", height);
            
            const margin = {top: 80, right: 50, bottom: 80, left: 80};
            const innerWidth = width - margin.left - margin.right;
            const innerHeight = height - margin.top - margin.bottom;

            const g = svg.append("g")
                .attr("transform", `translate(${margin.left}, ${margin.top})`);

            // åˆ›å»ºèƒŒæ™¯åŒºåŸŸ
            const upperBg = g.append("rect")
                .attr("x", -20)
                .attr("y", -30)
                .attr("width", innerWidth + 40)
                .attr("height", 60)
                .attr("fill", "#ecf8ff")
                .attr("rx", 8)
                .style("opacity", 0.4);

            const lowerBg = g.append("rect")
                .attr("x", -20)
                .attr("y", 60)
                .attr("width", innerWidth + 40)
                .attr("height", 60)
                .attr("fill", "#f0f9e8")
                .attr("rx", 8)
                .style("opacity", 0.4);

            const numbers = [2, 4, 8, 16, 32, 64, 128, 256, 512];
            const logs = [1, 2, 3, 4, 5, 6, 7, 8, 9];

            const scaleNumbers = d3.scalePoint()
                .domain(numbers)
                .range([0, innerWidth])
                .padding(0.3);
            
            const scaleLogs = d3.scalePoint()
                .domain(logs)
                .range([0, innerWidth])
                .padding(0.3);

            // æ•°å­—è½´
            const numberAxis = g.append("g")
                .attr("class", "number-axis")
                .attr("transform", `translate(0, 30)`);
            
            numberAxis.call(d3.axisBottom(scaleNumbers));
            
            numberAxis.selectAll("text")
                .style("font-size", "12px")
                .style("font-weight", "bold")
                .style("fill", "#2c3e50");

            // å¯¹æ•°è½´
            const logAxis = g.append("g")
                .attr("transform", `translate(0, 90)`)
                .attr("class", "log-axis");
            
            logAxis.call(d3.axisBottom(scaleLogs));
            
            logAxis.selectAll("text")
                .style("font-size", "12px")
                .style("font-weight", "bold")
                .style("fill", "#2c3e50");

            // æ·»åŠ è½´æ ‡ç­¾
            g.append("text")
                .attr("x", innerWidth / 2)
                .attr("y", -10)
                .attr("text-anchor", "middle")
                .style("font-size", "16px")
                .style("font-weight", "bold")
                .style("fill", "#34495e")
                .text("æ•°å­—ä¸–ç•Œ (ä¹˜æ³•ã€é™¤æ³•ã€å¹‚è¿ç®—)");

            g.append("text")
                .attr("x", innerWidth / 2)
                .attr("y", 120)
                .attr("text-anchor", "middle")
                .style("font-size", "16px")
                .style("font-weight", "bold")
                .style("fill", "#34495e")
                .text("å¯¹æ•°ä¸–ç•Œ (åŠ æ³•ã€å‡æ³•ã€ä¹˜æ³•)");

            // æ·»åŠ å‚ç›´è¿æ¥çº¿ï¼ˆè™šçº¿ï¼‰
            numbers.forEach((num, i) => {
                g.append("line")
                    .attr("x1", scaleNumbers(num))
                    .attr("y1", 30)
                    .attr("x2", scaleLogs(logs[i]))
                    .attr("y2", 90)
                    .attr("stroke", "#9b59b6")
                    .attr("stroke-width", 2)
                    .attr("stroke-dasharray", "5,5")
                    .style("opacity", 0.6);
            });

            // æ·»åŠ è¿æ¥ç‚¹
            numbers.forEach((num, i) => {
                // ä¸Šæ–¹çš„ç‚¹
                g.append("circle")
                    .attr("cx", scaleNumbers(num))
                    .attr("cy", 30)
                    .attr("r", 4)
                    .attr("fill", "#3498db")
                    .attr("stroke", "#2980b9")
                    .attr("stroke-width", 2);
                
                // ä¸‹æ–¹çš„ç‚¹
                g.append("circle")
                    .attr("cx", scaleLogs(logs[i]))
                    .attr("cy", 90)
                    .attr("r", 4)
                    .attr("fill", "#e74c3c")
                    .attr("stroke", "#c0392b")
                    .attr("stroke-width", 2);
            });

            // æ·»åŠ ç¤ºä¾‹è¯´æ˜
            g.append("text")
                .attr("x", 10)
                .attr("y", innerHeight - 20)
                .attr("text-anchor", "start")
                .style("font-size", "14px")
                .style("fill", "#7f8c8d")
                .text("ä¾‹å¦‚ï¼š2Ã—4=8 å¯¹åº” logâ‚‚(2)+logâ‚‚(4)=1+2=3=logâ‚‚(8)");
        }

        // å¯¹æ•°æ€§è´¨å¯è§†åŒ–
        function visualizeLogProperties(containerId) {
            const container = d3.select(`#${containerId}`);
            if(container.empty()) return;
            
            container.html('');
            
            const svg = container.append('svg')
                .attr('width', '100%')
                .attr('height', '100%')
                .style('margin-top', '-60px');

            const bounds = container.node().getBoundingClientRect();
            const width = bounds.width, height = bounds.height;
            const centerX = width / 2;

            const properties = [
                { 
                    title: "ä¹˜æ³•åœ¨å¯¹æ•°ä¸–ç•Œå˜æˆåŠ æ³•", 
                    formula: "\\log(x \\cdot y) = \\log(x) + \\log(y)", 
                    y: height*0.2, 
                    color1: "#3498db", 
                    color2: "#e74c3c", 
                    operator: "+", 
                    animation: "merge" 
                },
                { 
                    title: "é™¤æ³•åœ¨å¯¹æ•°ä¸–ç•Œå˜æˆå‡æ³•", 
                    formula: "\\log\\left(\\frac{x}{y}\\right) = \\log(x) - \\log(y)", 
                    y: height*0.5, 
                    color1: "#27ae60", 
                    color2: "#f39c12", 
                    operator: "-", 
                    animation: "separate" 
                },
                { 
                    title: "å¹‚åœ¨å¯¹æ•°ä¸–ç•Œå˜æˆä¹˜æ³•", 
                    formula: "\\log(x^n) = n \\cdot \\log(x)", 
                    y: height*0.8, 
                    color1: "#9b59b6", 
                    color2: "#e67e22", 
                    operator: "Ã—", 
                    animation: "multiply" 
                }
            ];

            properties.forEach((prop, index) => {
                const propGroup = svg.append("g")
                    .attr("transform", `translate(${centerX}, ${prop.y})`);

                const circle1 = propGroup.append("circle")
                    .attr("cx", -80)
                    .attr("r", 35)
                    .attr("fill", prop.color1)
                    .attr("opacity", 1)
                    .attr("stroke", "#2c3e50")
                    .attr("stroke-width", 3);
                
                const circle2 = propGroup.append("circle")
                    .attr("cx", 80)
                    .attr("r", 35)
                    .attr("fill", prop.color2)
                    .attr("opacity", 1)
                    .attr("stroke", "#2c3e50")
                    .attr("stroke-width", 3);
                
                const operatorText = propGroup.append("text")
                    .attr("y", 5)
                    .attr("text-anchor", "middle")
                    .style("font-size", "40px")
                    .style("font-weight", "bold")
                    .style("fill", "#2c3e50")
                    .text(prop.operator);
                
                propGroup.append("text")
                    .attr("x", -80)
                    .attr("y", 8)
                    .attr("text-anchor", "middle")
                    .style("fill", "#2c3e50")
                    .style("font-weight", "bold")
                    .style("font-size", "16px")
                    .text(index === 2 ? "log(x)" : "log(x)");
                
                propGroup.append("text")
                    .attr("x", 80)
                    .attr("y", 8)
                    .attr("text-anchor", "middle")
                    .style("fill", "#2c3e50")
                    .style("font-weight", "bold")
                    .style("font-size", "16px")
                    .text(index === 2 ? "n" : "log(y)");

                const titleDiv = propGroup.append("text")
                    .attr("x", -200)
                    .attr("y", 0)
                    .style("font-size", "14px")
                    .style("text-align", "left")
                    .style("color", "#2c3e50")
                    .style("font-weight", "bold")
                    .text(prop.title)
                    .style("opacity", 0);

                titleDiv.transition()
                    .delay(index * 500)
                    .duration(500)
                    .style("opacity", 1);

                function animateProperty() {
                    if (prop.animation === "merge") {
                        circle1.transition().duration(2000).attr("cx", 0)
                            .transition().duration(1000).attr("r", 40)
                            .transition().duration(2000).attr("cx", -80).attr("r", 30);
                        circle2.transition().duration(2000).attr("cx", 0)
                            .transition().duration(1000).attr("r", 40)
                            .transition().duration(2000).attr("cx", 80).attr("r", 30);
                    } else if (prop.animation === "separate") {
                        circle1.transition().duration(2000).attr("cx", -100)
                            .transition().duration(1000).attr("cx", -80);
                        circle2.transition().duration(2000).attr("cx", 100).attr("opacity", 0.3)
                            .transition().duration(1000).attr("cx", 80).attr("opacity", 0.7);
                    } else if (prop.animation === "multiply") {
                        circle1.transition().duration(1000).attr("r", 40)
                            .transition().duration(1000).attr("r", 30)
                            .transition().duration(1000).attr("r", 40)
                            .transition().duration(1000).attr("r", 30);
                        circle2.transition().duration(1000).attr("r", 25)
                            .transition().duration(1000).attr("r", 35)
                            .transition().duration(1000).attr("r", 25)
                            .transition().duration(1000).attr("r", 30);
                    }
                }
                
                setTimeout(() => { 
                    animateProperty(); 
                    setInterval(animateProperty, 6000); 
                }, index * 1000);
            });
        }

        // å¸¸ç”¨å¯¹æ•°ç³»ç»Ÿå¯è§†åŒ–
        function visualizeCommonLogs(containerId) {
            const svg = d3.select("#animation5");
            if(svg.empty()) return;
            svg.selectAll("*").remove();
            const bounds = svg.node().getBoundingClientRect();
            const width = bounds.width, height = bounds.height;
            const centerX = width / 2;

            svg.append("text")
                .attr("x", centerX)
                .attr("y", 40)
                .attr("text-anchor", "middle")
                .style("font-size", "18px")
                .style("font-weight", "bold")
                .text("å¸¸ç”¨å¯¹æ•°ä¸è‡ªç„¶å¯¹æ•°å¯¹æ¯”");

            const lgGroup = svg.append("g")
                .attr("transform", `translate(${width*0.1}, 80)`);
            
            lgGroup.append("text")
                .text("å¸¸ç”¨å¯¹æ•° (lg)")
                .style("font-size", "16px")
                .style("font-weight", "bold")
                .style("fill", "#e74c3c");
            
            [{input: "10", output: "1"}, {input: "100", output: "2"}, {input: "1000", output: "3"}].forEach((ex, i) => {
                const y = 30 + i * 40;
                const g = lgGroup.append("g")
                    .style("opacity", 0);
                
                g.append("rect")
                    .attr("y", y)
                    .attr("width", 150)
                    .attr("height", 30)
                    .attr("fill", "#ffebee")
                    .attr("stroke", "#e74c3c")
                    .attr("rx", 5);
                
                g.append("text")
                    .text(`lg(${ex.input}) = ${ex.output}`)
                    .attr("x", 75)
                    .attr("y", y + 20)
                    .attr("text-anchor", "middle")
                    .style("font-size", "14px");
                
                g.transition()
                    .delay(500 + i * 300)
                    .duration(500)
                    .style("opacity", 1);
            });

            const lnGroup = svg.append("g")
                .attr("transform", `translate(${width*0.9 - 150}, 80)`);
            
            lnGroup.append("text")
                .text("è‡ªç„¶å¯¹æ•° (ln)")
                .style("font-size", "16px")
                .style("font-weight", "bold")
                .style("fill", "#27ae60");
            
            [{input: "e", output: "1"}, {input: "eÂ²", output: "2"}, {input: "1", output: "0"}].forEach((ex, i) => {
                const y = 30 + i * 40;
                const g = lnGroup.append("g")
                    .style("opacity", 0);
                
                g.append("rect")
                    .attr("y", y)
                    .attr("width", 150)
                    .attr("height", 30)
                    .attr("fill", "#e8f5e8")
                    .attr("stroke", "#27ae60")
                    .attr("rx", 5);
                
                g.append("text")
                    .text(`ln(${ex.input}) = ${ex.output}`)
                    .attr("x", 75)
                    .attr("y", y + 20)
                    .attr("text-anchor", "middle")
                    .style("font-size", "14px");
                
                g.transition()
                    .delay(1500 + i * 300)
                    .duration(500)
                    .style("opacity", 1);
            });

            const curveGroup = svg.append("g")
                .attr("transform", `translate(50, ${height-150})`);
            
            const xScale = d3.scaleLinear()
                .domain([0.1, 10])
                .range([0, width - 100]);
            
            const yScale = d3.scaleLinear()
                .domain([-2, 3])
                .range([120, 0]);

            curveGroup.append("line")
                .attr("x1", 0)
                .attr("y1", yScale(0))
                .attr("x2", width-100)
                .attr("y2", yScale(0))
                .attr("stroke", "#333");
            
            curveGroup.append("line")
                .attr("x1", xScale(1))
                .attr("y1", 0)
                .attr("x2", xScale(1))
                .attr("y2", 120)
                .attr("stroke", "#333");

            // ç»˜åˆ¶lg(x)å‡½æ•°æ›²çº¿
            const lgLine = d3.line()
                .x(d => xScale(d))
                .y(d => yScale(Math.log10(d)))
                .curve(d3.curveMonotoneX);
            
            const lgData = d3.range(0.1, 10, 0.1);
            
            curveGroup.append("path")
                .datum(lgData)
                .attr("fill", "none")
                .attr("stroke", "#e74c3c")
                .attr("stroke-width", 3)
                .attr("d", lgLine)
                .style("opacity", 0)
                .transition()
                .delay(3000)
                .duration(1000)
                .style("opacity", 1);

            // ç»˜åˆ¶ln(x)å‡½æ•°æ›²çº¿
            const lnLine = d3.line()
                .x(d => xScale(d))
                .y(d => yScale(Math.log(d)))
                .curve(d3.curveMonotoneX);
            
            const lnData = d3.range(0.1, 10, 0.1);
            
            curveGroup.append("path")
                .datum(lnData)
                .attr("fill", "none")
                .attr("stroke", "#27ae60")
                .attr("stroke-width", 3)
                .attr("d", lnLine)
                .style("opacity", 0)
                .transition()
                .delay(3500)
                .duration(1000)
                .style("opacity", 1);

            // æ·»åŠ å‡½æ•°æ ‡ç­¾
            curveGroup.append("text")
                .text("y = lg(x)")
                .attr("x", xScale(8))
                .attr("y", yScale(0.9))
                .style("fill", "#e74c3c")
                .style("font-weight", "bold")
                .style("font-size", "14px");
            
            curveGroup.append("text")
                .text("y = ln(x)")
                .attr("x", xScale(6))
                .attr("y", yScale(1.8))
                .style("fill", "#27ae60")
                .style("font-weight", "bold")
                .style("font-size", "14px");
        }

        // --- åˆå§‹åŒ– ---
        document.addEventListener('DOMContentLoaded', () => {
            showSlide(0);
            updateSlideInfo();
            console.log('âœ¨ å¯¹æ•°å‡½æ•°æ•™å­¦ç³»ç»Ÿåˆå§‹åŒ–å®Œæˆ');
            // è‡ªåŠ¨å¯åŠ¨æ’­æ”¾
            setTimeout(() => {
                console.log('ğŸ¬ è‡ªåŠ¨å¯åŠ¨æ’­æ”¾...');
                startAutoPlay();
            }, 1000);

        });
    </script>
    <script src="./assets/course-navigation.js"></script>
</body>
</html>


