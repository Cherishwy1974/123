<!DOCTYPE html>

<html lang="zh-CN">
<head>
<meta charset="utf-8"/>
<meta content="width=device-width, initial-scale=1.0" name="viewport"/>
<title>
   02_2.3_æé™çš„è¿ç®—æ³•åˆ™
  </title>
<link href="https://fonts.googleapis.com" rel="preconnect"/>
<link crossorigin="" href="https://fonts.gstatic.com" rel="preconnect"/>
<link href="https://fonts.googleapis.com/css2?family=Noto+Serif+SC:wght@400;600;700&amp;display=swap" rel="stylesheet"/>
<script src="https://d3js.org/d3.v7.min.js">
</script>
<style>
   * { margin: 0; padding: 0; box-sizing: border-box; }
        body {
            font-family: 'Noto Serif SC', serif;
            background: #1a1a2e;
            overflow: hidden;
            height: 100vh;
            width: 100vw;
        }
        .blackboard {
            width: 100vw;
            height: 100vh;
            background: #1a1a2e;
            position: relative;
            border: 10px solid #795548;
            margin: 0;
        }
        .avatar-container {
            position: fixed;
            top: 60%; left: 50%;
            transform: translate(-50%, -50%);
            width: 975px; height: 1105px;
            overflow: hidden; z-index: 50;
            pointer-events: none; background: transparent;
            border: none; box-shadow: none;
        }
        .wrapper {
            width: 100%; height: 100%;
            background: transparent; pointer-events: auto;
        }
        .content-area {
            position: absolute;
            top: 20px; left: 50px; right: 50px; bottom: 120px;
            z-index: 10; overflow: hidden;
        }
        .page {
            position: absolute;
            top: 0; left: 0; right: 0; bottom: 0;
            opacity: 0; visibility: hidden;
            transition: all 0.7s ease-in-out;
            padding: 20px;
            display: grid;
            grid-template-columns: 2fr 3fr;
            gap: 20px;
            align-items: center;
        }
        .page.active {
            opacity: 1; visibility: visible;
        }
        /* å°é¢é¡µç‰¹æ®Šæ ·å¼ - è¦†ç›–gridå¸ƒå±€ */
        .page.cover-page {
            display: flex !important;
            grid-template-columns: none !important;
            padding: 0 !important;
            align-items: center !important;
            justify-content: center !important;
        }
        .page.cover-page > div {
            display: flex !important;
        }
        .chalk-text {
            color: #ffffff;
            font-family: 'Noto Serif SC', serif;
            text-rendering: optimizeLegibility;
            -webkit-font-smoothing: antialiased;
            -moz-osx-font-smoothing: grayscale;
        }
        .page-title {
            font-size: 24px; font-weight: bold;
            color: #e1bee7; margin-bottom: 1.5rem;
        }
        .text-medium {
            font-size: 16px; margin-bottom: 0.8rem;
            line-height: 1.7; color: #f3e5f5; font-weight: 500;
        }
        .emphasis {
            color: #FF6B6B; font-size: 18px;
        }
        .text-medium p {
            margin-bottom: 1rem;
        }
        .text-medium strong {
            color: #81c784;
            font-weight: 600;
        }
        .graph-container {
            background: transparent;
            border: none;
            padding: 0;
            width: 100%; height: 100%;
            display: flex; justify-content: center; align-items: center;
        }
        .subtitle-area {
            position: absolute;
            bottom: 20px; left: 50px; right: 50px;
            height: 50px; background: rgba(0,0,0,0.8);
            border-radius: 8px; display: flex;
            align-items: center; justify-content: center;
            z-index: 60; color: white;
            font-size: 0.9rem; text-align: center;
            padding: 0 20px; line-height: 1.4;
        }
        .control-bar {
            position: fixed;
            left: -9999px;
            top: 50%;
            transform: translateY(-50%);
            width: 270px;
            height: auto;
            background: rgba(255, 255, 255, 0.15);
            backdrop-filter: blur(15px);
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            gap: 12px;
            z-index: 200;
            border-radius: 0 20px 20px 0;
            padding: 25px 20px;
            transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.2);
            border: 1px solid rgba(255, 255, 255, 0.2);
        }
        .control-bar:hover { 
            left: -9999px; 
            box-shadow: 0 12px 40px rgba(0,0,0,0.3); 
        }
        .control-bar::before {
            content: 'â–¶ï¸';
            position: absolute;
            top: 50%;
            right: -30px;
            transform: translateY(-50%);
            background: rgba(255, 255, 255, 0.2);
            backdrop-filter: blur(10px);
            padding: 12px 8px;
            border-radius: 0 15px 15px 0;
            font-size: 0.9rem;
            writing-mode: vertical-lr;
            border: 1px solid rgba(255, 255, 255, 0.1);
            color: #333;
        }
        .btn {
            padding: 14px 22px;
            background: rgba(255, 255, 255, 0.25);
            color: #333;
            border: 1px solid rgba(255, 255, 255, 0.3);
            border-radius: 12px;
            cursor: pointer;
            font-size: 14px;
            font-weight: 600;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            width: 100%;
            text-align: center;
            backdrop-filter: blur(5px);
            text-shadow: 0 1px 2px rgba(255,255,255,0.3);
        }
        .btn:hover { 
            background: rgba(255, 255, 255, 0.35); 
            transform: translateY(-3px); 
            box-shadow: 0 6px 20px rgba(0, 0, 0, 0.2); 
        }
        .btn.primary { 
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); 
            color: #fff; 
            text-shadow: 0 1px 2px rgba(0,0,0,0.3); 
        }
        .btn.primary:hover { 
            background: linear-gradient(135deg, #5a6fd8 0%, #6a4190 100%); 
            box-shadow: 0 8px 25px rgba(102,126,234,0.4); 
        }

        /* åæ ‡ç³»æ ·å¼ - æ”¹ä¸ºç™½è‰² */
        .viz-panel .axis path,
        .viz-panel .axis line {
            stroke: white;
            stroke-width: 2;
        }
        .viz-panel .axis text {
            fill: white;
            font-size: 18px;
        }
        .viz-panel .label {
            fill: white;
            font-size: 18px;
            font-weight: 500;
        }

        /* è¿æ¥çŠ¶æ€æŒ‡ç¤ºå™¨ - é»˜è®¤éšè— */
        .status-indicator {
            position: absolute;
            top: 10px; right: 10px;
            padding: 5px 10px;
            background: rgba(0,0,0,0.5);
            color: white; border-radius: 5px;
            font-size: 12px; z-index: 100;
            transition: opacity 0.3s ease;
            display: none; /* é»˜è®¤éšè—çº¢è‰²æç¤º */
        }
        .status-indicator.connected { background: rgba(76, 175, 80, 0.8); }
        .status-indicator.recording {
            background: rgba(244, 67, 54, 0.8);
            animation: pulse 1.5s infinite;
        }
        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }
        .status-indicator.error { background: rgba(244, 67, 54, 0.8); }
        .status-indicator.connecting { background: rgba(255, 152, 0, 0.8); }

        /* å½•åˆ¶æ¨¡å¼ä¸‹éšè—çŠ¶æ€æŒ‡ç¤ºå™¨ */
        .recording-mode .status-indicator {
            opacity: 0; pointer-events: none;
        }
        /* å½•åˆ¶æ¨¡å¼ä¸‹éšè—æ§åˆ¶æ  */
        .recording-mode .control-bar {
            left: -9999px; transition: left 0.5s ease;
        }
  </style>
</head>
<body>
<div class="blackboard">
<div class="status-indicator" id="statusIndicator">
    ç­‰å¾…è¿æ¥
   </div>
<div class="avatar-container">
<div class="wrapper" id="avatarWrapper">
</div>
</div>
<div class="content-area" id="contentArea">
<div class="page active cover-page" data-page="1">
<div style="display: flex !important; width: 100%; height: 100%; align-items: center; justify-content: center;">
<div style="flex: 1; text-align: center; padding: 2rem;">
<h1 style="font-size: 2.2rem; font-weight: bold; color: #f1c40f; text-shadow: 0 0 8px rgba(241, 196, 15, 0.5); margin-bottom: 1rem;">
        æé™çš„è¿ç®—æ³•åˆ™
       </h1>
<p style="font-size: 1.1rem; color: #9ca3af; margin-bottom: 1.5rem;">
        ç¬¬2ç«  è§†é¢‘ 2.3
       </p>
<div style="display: inline-block; text-align: left; margin-top: 1.5rem;">
<p style="font-size: 0.95rem; color: #e0e0e0; margin: 0.6rem 0;">
         âœ“ æé™å››åˆ™è¿ç®—æ³•åˆ™
        </p>
<p style="font-size: 0.95rem; color: #e0e0e0; margin: 0.6rem 0;">
         âœ“ æé™è¿ç®—çš„å……è¦æ¡ä»¶
        </p>
<p style="font-size: 0.95rem; color: #e0e0e0; margin: 0.6rem 0;">
         âœ“ å¤åˆå‡½æ•°çš„æé™
        </p>
<p style="font-size: 0.95rem; color: #e0e0e0; margin: 0.6rem 0;">
         âœ“ å…¸å‹ä¾‹é¢˜ä¸åº”ç”¨
        </p>
</div>
</div>
<div style="flex: 1; display: flex; align-items: center; justify-content: center;">
<svg style="width: 100%; max-width: 500px; height: 400px;" viewbox="0 0 600 500">
<defs>
<lineargradient id="grad1" x1="0%" x2="100%" y1="0%" y2="100%">
<stop offset="0%" style="stop-color:#3498db;stop-opacity:1">
</stop>
<stop offset="100%" style="stop-color:#9b59b6;stop-opacity:1">
</stop>
</lineargradient>
</defs>
<text fill="url(#grad1)" font-family="serif" font-size="60" text-anchor="middle" x="300" y="120">
         lim
         <animate attributename="opacity" dur="2s" repeatcount="indefinite" values="0.5;1;0.5">
</animate>
</text>
<line stroke="#3498db" stroke-width="3" x1="100" x2="500" y1="250" y2="250">
</line>
<circle cx="500" cy="250" fill="#e74c3c" r="15">
<animate attributename="r" dur="2s" repeatcount="indefinite" values="10;20;10">
</animate>
</circle>
<path d="M 100 250 Q 300 150 500 250" fill="none" stroke="#2ecc71" stroke-width="3">
<animate attributename="stroke-dasharray" dur="3s" repeatcount="indefinite" values="0,1000;1000,0">
</animate>
</path>
<text fill="#e74c3c" font-size="24" text-anchor="middle" x="500" y="300">
         xâ†’xâ‚€
        </text>
</svg>
</div>
</div>
</div>

<!-- Pages will be dynamically generated here -->
</div>
<div class="subtitle-area" id="subtitleArea">
    æ¬¢è¿å­¦ä¹ æé™çš„è¿ç®—æ³•åˆ™ï¼ç‚¹å‡»"å¼€å§‹è®²è¯¾"å¯åŠ¨è™šæ‹Ÿäººè®²å¸ˆã€‚
   </div>
<div class="control-bar">
<div style="color: white; margin-bottom: 1rem; text-align: center; font-size: 12px;">
     ç¬¬
     <span id="currentPage">
      1
     </span>
     é¡µ / å…±
     <span id="totalPages">
      9
     </span>
     é¡µ
    </div>
<div id="connectionStatus" style="color: #ffab40; margin-bottom: 1rem; text-align: center; font-size: 11px;">
     è™šæ‹Ÿäººæœªè¿æ¥
    </div>
<button class="btn" onclick="previousPage()">
     â¬…ï¸ ä¸Šä¸€é¡µ
    </button>
<button class="btn primary" id="startBtn" onclick="startTeaching()">
     ğŸ€ å¼€å§‹è®²è¯¾
    </button>
<button class="btn" onclick="nextPage()">
     ä¸‹ä¸€é¡µ â¡ï¸
    </button>
<button class="btn" onclick="restart()">
     ğŸ”„ é‡æ–°å¼€å§‹
    </button>
<button class="btn" id="autoPlayBtn" onclick="startAutoPlay()" style="background: linear-gradient(135deg, #2196f3, #1976d2);">
     ğŸ¬ è‡ªåŠ¨æ’­æ”¾
    </button>
<div style="color: #ffab40; margin-top: 0.5rem; text-align: center; font-size: 10px; line-height: 1.2;">
     ğŸ’¡ å½•åˆ¶æç¤º:
     <br/>
     ç‚¹å‡»è‡ªåŠ¨æ’­æ”¾åç«‹å³å¼€å§‹å½•å±
     <br/>
     ç³»ç»Ÿä¼šè‡ªåŠ¨å®Œæˆå…¨éƒ¨æ¼”ç¤º
    </div>
</div>
</div>
<script>
   window.MathJax = {
            tex: {
                inlineMath: [['$', '$'], ['\\(', '\\)']],
                displayMath: [['$$', '$$'], ['\\[', '\\]']],
                packages: ['base', 'ams']
            },
            startup: {
                pageReady: () => {
                    console.log('MathJax is ready.');
                    return MathJax.startup.defaultPageReady();
                }
            }
        };
  </script>
<script async="" id="MathJax-script" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js">
</script>
<!-- è®¯é£å®˜æ–¹SDK - æŒ‰ç…§æˆåŠŸæ¡ˆä¾‹çš„åŠ è½½æ–¹å¼ -->
<script type="module">
        // æ’­æ”¾å®Œæˆæ ‡è®°ï¼ˆä¾›OBSæ£€æµ‹ï¼‰
        window.playbackFinished = false;

   try {
                    // æ ¹æ®æˆåŠŸæ¡ˆä¾‹,å¯¼å…¥è®¯é£å®˜æ–¹SDK
        const { default: AvatarPlatform, SDKEvents, PlayerEvents, RecorderEvents, UserMedia } = await import('./avatar-sdk-web_3.1.2.1002/index.js');

        // æŒ‚è½½åˆ°å…¨å±€å¯¹è±¡
        window.AvatarPlatform = AvatarPlatform;
        window.SDKEvents = SDKEvents;
        window.PlayerEvents = PlayerEvents;
        window.RecorderEvents = RecorderEvents;
        window.UserMedia = UserMedia;

        console.log('âœ… è®¯é£å®˜æ–¹SDKæ¨¡å—å·²åŠ è½½');
        console.log('SDKç‰ˆæœ¬:', AvatarPlatform.getVersion());
        console.log('å¯ç”¨äº‹ä»¶:', { SDKEvents, PlayerEvents, RecorderEvents });

    } catch (error) {
        console.error('âŒ SDKæ¨¡å—åŠ è½½å¤±è´¥:', error);
        throw error; // ç›´æ¥æŠ›å‡ºé”™è¯¯,ä¸ä½¿ç”¨æ¨¡æ‹ŸSDK
    }

        // è§¦å‘è‡ªå®šä¹‰äº‹ä»¶,é€šçŸ¥SDKå·²å‡†å¤‡å°±ç»ª
        window.dispatchEvent(new CustomEvent('sdkReady'));
  </script>
<script>
   let avatarPlatform = null;
        let isConnected = false;
        let isTeaching = false;
        let currentPage = 1;
        const totalPages = 9;

        // æ•™å­¦å†…å®¹
        const boardContent = [
            {
                title: "å‰ææ¡ä»¶ï¼šæé™å­˜åœ¨",
                text: "<p>åœ¨åº”ç”¨æ‰€æœ‰è¿ç®—æ³•åˆ™ä¹‹å‰,å¿…é¡»æ˜ç¡®ä¸€ä¸ªé‡è¦å‰æ:</p><p><strong>æ ¸å¿ƒå‰æ:</strong>æ‰€æœ‰å‚ä¸è¿ç®—çš„å‡½æ•°çš„æé™éƒ½å¿…é¡»å­˜åœ¨(å³ä¸ºä¸€ä¸ªç¡®å®šçš„æ•°å€¼)ã€‚</p><p>é€šå¸¸è¡¨ç¤ºä¸º:</p><p>$\\lim\\limits_{x \\to a} f(x) = A$</p><p>$\\lim\\limits_{x \\to a} g(x) = B$</p><p><strong>ç›´è§‚ç†è§£:</strong>åªæœ‰å½“ä¸¤ä¸ªå‡½æ•°å„è‡ªéƒ½æœ‰æ˜ç¡®çš„\"ç›®çš„åœ°\",æˆ‘ä»¬æ‰èƒ½è®¡ç®—å®ƒä»¬ç»„åˆåçš„\"ç›®çš„åœ°\"ã€‚</p>"
            },
            {
                title: "åŠ æ³•æ³•åˆ™",
                text: "<p><strong>æ³•åˆ™å†…å®¹:</strong>ä¸¤ä¸ªå‡½æ•°æé™çš„å’Œç­‰äºå®ƒä»¬å’Œçš„æé™ã€‚</p><p><strong>å…¬å¼:</strong></p><p>$\\lim\\limits_{x \\to a} [f(x) + g(x)] = \\lim\\limits_{x \\to a} f(x) + \\lim\\limits_{x \\to a} g(x) = A + B$</p><p><strong>å‡ ä½•æ„ä¹‰:</strong>ä»å‡ ä½•è§’åº¦çœ‹,è¿™å°±åƒä¸¤æ¡çº¿æ®µçš„é•¿åº¦ç›¸åŠ ,ç»“æœæ˜¯å¯é¢„æµ‹çš„ã€‚</p><p><strong>ç›´è§‚ç†è§£:</strong>å¦‚æœä¸¤ä¸ªé‡åˆ†åˆ«è¶‹å‘äºç¡®å®šçš„å€¼,é‚£ä¹ˆå®ƒä»¬çš„å’Œä¹Ÿä¼šè¶‹å‘äºè¿™ä¸¤ä¸ªå€¼çš„å’Œã€‚</p>"
            },
            {
                title: "å‡æ³•æ³•åˆ™",
                text: "<p><strong>æ³•åˆ™å†…å®¹:</strong>ä¸¤ä¸ªå‡½æ•°æé™çš„å·®ç­‰äºå®ƒä»¬å·®çš„æé™ã€‚</p><p><strong>å…¬å¼:</strong></p><p>$\\lim\\limits_{x \\to a} [f(x) - g(x)] = \\lim\\limits_{x \\to a} f(x) - \\lim\\limits_{x \\to a} g(x) = A - B$</p><p><strong>ç‰¹ç‚¹:</strong>è¿™ä¸åŠ æ³•æ³•åˆ™ç±»ä¼¼,ä½“ç°äº†æé™è¿ç®—çš„çº¿æ€§æ€§è´¨ã€‚</p><p><strong>æ³¨æ„:</strong>å‡æ³•æ³•åˆ™åŒæ ·è¦æ±‚ä¸¤ä¸ªå‡½æ•°çš„æé™éƒ½å­˜åœ¨ã€‚</p>"
            },
            {
                title: "ä¹˜æ³•æ³•åˆ™",
                text: "<p><strong>æ³•åˆ™å†…å®¹:</strong>ä¸¤ä¸ªå‡½æ•°æé™çš„ç§¯ç­‰äºå®ƒä»¬ç§¯çš„æé™ã€‚</p><p><strong>å…¬å¼:</strong></p><p>$\\lim\\limits_{x \\to a} [f(x) \\cdot g(x)] = \\lim\\limits_{x \\to a} f(x) \\cdot \\lim\\limits_{x \\to a} g(x) = A \\cdot B$</p><p><strong>å‡ ä½•æ„ä¹‰:</strong>ä»é¢ç§¯çš„è§’åº¦ç†è§£,ä¸¤ä¸ªè¾¹é•¿çš„ä¹˜ç§¯å°±æ˜¯çŸ©å½¢çš„é¢ç§¯ã€‚</p><p><strong>ç›´è§‚ç†è§£:</strong>å¦‚æœä¸¤ä¸ªé‡åˆ†åˆ«è¶‹å‘äºAå’ŒB,é‚£ä¹ˆå®ƒä»¬çš„ä¹˜ç§¯è¶‹å‘äºAÃ—Bã€‚</p>"
            },
            {
                title: "é™¤æ³•æ³•åˆ™",
                text: "<p><strong>æ³•åˆ™å†…å®¹:</strong>ä¸¤ä¸ªå‡½æ•°æé™çš„å•†ç­‰äºå®ƒä»¬å•†çš„æé™,ä½†å‰ææ˜¯åˆ†æ¯çš„æé™ä¸ä¸ºé›¶ã€‚</p><p><strong>å…¬å¼:</strong></p><p>$\\lim\\limits_{x \\to a} \\frac{f(x)}{g(x)} = \\frac{\\lim\\limits_{x \\to a} f(x)}{\\lim\\limits_{x \\to a} g(x)} = \\frac{A}{B}$ (å½“ $B \\neq 0$)</p><p><strong>é‡è¦æ¡ä»¶:</strong>åˆ†æ¯å‡½æ•°çš„æé™å¿…é¡»ä¸ä¸ºé›¶,å¦åˆ™é™¤æ³•æ³•åˆ™ä¸é€‚ç”¨ã€‚</p><p>è¿™ä¸ªæ¡ä»¶éå¸¸é‡è¦,å› ä¸ºé™¤ä»¥é›¶æ˜¯æœªå®šä¹‰çš„ã€‚</p>"
            },
            {
                title: "å¤åˆå‡½æ•°çš„æé™æ³•åˆ™",
                text: "<p><strong>æ³•åˆ™å†…å®¹:</strong>å¯¹äºå¤åˆå‡½æ•° $f(g(x))$,åœ¨æ»¡è¶³ä¸€å®šæ¡ä»¶ä¸‹,å¯ä»¥ä»å¤–åˆ°å†…é€å±‚è®¡ç®—æé™ã€‚</p><p><strong>é€‚ç”¨æ¡ä»¶:</strong></p><ul><li>$\\lim\\limits_{x \\to a} g(x) = u_0$ å­˜åœ¨</li><li>$\\lim\\limits_{u \\to u_0} f(u) = A$ å­˜åœ¨</li><li>åœ¨ $x \\to a$ è¿‡ç¨‹ä¸­,$g(x) \\neq u_0$(æˆ– $f(u)$ åœ¨ $u = u_0$ å¤„è¿ç»­)</li></ul><p><strong>å…¬å¼:</strong></p><p>$\\lim\\limits_{x \\to a} f(g(x)) = \\lim\\limits_{u \\to u_0} f(u) = A$</p><p><strong>ç›´è§‚ç†è§£:</strong>å¯ä»¥\"ä»å¤–åˆ°å†…\"é€å±‚è®¡ç®—æé™,å…ˆç®—å†…å±‚å†ç®—å¤–å±‚ã€‚</p>"
            },
            {
                title: "ç»¼åˆåº”ç”¨ç¤ºä¾‹",
                text: "<p>è®©æˆ‘ä»¬é€šè¿‡ä¸€ä¸ªå…·ä½“ä¾‹å­æ¥åº”ç”¨è¿™äº›æ³•åˆ™:</p><p><strong>ä¾‹é¢˜:</strong></p><p>$\\lim\\limits_{x \\to 2} \\frac{x^2 + 3x - 1}{2x + 1}$</p><p><strong>è§£é¢˜æ­¥éª¤:</strong></p><ul><li>1. åˆ†å­æé™: $\\lim\\limits_{x \\to 2} (x^2 + 3x - 1) = 4 + 6 - 1 = 9$</li><li>2. åˆ†æ¯æé™: $\\lim\\limits_{x \\to 2} (2x + 1) = 4 + 1 = 5$</li><li>3. åº”ç”¨é™¤æ³•æ³•åˆ™: $\\frac{9}{5}$</li></ul><p><strong>æœ€ç»ˆç­”æ¡ˆ:</strong></p><p>$\\lim\\limits_{x \\to 2} \\frac{x^2 + 3x - 1}{2x + 1} = \\frac{9}{5}$</p>"
            },
            {
                title: "æ€»ç»“",
                text: "<p>æé™çš„è¿ç®—æ³•åˆ™ä¸ºæˆ‘ä»¬æä¾›äº†å¼ºå¤§çš„è®¡ç®—å·¥å…·:</p><p><strong>äº”å¤§æ³•åˆ™:</strong></p><ul><li><strong>åŠ æ³•æ³•åˆ™:</strong> $\\displaystyle\\lim[f(x) + g(x)] = \\lim f(x) + \\lim g(x)$</li><li><strong>å‡æ³•æ³•åˆ™:</strong> $\\displaystyle\\lim[f(x) - g(x)] = \\lim f(x) - \\lim g(x)$</li><li><strong>ä¹˜æ³•æ³•åˆ™:</strong> $\\displaystyle\\lim[f(x) \\cdot g(x)] = \\lim f(x) \\cdot \\lim g(x)$</li><li><strong>é™¤æ³•æ³•åˆ™:</strong> $\\displaystyle\\lim\\frac{f(x)}{g(x)} = \\frac{\\lim f(x)}{\\lim g(x)}$ (åˆ†æ¯æé™â‰ 0)</li><li><strong>å¤åˆå‡½æ•°æ³•åˆ™:</strong> $\\displaystyle\\lim f(g(x)) = f(\\lim g(x))$ (æ»¡è¶³æ¡ä»¶æ—¶)</li></ul><p><strong>å…³é”®è¦ç‚¹:</strong>è®°ä½å‰ææ¡ä»¶,æ­£ç¡®åº”ç”¨è¿™äº›æ³•åˆ™,å°±èƒ½è§£å†³å¤§å¤šæ•°æé™è®¡ç®—é—®é¢˜ã€‚</p>"
            }
        ];

        const subtitleScript = {
            1: "åŒå­¦ä»¬å¥½,ä»Šå¤©æˆ‘ä»¬æ¥å­¦ä¹ æé™çš„è¿ç®—æ³•åˆ™,è¿™æ˜¯å¾®ç§¯åˆ†ä¸­æœ€åŸºæœ¬ä¹Ÿæ˜¯æœ€é‡è¦çš„å·¥å…·ä¹‹ä¸€ã€‚æˆ‘ä»¬å°†å­¦ä¹ æé™çš„å››åˆ™è¿ç®—æ³•åˆ™å’Œå¤åˆå‡½æ•°çš„æé™æ³•åˆ™,è¿™äº›æ³•åˆ™æ˜¯è®¡ç®—å¤æ‚æé™çš„åŸºç¡€ã€‚",
            2: "åœ¨å­¦ä¹ è¿ç®—æ³•åˆ™ä¹‹å‰,æˆ‘ä»¬å¿…é¡»æ˜ç¡®ä¸€ä¸ªé‡è¦å‰æ:æ‰€æœ‰å‚ä¸è¿ç®—çš„å‡½æ•°çš„æé™éƒ½å¿…é¡»å­˜åœ¨ã€‚åªæœ‰å½“ä¸¤ä¸ªå‡½æ•°å„è‡ªéƒ½æœ‰æ˜ç¡®çš„ç›®æ ‡å€¼,æˆ‘ä»¬æ‰èƒ½è®¡ç®—å®ƒä»¬ç»„åˆåçš„ç»“æœã€‚è¿™æ˜¯åº”ç”¨æ‰€æœ‰è¿ç®—æ³•åˆ™çš„å‰ææ¡ä»¶ã€‚",
            3: "ç¬¬ä¸€ä¸ªæ³•åˆ™æ˜¯åŠ æ³•æ³•åˆ™ã€‚ä¸¤ä¸ªå‡½æ•°æé™çš„å’Œç­‰äºå®ƒä»¬å’Œçš„æé™ã€‚ä»å‡ ä½•è§’åº¦çœ‹,è¿™å°±åƒä¸¤æ¡çº¿æ®µçš„é•¿åº¦ç›¸åŠ ,ç»“æœæ˜¯å¯é¢„æµ‹çš„ã€‚å¦‚æœä¸¤ä¸ªé‡åˆ†åˆ«è¶‹å‘äºç¡®å®šçš„å€¼,é‚£ä¹ˆå®ƒä»¬çš„å’Œä¹Ÿä¼šè¶‹å‘äºè¿™ä¸¤ä¸ªå€¼çš„å’Œã€‚",
            4: "ç¬¬äºŒä¸ªæ³•åˆ™æ˜¯å‡æ³•æ³•åˆ™ã€‚ä¸¤ä¸ªå‡½æ•°æé™çš„å·®ç­‰äºå®ƒä»¬å·®çš„æé™ã€‚è¿™ä¸åŠ æ³•æ³•åˆ™ç±»ä¼¼,ä½“ç°äº†æé™è¿ç®—çš„çº¿æ€§æ€§è´¨ã€‚å‡æ³•æ³•åˆ™åŒæ ·è¦æ±‚ä¸¤ä¸ªå‡½æ•°çš„æé™éƒ½å­˜åœ¨ã€‚",
            5: "ç¬¬ä¸‰ä¸ªæ³•åˆ™æ˜¯ä¹˜æ³•æ³•åˆ™ã€‚ä¸¤ä¸ªå‡½æ•°æé™çš„ç§¯ç­‰äºå®ƒä»¬ç§¯çš„æé™ã€‚ä»é¢ç§¯çš„è§’åº¦ç†è§£,ä¸¤ä¸ªè¾¹é•¿çš„ä¹˜ç§¯å°±æ˜¯çŸ©å½¢çš„é¢ç§¯ã€‚å¦‚æœä¸¤ä¸ªé‡åˆ†åˆ«è¶‹å‘äºAå’ŒB,é‚£ä¹ˆå®ƒä»¬çš„ä¹˜ç§¯è¶‹å‘äºAä¹˜ä»¥Bã€‚",
            6: "ç¬¬å››ä¸ªæ³•åˆ™æ˜¯é™¤æ³•æ³•åˆ™ã€‚ä¸¤ä¸ªå‡½æ•°æé™çš„å•†ç­‰äºå®ƒä»¬å•†çš„æé™,ä½†å‰ææ˜¯åˆ†æ¯çš„æé™ä¸ä¸ºé›¶ã€‚è¿™ä¸ªæ¡ä»¶éå¸¸é‡è¦,å› ä¸ºé™¤ä»¥é›¶æ˜¯æœªå®šä¹‰çš„ã€‚åˆ†æ¯å‡½æ•°çš„æé™å¿…é¡»ä¸ä¸ºé›¶,å¦åˆ™é™¤æ³•æ³•åˆ™ä¸é€‚ç”¨ã€‚",
            7: "å¤åˆå‡½æ•°çš„æé™æ³•åˆ™å‘Šè¯‰æˆ‘ä»¬,åœ¨æ»¡è¶³ä¸€å®šæ¡ä»¶ä¸‹,å¯ä»¥ä»å¤–åˆ°å†…é€å±‚è®¡ç®—æé™ã€‚æˆ‘ä»¬å¯ä»¥å…ˆç®—å†…å±‚å‡½æ•°çš„æé™,å†ç®—å¤–å±‚å‡½æ•°çš„æé™ã€‚è¿™ä¸ºæˆ‘ä»¬å¤„ç†å¤æ‚çš„å¤åˆå‡½æ•°æä¾›äº†æœ‰åŠ›å·¥å…·ã€‚",
            8: "è®©æˆ‘ä»¬é€šè¿‡ä¸€ä¸ªå…·ä½“ä¾‹å­æ¥åº”ç”¨è¿™äº›æ³•åˆ™ã€‚æˆ‘ä»¬è®¡ç®—è¿™ä¸ªåˆ†å¼æé™,å…ˆåˆ†åˆ«æ±‚å‡ºåˆ†å­å’Œåˆ†æ¯çš„æé™,ç„¶ååº”ç”¨é™¤æ³•æ³•åˆ™,å¾—åˆ°æœ€ç»ˆç­”æ¡ˆä¹åˆ†ä¹‹äº”ã€‚",
            9: "æ€»ç»“ä¸€ä¸‹,æé™çš„è¿ç®—æ³•åˆ™ä¸ºæˆ‘ä»¬æä¾›äº†å¼ºå¤§çš„è®¡ç®—å·¥å…·,åŒ…æ‹¬åŠ æ³•ã€å‡æ³•ã€ä¹˜æ³•ã€é™¤æ³•å’Œå¤åˆå‡½æ•°æ³•åˆ™ã€‚è®°ä½å‰ææ¡ä»¶,æ­£ç¡®åº”ç”¨è¿™äº›æ³•åˆ™,å°±èƒ½è§£å†³å¤§å¤šæ•°æé™è®¡ç®—é—®é¢˜ã€‚"
        };

        const autoPlayDurations = { 1: 14000, 2: 16000, 3: 15000, 4: 13000, 5: 15000, 6: 16000, 7: 16000, 8: 13000, 9: 15000 };

        // çŠ¶æ€æ›´æ–°å‡½æ•°
        function updateStatus(message, type = 'normal') {
            const indicator = document.getElementById('statusIndicator');
            const connectionStatus = document.getElementById('connectionStatus');

            if (indicator) {
                indicator.textContent = message;
                indicator.className = 'status-indicator';
                if (type === 'connected') {
                    indicator.classList.add('connected');
                } else if (type === 'error') {
                    indicator.classList.add('error');
                } else if (type === 'connecting') {
                    indicator.classList.add('connecting');
                }
            }

            if (connectionStatus) {
                connectionStatus.textContent = message;
                connectionStatus.style.color = type === 'connected' ? '#81c784' :
                                              type === 'error' ? '#f44336' : '#ffab40';
            }
        }

        // ç­‰å¾…SDKåŠ è½½å®Œæˆ
        function waitForSDK() {
            return new Promise((resolve, reject) => {
                if (typeof AvatarPlatform !== 'undefined') {
                    resolve();
                    return;
                }

                const timeout = setTimeout(() => {
                    reject(new Error('SDKåŠ è½½è¶…æ—¶,è¯·åˆ·æ–°é¡µé¢é‡è¯•'));
                }, 10000);

                window.addEventListener('sdkReady', function handler() {
                    clearTimeout(timeout);
                    window.removeEventListener('sdkReady', handler);
                    resolve();
                });
            });
        }

        document.addEventListener('DOMContentLoaded', () => {
            const contentArea = document.getElementById('contentArea');
            
            // å°é¢é¡µå·²ç»åœ¨HTMLä¸­å­˜åœ¨ï¼Œä¸éœ€è¦åŠ¨æ€åˆ›å»º

            // åˆ›å»ºå†…å®¹é¡µ
            boardContent.forEach((content, i) => {
                const page = document.createElement('div');
                page.className = 'page';
                page.dataset.page = i + 2;
                page.innerHTML = `
                    <div class="chalk-text">
                        <div class="page-title">${content.title}</div>
                        <div class="text-medium">${content.text}</div>
                    </div>
                    <div class="graph-container">
                        <svg id="viz-${i+2}" width="100%" height="100%"></svg>
                    </div>
                `;
                contentArea.appendChild(page);
            });

            // è®¾ç½®æ€»é¡µæ•°ï¼ˆ+1å› ä¸ºæœ‰å°é¢ï¼‰
            document.getElementById('totalPages').textContent = totalPages + 1;
            switchToPage(1, false);
            console.log('âœ¨ æé™çš„è¿ç®—æ³•åˆ™æ•™å­¦ç³»ç»Ÿåˆå§‹åŒ–å®Œæˆ');

            // ğŸš€ è‡ªåŠ¨å¯åŠ¨æ’­æ”¾ - å»¶è¿Ÿ3ç§’åè‡ªåŠ¨å¼€å§‹
            setTimeout(() => {
                console.log('ğŸš€ è‡ªåŠ¨å¯åŠ¨æ’­æ”¾...');
                startAutoPlay();
            }, 3000);
        });

        function switchToPage(pageNum, shouldSpeak = true) {
            if (pageNum < 1 || pageNum > totalPages + 1) return;
            currentPage = pageNum;
            document.querySelectorAll('.page').forEach(p => {
                p.classList.remove('active');
                p.style.display = 'none';
            });
            const activeSlide = document.querySelector(`[data-page="${pageNum}"]`);
            if (activeSlide) {
                activeSlide.style.display = 'grid';
                requestAnimationFrame(() => {
                    activeSlide.classList.add('active');
                    drawPageGraph(pageNum);
                    if(window.MathJax && typeof window.MathJax.typeset === 'function') {
                        window.MathJax.typeset();
                    }
                });
            }
            updatePageInfo();
            if (shouldSpeak && !isAutoPlaying) {
                speakContent(pageNum);
            }
        }

        // é™é»˜é¡µé¢åˆ‡æ¢ - ä¸æ’­æ”¾è¯­éŸ³,ä¸“ç”¨äºè‡ªåŠ¨æ’­æ”¾
        function switchToPageSilent(pageNum) {
            if (pageNum < 1 || pageNum > totalPages) {
                console.log(`âŒ é¡µé¢åˆ‡æ¢å¤±è´¥:é¡µç ${pageNum}è¶…å‡ºèŒƒå›´(1-${totalPages})`);
                return;
            }

            console.log(`ğŸ”„ å¼€å§‹åˆ‡æ¢åˆ°ç¬¬${pageNum}é¡µ...`);

            const allPages = document.querySelectorAll('.page');
            allPages.forEach(page => {
                page.classList.remove('active');
                page.style.display = 'none';
            });

            const targetPage = document.querySelector(`[data-page="${pageNum}"]`);
            if (targetPage) {
                targetPage.style.display = 'grid';
                currentPage = pageNum;
                updatePageInfo();
                console.log(`âœ… æˆåŠŸåˆ‡æ¢åˆ°ç¬¬${pageNum}é¡µ`);

                targetPage.offsetHeight; // è§¦å‘é‡ç»˜

                setTimeout(() => {
                    targetPage.classList.add('active');
                    drawPageGraph(pageNum);
                    console.log(`ğŸ¨ ç¬¬${pageNum}é¡µå›¾åƒç»˜åˆ¶å®Œæˆ`);
                }, 300);
            } else {
                console.log(`âŒ æœªæ‰¾åˆ°ç¬¬${pageNum}é¡µçš„DOMå…ƒç´ `);
            }
        }

        function drawPageGraph(pageNum) {
            // å°é¢é¡µï¼ˆç¬¬1é¡µï¼‰ä¸éœ€è¦ç»˜åˆ¶å›¾åƒï¼Œå·²æœ‰é™æ€SVG
            if (pageNum === 1) {
                console.log('âœ… ç¬¬1é¡µæ˜¯å°é¢é¡µï¼Œè·³è¿‡å›¾åƒç»˜åˆ¶');
                return;
            }

            const svg = d3.select(`#viz-${pageNum}`);
            if (svg.empty()) {
                console.log(`âš ï¸ æœªæ‰¾åˆ°#viz-${pageNum}çš„SVGå…ƒç´ `);
                return;
            }

            svg.selectAll("*").remove();

            const container = svg.node().parentNode;
            const width = container.clientWidth;
            const height = container.clientHeight;
            svg.attr('viewBox', `0 0 ${width} ${height}`);

            switch(pageNum) {
                case 2: drawPrerequGraph(svg, width, height); break;
                case 3: drawAdditionGraph(svg, width, height); break;
                case 4: drawSubtractionGraph(svg, width, height); break;
                case 5: drawMultiplicationGraph(svg, width, height); break;
                case 6: drawDivisionGraph(svg, width, height); break;
                case 7: drawCompositeGraph(svg, width, height); break;
                case 8: drawExampleGraph(svg, width, height); break;
                case 9: drawSummaryGraph(svg, width, height); break;
            }
        }

        function drawIntroGraph(svg, width, height) {
            const centerX = width / 2;
            const centerY = height / 2;

            // æ˜¾ç¤ºæé™è¿ç®—æ³•åˆ™çš„æ ‡é¢˜
            const title = svg.append("foreignObject")
                .attr("x", centerX - 180)
                .attr("y", centerY - 80)
                .attr("width", 360)
                .attr("height", 160)
                .append("xhtml:div")
                .style("font-size", "28px")
                .style("color", "#81c784")
                .style("text-align", "center")
                .style("font-weight", "bold")
                .html("æé™è¿ç®—æ³•åˆ™<br><span style='font-size:22px; color:#ffab40;'>åŠ å‡ä¹˜é™¤ + å¤åˆ</span>");

            title.style("opacity", 0).transition().duration(1000).delay(500).style("opacity", 1);
            setTimeout(() => { if(window.MathJax && typeof window.MathJax.typeset === 'function') window.MathJax.typeset(); }, 100);
        }

        function drawPrerequGraph(svg, width, height) {
            const centerX = width / 2;
            const centerY = height / 2;

            // æ˜¾ç¤ºå‰ææ¡ä»¶
            const prereq = svg.append("foreignObject")
                .attr("x", centerX - 200)
                .attr("y", centerY - 100)
                .attr("width", 400)
                .attr("height", 200)
                .append("xhtml:div")
                .style("font-size", "24px")
                .style("color", "#e1bee7")
                .style("text-align", "center")
                .style("font-weight", "bold")
                .html("$ \\lim_{x \\to a} f(x) = A $<br><br>$ \\lim_{x \\to a} g(x) = B $<br><br><span style='font-size:18px; color:#ffab40;'>æé™å¿…é¡»å­˜åœ¨!</span>");

            prereq.style("opacity", 0).transition().duration(1000).delay(300).style("opacity", 1);
            setTimeout(() => { if(window.MathJax && typeof window.MathJax.typeset === 'function') window.MathJax.typeset(); }, 100);
        }

        function drawAdditionGraph(svg, width, height) {
            drawOperationGraph(svg, width, height, "+", "#81c784", "A + B");
        }

        function drawSubtractionGraph(svg, width, height) {
            drawOperationGraph(svg, width, height, "-", "#e1bee7", "A - B");
        }

        function drawMultiplicationGraph(svg, width, height) {
            drawOperationGraph(svg, width, height, "Ã—", "#ffab40", "A Ã— B");
        }

        function drawDivisionGraph(svg, width, height) {
            drawOperationGraph(svg, width, height, "Ã·", "#f87171", "A/B (Bâ‰ 0)");
        }

        function drawOperationGraph(svg, width, height, operator, color, result) {
            const centerX = width / 2;
            const centerY = height / 2;

            // Aå€¼
            const a = svg.append("text")
                .attr("x", centerX - 100)
                .attr("y", centerY)
                .attr("text-anchor", "middle")
                .attr("font-size", "48px")
                .attr("fill", color)
                .attr("font-weight", "bold")
                .text("A");

            // è¿ç®—ç¬¦
            const op = svg.append("text")
                .attr("x", centerX)
                .attr("y", centerY)
                .attr("text-anchor", "middle")
                .attr("font-size", "48px")
                .attr("fill", "white")
                .attr("font-weight", "bold")
                .text(operator);

            // Bå€¼
            const b = svg.append("text")
                .attr("x", centerX + 100)
                .attr("y", centerY)
                .attr("text-anchor", "middle")
                .attr("font-size", "48px")
                .attr("fill", color)
                .attr("font-weight", "bold")
                .text("B");

            // ç­‰å·å’Œç»“æœ
            const equals = svg.append("text")
                .attr("x", centerX)
                .attr("y", centerY + 80)
                .attr("text-anchor", "middle")
                .attr("font-size", "36px")
                .attr("fill", "white")
                .text("=");

            const res = svg.append("text")
                .attr("x", centerX)
                .attr("y", centerY + 130)
                .attr("text-anchor", "middle")
                .attr("font-size", "36px")
                .attr("fill", color)
                .attr("font-weight", "bold")
                .text(result);

            // åŠ¨ç”»
            a.attr("opacity", 0).transition().duration(500).attr("opacity", 1);
            op.attr("opacity", 0).transition().delay(300).duration(500).attr("opacity", 1);
            b.attr("opacity", 0).transition().delay(600).duration(500).attr("opacity", 1);
            equals.attr("opacity", 0).transition().delay(1000).duration(500).attr("opacity", 1);
            res.attr("opacity", 0).transition().delay(1300).duration(500).attr("opacity", 1);
        }

        function drawCompositeGraph(svg, width, height) {
            const centerX = width / 2;
            const centerY = height / 2;

            // æ˜¾ç¤ºå¤åˆå‡½æ•°
            const comp = svg.append("foreignObject")
                .attr("x", centerX - 200)
                .attr("y", centerY - 100)
                .attr("width", 400)
                .attr("height", 200)
                .append("xhtml:div")
                .style("font-size", "28px")
                .style("color", "#81c784")
                .style("text-align", "center")
                .style("font-weight", "bold")
                .html("$ f(g(x)) $<br><br><span style='font-size:22px; color:#ffab40;'>ä»å¤–åˆ°å†…é€å±‚è®¡ç®—</span>");

            comp.style("opacity", 0).transition().duration(1000).delay(300).style("opacity", 1);
            setTimeout(() => { if(window.MathJax && typeof window.MathJax.typeset === 'function') window.MathJax.typeset(); }, 100);
        }

        function drawExampleGraph(svg, width, height) {
            const centerX = width / 2;
            const centerY = height / 2;

            // æ˜¾ç¤ºç¤ºä¾‹ç­”æ¡ˆ
            const example = svg.append("foreignObject")
                .attr("x", centerX - 200)
                .attr("y", centerY - 80)
                .attr("width", 400)
                .attr("height", 160)
                .append("xhtml:div")
                .style("font-size", "32px")
                .style("color", "#81c784")
                .style("text-align", "center")
                .style("font-weight", "bold")
                .html("$ \\frac{9}{5} $");

            example.style("opacity", 0).transition().duration(1000).delay(500).style("opacity", 1);
            setTimeout(() => { if(window.MathJax && typeof window.MathJax.typeset === 'function') window.MathJax.typeset(); }, 100);
        }

        function drawSummaryGraph(svg, width, height) {
            const centerX = width / 2;
            const centerY = height / 2;

            // æ˜¾ç¤ºæ€»ç»“
            const summary = svg.append("foreignObject")
                .attr("x", centerX - 180)
                .attr("y", centerY - 100)
                .attr("width", 360)
                .attr("height", 200)
                .append("xhtml:div")
                .style("font-size", "24px")
                .style("color", "#e1bee7")
                .style("text-align", "center")
                .style("font-weight", "bold")
                .html("äº”å¤§æ³•åˆ™<br><span style='font-size:20px; color:#81c784;'>+  -  Ã—  Ã·<br>å¤åˆå‡½æ•°</span>");

            summary.style("opacity", 0).transition().duration(1000).delay(300).style("opacity", 1);
        }

        // è™šæ‹Ÿäººæ§åˆ¶ - ä½¿ç”¨æ­£ç¡®çš„é…ç½®
        async function startTeaching() {
            const startBtn = document.getElementById('startBtn');
            startBtn.textContent = 'ğŸ”„ å¯åŠ¨ä¸­...';
            startBtn.disabled = true;

            try {
                console.log('â³ ç­‰å¾…SDKæ¨¡å—åŠ è½½...');
                updateStatus('ç­‰å¾…SDKåŠ è½½...', 'connecting');
                await waitForSDK();

                console.log('âœ… è®¯é£å®˜æ–¹SDKå·²åŠ è½½');
                updateStatus('SDKå·²åŠ è½½', 'connecting');

                if(avatarPlatform) {
                    avatarPlatform.destroy();
                }

                // åˆ›å»ºè™šæ‹Ÿäººå®ä¾‹
                avatarPlatform = new AvatarPlatform({
                    useInlinePlayer: true
                });

                // è®¾ç½®äº‹ä»¶ç›‘å¬
                avatarPlatform
                    .on('connected', (initResp) => {
                        console.log('ğŸ‰ è™šæ‹Ÿäººè¿æ¥æˆåŠŸ!', initResp);
                        isConnected = true;
                        isTeaching = true;
                        updateStatus('å·²è¿æ¥', 'connected');
                        startBtn.textContent = 'ğŸ’– è™šæ‹Ÿäººå·²å°±ç»ª';
                        startBtn.disabled = false;

                        setTimeout(() => {
                            speakContent(1);
                        }, 1000);
                    })
                    .on('disconnected', (err) => {
                        console.log('ğŸ”Œ è™šæ‹Ÿäººè¿æ¥æ–­å¼€');
                        isConnected = false;
                        isTeaching = false;
                        updateStatus('è¿æ¥æ–­å¼€', 'error');
                        startBtn.textContent = 'ğŸ€ å¼€å§‹è®²è¯¾';
                        startBtn.disabled = false;
                        if (err) {
                            console.error('âŒ è¿æ¥å¼‚å¸¸æ–­å¼€:', err);
                        }
                    })
                    .on('error', (error) => {
                        console.error('âŒ è™šæ‹Ÿäººé”™è¯¯:', error);
                        updateStatus('é”™è¯¯: ' + error.message, 'error');
                        startBtn.textContent = 'âŒ è¿æ¥å¤±è´¥';
                        startBtn.disabled = false;
                        isTeaching = false;
                        isConnected = false;
                    });

                // ä½¿ç”¨æ­£ç¡®çš„APIé…ç½®
                avatarPlatform.setApiInfo({
                    appId: 'f34b6995',
                    apiKey: '11bce7d2c44157a6875476f368ceb2a0',
                    apiSecret: 'NjIzNjk2ZWQ0ZGNjMGE0ODkzYjhmNzQy',
                    sceneId: '233767656807862272',
                    serverUrl: 'wss://avatar.cn-huadong-1.xf-yun.com/v1/interact'
                });

                // ä½¿ç”¨æ­£ç¡®çš„å…¨å±€å‚æ•°
                avatarPlatform.setGlobalParams({
                    stream: {
                        protocol: 'xrtc',
                        alpha: 1,
                        bitrate: 1000000,
                        fps: 25
                    },
                    avatar: {
                        avatar_id: '110332017',
                        width: 1920,
                        height: 1080,
                        scale: 1,
                        move_h: 0,
                        move_v: 0,
                        audio_format: 1
                    },
                    tts: {
                        vcn: 'x4_yiting',
                        speed: 50,
                        pitch: 50,
                        volume: 100
                    },
                    avatar_dispatch: {
                        interactive_mode: 1,
                        content_analysis: 0
                    }
                });

                // å¯åŠ¨è™šæ‹Ÿäºº
                await avatarPlatform.start({
                    wrapper: document.getElementById('avatarWrapper')
                });

                console.log('ğŸ“ è™šæ‹Ÿäººæ•™å­¦ç³»ç»Ÿå¯åŠ¨å®Œæˆ');

            } catch (error) {
                console.error('âŒ å¯åŠ¨å¤±è´¥:', error);
                updateStatus('å¯åŠ¨å¤±è´¥', 'error');
                startBtn.textContent = 'ğŸ”„ é‡è¯•';
                startBtn.disabled = false;

                alert(`å¯åŠ¨å¤±è´¥:${error.message}\n\nè¯·æ£€æŸ¥æ§åˆ¶å°è·å–è¯¦ç»†é”™è¯¯ä¿¡æ¯ã€‚`);
            }
        }

        // åŠ¨ä½œæ‰§è¡Œ
        async function performVirtualAction(actionId) {
            if (!isTeaching || !isConnected || !avatarPlatform) {
                console.log('âš ï¸ è™šæ‹Ÿäººæœªè¿æ¥,è·³è¿‡åŠ¨ä½œæ‰§è¡Œ');
                return;
            }

            try {
                await avatarPlatform.writeCmd("action", actionId);
                console.log(`âœ… æ‰§è¡ŒåŠ¨ä½œ: ${actionId}`);
            } catch (error) {
                console.error(`âŒ åŠ¨ä½œæ‰§è¡Œå¤±è´¥ (${actionId}):`, error);
            }
        }

        // åŠ¨ä½œæ˜ å°„
        function getActionsForPage(pageNum) {
            const actionMap = {
                1: 'A_RLH_welcome_O',
                2: 'A_LH_introduced_O',
                3: 'A_RH_please1_O',
                4: 'A_RLH_emphasize_O',
                5: 'A_U_No_pointing_O',
                6: 'A_RH_please1_O',
                7: 'A_LH_introduced_O',
                8: 'A_RLH_emphasize_O',
                9: 'A_RLH_welcome_O'
            };
            return actionMap[pageNum];
        }

        // è¯­éŸ³æ’­æ”¾
        async function speakContent(pageNum) {
            console.log(`ğŸ” æ£€æŸ¥æ’­æ”¾æ¡ä»¶: isTeaching=${isTeaching}, isConnected=${isConnected}, avatarPlatform=${!!avatarPlatform}`);

            if (!isTeaching || !isConnected || !avatarPlatform) {
                console.log('âš ï¸ è™šæ‹Ÿäººæœªè¿æ¥æˆ–æœªå¼€å§‹æ•™å­¦,è·³è¿‡è¯­éŸ³æ’­æŠ¥');
                return;
            }

            const content = subtitleScript[pageNum];
            if (!content) return;

            try {
                // å…ˆæ‰§è¡ŒåŠ¨ä½œ
                const actionId = getActionsForPage(pageNum);
                if (actionId) {
                    await performVirtualAction(actionId);
                }

                // ç„¶åæ’­æ”¾è¯­éŸ³å†…å®¹
                await avatarPlatform.writeText(content, {
                    nlp: false
                });

                console.log(`âœ… è™šæ‹Ÿäººè®²è§£ç¬¬${pageNum}é¡µ,åŠ¨ä½œ: ${actionId}`);

                // æ›´æ–°å­—å¹•æ˜¾ç¤º
                updateSubtitle(content);
            } catch (error) {
                console.error('âŒ è™šæ‹Ÿäººè®²è§£å¤±è´¥:', error);
            }
        }

        // æ›´æ–°å­—å¹•æ˜¾ç¤º
        function updateSubtitle(text) {
            const subtitleArea = document.getElementById('subtitleArea');
            if (subtitleArea) {
                subtitleArea.textContent = text;
            }
        }

        // é¡µé¢æ§åˆ¶å‡½æ•°
        function nextPage() {
            if (currentPage < totalPages) {
                switchToPage(currentPage + 1);
            }
        }
        function previousPage() {
            if (currentPage > 1) {
                switchToPage(currentPage - 1);
            }
        }
        function restart() { switchToPage(1); }
        function updatePageInfo() {
            document.getElementById('currentPage').textContent = currentPage;
        }

        // è·å–é¡µé¢æ ‡é¢˜
        function getPageTitle(pageNum) {
            return boardContent[pageNum - 1]?.title || `ç¬¬${pageNum}é¡µ`;
        }

        // è‡ªåŠ¨æ’­æ”¾åŠŸèƒ½
        let isAutoPlaying = false;
        async function startAutoPlay() {
            if (isAutoPlaying) {
                stopAutoPlay();
                return;
            }

            try {
                console.log('ğŸ¬ å¼€å§‹è‡ªåŠ¨æ’­æ”¾å®Œæ•´è¯¾ç¨‹...');
                isAutoPlaying = true;

                const autoPlayBtn = document.getElementById('autoPlayBtn');
                autoPlayBtn.textContent = 'â¹ï¸ åœæ­¢æ’­æ”¾';
                autoPlayBtn.style.background = 'linear-gradient(135deg, #f44336, #d32f2f)';

                updateStatus(`ğŸ¬ è‡ªåŠ¨æ’­æ”¾å°†åœ¨ 1 ç§’åå¼€å§‹,è¯·å‡†å¤‡å½•å±!`, 'connecting');
                await new Promise(resolve => setTimeout(resolve, 1000));

                updateStatus('ğŸ¬ è‡ªåŠ¨æ’­æ”¾å¼€å§‹!', 'connected');
                document.body.classList.add('recording-mode');

                // å¦‚æœè™šæ‹Ÿäººæœªè¿æ¥,åœ¨åå°å°è¯•è¿æ¥
                if (!avatarPlatform || !isConnected) {
                    console.log('ğŸ¬ å¯åŠ¨è™šæ‹Ÿäºº...');
                    await startTeaching();
                    await new Promise(resolve => setTimeout(resolve, 2000));
                }

                // é€é¡µæ’­æ”¾
                for (let page = 1; page <= totalPages; page++) {
                    try {
                        if (!isAutoPlaying) break;

                        console.log(`\nğŸ¬ === å¼€å§‹æ’­æ”¾ç¬¬${page}é¡µ/${totalPages}é¡µ ===`);

                        switchToPageSilent(page);
                        updateStatus(`ğŸ“– ç¬¬${page}é¡µ/${totalPages}é¡µ - ${getPageTitle(page)}`, 'connected');

                        await new Promise(resolve => setTimeout(resolve, 800));

                        if (isConnected && isTeaching && avatarPlatform) {
                            console.log(`ğŸµ æ’­æ”¾ç¬¬${page}é¡µè¯­éŸ³...`);
                            try {
                                await speakContent(page);
                                const pageTime = autoPlayDurations[page];
                                await new Promise(resolve => setTimeout(resolve, pageTime));
                            } catch (error) {
                                console.error(`âŒ ç¬¬${page}é¡µè¯­éŸ³æ’­æ”¾å¤±è´¥:`, error);
                                const pageTime = autoPlayDurations[page];
                                await new Promise(resolve => setTimeout(resolve, pageTime));
                            }
                        } else {
                            const pageTime = autoPlayDurations[page];
                            await new Promise(resolve => setTimeout(resolve, pageTime));
                        }

                        const waitTime = page === totalPages ? 2000 : 1000;
                        await new Promise(resolve => setTimeout(resolve, waitTime));

                    } catch (error) {
                        console.error(`âŒ ç¬¬${page}é¡µæ’­æ”¾è¿‡ç¨‹å‡ºé”™:`, error);
                        await new Promise(resolve => setTimeout(resolve, 2000));
                    }
                }

                if (isAutoPlaying) {
                    await new Promise(resolve => setTimeout(resolve, 3000));
                    stopAutoPlay();
                }

            } catch (error) {
                console.error('âŒ è‡ªåŠ¨æ’­æ”¾å¤±è´¥:', error);
                updateStatus('è‡ªåŠ¨æ’­æ”¾å¤±è´¥: ' + error.message, 'error');
                stopAutoPlay();
            }
        }

        function stopAutoPlay() {
            if (isAutoPlaying) {
                isAutoPlaying = false;
                window.playbackFinished = true;
                document.title = "PLAYBACK_FINISHED";
                console.log('ğŸ‰ æ’­æ”¾å®Œæˆï¼å·²ä¿®æ”¹æ ‡é¢˜ä¸º PLAYBACK_FINISHED');
                document.body.classList.remove('recording-mode');

                const autoPlayBtn = document.getElementById('autoPlayBtn');
                autoPlayBtn.textContent = 'ğŸ¬ è‡ªåŠ¨æ’­æ”¾';
                autoPlayBtn.style.background = 'linear-gradient(135deg, #2196f3, #1976d2)';

                console.log('â¹ï¸ è‡ªåŠ¨æ’­æ”¾å·²åœæ­¢');
                updateStatus('è‡ªåŠ¨æ’­æ”¾å·²åœæ­¢', 'normal');
            }
        }

        // é¡µé¢å…³é—­æ¸…ç†
        window.addEventListener('beforeunload', function() {
            if (isAutoPlaying) {
                stopAutoPlay();
            }

            if (avatarPlatform && isConnected) {
                avatarPlatform.stop();
            }
        });
  </script>
</body>
</html>
