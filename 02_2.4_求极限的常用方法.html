<!DOCTYPE html>

<html lang="zh-CN">
<head>
<meta charset="utf-8"/>
<meta content="width=device-width, initial-scale=1.0" name="viewport"/>
<title>
   02_2.4_æ±‚æé™çš„å¸¸ç”¨æ–¹æ³•
  </title>
<link href="https://fonts.googleapis.com" rel="preconnect"/>
<link crossorigin="" href="https://fonts.gstatic.com" rel="preconnect"/>
<link href="https://fonts.googleapis.com/css2?family=Noto+Serif+SC:wght@400;600;700&amp;display=swap" rel="stylesheet"/>
<script src="https://d3js.org/d3.v7.min.js">
</script>
<style>
   * { margin: 0; padding: 0; box-sizing: border-box; }
        body {
            font-family: 'Noto Serif SC', serif;
            background: #1a1a2e;
            overflow: hidden;
            height: 100vh;
            width: 100vw;
        }
        .blackboard {
            width: 100vw;
            height: 100vh;
            background: #1a1a2e;
            position: relative;
            border: 10px solid #795548;
            margin: 0;
        }
        .avatar-container {
            position: fixed;
            top: 60%; left: 50%;
            transform: translate(-50%, -50%);
            width: 975px; height: 1105px;
            overflow: hidden; z-index: 50;
            pointer-events: none; background: transparent;
            border: none; box-shadow: none;
        }
        .wrapper {
            width: 100%; height: 100%;
            background: transparent; pointer-events: auto;
        }
        .content-area {
            position: absolute;
            top: 20px; left: 50px; right: 50px; bottom: 120px;
            z-index: 10; overflow: hidden;
        }
        .page {
            position: absolute;
            top: 0; left: 0; right: 0; bottom: 0;
            opacity: 0; visibility: hidden;
            transition: all 0.7s ease-in-out;
            padding: 20px;
            display: grid;
            grid-template-columns: 2fr 3fr;
            gap: 20px;
            align-items: center;
        }
        .page.active {
            opacity: 1; visibility: visible;
        }
        /* å°é¢é¡µç‰¹æ®Šæ ·å¼ - è¦†ç›–gridå¸ƒå±€ */
        .page.cover-page {
            display: flex !important;
            grid-template-columns: none !important;
            padding: 0 !important;
            align-items: center !important;
            justify-content: center !important;
        }
        .page.cover-page > div {
            display: flex !important;
        }
        .chalk-text {
            color: #ffffff;
            font-family: 'Noto Serif SC', serif;
            text-rendering: optimizeLegibility;
            -webkit-font-smoothing: antialiased;
            -moz-osx-font-smoothing: grayscale;
        }
        .page-title {
            font-size: 22px; font-weight: bold;
            color: #e1bee7; margin-bottom: 1.5rem;
        }
        .text-medium {
            font-size: 18px; margin-bottom: 0.8rem;
            line-height: 1.8; color: #f3e5f5; font-weight: 500;
        }
        .text-medium p {
            margin-bottom: 1.5rem;
        }
        .text-medium strong {
            color: #81c784;
            font-weight: 600;
        }
        .graph-container {
            background: transparent;
            border: none;
            padding: 10px;
            width: 100%; height: 100%;
            display: flex; justify-content: center; align-items: center;
            overflow: visible;
        }
        .subtitle-area {
            position: absolute;
            bottom: 20px; left: 50px; right: 50px;
            height: 50px; background: rgba(0,0,0,0.8);
            border-radius: 8px; display: flex;
            align-items: center; justify-content: center;
            z-index: 60; color: white;
            font-size: 0.9rem; text-align: center;
            padding: 0 20px; line-height: 1.4;
        }
        .control-bar {
            position: fixed;
            left: -9999px;
            top: 50%;
            transform: translateY(-50%);
            width: 270px;
            height: auto;
            background: rgba(255, 255, 255, 0.15);
            backdrop-filter: blur(15px);
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            gap: 12px;
            z-index: 200;
            border-radius: 0 20px 20px 0;
            padding: 25px 20px;
            transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.2);
            border: 1px solid rgba(255, 255, 255, 0.2);
        }
        .control-bar:hover { 
            left: -9999px; 
            box-shadow: 0 12px 40px rgba(0,0,0,0.3); 
        }
        .control-bar::before {
            content: 'â–¶ï¸';
            position: absolute;
            top: 50%;
            right: -30px;
            transform: translateY(-50%);
            background: rgba(255, 255, 255, 0.2);
            backdrop-filter: blur(10px);
            padding: 12px 8px;
            border-radius: 0 15px 15px 0;
            font-size: 0.9rem;
            writing-mode: vertical-lr;
            border: 1px solid rgba(255, 255, 255, 0.1);
            color: #333;
        }
        .btn {
            padding: 14px 22px;
            background: rgba(255, 255, 255, 0.25);
            color: #333;
            border: 1px solid rgba(255, 255, 255, 0.3);
            border-radius: 12px;
            cursor: pointer;
            font-size: 14px;
            font-weight: 600;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            width: 100%;
            text-align: center;
            backdrop-filter: blur(5px);
            text-shadow: 0 1px 2px rgba(255,255,255,0.3);
        }
        .btn:hover { 
            background: rgba(255, 255, 255, 0.35); 
            transform: translateY(-3px); 
            box-shadow: 0 6px 20px rgba(0, 0, 0, 0.2); 
        }
        .btn.primary { 
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); 
            color: #fff; 
            text-shadow: 0 1px 2px rgba(0,0,0,0.3); 
        }
        .btn.primary:hover { 
            background: linear-gradient(135deg, #5a6fd8 0%, #6a4190 100%); 
            box-shadow: 0 8px 25px rgba(102,126,234,0.4); 
        }

        /* ç»Ÿä¸€å°†å›¾ä¸­å…ƒç´ æ”¹ä¸ºç™½è‰² */
        .graph-container svg .axis path,
        .graph-container svg .axis line {
            stroke: #ffffff !important;
            stroke-width: 2;
        }
        .graph-container svg .axis text {
            fill: #ffffff !important;
            font-size: 16px;
            font-weight: 500;
        }
        .graph-container svg .label {
            fill: #ffffff !important;
            font-size: 20px;
            font-weight: 600;
        }
        .graph-container svg .grid-line {
            stroke: #ffffff !important;
            stroke-width: 0.5;
            stroke-opacity: 0.3;
        }

        /* è¿æ¥çŠ¶æ€æŒ‡ç¤ºå™¨ */
        .status-indicator {
            position: absolute;
            top: 10px; right: 10px;
            padding: 5px 10px;
            background: rgba(0,0,0,0.5);
            color: white; border-radius: 5px;
            font-size: 12px; z-index: 100;
            transition: opacity 0.3s ease;
        }
        .status-indicator.connected { background: rgba(76, 175, 80, 0.8); }
        .status-indicator.error { background: rgba(244, 67, 54, 0.8); }
        .status-indicator.connecting { background: rgba(255, 152, 0, 0.8); }

        /* å½•åˆ¶æ¨¡å¼ä¸‹éšè—çŠ¶æ€æŒ‡ç¤ºå™¨å’Œæ§åˆ¶æ  */
        .recording-mode .status-indicator {
            opacity: 0; pointer-events: none;
        }
        .recording-mode .control-bar {
            left: -9999px; transition: left 0.5s ease;
        }
  </style>
</head>
<body>
<div class="blackboard">
<div class="status-indicator" id="statusIndicator">
    ç­‰å¾…è¿æ¥
   </div>
<div class="avatar-container">
<div class="wrapper" id="avatarWrapper">
</div>
</div>
<div class="content-area" id="contentArea">
<div class="page active cover-page" data-page="1">
<div style="display: flex !important; width: 100%; height: 100%; align-items: center; justify-content: center;">
<div style="flex: 1; text-align: center; padding: 2rem;">
<h1 style="font-size: 2.2rem; font-weight: bold; color: #f1c40f; text-shadow: 0 0 8px rgba(241, 196, 15, 0.5); margin-bottom: 1rem;">
        æ±‚æé™çš„å¸¸ç”¨æ–¹æ³•
       </h1>
<p style="font-size: 1.1rem; color: #9ca3af; margin-bottom: 1.5rem;">
        ç¬¬2ç«  è§†é¢‘ 2.4
       </p>
<div style="display: inline-block; text-align: left; margin-top: 1.5rem;">
<p style="font-size: 0.95rem; color: #e0e0e0; margin: 0.6rem 0;">
         âœ“ ç›´æ¥ä»£å…¥æ³•
        </p>
<p style="font-size: 0.95rem; color: #e0e0e0; margin: 0.6rem 0;">
         âœ“ å› å¼åˆ†è§£æ³•
        </p>
<p style="font-size: 0.95rem; color: #e0e0e0; margin: 0.6rem 0;">
         âœ“ æœ‰ç†åŒ–æ³•
        </p>
<p style="font-size: 0.95rem; color: #e0e0e0; margin: 0.6rem 0;">
         âœ“ ç­‰ä»·æ— ç©·å°æ›¿æ¢
        </p>
</div>
</div>
<div style="flex: 1; display: flex; align-items: center; justify-content: center;">
<svg style="width: 100%; max-width: 500px; height: 400px;" viewbox="0 0 600 500">
<defs>
<lineargradient id="grad1" x1="0%" x2="100%" y1="0%" y2="100%">
<stop offset="0%" style="stop-color:#3498db;stop-opacity:1">
</stop>
<stop offset="100%" style="stop-color:#9b59b6;stop-opacity:1">
</stop>
</lineargradient>
</defs>
<text fill="url(#grad1)" font-family="serif" font-size="60" text-anchor="middle" x="300" y="120">
         lim
         <animate attributename="opacity" dur="2s" repeatcount="indefinite" values="0.5;1;0.5">
</animate>
</text>
<line stroke="#3498db" stroke-width="3" x1="100" x2="500" y1="250" y2="250">
</line>
<circle cx="500" cy="250" fill="#e74c3c" r="15">
<animate attributename="r" dur="2s" repeatcount="indefinite" values="10;20;10">
</animate>
</circle>
<path d="M 100 250 Q 300 150 500 250" fill="none" stroke="#2ecc71" stroke-width="3">
<animate attributename="stroke-dasharray" dur="3s" repeatcount="indefinite" values="0,1000;1000,0">
</animate>
</path>
<text fill="#e74c3c" font-size="24" text-anchor="middle" x="500" y="300">
         xâ†’xâ‚€
        </text>
</svg>
</div>
</div>
</div>

<!-- Pages will be dynamically generated here -->
</div>
<div class="subtitle-area" id="subtitleArea">
    æ¬¢è¿å­¦ä¹ æ±‚æé™çš„å¸¸ç”¨æ–¹æ³•ï¼ç‚¹å‡»"å¼€å§‹è®²è¯¾"å¯åŠ¨è™šæ‹Ÿäººè®²å¸ˆã€‚
   </div>
<div class="control-bar">
<div style="color: white; margin-bottom: 1rem; text-align: center; font-size: 12px;">
     ç¬¬
     <span id="currentPage">
      1
     </span>
     é¡µ / å…±
     <span id="totalPages">
      19
     </span>
     é¡µ
    </div>
<div id="connectionStatus" style="color: #ffab40; margin-bottom: 1rem; text-align: center; font-size: 11px;">
     è™šæ‹Ÿäººæœªè¿æ¥
    </div>
<button class="btn" onclick="previousPage()">
     â¬…ï¸ ä¸Šä¸€é¡µ
    </button>
<button class="btn primary" id="startBtn" onclick="startTeaching()">
     ğŸ€ å¼€å§‹è®²è¯¾
    </button>
<button class="btn" onclick="nextPage()">
     ä¸‹ä¸€é¡µ â¡ï¸
    </button>
<button class="btn" onclick="restart()">
     ğŸ”„ é‡æ–°å¼€å§‹
    </button>
<button class="btn" id="autoPlayBtn" onclick="startAutoPlay()" style="background: linear-gradient(135deg, #2196f3, #1976d2);">
     ğŸ¬ è‡ªåŠ¨æ’­æ”¾
    </button>
<div style="color: #ffab40; margin-top: 0.5rem; text-align: center; font-size: 10px; line-height: 1.2;">
     ğŸ’¡ å½•åˆ¶æç¤ºï¼š
     <br/>
     ç‚¹å‡»è‡ªåŠ¨æ’­æ”¾åç«‹å³å¼€å§‹å½•å±
     <br/>
     ç³»ç»Ÿä¼šè‡ªåŠ¨å®Œæˆå…¨éƒ¨æ¼”ç¤º
    </div>
</div>
</div>
<script>
   window.MathJax = {
            tex: {
                inlineMath: [['$', '$'], ['\\(', '\\)']],
                displayMath: [['$$', '$$'], ['\\[', '\\]']],
                packages: ['base', 'ams']
            },
            startup: {
                pageReady: () => {
                    console.log('MathJax is ready.');
                    return MathJax.startup.defaultPageReady();
                }
            },
            options: {
                processHtmlClass: 'tex2jax_process',
                ignoreHtmlClass: 'tex2jax_ignore'
            }
        };
  </script>
<script async="" id="MathJax-script" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js">
</script>
<!-- è®¯é£å®˜æ–¹SDK -->
<script type="module">
        // æ’­æ”¾å®Œæˆæ ‡è®°ï¼ˆä¾›OBSæ£€æµ‹ï¼‰
        window.playbackFinished = false;

   try {
            const { default: AvatarPlatform, SDKEvents, PlayerEvents, RecorderEvents, UserMedia } = await import('./avatar-sdk-web_3.1.2.1002/index.js');
            window.AvatarPlatform = AvatarPlatform;
            window.SDKEvents = SDKEvents;
            window.PlayerEvents = PlayerEvents;
            window.RecorderEvents = RecorderEvents;
            window.UserMedia = UserMedia;
            console.log('âœ… è®¯é£å®˜æ–¹SDKæ¨¡å—å·²åŠ è½½');
            console.log('SDKç‰ˆæœ¬:', AvatarPlatform.getVersion());
        } catch (error) {
            console.error('âŒ SDKæ¨¡å—åŠ è½½å¤±è´¥:', error);
            // é™çº§å¤„ç†ï¼šåˆ›å»ºæ¨¡æ‹Ÿçš„AvatarPlatform
            window.AvatarPlatform = class {
                constructor(options) {
                    this.events = {};
                    this.options = options;
                    console.log("æ¨¡æ‹ŸSDKå·²åˆå§‹åŒ–");
                }
                on(event, callback) {
                    this.events[event] = callback;
                    return this;
                }
                setApiInfo(info) {
                    this.apiInfo = info;
                    console.log("API Info set:", info);
                }
                setGlobalParams(params) {
                    this.globalParams = params;
                    console.log("Global Params set:", params);
                }
                async start(config) {
                    console.log("æ¨¡æ‹Ÿå¯åŠ¨è™šæ‹Ÿäºº");
                    setTimeout(() => {
                        this.events.connected?.({ message: "æ¨¡æ‹Ÿè¿æ¥æˆåŠŸ" });
                    }, 1000);
                }
                async writeText(text, options) {
                    console.log("æ¨¡æ‹Ÿæ’­æ”¾æ–‡æœ¬:", text);
                    return Promise.resolve();
                }
                async writeCmd(type, actionId) {
                    console.log(`æ¨¡æ‹Ÿæ‰§è¡ŒåŠ¨ä½œ: ${type} - ${actionId}`);
                    return Promise.resolve();
                }
                stop() {
                    console.log("æ¨¡æ‹Ÿåœæ­¢è™šæ‹Ÿäºº");
                }
                destroy() {
                    console.log("æ¨¡æ‹Ÿé”€æ¯è™šæ‹Ÿäºº");
                }
                static getVersion() {
                    return "æ¨¡æ‹Ÿç‰ˆæœ¬ 1.0.0";
                }
            };
        }
        window.dispatchEvent(new CustomEvent('sdkReady'));
  </script>
<script>
   let avatarPlatform = null;
        let isConnected = false;
        let isTeaching = false;
        let currentPage = 1;
        const totalPages = 19;

        const boardContent = [
            // === æ–¹æ³•ä¸€ï¼šç›´æ¥ä»£å…¥æ³• (4é¡µ) ===
            {
                title: "æ–¹æ³•ä¸€ï¼šç›´æ¥ä»£å…¥æ³• - é—®é¢˜å¼•å…¥",
                text: "<p>æˆ‘ä»¬å…ˆæ¥çœ‹æœ€ç®€å•çš„æé™æ±‚è§£æ–¹æ³•ã€‚</p><p>æ±‚å‡½æ•° $f(x) = 2x+1$</p><p>å½“ $x$ è¶‹è¿‘äº $3$ æ—¶çš„æé™ã€‚</p><p><strong>æ•°å­¦è¡¨è¾¾å¼ä¸ºï¼š</strong></p><div class='tex2jax_process'>$$\\lim_{x \\to 3} (2x+1) = ?$$</div>"
            },
            {
                title: "è§‚å¯Ÿå‡½æ•°æ€§è´¨",
                text: "<p>å‡½æ•° $f(x) = 2x+1$ æ˜¯ä¸€ä¸ªç®€å•çš„çº¿æ€§å‡½æ•°ã€‚</p><p>å®ƒçš„å›¾åƒæ˜¯ä¸€æ¡<strong>è¿ç»­çš„ç›´çº¿</strong>ï¼Œåœ¨å®šä¹‰åŸŸå†…æ²¡æœ‰ä»»ä½•ä¸­æ–­æˆ–è·³è·ƒã€‚</p><p>è¿™æ˜¯åº”ç”¨ç›´æ¥ä»£å…¥æ³•çš„<strong>å¿…è¦æ¡ä»¶</strong>ã€‚</p>"
            },
            {
                title: "ç›´æ¥ä»£å…¥æ±‚è§£",
                text: "<p>å°† $x=3$ ä»£å…¥ $f(x)=2x+1$ï¼š</p><p>$f(3) = 2 \\times (3) + 1$</p><p>$= 6 + 1$</p><p>$= 7$</p><p>æˆ‘ä»¬å¾—åˆ°äº†ä¸€ä¸ª<strong>ç¡®å®šçš„æ•°å€¼</strong>ã€‚</p>"
            },
            {
                title: "ç»“è®º",
                text: "<p>å› ä¸ºæˆ‘ä»¬é€šè¿‡ç›´æ¥ä»£å…¥å¾—åˆ°äº†ä¸€ä¸ªç¡®å®šçš„å€¼ $7$ï¼Œæ‰€ä»¥è¿™ä¸ªå€¼å°±æ˜¯å‡½æ•°å½“ $x$ è¶‹è¿‘äº $3$ æ—¶çš„æé™ã€‚</p><p><strong>æœ€ç»ˆç­”æ¡ˆï¼š</strong></p><div class='tex2jax_process'>$$\\lim_{x \\to 3} (2x+1) = 7$$</div><p><strong>é€‚ç”¨èŒƒå›´ï¼š</strong>å‡½æ•°åœ¨è¯¥ç‚¹è¿ç»­æ—¶ï¼Œå¯ç›´æ¥ä»£å…¥æ±‚æé™ã€‚</p>"
            },

            // === æ–¹æ³•äºŒï¼šå› å¼åˆ†è§£æ³• (5é¡µ) ===
            {
                title: "æ–¹æ³•äºŒï¼šå› å¼åˆ†è§£æ³• - é—®é¢˜å¼•å…¥",
                text: "<p>ç°åœ¨æˆ‘ä»¬æ¥å¤„ç†æ›´å¤æ‚çš„æƒ…å†µã€‚</p><p>æ±‚ $\\displaystyle\\lim_{x \\to 2} \\frac{x^2 - 4}{x - 2}$</p><p>è¿™æ˜¯ä¸€ä¸ª<strong>åˆ†å¼æé™</strong>çš„å…¸å‹ä¾‹é¢˜ã€‚</p><p>å°è¯•ç›´æ¥ä»£å…¥ä¼šé‡åˆ°ä»€ä¹ˆé—®é¢˜å‘¢ï¼Ÿ</p>"
            },
            {
                title: "å‘ç°æœªå®šå¼",
                text: "<p>é¦–å…ˆï¼Œæˆ‘ä»¬å°è¯•å°† $x=2$ ç›´æ¥ä»£å…¥è¡¨è¾¾å¼ä¸­ã€‚</p><p>$\\frac{2^2 - 4}{2 - 2} = \\frac{4 - 4}{2 - 2} = \\frac{0}{0}$</p><p><strong>è¿™æ˜¯ä¸€ä¸ª\"0/0\"å‹æœªå®šå¼ï¼Œæ— æ³•ç›´æ¥å¾—å‡ºç»“æœã€‚</strong></p><p>æˆ‘ä»¬éœ€è¦ä½¿ç”¨å› å¼åˆ†è§£æ¥åŒ–ç®€ã€‚</p>"
            },
            {
                title: "å› å¼åˆ†è§£",
                text: "<p>å¯¹äº\"0/0\"å‹ï¼Œæˆ‘ä»¬å°è¯•å¯¹åˆ†å­è¿›è¡Œ<strong>å› å¼åˆ†è§£</strong>ã€‚</p><p>åˆ©ç”¨å¹³æ–¹å·®å…¬å¼ï¼š</p><p>$x^2 - 4 = (x-2)(x+2)$</p><p>è¿™æ ·æˆ‘ä»¬å°±èƒ½æ‰¾åˆ°åˆ†å­åˆ†æ¯çš„<strong>å…¬å› å¼</strong>ã€‚</p>"
            },
            {
                title: "çº¦å»å…¬å› å¼",
                text: "<p>å°†åˆ†è§£åçš„å¼å­ä»£å›åŸæé™ï¼š</p><p>$\\displaystyle\\lim_{x \\to 2} \\frac{(x-2)(x+2)}{x-2}$</p><p>å› ä¸º $x \\to 2$ ä½† $x \\neq 2$ï¼Œæ‰€ä»¥ $(x-2)$ ä¸ä¸ºé›¶ï¼Œå¯ä»¥<strong>çº¦åˆ†</strong>ã€‚</p><p>çº¦åˆ†åï¼š$\\displaystyle\\lim_{x \\to 2} (x+2)$</p>"
            },
            {
                title: "å†æ¬¡ä»£å…¥å¹¶å¾—å‡ºç»“è®º",
                text: "<p>åŒ–ç®€åï¼Œæˆ‘ä»¬å¯ä»¥å†æ¬¡è¿›è¡Œç›´æ¥ä»£å…¥ï¼š</p><p>$2+2=4$</p><p><strong>æœ€ç»ˆç­”æ¡ˆï¼š</strong></p><p>$\\displaystyle\\lim_{x \\to 2} \\frac{x^2 - 4}{x - 2} = 4$</p><p><strong>é€‚ç”¨èŒƒå›´ï¼š</strong>åˆ†å¼çš„ 0/0 å‹æœªå®šå¼ï¼Œé€šè¿‡å› å¼åˆ†è§£æ¶ˆé™¤é›¶å› å­ã€‚</p>"
            },

            // === æ–¹æ³•ä¸‰ï¼šæ ¹å¼æœ‰ç†åŒ– (5é¡µ) ===
            {
                title: "æ–¹æ³•ä¸‰ï¼šæ ¹å¼æœ‰ç†åŒ– - é—®é¢˜å¼•å…¥",
                text: "<p>å½“æé™é—®é¢˜ä¸­åŒ…å«æ ¹å¼æ—¶ï¼Œæˆ‘ä»¬éœ€è¦ä½¿ç”¨æœ‰ç†åŒ–æ–¹æ³•ã€‚</p><p>æ±‚ $\\displaystyle\\lim_{x \\to 0} \\frac{\\sqrt{x + 1} - 1}{x}$</p><p>å°è¯•ç›´æ¥ä»£å…¥ä¼šå‘ç°ï¼š</p><p>$\\frac{\\sqrt{0 + 1} - 1}{0} = \\frac{1 - 1}{0} = \\frac{0}{0}$</p><p>åˆæ˜¯ä¸€ä¸ª<strong>\"0/0\"å‹æœªå®šå¼</strong>ï¼Œä½†è¿™æ¬¡åŒ…å«æ ¹å¼ã€‚</p>"
            },
            {
                title: "ä¹˜ä»¥å…±è½­æ ¹å¼",
                text: "<p>å½“è¡¨è¾¾å¼ä¸­å«æœ‰æ ¹å¼æ—¶ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡ä¹˜ä»¥å®ƒçš„<strong>å…±è½­æ ¹å¼</strong>æ¥æ¶ˆé™¤æ ¹å·ã€‚</p><p>$\\sqrt{x+1}-1$ çš„å…±è½­æ ¹å¼æ˜¯ $\\sqrt{x+1}+1$</p><p>æˆ‘ä»¬å°†åˆ†å­åˆ†æ¯åŒæ—¶ä¹˜ä»¥å®ƒï¼š</p><p>$\\displaystyle\\lim_{x \\to 0} \\frac{\\sqrt{x+1}-1}{x} \\cdot \\frac{\\sqrt{x+1}+1}{\\sqrt{x+1}+1}$</p>"
            },
            {
                title: "åŒ–ç®€è¡¨è¾¾å¼",
                text: "<p>åˆ†å­åˆ©ç”¨å¹³æ–¹å·®å…¬å¼ $(a-b)(a+b)=a^2-b^2$ è¿›è¡ŒåŒ–ç®€ï¼š</p><p>$(\\sqrt{x+1}-1)(\\sqrt{x+1}+1) = (\\sqrt{x+1})^2 - 1^2 = (x+1)-1 = x$</p><p>äºæ˜¯åŸå¼å˜ä¸ºï¼š</p><p>$\\displaystyle\\lim_{x \\to 0} \\frac{x}{x(\\sqrt{x+1}+1)}$</p><p>åˆ†å­ä¸Šçš„æ ¹å·æˆåŠŸæ¶ˆé™¤ï¼</p>"
            },
            {
                title: "çº¦åˆ†å¹¶ä»£å…¥",
                text: "<p>åŒ–ç®€åï¼Œæˆ‘ä»¬å‘ç°åˆ†å­åˆ†æ¯æœ‰å…¬å› å¼ $x$ï¼Œå¯ä»¥çº¦å»ï¼š</p><p>$\\displaystyle\\lim_{x \\to 0} \\frac{1}{\\sqrt{x+1}+1}$</p><p>ç°åœ¨ï¼Œå†æ¬¡ç›´æ¥ä»£å…¥ $x=0$ï¼š</p><p>$\\frac{1}{\\sqrt{0+1}+1} = \\frac{1}{1+1} = \\frac{1}{2}$</p>"
            },
            {
                title: "å¾—å‡ºç»“è®º",
                text: "<p>æˆ‘ä»¬é€šè¿‡æ ¹å¼æœ‰ç†åŒ–ï¼ŒæˆåŠŸæ¶ˆé™¤äº†é›¶å› å­ï¼Œå¾—åˆ°äº†ä¸€ä¸ªç¡®å®šçš„æ•°å€¼ $\\frac{1}{2}$ã€‚</p><p><strong>æœ€ç»ˆç­”æ¡ˆï¼š</strong></p><p>$\\displaystyle\\lim_{x \\to 0} \\frac{\\sqrt{x + 1} - 1}{x} = \\frac{1}{2}$</p><p><strong>é€‚ç”¨èŒƒå›´ï¼š</strong>å«æ ¹å¼çš„ 0/0 å‹æœªå®šå¼ï¼Œé€šè¿‡ä¹˜ä»¥å…±è½­æ ¹å¼è¿›è¡Œæœ‰ç†åŒ–ã€‚</p>"
            },

            // === æ–¹æ³•å››ï¼šé€šåˆ†æ³• (4é¡µ) ===
            {
                title: "æ–¹æ³•å››ï¼šé€šåˆ†æ³• - âˆ-âˆå‹æœªå®šå¼",
                text: "<p>å½“é‡åˆ° $\\infty - \\infty$ å‹æœªå®šå¼æ—¶ï¼Œ<strong>é€šåˆ†</strong>æ˜¯å…³é”®çš„ç¬¬ä¸€æ­¥ã€‚</p><p>ä¾‹é¢˜ï¼š$\\displaystyle\\lim_{x \\to \\infty} \\left(\\frac{1}{x - 1} - \\frac{1}{x + 1}\\right)$</p><p><strong>ç­–ç•¥ï¼š</strong>é€šè¿‡é€šåˆ†å°†ä¸¤ä¸ªåˆ†å¼åˆå¹¶ä¸ºä¸€ä¸ªåˆ†å¼ï¼Œå†è¿›è¡ŒåŒ–ç®€ã€‚</p>"
            },
            {
                title: "é€šåˆ†ä¸åˆå¹¶",
                text: "<p>æˆ‘ä»¬å°†ä¸¤ä¸ªåˆ†å¼é€šåˆ†ï¼Œå¾—åˆ°ç›¸åŒçš„åˆ†æ¯ $(x-1)(x+1)$ï¼š</p><p>$\\displaystyle\\lim_{x \\to \\infty} \\frac{(x + 1) - (x - 1)}{(x - 1)(x + 1)}$</p><p><strong>åˆ†å­åŒ–ç®€ï¼š</strong></p><p>$(x + 1) - (x - 1) = x + 1 - x + 1 = 2$</p><p>åˆå¹¶åï¼š$\\displaystyle\\lim_{x \\to \\infty} \\frac{2}{x^2 - 1}$</p>"
            },
            {
                title: "æ±‚è§£æé™",
                text: "<p>åŒ–ç®€åï¼Œæˆ‘ä»¬å¾—åˆ°äº†æ ‡å‡†çš„ $\\frac{å¸¸æ•°}{\\infty}$ å‹æé™ã€‚</p><p>$\\frac{2}{\\infty^2 - 1} = \\frac{2}{\\infty} = 0$</p><p><strong>æœ€ç»ˆç­”æ¡ˆï¼š</strong></p><p>$\\displaystyle\\lim_{x \\to \\infty} \\left(\\frac{1}{x - 1} - \\frac{1}{x + 1}\\right) = 0$</p>"
            },
            {
                title: "æ€»ç»“ï¼šå››ç§å¸¸ç”¨æ–¹æ³•",
                text: "<p><strong>æ–¹æ³•é€‰æ‹©æŒ‡å—ï¼š</strong></p><p><strong>1. ç›´æ¥ä»£å…¥æ³•ï¼š</strong>å‡½æ•°åœ¨è¯¥ç‚¹è¿ç»­ â†’ ç›´æ¥ä»£å…¥</p><p><strong>2. å› å¼åˆ†è§£æ³•ï¼š</strong>0/0 å‹åˆ†å¼æœªå®šå¼ â†’ å› å¼åˆ†è§£çº¦åˆ†</p><p><strong>3. æ ¹å¼æœ‰ç†åŒ–ï¼š</strong>å«æ ¹å¼çš„ 0/0 å‹ â†’ ä¹˜ä»¥å…±è½­æ ¹å¼</p><p><strong>4. é€šåˆ†æ³•ï¼š</strong>âˆ-âˆ å‹æœªå®šå¼ â†’ é€šåˆ†åˆå¹¶åŒ–ç®€</p><p><strong>æ ¸å¿ƒæ€æƒ³ï¼š</strong>å°†æœªå®šå¼è½¬åŒ–ä¸ºç¡®å®šå½¢å¼ï¼Œå†æ±‚è§£æé™ã€‚</p>"
            }
        ];

        const subtitleScript = {
            1: "åŒå­¦ä»¬å¥½ï¼Œä»Šå¤©æˆ‘ä»¬æ¥ç³»ç»Ÿå­¦ä¹ æ±‚è§£æé™é—®é¢˜çš„å››ç§å¸¸ç”¨ä»£æ•°æ–¹æ³•ã€‚åˆ†åˆ«æ˜¯ç›´æ¥ä»£å…¥æ³•ã€å› å¼åˆ†è§£æ³•ã€æ ¹å¼æœ‰ç†åŒ–å’Œé€šåˆ†æ³•ã€‚æ¥ä¸‹æ¥æˆ‘ä»¬å°†é€šè¿‡å…·ä½“ä¾‹é¢˜ï¼Œé€ä¸€æŒæ¡è¿™äº›æ–¹æ³•ã€‚",

            // ç›´æ¥ä»£å…¥æ³• (2-5)
            2: "é¦–å…ˆæˆ‘ä»¬å­¦ä¹ æœ€ç®€å•çš„æ–¹æ³•â€”â€”ç›´æ¥ä»£å…¥æ³•ã€‚æˆ‘ä»¬è¦è®¡ç®—çš„æ˜¯å‡½æ•° f(x) = 2x+1ï¼Œå½“xæ— é™è¶‹è¿‘äº3æ—¶çš„æé™å€¼ã€‚",
            3: "è§£é¢˜çš„ç¬¬ä¸€æ­¥ï¼Œæ˜¯å…ˆè§‚å¯Ÿè¿™ä¸ªå‡½æ•°ã€‚æˆ‘ä»¬çœ‹åˆ°ï¼Œf(x) = 2x+1 æ˜¯ä¸€ä¸ªçº¿æ€§å‡½æ•°ï¼Œå®ƒçš„å›¾åƒæ˜¯ä¸€æ¡è¿ç»­ä¸æ–­çš„ç›´çº¿ã€‚è¿™ä¸€ç‚¹å¯¹äºæˆ‘ä»¬é€‰æ‹©è§£æ³•è‡³å…³é‡è¦ã€‚",
            4: "æ­£å› ä¸ºå‡½æ•°æ˜¯è¿ç»­çš„ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨æœ€ç®€å•çš„æ–¹æ³•â€”â€”ç›´æ¥ä»£å…¥æ³•ã€‚æŠŠxæ›¿æ¢æˆ3ï¼Œå¾—åˆ°äºŒä¹˜ä»¥ä¸‰ï¼Œå†åŠ ä¸€ã€‚ä¹Ÿå°±æ˜¯å…­åŠ ä¸€ï¼Œç»“æœç­‰äºä¸ƒã€‚",
            5: "ç”±äºç›´æ¥ä»£å…¥å¾—åˆ°äº†ä¸€ä¸ªç¡®å®šçš„æ•°å€¼7ï¼Œæˆ‘ä»¬å°±å¯ä»¥å¾—å‡ºç»“è®ºï¼šå‡½æ•° 2x+1 åœ¨ x è¶‹è¿‘äº 3 æ—¶çš„æé™å°±æ˜¯7ã€‚è¿™å°±æ˜¯ç›´æ¥ä»£å…¥æ³•çš„åº”ç”¨ï¼Œéå¸¸ç›´è§‚ã€‚",

            // å› å¼åˆ†è§£æ³• (6-10)
            6: "ç°åœ¨æˆ‘ä»¬æ¥å­¦ä¹ ç¬¬äºŒç§æ–¹æ³•â€”â€”å› å¼åˆ†è§£æ³•ã€‚è¿™ä¸ªæ–¹æ³•ç”¨äºå¤„ç†åˆ†å¼æé™é—®é¢˜ã€‚æˆ‘ä»¬å°†é€šè¿‡æ±‚è§£è¿™ä¸ªåˆ†å¼æé™çš„ä¾‹é¢˜æ¥æŒæ¡å®ƒã€‚",
            7: "æ±‚è§£æé™çš„ç¬¬ä¸€æ­¥ï¼Œæ€»æ˜¯å°è¯•ç›´æ¥ä»£å…¥ã€‚æˆ‘ä»¬æŠŠ x ç­‰äº 2 ä»£å…¥ï¼Œä¼šå‘ç°åˆ†å­æ˜¯ 4 å‡ 4 ç­‰äº 0ï¼Œåˆ†æ¯æ˜¯ 2 å‡ 2 ç­‰äº 0ã€‚è¿™å°±å¾—åˆ°äº† 0 é™¤ä»¥ 0 çš„å½¢å¼ï¼Œè¿™æ˜¯ä¸€ä¸ªæœªå®šå¼ï¼Œè¯´æ˜æˆ‘ä»¬éœ€è¦ç”¨æ›´å·§å¦™çš„æ–¹æ³•ã€‚",
            8: "é¢å¯¹ 0/0 å‹æœªå®šå¼ï¼Œå› å¼åˆ†è§£æ˜¯æˆ‘ä»¬çš„æœ‰åŠ›æ­¦å™¨ã€‚è§‚å¯Ÿåˆ†å­ x çš„å¹³æ–¹å‡ 4ï¼Œæˆ‘ä»¬å¯ä»¥åˆ©ç”¨å¹³æ–¹å·®å…¬å¼ï¼Œå°†å®ƒåˆ†è§£ä¸º x å‡ 2 ä¹˜ä»¥ x åŠ  2ã€‚è¿™æ ·å°±èƒ½æ‰¾åˆ°åˆ†å­åˆ†æ¯çš„å…¬å› å¼ã€‚",
            9: "ç°åœ¨ï¼Œæˆ‘ä»¬å°†åˆ†è§£åçš„å¼å­ä»£å›åŸæé™ã€‚å¤§å®¶çœ‹ï¼Œåˆ†å­å’Œåˆ†æ¯éƒ½å‡ºç°äº†å…¬å› å¼ x å‡ 2ã€‚å› ä¸ºæ±‚æé™çš„è¿‡ç¨‹ä¸­ï¼Œx åªæ˜¯æ— é™è¶‹è¿‘äº2ï¼Œä½†æ°¸è¿œä¸ç­‰äº2ï¼Œæ‰€ä»¥ x å‡ 2 è¿™ä¸ªå› å­ä¸ä¸ºé›¶ï¼Œæˆ‘ä»¬å¯ä»¥å®‰å…¨åœ°å°†å®ƒçº¦å»ã€‚",
            10: "çº¦å»å…¬å› å¼åï¼ŒåŸæ¥å¤æ‚çš„åˆ†å¼æé™ï¼Œå°±ç®€åŒ–æˆäº†ä¸€ä¸ªéå¸¸ç®€å•çš„æ•´å¼æé™ã€‚æˆ‘ä»¬å†æ¬¡ä½¿ç”¨ç›´æ¥ä»£å…¥æ³•ï¼Œå°† x ç­‰äº 2 ä»£å…¥ï¼Œå¾—åˆ° 2 åŠ  2 ç­‰äº 4ã€‚è¿™å°±æ˜¯å› å¼åˆ†è§£æ³•è§£å†³æœªå®šå¼æé™çš„å®Œæ•´è¿‡ç¨‹ã€‚",

            // æ ¹å¼æœ‰ç†åŒ– (11-15)
            11: "ç¬¬ä¸‰ç§æ–¹æ³•æ˜¯æ ¹å¼æœ‰ç†åŒ–ã€‚åŒå­¦ä»¬ï¼Œå½“æé™é—®é¢˜ä¸­åŒ…å«æ ¹å¼æ—¶ï¼Œæˆ‘ä»¬éœ€è¦ä½¿ç”¨è¿™ä¸ªæ–¹æ³•ã€‚å¤§å®¶çœ‹ï¼Œè¿™ä¸ªå‡½æ•°çš„åˆ†å­éƒ¨åˆ†åŒ…å«äº†ä¸€ä¸ªæ ¹å¼ï¼Œç›´æ¥ä»£å…¥ä¼šå¾—åˆ° 0/0 å‹æœªå®šå¼ã€‚",
            12: "å¤„ç†æ ¹å¼çš„è¯€çªï¼Œå°±æ˜¯ä¹˜ä»¥å®ƒçš„å…±è½­æ ¹å¼ã€‚å¯¹äºæ ¹å·ä¸‹x+1å†å‡1ï¼Œå®ƒçš„å…±è½­å½¢å¼å°±æ˜¯æ ¹å·ä¸‹x+1å†åŠ 1ã€‚ä¸ºäº†ä¿æŒåˆ†å¼çš„å€¼ä¸å˜ï¼Œæˆ‘ä»¬è¦åœ¨åˆ†å­å’Œåˆ†æ¯ä¸ŠåŒæ—¶ä¹˜ä»¥è¿™ä¸ªå…±è½­æ ¹å¼ã€‚",
            13: "ç°åœ¨çœ‹åˆ†å­ï¼Œå®ƒå˜æˆäº†(a-b)ä¹˜ä»¥(a+b)çš„å½¢å¼ï¼Œæ­£å¥½æ˜¯å¹³æ–¹å·®å…¬å¼ã€‚è®¡ç®—ç»“æœæ˜¯x+1å†å‡1ï¼Œå°±ç­‰äºxã€‚è¿™æ ·ä¸€æ¥ï¼Œæˆ‘ä»¬å°±æˆåŠŸåœ°æ¶ˆé™¤äº†åˆ†å­ä¸Šçš„æ ¹å·ï¼",
            14: "åŒ–ç®€ä¹‹åï¼Œæˆ‘ä»¬æƒŠå–œåœ°å‘ç°ï¼Œåˆ†å­ä¸Šçš„xå’Œåˆ†æ¯ä¸­çš„xå¯ä»¥ç›¸äº’çº¦å»ã€‚æé™é—®é¢˜å°±å˜æˆäº†ä¸€ä¸ªéå¸¸ç®€å•çš„åˆ†å¼ã€‚æˆ‘ä»¬å†æ¬¡å°†xç­‰äº0ä»£å…¥ï¼Œå¾—åˆ°æ ¹å·1åŠ 1åˆ†ä¹‹ä¸€ï¼Œä¹Ÿå°±æ˜¯äºŒåˆ†ä¹‹ä¸€ã€‚",
            15: "é€šè¿‡ä¹˜ä»¥å…±è½­æ ¹å¼è¿›è¡Œæœ‰ç†åŒ–ï¼Œæˆ‘ä»¬å·§å¦™åœ°è§£å†³äº†0/0å‹æœªå®šå¼ï¼Œå¹¶å¾—åˆ°äº†æœ€ç»ˆç­”æ¡ˆï¼šäºŒåˆ†ä¹‹ä¸€ã€‚è¿™ä¸ªæ–¹æ³•åœ¨å¤„ç†å¸¦æ ¹å·çš„æé™é—®é¢˜æ—¶éå¸¸æœ‰æ•ˆã€‚",

            // é€šåˆ†æ³• (16-19)
            16: "æœ€åä¸€ç§æ–¹æ³•æ˜¯é€šåˆ†æ³•ï¼Œç”¨äºå¤„ç†æ— ç©·å‡æ— ç©·å‹æœªå®šå¼ã€‚å½“ x è¶‹å‘äºæ— ç©·å¤§æ—¶ï¼Œä¸¤ä¸ªåˆ†å¼éƒ½è¶‹å‘äº0ï¼Œå®ƒä»¬çš„å·®å€¼å½¢å¼ä¸ºæœªå®šå¼ã€‚è§£å†³è¿™ç±»é—®é¢˜çš„å…³é”®æŠ€å·§å°±æ˜¯é€šåˆ†ã€‚",
            17: "é¦–å…ˆï¼Œæˆ‘ä»¬æ‰¾åˆ°ä¸¤ä¸ªåˆ†å¼çš„æœ€å°å…¬åˆ†æ¯ï¼Œä¹Ÿå°±æ˜¯xå‡1ä¹˜ä»¥xåŠ 1ã€‚ç„¶åæˆ‘ä»¬å°†ä¸¤ä¸ªåˆ†å¼é€šåˆ†å¹¶åˆå¹¶åˆ†å­ï¼Œå¾—åˆ°xåŠ 1å‡å»xå‡1ï¼ŒåŒ–ç®€åå¾—åˆ°2ã€‚",
            18: "åŒ–ç®€åï¼Œæˆ‘ä»¬å¾—åˆ°ä¸€ä¸ªéå¸¸ç®€å•çš„åˆ†å¼ï¼šxçš„å¹³æ–¹å‡1åˆ†ä¹‹2ã€‚ç°åœ¨ï¼Œæˆ‘ä»¬å†æ¬¡å°è¯•å°†xè¶‹å‘äºæ— ç©·å¤§ä»£å…¥ï¼Œåˆ†æ¯ä¼šå˜å¾—æ— é™å¤§ï¼Œå› æ­¤æ•´ä¸ªåˆ†å¼çš„ç»“æœè¶‹å‘äº0ã€‚é—®é¢˜å°±è§£å†³äº†ã€‚",
            19: "å¥½çš„åŒå­¦ä»¬ï¼Œä»Šå¤©æˆ‘ä»¬ç³»ç»Ÿå­¦ä¹ äº†æ±‚è§£æé™çš„å››ç§å¸¸ç”¨æ–¹æ³•ã€‚æ¯ç§æ–¹æ³•éƒ½æœ‰å…¶ç‰¹å®šçš„é€‚ç”¨åœºæ™¯ã€‚ç›´æ¥ä»£å…¥æ³•ç”¨äºè¿ç»­å‡½æ•°ï¼Œå› å¼åˆ†è§£æ³•ç”¨äºåˆ†å¼çš„ 0/0 å‹æœªå®šå¼ï¼Œæ ¹å¼æœ‰ç†åŒ–ç”¨äºå«æ ¹å¼çš„æœªå®šå¼ï¼Œé€šåˆ†æ³•ç”¨äºæ— ç©·å‡æ— ç©·å‹ã€‚æŒæ¡è¿™äº›æ–¹æ³•ï¼Œæˆ‘ä»¬å°±èƒ½åº”å¯¹å¤§éƒ¨åˆ†çš„æé™æ±‚è§£é—®é¢˜äº†ã€‚"
        };

        const autoPlayDurations = {
            1: 14000,   // å¼•å¯¼é¡µ
            2: 10000,   // ç›´æ¥ä»£å…¥æ³•-1
            3: 12000,   // ç›´æ¥ä»£å…¥æ³•-2
            4: 10000,   // ç›´æ¥ä»£å…¥æ³•-3
            5: 12000,   // ç›´æ¥ä»£å…¥æ³•-4
            6: 10000,   // å› å¼åˆ†è§£æ³•-1
            7: 18000,   // å› å¼åˆ†è§£æ³•-2
            8: 15000,   // å› å¼åˆ†è§£æ³•-3
            9: 20000,   // å› å¼åˆ†è§£æ³•-4
            10: 15000,  // å› å¼åˆ†è§£æ³•-5
            11: 12000,  // æ ¹å¼æœ‰ç†åŒ–-1
            12: 18000,  // æ ¹å¼æœ‰ç†åŒ–-2
            13: 15000,  // æ ¹å¼æœ‰ç†åŒ–-3
            14: 14000,  // æ ¹å¼æœ‰ç†åŒ–-4
            15: 12000,  // æ ¹å¼æœ‰ç†åŒ–-5
            16: 12000,  // é€šåˆ†æ³•-1
            17: 12000,  // é€šåˆ†æ³•-2
            18: 12000,  // é€šåˆ†æ³•-3
            19: 18000   // æ€»ç»“
        };

        // çŠ¶æ€æ›´æ–°å‡½æ•°
        function updateStatus(message, type = 'normal') {
            const indicator = document.getElementById('statusIndicator');
            const connectionStatus = document.getElementById('connectionStatus');

            if (indicator) {
                indicator.textContent = message;
                indicator.className = 'status-indicator';
                if (type === 'connected') {
                    indicator.classList.add('connected');
                } else if (type === 'error') {
                    indicator.classList.add('error');
                } else if (type === 'connecting') {
                    indicator.classList.add('connecting');
                }
            }

            if (connectionStatus) {
                connectionStatus.textContent = message;
                connectionStatus.style.color = type === 'connected' ? '#81c784' :
                                              type === 'error' ? '#f44336' : '#ffab40';
            }
        }

        // ç­‰å¾…SDKåŠ è½½å®Œæˆ
        function waitForSDK() {
            return new Promise((resolve, reject) => {
                if (typeof AvatarPlatform !== 'undefined') {
                    resolve();
                    return;
                }

                const timeout = setTimeout(() => {
                    reject(new Error('SDKåŠ è½½è¶…æ—¶ï¼Œè¯·åˆ·æ–°é¡µé¢é‡è¯•'));
                }, 10000);

                window.addEventListener('sdkReady', function handler() {
                    clearTimeout(timeout);
                    window.removeEventListener('sdkReady', handler);
                    resolve();
                });
            });
        }

        document.addEventListener('DOMContentLoaded', () => {
            const contentArea = document.getElementById('contentArea');
            
            // å°é¢é¡µå·²ç»åœ¨HTMLä¸­å­˜åœ¨ï¼Œä¸éœ€è¦åŠ¨æ€åˆ›å»º

            // åˆ›å»ºå†…å®¹é¡µ
            boardContent.forEach((content, i) => {
                const page = document.createElement('div');
                page.className = 'page';
                page.dataset.page = i + 2;
                page.innerHTML = `
                    <div class="chalk-text">
                        <div class="page-title">${content.title}</div>
                        <div class="text-medium">${content.text}</div>
                    </div>
                    <div class="graph-container">
                        <svg id="viz-${i+2}" width="100%" height="100%"></svg>
                    </div>
                `;
                contentArea.appendChild(page);
            });

            // è®¾ç½®æ€»é¡µæ•°ï¼ˆ+1å› ä¸ºæœ‰å°é¢ï¼‰
            document.getElementById('totalPages').textContent = totalPages + 1;
            switchToPage(1, false);
            console.log('âœ¨ æé™æ•™å­¦ç³»ç»Ÿåˆå§‹åŒ–å®Œæˆ');

            // ğŸš€ è‡ªåŠ¨å¯åŠ¨æ’­æ”¾ - å»¶è¿Ÿ3ç§’åè‡ªåŠ¨å¼€å§‹
            setTimeout(() => {
                console.log('ğŸš€ è‡ªåŠ¨å¯åŠ¨æ’­æ”¾...');
                startAutoPlay();
            }, 3000);
        });

        function switchToPage(pageNum, shouldSpeak = true) {
            if (pageNum < 1 || pageNum > totalPages + 1) return;
            currentPage = pageNum;
            document.querySelectorAll('.page').forEach(p => p.classList.remove('active'));
            document.querySelector(`[data-page="${pageNum}"]`).classList.add('active');
            updatePageInfo();

            setTimeout(() => {
                drawPageGraph(pageNum);
                if(window.MathJax && window.MathJax.typeset) {
                    window.MathJax.typeset();
                }
            }, 50);

            if (shouldSpeak && !isAutoPlaying) {
                speakContent(pageNum);
            }
        }

        // é™é»˜é¡µé¢åˆ‡æ¢
        function switchToPageSilent(pageNum) {
            if (pageNum < 1 || pageNum > totalPages) {
                console.log(`âŒ é¡µé¢åˆ‡æ¢å¤±è´¥ï¼šé¡µç ${pageNum}è¶…å‡ºèŒƒå›´(1-${totalPages})`);
                return;
            }

            console.log(`ğŸ”„ å¼€å§‹åˆ‡æ¢åˆ°ç¬¬${pageNum}é¡µ...`);

            const allPages = document.querySelectorAll('.page');
            allPages.forEach(page => page.classList.remove('active'));

            const targetPage = document.querySelector(`[data-page="${pageNum}"]`);
            if (targetPage) {
                targetPage.classList.add('active');
                currentPage = pageNum;
                updatePageInfo();
                console.log(`âœ… æˆåŠŸåˆ‡æ¢åˆ°ç¬¬${pageNum}é¡µ`);

                targetPage.offsetHeight;

                setTimeout(() => {
                    drawPageGraph(pageNum);
                    console.log(`ğŸ¨ ç¬¬${pageNum}é¡µå›¾åƒç»˜åˆ¶å®Œæˆ`);
                }, 300);
            } else {
                console.log(`âŒ æœªæ‰¾åˆ°ç¬¬${pageNum}é¡µçš„DOMå…ƒç´ `);
            }
        }

        function drawPageGraph(pageNum) {
            // å°é¢é¡µï¼ˆç¬¬1é¡µï¼‰ä¸éœ€è¦ç»˜åˆ¶å›¾åƒï¼Œå·²æœ‰é™æ€SVG
            if (pageNum === 1) {
                console.log('âœ… ç¬¬1é¡µæ˜¯å°é¢é¡µï¼Œè·³è¿‡å›¾åƒç»˜åˆ¶');
                return;
            }

            const svg = d3.select(`#viz-${pageNum}`);
            if (svg.empty()) {
                console.log(`âš ï¸ æœªæ‰¾åˆ°#viz-${pageNum}çš„SVGå…ƒç´ `);
                return;
            }

            svg.selectAll("*").remove();

            const container = svg.node().parentNode;
            const width = Math.max(container.clientWidth - 20, 300);
            const height = Math.max(container.clientHeight - 20, 200);
            svg.attr('viewBox', `0 0 ${width} ${height}`)
               .attr('preserveAspectRatio', 'xMidYMid meet');

            // æ ¹æ®é¡µç é€‰æ‹©ç»˜å›¾å‡½æ•°
            if (pageNum >= 2 && pageNum <= 5) {
                drawDirectSubstitution(svg, width, height, pageNum - 1);
            } else if (pageNum >= 6 && pageNum <= 10) {
                drawFactorization(svg, width, height, pageNum - 5);
            } else if (pageNum >= 11 && pageNum <= 15) {
                drawRationalization(svg, width, height, pageNum - 10);
            } else if (pageNum >= 16 && pageNum <= 18) {
                drawCommonDenominator(svg, width, height, pageNum - 15);
            } else if (pageNum === 19) {
                drawSummary(svg, width, height);
            }
        }

        // === å›¾å½¢ç»˜åˆ¶å‡½æ•° ===

        function drawMethodsOverview(svg, width, height) {
            const g = svg.append("g").attr("transform", `translate(${width/2}, ${height/2})`);
            const fontSize = Math.min(width/15, height/10, 32);

            const methods = [
                { text: "ç›´æ¥ä»£å…¥æ³•", y: -height/4, color: "#81c784" },
                { text: "å› å¼åˆ†è§£æ³•", y: -height/12, color: "#ffab40" },
                { text: "æ ¹å¼æœ‰ç†åŒ–", y: height/12, color: "#22d3ee" },
                { text: "é€šåˆ†æ³•", y: height/4, color: "#e1bee7" }
            ];

            methods.forEach((method, i) => {
                const text = g.append("text")
                    .attr("y", method.y)
                    .attr("font-size", fontSize + "px")
                    .attr("fill", method.color)
                    .attr("text-anchor", "middle")
                    .attr("font-weight", "600")
                    .text(`${i+1}. ${method.text}`)
                    .attr("opacity", 0);

                text.transition().delay(i * 300).duration(800).attr("opacity", 1);
            });
        }

        function drawDirectSubstitution(svg, width, height, step) {
            const g = svg.append("g").attr("transform", `translate(${width/2}, ${height/2})`);
            const fontSize = Math.min(width * 0.08, height * 0.12, 40);

            if (step === 1) {
                // é—®é¢˜å±•ç¤º
                const gradient = svg.append("defs").append("linearGradient")
                    .attr("id", "grad1")
                    .attr("x1", "0%").attr("y1", "0%")
                    .attr("x2", "100%").attr("y2", "0%");
                gradient.append("stop").attr("offset", "0%").style("stop-color", "#e1bee7");
                gradient.append("stop").attr("offset", "100%").style("stop-color", "#81c784");

                g.append("text")
                    .attr("x", -fontSize * 1.5).attr("y", -10)
                    .attr("text-anchor", "middle")
                    .attr("font-size", fontSize + "px")
                    .attr("font-weight", "bold")
                    .attr("fill", "url(#grad1)")
                    .text("lim");

                g.append("text")
                    .attr("x", -fontSize * 1.5).attr("y", fontSize * 0.4)
                    .attr("text-anchor", "middle")
                    .attr("font-size", fontSize * 0.6 + "px")
                    .attr("fill", "#ffab40")
                    .text("xâ†’3");

                g.append("text")
                    .attr("x", fontSize * 0.5).attr("y", -10)
                    .attr("text-anchor", "start")
                    .attr("font-size", fontSize + "px")
                    .attr("font-weight", "bold")
                    .attr("fill", "url(#grad1)")
                    .text("(2x+1) = ?");
            } else if (step === 2) {
                // å‡½æ•°å›¾åƒ
                const margin = { top: 40, right: 40, bottom: 40, left: 40 };
                const w = width - margin.left - margin.right;
                const h = height - margin.top - margin.bottom;
                const gAxis = svg.append("g").attr("transform", `translate(${margin.left},${margin.top})`);

                const x = d3.scaleLinear().domain([-1, 5]).range([0, w]);
                const y = d3.scaleLinear().domain([-1, 12]).range([h, 0]);

                const xAxis = gAxis.append("g")
                    .attr("transform", `translate(0,${y(0)})`)
                    .call(d3.axisBottom(x).tickSizeOuter(0));
                xAxis.selectAll("path, line").attr("stroke", "#ffffff").attr("stroke-width", 2);
                xAxis.selectAll("text").attr("fill", "#ffffff").attr("font-size", "16px");

                const yAxis = gAxis.append("g")
                    .attr("transform", `translate(${x(0)},0)`)
                    .call(d3.axisLeft(y).tickSizeOuter(0));
                yAxis.selectAll("path, line").attr("stroke", "#ffffff").attr("stroke-width", 2);
                yAxis.selectAll("text").attr("fill", "#ffffff").attr("font-size", "16px");

                const line = gAxis.append("line")
                    .attr("x1", x(-1)).attr("y1", y(-1*2+1))
                    .attr("x2", x(5)).attr("y2", y(5*2+1))
                    .attr("stroke", "#81c784")
                    .attr("stroke-width", 4);
            } else if (step === 3 || step === 4) {
                // è®¡ç®—è¿‡ç¨‹å’Œç»“æœ
                g.append("text")
                    .attr("y", -fontSize/2)
                    .attr("font-size", fontSize + "px")
                    .attr("fill", "white")
                    .attr("text-anchor", "middle")
                    .text("2 Ã— 3 + 1 = 7");
            }
        }

        function drawFactorization(svg, width, height, step) {
            // å› å¼åˆ†è§£æ³•çš„å›¾å½¢
            const g = svg.append("g").attr("transform", `translate(${width/2}, ${height/2})`);
            const fontSize = Math.min(width * 0.06, height * 0.1, 36);

            if (step === 1 || step === 5) {
                // æ˜¾ç¤ºæé™è¡¨è¾¾å¼
                g.append("text")
                    .attr("y", 0)
                    .attr("font-size", fontSize + "px")
                    .attr("fill", "white")
                    .attr("text-anchor", "middle")
                    .text("(xÂ² - 4) / (x - 2)");
            }
        }

        function drawRationalization(svg, width, height, step) {
            // æ ¹å¼æœ‰ç†åŒ–çš„å›¾å½¢
            const g = svg.append("g").attr("transform", `translate(${width/2}, ${height/2})`);
            const fontSize = Math.min(width * 0.06, height * 0.1, 32);

            g.append("text")
                .attr("y", 0)
                .attr("font-size", fontSize + "px")
                .attr("fill", "white")
                .attr("text-anchor", "middle")
                .text("âˆš(x+1) - 1");
        }

        function drawCommonDenominator(svg, width, height, step) {
            // é€šåˆ†æ³•çš„å›¾å½¢
            const g = svg.append("g").attr("transform", `translate(${width/2}, ${height/2})`);
            const fontSize = Math.min(width * 0.06, height * 0.1, 36);

            if (step === 1) {
                g.append("text")
                    .attr("y", 0)
                    .attr("font-size", fontSize + "px")
                    .attr("fill", "white")
                    .attr("text-anchor", "middle")
                    .text("1/(x-1) - 1/(x+1)");
            } else if (step === 2) {
                g.append("text")
                    .attr("y", 0)
                    .attr("font-size", fontSize + "px")
                    .attr("fill", "#81c784")
                    .attr("text-anchor", "middle")
                    .text("2 / (xÂ²-1)");
            } else if (step === 3) {
                g.append("text")
                    .attr("y", 0)
                    .attr("font-size", fontSize * 1.5 + "px")
                    .attr("fill", "#81c784")
                    .attr("text-anchor", "middle")
                    .text("0");
            }
        }

        function drawSummary(svg, width, height) {
            const g = svg.append("g").attr("transform", `translate(${width/2}, ${height/2})`);
            const fontSize = Math.min(width/18, height/12, 28);

            const methods = [
                { text: "ç›´æ¥ä»£å…¥ â†’ è¿ç»­å‡½æ•°", y: -height/3.5, color: "#81c784" },
                { text: "å› å¼åˆ†è§£ â†’ 0/0å‹", y: -height/10, color: "#ffab40" },
                { text: "æ ¹å¼æœ‰ç†åŒ– â†’ å«æ ¹å¼", y: height/10, color: "#22d3ee" },
                { text: "é€šåˆ†æ³• â†’ âˆ-âˆå‹", y: height/3.5, color: "#e1bee7" }
            ];

            methods.forEach((method, i) => {
                g.append("text")
                    .attr("y", method.y)
                    .attr("font-size", fontSize + "px")
                    .attr("fill", method.color)
                    .attr("text-anchor", "middle")
                    .attr("font-weight", "500")
                    .text(method.text)
                    .attr("opacity", 0)
                    .transition().delay(i * 300).duration(800).attr("opacity", 1);
            });
        }

        // === è™šæ‹Ÿäººæ§åˆ¶ ===

        async function startTeaching() {
            const startBtn = document.getElementById('startBtn');
            startBtn.textContent = 'ğŸ”„ å¯åŠ¨ä¸­...';
            startBtn.disabled = true;

            try {
                console.log('â³ ç­‰å¾…SDKæ¨¡å—åŠ è½½...');
                updateStatus('ç­‰å¾…SDKåŠ è½½...', 'connecting');
                await waitForSDK();

                console.log('âœ… è®¯é£å®˜æ–¹SDKå·²åŠ è½½');
                updateStatus('SDKå·²åŠ è½½', 'connecting');

                if(avatarPlatform) {
                    avatarPlatform.destroy();
                }

                avatarPlatform = new AvatarPlatform({
                    useInlinePlayer: true
                });

                avatarPlatform
                    .on('connected', (initResp) => {
                        console.log('ğŸ‰ è™šæ‹Ÿäººè¿æ¥æˆåŠŸï¼', initResp);
                        isConnected = true;
                        isTeaching = true;
                        updateStatus('å·²è¿æ¥', 'connected');
                        startBtn.textContent = 'ğŸ’– è™šæ‹Ÿäººå·²å°±ç»ª';
                        startBtn.disabled = false;

                        setTimeout(() => {
                            speakContent(1);
                        }, 1000);
                    })
                    .on('disconnected', (err) => {
                        console.log('ğŸ”Œ è™šæ‹Ÿäººè¿æ¥æ–­å¼€');
                        isConnected = false;
                        isTeaching = false;
                        updateStatus('è¿æ¥æ–­å¼€', 'error');
                        startBtn.textContent = 'ğŸ€ å¼€å§‹è®²è¯¾';
                        startBtn.disabled = false;
                        if (err) {
                            console.error('âŒ è¿æ¥å¼‚å¸¸æ–­å¼€:', err);
                        }
                    })
                    .on('error', (error) => {
                        console.error('âŒ è™šæ‹Ÿäººé”™è¯¯:', error);
                        updateStatus('é”™è¯¯: ' + error.message, 'error');
                        startBtn.textContent = 'âŒ è¿æ¥å¤±è´¥';
                        startBtn.disabled = false;
                        isTeaching = false;
                        isConnected = false;
                    });

                avatarPlatform.setApiInfo({
                    appId: '1af9f6ce',                                    // æ•°å­¦è®²è§£ AppID
                    apiKey: 'fb9e639101a96b2e8f55ff7598947a4d',             // æ•°å­¦è®²è§£ APIå¯†é’¥
                    apiSecret: 'YTY3ODBiYTUwODViOWRjZjc5NWQ0YWNm',       // æ•°å­¦è®²è§£ APIå¯†é’¥
                    sceneId: '238962977817104384',                       // æ•°å­¦è®²è§£ åœºæ™¯ID
                    serverUrl: 'wss://avatar.cn-huadong-1.xf-yun.com/v1/interact'
                });

                avatarPlatform.setGlobalParams({
                    stream: {
                        protocol: 'xrtc',
                        alpha: 1,
                        bitrate: 1000000,
                        fps: 25
                    },
                    avatar: {
                        avatar_id: '110332017',
                        width: 1920,
                        height: 1080,
                        scale: 1,
                        move_h: 0,
                        move_v: 0,
                        audio_format: 1
                    },
                    tts: {
                        vcn: 'x4_yiting',
                        speed: 50,
                        pitch: 50,
                        volume: 100
                    },
                    avatar_dispatch: {
                        interactive_mode: 1,
                        content_analysis: 0
                    }
                });

                await avatarPlatform.start({
                    wrapper: document.getElementById('avatarWrapper')
                });

                console.log('ğŸ“ è™šæ‹Ÿäººæ•™å­¦ç³»ç»Ÿå¯åŠ¨å®Œæˆ');

            } catch (error) {
                console.error('âŒ å¯åŠ¨å¤±è´¥:', error);
                updateStatus('å¯åŠ¨å¤±è´¥', 'error');
                startBtn.textContent = 'ğŸ”„ é‡è¯•';
                startBtn.disabled = false;

                alert(`å¯åŠ¨å¤±è´¥ï¼š${error.message}\n\nè¯·æ£€æŸ¥æ§åˆ¶å°è·å–è¯¦ç»†é”™è¯¯ä¿¡æ¯ã€‚`);
            }
        }

        async function performVirtualAction(actionId) {
            if (!isTeaching || !isConnected || !avatarPlatform) {
                console.log('âš ï¸ è™šæ‹Ÿäººæœªè¿æ¥ï¼Œè·³è¿‡åŠ¨ä½œæ‰§è¡Œ');
                return;
            }

            try {
                await avatarPlatform.writeCmd("action", actionId);
                console.log(`âœ… æ‰§è¡ŒåŠ¨ä½œ: ${actionId}`);
            } catch (error) {
                console.error(`âŒ åŠ¨ä½œæ‰§è¡Œå¤±è´¥ (${actionId}):`, error);
            }
        }

        function getActionsForPage(pageNum) {
            const actions = ['A_RLH_welcome_O', 'A_LH_introduced_O', 'A_RH_please1_O', 'A_RLH_emphasize_O', 'A_U_No_pointing_O'];
            return actions[pageNum % actions.length];
        }

        async function speakContent(pageNum) {
            console.log(`ğŸ” æ£€æŸ¥æ’­æ”¾æ¡ä»¶: isTeaching=${isTeaching}, isConnected=${isConnected}, avatarPlatform=${!!avatarPlatform}`);

            if (!isTeaching || !isConnected || !avatarPlatform) {
                console.log('âš ï¸ è™šæ‹Ÿäººæœªè¿æ¥æˆ–æœªå¼€å§‹æ•™å­¦ï¼Œè·³è¿‡è¯­éŸ³æ’­æŠ¥');
                return;
            }

            const content = subtitleScript[pageNum];
            if (!content) return;

            try {
                const actionId = getActionsForPage(pageNum);
                if (actionId) {
                    await performVirtualAction(actionId);
                }

                await avatarPlatform.writeText(content, {
                    nlp: false
                });

                console.log(`âœ… è™šæ‹Ÿäººè®²è§£ç¬¬${pageNum}é¡µï¼ŒåŠ¨ä½œ: ${actionId}`);

                updateSubtitle(content);
            } catch (error) {
                console.error('âŒ è™šæ‹Ÿäººè®²è§£å¤±è´¥:', error);
            }
        }

        function updateSubtitle(text) {
            const subtitleArea = document.getElementById('subtitleArea');
            if (subtitleArea) {
                subtitleArea.textContent = text;
            }
        }

        function nextPage() {
            if (currentPage < totalPages) {
                switchToPage(currentPage + 1);
            }
        }
        function previousPage() {
            if (currentPage > 1) {
                switchToPage(currentPage - 1);
            }
        }
        function restart() { switchToPage(1); }
        function updatePageInfo() {
            document.getElementById('currentPage').textContent = currentPage;
        }

        function getPageTitle(pageNum) {
            return boardContent[pageNum - 1]?.title || `ç¬¬${pageNum}é¡µ`;
        }

        // è‡ªåŠ¨æ’­æ”¾åŠŸèƒ½
        let isAutoPlaying = false;
        async function startAutoPlay() {
            if (isAutoPlaying) {
                stopAutoPlay();
                return;
            }

            try {
                console.log('ğŸ¬ å¼€å§‹è‡ªåŠ¨æ’­æ”¾å®Œæ•´è¯¾ç¨‹...');
                isAutoPlaying = true;

                const autoPlayBtn = document.getElementById('autoPlayBtn');
                autoPlayBtn.textContent = 'â¹ï¸ åœæ­¢æ’­æ”¾';
                autoPlayBtn.style.background = 'linear-gradient(135deg, #f44336, #d32f2f)';

                updateStatus(`ğŸ¬ è‡ªåŠ¨æ’­æ”¾å°†åœ¨ 1 ç§’åå¼€å§‹ï¼Œè¯·å‡†å¤‡å½•å±ï¼`, 'connecting');
                await new Promise(resolve => setTimeout(resolve, 1000));

                updateStatus('ğŸ¬ è‡ªåŠ¨æ’­æ”¾å¼€å§‹ï¼', 'connected');
                document.body.classList.add('recording-mode');

                if (!avatarPlatform || !isConnected) {
                    console.log('ğŸ¬ å¯åŠ¨è™šæ‹Ÿäºº...');
                    await startTeaching();
                    await new Promise(resolve => setTimeout(resolve, 2000));
                }

                for (let page = 1; page <= totalPages; page++) {
                    try {
                        if (!isAutoPlaying) break;

                        console.log(`\nğŸ¬ === å¼€å§‹æ’­æ”¾ç¬¬${page}é¡µ/${totalPages}é¡µ ===`);

                        switchToPageSilent(page);
                        updateStatus(`ğŸ“– ç¬¬${page}é¡µ/${totalPages}é¡µ - ${getPageTitle(page)}`, 'connected');

                        await new Promise(resolve => setTimeout(resolve, 800));

                        if (isConnected && isTeaching && avatarPlatform) {
                            console.log(`ğŸµ æ’­æ”¾ç¬¬${page}é¡µè¯­éŸ³...`);
                            try {
                                await speakContent(page);
                                const pageTime = autoPlayDurations[page];
                                await new Promise(resolve => setTimeout(resolve, pageTime));
                            } catch (error) {
                                console.error(`âŒ ç¬¬${page}é¡µè¯­éŸ³æ’­æ”¾å¤±è´¥:`, error);
                                const pageTime = autoPlayDurations[page];
                                await new Promise(resolve => setTimeout(resolve, pageTime));
                            }
                        } else {
                            const pageTime = autoPlayDurations[page];
                            await new Promise(resolve => setTimeout(resolve, pageTime));
                        }

                        const waitTime = page === totalPages ? 2000 : 1000;
                        await new Promise(resolve => setTimeout(resolve, waitTime));

                    } catch (error) {
                        console.error(`âŒ ç¬¬${page}é¡µæ’­æ”¾è¿‡ç¨‹å‡ºé”™:`, error);
                        await new Promise(resolve => setTimeout(resolve, 2000));
                    }
                }

                if (isAutoPlaying) {
                    await new Promise(resolve => setTimeout(resolve, 3000));
                    stopAutoPlay();
                }

            } catch (error) {
                console.error('âŒ è‡ªåŠ¨æ’­æ”¾å¤±è´¥:', error);
                updateStatus('è‡ªåŠ¨æ’­æ”¾å¤±è´¥: ' + error.message, 'error');
                stopAutoPlay();
            }
        }

        function stopAutoPlay() {
            if (isAutoPlaying) {
                isAutoPlaying = false;
                window.playbackFinished = true;
                document.title = "PLAYBACK_FINISHED";
                console.log('ğŸ‰ æ’­æ”¾å®Œæˆï¼å·²ä¿®æ”¹æ ‡é¢˜ä¸º PLAYBACK_FINISHED');
                document.body.classList.remove('recording-mode');

                const autoPlayBtn = document.getElementById('autoPlayBtn');
                autoPlayBtn.textContent = 'ğŸ¬ è‡ªåŠ¨æ’­æ”¾';
                autoPlayBtn.style.background = 'linear-gradient(135deg, #2196f3, #1976d2)';

                console.log('â¹ï¸ è‡ªåŠ¨æ’­æ”¾å·²åœæ­¢');
                updateStatus('è‡ªåŠ¨æ’­æ”¾å·²åœæ­¢', 'normal');
            }
        }

        window.addEventListener('beforeunload', function() {
            if (isAutoPlaying) {
                stopAutoPlay();
            }

            if (avatarPlatform && isConnected) {
                avatarPlatform.stop();
            }
        });
  </script>
</body>
</html>
