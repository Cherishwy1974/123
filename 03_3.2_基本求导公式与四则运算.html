<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=1920, initial-scale=1.0">
    <title>03_3.2_åŸºæœ¬æ±‚å¯¼å…¬å¼ä¸å››åˆ™è¿ç®—(æ‰©å±•ç‰ˆ)</title>

    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Serif+SC:wght@400;600;700&display=swap" rel="stylesheet">

    <script>
        window.MathJax = {
            tex: {
                inlineMath: [['$', '$'], ['\\(', '\\)']],
                displayMath: [['$$', '$$'], ['\\[', '\\]']],
                processEscapes: true,
                processEnvironments: true
            },
            svg: { fontCache: 'global' },
            startup: {
                pageReady: () => {
                    return MathJax.startup.defaultPageReady().then(() => {
                        console.log('âœ… MathJaxå·²åŠ è½½');
                    });
                }
            }
        };
    </script>
    <script async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>

    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        html, body { width: 100%; height: 100%; margin: 0; padding: 0; }
        body { font-family: 'Noto Serif SC', serif; background: #1a1a2e; overflow: hidden; height: 100vh; width: 100vw; }
        .blackboard { width: 100vw; height: 100vh; background: #1a1a2e; position: relative; border: 10px solid #795548; margin: 0; }

        .avatar-container {
            position: fixed;
            top: 60%;
            left: 50%;
            transform: translate(-50%, -50%);
            width: 975px;
            height: 1105px;
            overflow: hidden;
            z-index: 50;
            pointer-events: none;
            background: transparent;
        }

        .wrapper { width: 100%; height: 100%; background: transparent; pointer-events: auto; }

        .slide-container { width: 100%; height: 100%; position: relative; }
        .slide {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            opacity: 0;
            visibility: hidden;
            transition: opacity 0.6s ease-in-out;
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 2rem;
            background-color: transparent;
        }
        .slide.active { opacity: 1; visibility: visible; }

        .slide-content { display: flex; flex-direction: row; gap: 2rem; width: 100%; height: 95%; }

        .chalkboard {
            flex: 0 0 45%;
            padding: 20px;
            display: flex;
            flex-direction: column;
            justify-content: center;
            overflow-y: auto;
        }

        .chalkboard h2 {
            color: #f1c40f;
            border-bottom: 2px solid #f39c12;
            font-size: 28px;
            padding-bottom: 10px;
            margin-bottom: 20px;
        }

        .chalkboard h3 {
            color: #1abc9c;
            font-size: 22px;
            margin-top: 20px;
            margin-bottom: 10px;
        }

        .chalkboard p, .chalkboard li {
            color: #e0e0e0;
            font-size: 18px;
            line-height: 1.8;
            margin: 8px 0;
        }

        .chalkboard strong { color: #e74c3c; }

        .math-formula {
            background-color: rgba(0,0,0,0.2);
            padding: 15px;
            border-radius: 5px;
            border-left: 4px solid #f39c12;
            font-size: 20px;
            color: #1abc9c;
            text-align: center;
            margin: 15px 0;
        }

        .visualization {
            flex: 1;
            padding: 20px;
            display: flex;
            justify-content: center;
            align-items: center;
            overflow: hidden;
        }

        .control-bar {
            position: fixed;
            left: -9999px;
            top: 50%;
            transform: translateY(-50%);
            width: 270px;
            background: rgba(255, 255, 255, 0.15);
            backdrop-filter: blur(15px);
            display: flex;
            flex-direction: column;
            gap: 12px;
            z-index: 200;
            border-radius: 0 20px 20px 0;
            padding: 25px 20px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.2);
            border: 1px solid rgba(255, 255, 255, 0.2);
        }

        .btn {
            padding: 14px 22px;
            background: rgba(255, 255, 255, 0.25);
            color: #333;
            border: 1px solid rgba(255, 255, 255, 0.3);
            border-radius: 12px;
            cursor: pointer;
            font-size: 14px;
            font-weight: 600;
            width: 100%;
            text-align: center;
        }

        .btn.primary {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: #fff;
        }

        .subtitle-area {
            position: absolute;
            bottom: 20px;
            left: 50px;
            right: 50px;
            min-height: 50px;
            background: rgba(0,0,0,0.8);
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 60;
            color: white;
            font-size: 23px;
            text-align: center;
            padding: 15px 20px;
            line-height: 1.4;
        }

        .status-indicator {
            position: absolute;
            top: 10px;
            right: 10px;
            padding: 5px 10px;
            background: rgba(0,0,0,0.5);
            color: white;
            border-radius: 5px;
            font-size: 16px;
            z-index: 100;
            display: none;
        }

        .status-indicator.connected { background: rgba(76, 175, 80, 0.8); display: block; }
        .status-indicator.error { background: rgba(244, 67, 54, 0.8); display: block; }
        .status-indicator.connecting { background: rgba(255, 152, 0, 0.8); display: block; }
    </style>
</head>
<body class="blackboard">
    <div class="status-indicator" id="statusIndicator">ç­‰å¾…è¿æ¥</div>

    <div class="avatar-container">
        <div class="wrapper" id="avatarWrapper"></div>
    </div>

    <div class="slide-container">
        <!-- ç¬¬1é¡µï¼šå¼•å…¥ -->
        <div class="slide active">
            <div class="slide-content">
                <div class="chalkboard">
                    <h2>ä¸ºä»€ä¹ˆéœ€è¦æ±‚å¯¼å…¬å¼?</h2>
                    <p>ä¸ŠèŠ‚è¯¾æˆ‘ä»¬å­¦ä¹ äº†å¯¼æ•°çš„<strong>å®šä¹‰</strong>:</p>
                    <div class="math-formula">
                        $$f'(x) = \\lim_limits_{h \\to 0} \\frac{f(x+h) - f(x)}{h}$$
                    </div>
                    <p>ä½†æ˜¯,å¦‚æœæ¯æ¬¡éƒ½ç”¨å®šä¹‰æ¥æ±‚å¯¼...</p>
                    <h3>é—®é¢˜æ¥äº†!</h3>
                    <p>å¯¹äº $f(x) = x^{100}$,ç”¨å®šä¹‰æ±‚å¯¼éœ€è¦å±•å¼€ $(x+h)^{100}$ï¼Œè¿™å¤ªæ…¢äº†!</p>
                    <p>æˆ‘ä»¬éœ€è¦æ›´é«˜æ•ˆçš„æ–¹æ³• â€” <strong>æ±‚å¯¼å…¬å¼</strong>!</p>
                </div>
                <div class="visualization">
                    <svg viewBox="0 0 600 500" style="width: 100%; height: 100%;"><defs><linearGradient id="grad1" x1="0%" y1="0%" x2="100%" y2="0%"><stop offset="0%" style="stop-color:#e74c3c;stop-opacity:1"></stop><stop offset="100%" style="stop-color:#f39c12;stop-opacity:1"></stop></linearGradient></defs><text fill="#f39c12" font-size="32" text-anchor="middle" x="300" y="80">ç”¨å®šä¹‰å¤ªæ…¢...</text><circle cx="150" cy="200" r="40" fill="none" stroke="#e74c3c" stroke-width="3"><animate attributeName="r" dur="2s" values="40;50;40" repeatCount="indefinite"></animate></circle><text fill="#ecf0f1" font-size="18" text-anchor="middle" x="150" y="210">(x+h)^100</text><text fill="#f39c12" font-size="60" text-anchor="middle" x="300" y="220">â†’</text><circle cx="450" cy="200" r="40" fill="none" stroke="#2ecc71" stroke-width="3"><animate attributeName="r" dur="2s" values="40;50;40" repeatCount="indefinite" begin="0.5s"></animate></circle><text fill="#ecf0f1" font-size="18" text-anchor="middle" x="450" y="210">å…¬å¼</text><text fill="#3498db" font-size="24" text-anchor="middle" x="300" y="350">éœ€è¦æ›´é«˜æ•ˆçš„å·¥å…·!</text><path d="M 100 400 Q 200 350 500 400" fill="none" stroke="url(#grad1)" stroke-width="4"><animate attributeName="d" dur="3s" values="M 100 400 Q 200 350 500 400; M 100 400 Q 200 420 500 400; M 100 400 Q 200 350 500 400" repeatCount="indefinite"></animate></path></svg>
                </div>
            </div>
        </div>

        <!-- ç¬¬2é¡µ:å¹‚å‡½æ•°æ±‚å¯¼å…¬å¼ -->
        <div class="slide">
            <div class="slide-content">
                <div class="chalkboard">
                    <h2>åŸºç¡€å…¬å¼ä¸€:å¹‚å‡½æ•°</h2>
                    <h3>æ ¸å¿ƒå…¬å¼</h3>
                    <div class="math-formula">
                        $$(x^n)' = nx^{n-1}$$
                    </div>
                    <p>è¿™æ˜¯æœ€åŸºç¡€ä¹Ÿæ˜¯æœ€é‡è¦çš„å…¬å¼ã€‚</p>
                    <p><strong>è®°å¿†æ–¹æ³•:</strong> æŒ‡æ•°å˜æˆç³»æ•°,æŒ‡æ•°å‡1ã€‚</p>
                    <p>æˆ‘ä»¬æŠŠåŸæ¥çš„æŒ‡æ•° $n$ æ‹¿åˆ°å‰é¢ä½œä¸ºç³»æ•°ï¼Œç„¶åæ–°çš„æŒ‡æ•°æ˜¯åŸæ¥çš„ $n$ å‡å»1ã€‚</p>
                </div>
                <div class="visualization">
                    <svg viewBox="0 0 600 500" style="width: 100%; height: 100%;"><text fill="#f39c12" font-size="32" text-anchor="middle" x="300" y="60">å¹‚å‡½æ•°æ±‚å¯¼è§„å¾‹</text><text fill="#ecf0f1" font-size="80" text-anchor="middle" x="200" y="250">x</text><text fill="#e74c3c" font-size="60" text-anchor="middle" x="260" y="200">n</text><text fill="#f39c12" font-size="80" text-anchor="middle" x="350" y="250">â†’</text><text fill="#2ecc71" font-size="60" text-anchor="middle" x="430" y="250">n</text><text fill="#ecf0f1" font-size="80" text-anchor="middle" x="490" y="250">x</text><text fill="#3498db" font-size="40" text-anchor="middle" x="540" y="210">n-1</text><text fill="#f39c12" font-size="24" text-anchor="middle" x="300" y="380">"æŒ‡æ•°ä¸‹æ¥ï¼Œå†å‡ä¸€"</text></svg>
                </div>
            </div>
        </div>
        
        <!-- ç¬¬3é¡µ:å¹‚å‡½æ•°ç‰¹æ®Šæƒ…å†µ1 -->
        <div class="slide">
            <div class="slide-content">
                <div class="chalkboard">
                    <h2>å¹‚å‡½æ•°: ç‰¹æ®Šæƒ…å†µ (1)</h2>
                    <h3>å¸¸æ•°å‡½æ•°</h3>
                    <p>å½“ $n=0$ æ—¶, $f(x)=x^0=1$ã€‚ä½†æ›´ä¸€èˆ¬çš„ï¼Œä»»ä½•å¸¸æ•°Cçš„å¯¼æ•°éƒ½æ˜¯0ã€‚</p>
                    <div class="math-formula">
                        $$(C)' = 0$$
                    </div>
                    <p><strong>ç†è§£:</strong> å¯¼æ•°ä»£è¡¨å˜åŒ–ç‡ï¼Œå¸¸æ•°å‡½æ•°æ²¡æœ‰å˜åŒ–ï¼Œæ‰€ä»¥å˜åŒ–ç‡ä¸º0ã€‚</p>

                    <h3>$y=x$</h3>
                    <p>å½“ $n=1$ æ—¶, $f(x)=x$ã€‚</p>
                    <div class="math-formula">
                         $$(x)' = (x^1)' = 1 \\cdot x^{1-1} = 1 \\cdot x^0 = 1$$
                    </div>
                </div>
                <div class="visualization">
                     <svg viewBox="0 0 600 500" style="width: 100%; height: 100%;"><text fill="#f39c12" font-size="28" text-anchor="middle" x="300" y="60">æœ€ç®€å•çš„ä¾‹å­</text><rect x="100" y="120" width="400" height="100" fill="rgba(231,76,60,0.1)" stroke="#e74c3c" stroke-width="2" rx="10"></rect><text fill="#ecf0f1" font-size="24" x="150" y="175">å¸¸æ•° C â†’ æ±‚å¯¼ â†’ 0</text><text fill="#e0e0e0" font-size="18" x="150" y="200">(æ— å˜åŒ–)</text><rect x="100" y="280" width="400" height="100" fill="rgba(52,152,219,0.1)" stroke="#3498db" stroke-width="2" rx="10"></rect><text fill="#ecf0f1" font-size="24" x="150" y="335"> y = x â†’ æ±‚å¯¼ â†’ 1</text><text fill="#e0e0e0" font-size="18" x="150" y="360">(æ–œç‡æ’ä¸º1)</text></svg>
                </div>
            </div>
        </div>

        <!-- ç¬¬4é¡µ:å¹‚å‡½æ•°ç‰¹æ®Šæƒ…å†µ2 -->
        <div class="slide">
            <div class="slide-content">
                <div class="chalkboard">
                    <h2>å¹‚å‡½æ•°: ç‰¹æ®Šæƒ…å†µ (2)</h2>
                    <h3>å¸¸è§å¹‚å‡½æ•°</h3>
                    <p>æ ¹æ®å…¬å¼ $(x^n)' = nx^{n-1}$</p>
                    <div class="math-formula">
                        $$(x^2)' = 2x^{2-1} = 2x$$
                    </div>
                     <div class="math-formula">
                        $$(x^3)' = 3x^{3-1} = 3x^2$$
                    </div>
                    <p>è¿™ä¸ªè§„å¾‹éå¸¸ç›´æ¥ï¼Œä¸€å®šè¦ç†Ÿç»ƒæŒæ¡ã€‚</p>
                </div>
                <div class="visualization">
                    <svg viewBox="0 0 600 500" style="width: 100%; height: 100%;"><text fill="#f39c12" font-size="28" text-anchor="middle" x="300" y="60">æ›´å¤šä¾‹å­</text><g opacity="1"><rect x="100" y="150" width="400" height="80" fill="rgba(52,152,219,0.1)" stroke="#3498db" stroke-width="2" rx="10"></rect><text fill="#ecf0f1" font-size="24" x="150" y="195">xÂ² â†’ 2xÂ¹</text></g><g opacity="1"><rect x="100" y="280" width="400" height="80" fill="rgba(46,204,113,0.1)" stroke="#2ecc71" stroke-width="2" rx="10"></rect><text fill="#ecf0f1" font-size="24" x="150" y="325">xÂ³ â†’ 3xÂ²</text></g></svg>
                </div>
            </div>
        </div>

        <!-- ç¬¬5é¡µ:å¹‚å‡½æ•°æ¨å¹¿ -->
        <div class="slide">
            <div class="slide-content">
                <div class="chalkboard">
                    <h2>å¹‚å‡½æ•°: å…¬å¼æ¨å¹¿</h2>
                    <p>è¿™ä¸ªå…¬å¼å¯¹<strong>æ‰€æœ‰å®æ•° n</strong> éƒ½æˆç«‹ï¼ŒåŒ…æ‹¬è´Ÿæ•°å’Œåˆ†æ•°ï¼</p>
                    <h3>è´ŸæŒ‡æ•°</h3>
                    <p>ä¾‹å¦‚æ±‚ $\\frac{1}{x}$ çš„å¯¼æ•°ï¼Œå¯ä»¥å†™æˆ $x^{-1}$</p>
                    <div class="math-formula">
                        $$(\\frac{1}{x})' = (x^{-1})' = -1 \\cdot x^{-1-1} = -x^{-2} = -\\frac{1}{x^2}$$
                    </div>
                    <h3>åˆ†æ•°æŒ‡æ•° (æ ¹å·)</h3>
                     <div class="math-formula">
                        $$(\\sqrt{x})' = (x^{1/2})' = \\frac{1}{2} x^{-1/2} = \\frac{1}{2\\sqrt{x}}$$
                    </div>
                </div>
                <div class="visualization">
                     <svg viewBox="0 0 600 500" style="width: 100%; height: 100%;"><text fill="#f39c12" font-size="28" text-anchor="middle" x="300" y="60">å…¬å¼å¨åŠ›æ— ç©·!</text><g opacity="1"><rect x="100" y="150" width="400" height="80" fill="rgba(155,89,182,0.1)" stroke="#9b59b6" stroke-width="2" rx="10"></rect><text fill="#ecf0f1" font-size="24" x="150" y="195">1/x = xâ»Â¹ â†’ -1/xÂ²</text></g><g opacity="1"><rect x="100" y="280" width="400" height="80" fill="rgba(230,126,34,0.1)" stroke="#e67e22" stroke-width="2" rx="10"></rect><text fill="#ecf0f1" font-size="24" x="150" y="325">âˆšx = xÂ¹/Â² â†’ 1/(2âˆšx)</text></g></svg>
                </div>
            </div>
        </div>

        <!-- ç¬¬6é¡µ:æŒ‡æ•°å‡½æ•° -->
        <div class="slide">
            <div class="slide-content">
                <div class="chalkboard">
                    <h2>åŸºç¡€å…¬å¼äºŒ: æŒ‡æ•°å‡½æ•°</h2>
                    <h3>è‡ªç„¶æŒ‡æ•°å‡½æ•°</h3>
                    <div class="math-formula">
                        $$(e^x)' = e^x$$
                    </div>
                    <p><strong>æƒŠäººçš„æ€§è´¨:</strong> $e^x$ çš„å¯¼æ•°è¿˜æ˜¯å®ƒè‡ªå·±ï¼è¿™æ˜¯ $e$ è¿™ä¸ªæ•°å­—æœ€é‡è¦çš„ç‰¹æ€§ã€‚</p>
                    
                    <h3>ä¸€èˆ¬æŒ‡æ•°å‡½æ•°</h3>
                    <div class="math-formula">
                        $$(a^x)' = a^x \\ln a$$
                    </div>
                    <p>å½“ $a=e$ æ—¶, $\\ln e = 1$, å°±å˜å›äº†ä¸Šé¢çš„å…¬å¼ã€‚</p>
                </div>
                <div class="visualization">
                    <svg viewBox="0 0 600 500" style="width: 100%; height: 100%;">
                        <defs>
                            <linearGradient id="grad2" x1="0%" y1="0%" x2="0%" y2="100%">
                                <stop offset="0%" style="stop-color:#3498db;stop-opacity:1"></stop>
                                <stop offset="100%" style="stop-color:#2ecc71;stop-opacity:1"></stop>
                            </linearGradient>
                        </defs>
                        <text fill="#f39c12" font-size="26" text-anchor="middle" x="300" y="60">e^x çš„ç¥å¥‡æ€§è´¨</text>
                        <line x1="100" y1="350" x2="500" y2="350" stroke="#ecf0f1" stroke-width="2"></line>
                        <line x1="150" y1="100" x2="150" y2="400" stroke="#ecf0f1" stroke-width="2"></line>
                        <path d="M 150 350 Q 250 250 350 150 Q 400 100 450 80" fill="none" stroke="url(#grad2)" stroke-width="3"></path>
                        <text fill="#3498db" font-size="18" x="380" y="120">y = e^x</text>
                        <text fill="#2ecc71" font-size="18" x="380" y="150">y' = e^x</text>
                        <circle cx="300" cy="200" r="8" fill="#e74c3c">
                            <animate attributeName="r" dur="2s" values="8;12;8" repeatCount="indefinite"></animate>
                        </circle>
                        <text fill="#f39c12" font-size="20" text-anchor="middle" x="300" y="450">å¯¼æ•° = åŸå‡½æ•°!</text>
                    </svg>
                </div>
            </div>
        </div>
        
        <!-- ç¬¬7é¡µ:å¯¹æ•°å‡½æ•° -->
        <div class="slide">
            <div class="slide-content">
                <div class="chalkboard">
                    <h2>åŸºç¡€å…¬å¼ä¸‰: å¯¹æ•°å‡½æ•°</h2>
                    <h3>è‡ªç„¶å¯¹æ•°</h3>
                    <div class="math-formula">
                        $$(\\ln x)' = \\frac{1}{x}$$
                    </div>
                    <p><strong>å‡ ä½•æ„ä¹‰:</strong> å‡½æ•° $\\ln x$ åœ¨ç‚¹xå¤„çš„åˆ‡çº¿æ–œç‡ï¼Œæ­£å¥½æ˜¯ $\\frac{1}{x}$ã€‚</p>
                    
                    <h3>ä¸€èˆ¬å¯¹æ•°</h3>
                    <div class="math-formula">
                        $$(\\log_a x)' = \\frac{1}{x \\ln a}$$
                    </div>
                    <p>åŒæ ·ï¼Œå½“ $a=e$ æ—¶, $\\ln e = 1$, å°±å˜å›äº†è‡ªç„¶å¯¹æ•°çš„æ±‚å¯¼å…¬å¼ã€‚</p>
                </div>
                <div class="visualization">
                    <svg viewBox="0 0 600 500" style="width: 100%; height: 100%;"><text fill="#f39c12" font-size="26" text-anchor="middle" x="300" y="60">ln x çš„å¯¼æ•°</text><line x1="100" y1="400" x2="550" y2="400" stroke="#ecf0f1" stroke-width="2"></line><line x1="150" y1="50" x2="150" y2="450" stroke="#ecf0f1" stroke-width="2"></line><path d="M 160 400 Q 200 300 350 200 Q 450 150 500 130" fill="none" stroke="#2ecc71" stroke-width="3"></path><text fill="#2ecc71" font-size="18" x="450" y="180">y = ln x</text><circle cx="350" cy="200" r="5" fill="#e74c3c"></circle><line x1="280" y1="235" x2="420" y2="165" stroke="#e74c3c" stroke-width="2" stroke-dasharray="4"></line><text fill="#e74c3c" font-size="18" x="430" y="160">æ–œç‡ = 1/x</text></svg>
                </div>
            </div>
        </div>

        <!-- ç¬¬8é¡µ:ä¸‰è§’å‡½æ•°1 -->
        <div class="slide">
            <div class="slide-content">
                <div class="chalkboard">
                    <h2>åŸºç¡€å…¬å¼å››: ä¸‰è§’å‡½æ•° (1)</h2>
                    <h3>æ­£å¼¦ä¸ä½™å¼¦</h3>
                    <div class="math-formula">
                        $$(\\sin x)' = \\cos x$$
                    </div>
                    <div class="math-formula">
                        $$(\\cos x)' = -\\sin x$$
                    </div>
                    <p><strong>è®°å¿†æŠ€å·§:</strong> sin æ±‚å¯¼ä¸å˜å·ï¼Œcos æ±‚å¯¼è¦å˜å·ã€‚</p>
                    <p style="margin-left: 30px;">æ­£å¼¦(sin) â†’ ä½™å¼¦(cos)</p>
                    <p style="margin-left: 30px;">ä½™å¼¦(cos) â†’ è´Ÿæ­£å¼¦(-sin)</p>
                </div>
                <div class="visualization">
                    <svg viewBox="0 0 600 500" style="width: 100%; height: 100%;"><defs><marker id="arrow" markerWidth="10" markerHeight="10" refX="9" refY="3" orient="auto" markerUnits="strokeWidth"><path d="M0,0 L0,6 L9,3 z" fill="#f39c12"></path></marker></defs><text fill="#f39c12" font-size="26" text-anchor="middle" x="300" y="50">æ­£ä½™å¼¦çš„å¯¼æ•°å…³ç³»</text><circle cx="200" cy="250" r="70" fill="rgba(231,76,60,0.2)" stroke="#e74c3c" stroke-width="3"></circle><text fill="#ecf0f1" font-size="20" text-anchor="middle" x="200" y="255">sin x</text><line x1="270" y1="250" x2="330" y2="250" stroke="#f39c12" stroke-width="3" marker-end="url(#arrow)"></line><text fill="#f39c12" font-size="18" text-anchor="middle" x="300" y="230">æ±‚å¯¼</text><circle cx="400" cy="250" r="70" fill="rgba(52,152,219,0.2)" stroke="#3498db" stroke-width="3"></circle><text fill="#ecf0f1" font-size="20" text-anchor="middle" x="400" y="255">cos x</text><path d="M 400 320 C 350 450, 250 450, 200 320" fill="none" stroke="#f39c12" stroke-width="3" marker-end="url(#arrow)"></path><text fill="#f39c12" font-size="18" text-anchor="middle" x="300" y="420">æ±‚å¯¼ (æ³¨æ„å˜å·)</text></svg>
                </div>
            </div>
        </div>

        <!-- ç¬¬9é¡µ:ä¸‰è§’å‡½æ•°2 -->
        <div class="slide">
            <div class="slide-content">
                <div class="chalkboard">
                    <h2>åŸºç¡€å…¬å¼å››: ä¸‰è§’å‡½æ•° (2)</h2>
                    <h3>æ­£åˆ‡å‡½æ•°</h3>
                    <div class="math-formula">
                        $$(\\tan x)' = \\sec^2 x = \\frac{1}{\\cos^2 x}$$
                    </div>
                    <p style="color: #95a5a6; font-size: 16px;">æç¤º: è¿™ä¸ªå…¬å¼å¯ä»¥ç”¨åé¢çš„é™¤æ³•æ³•åˆ™ï¼Œé€šè¿‡ $\\tan x = \\frac{\\sin x}{\\cos x}$ æ¨å¯¼å‡ºæ¥ã€‚</p>
                    <h3 style="margin-top:20px">æ±‚å¯¼å¾ªç¯åœˆ</h3>
                    <p>è¿ç»­å¯¹ $\\sin x$ æ±‚å¯¼ï¼Œä¼šå‘ç°ä¸€ä¸ªæœ‰è¶£çš„å¾ªç¯ï¼š</p>
                    <p>$\\sin x \\xrightarrow{'} \\cos x \\xrightarrow{'} -\\sin x \\xrightarrow{'} -\\cos x \\xrightarrow{'} \\sin x$</p>
                </div>
                <div class="visualization">
                     <svg viewBox="0 0 600 500" style="width: 100%; height: 100%;"><defs><marker id="arrow_cycle" markerWidth="10" markerHeight="10" refX="9" refY="3" orient="auto" markerUnits="strokeWidth"><path d="M0,0 L0,6 L9,3 z" fill="#f39c12"></path></marker></defs><text fill="#f39c12" font-size="26" text-anchor="middle" x="300" y="50">ä¸‰è§’å‡½æ•°æ±‚å¯¼å¾ªç¯</text><circle cx="300" cy="130" r="50" fill="rgba(231,76,60,0.2)" stroke="#e74c3c" stroke-width="3"></circle><text fill="#ecf0f1" font-size="20" text-anchor="middle" x="300" y="135">sin x</text><circle cx="470" cy="250" r="50" fill="rgba(52,152,219,0.2)" stroke="#3498db" stroke-width="3"></circle><text fill="#ecf0f1" font-size="20" text-anchor="middle" x="470" y="255">cos x</text><circle cx="300" cy="370" r="50" fill="rgba(155,89,182,0.2)" stroke="#9b59b6" stroke-width="3"></circle><text fill="#ecf0f1" font-size="20" text-anchor="middle" x="300" y="375">-sin x</text><circle cx="130" cy="250" r="50" fill="rgba(46,204,113,0.2)" stroke="#2ecc71" stroke-width="3"></circle><text fill="#ecf0f1" font-size="20" text-anchor="middle" x="130" y="255">-cos x</text><line x1="350" y1="150" x2="420" y2="230" stroke="#f39c12" stroke-width="2" marker-end="url(#arrow_cycle)"></line><line x1="450" y1="300" x2="350" y2="350" stroke="#f39c12" stroke-width="2" marker-end="url(#arrow_cycle)"></line><line x1="250" y1="350" x2="180" y2="270" stroke="#f39c12" stroke-width="2" marker-end="url(#arrow_cycle)"></line><line x1="150" y1="200" x2="250" y2="150" stroke="#f39c12" stroke-width="2" marker-end="url(#arrow_cycle)"></line></svg>
                </div>
            </div>
        </div>

        <!-- ç¬¬10é¡µ:å››åˆ™è¿ç®—æ³•åˆ™1-å’Œå·® -->
        <div class="slide">
            <div class="slide-content">
                <div class="chalkboard">
                    <h2>æ±‚å¯¼çš„å››åˆ™è¿ç®—æ³•åˆ™</h2>
                    <h3>1. çº¿æ€§æ€§è´¨ (å’Œå·®æ³•åˆ™)</h3>
                    <div class="math-formula">
                        $$(af(x) \\pm bg(x))' = af'(x) \\pm bg'(x)$$
                    </div>
                    <p><strong>ç®€å•è¯´:</strong></p>
                    <ul style="margin-left: 30px;">
                        <li>å¸¸æ•°ç³»æ•°å¯ä»¥æå–å‡ºæ¥ã€‚</li>
                        <li>åŠ æ³•æˆ–å‡æ³•ï¼Œå¯ä»¥åˆ†å¼€æ¥åˆ†åˆ«æ±‚å¯¼ï¼Œå†ç›¸åŠ å‡ã€‚</li>
                    </ul>
                     <p>ä¾‹å¦‚: $(3x^2 + 5\\cos x)' = 3(x^2)' + 5(\\cos x)' = 6x - 5\\sin x$</p>
                </div>
                <div class="visualization">
                    <svg viewBox="0 0 600 500" style="width: 100%; height: 100%;"><text fill="#f39c12" font-size="26" text-anchor="middle" x="300" y="50">å’Œå·®æ³•åˆ™</text><rect x="100" y="150" width="150" height="60" fill="rgba(231,76,60,0.2)" stroke="#e74c3c" stroke-width="2" rx="10"></rect><text fill="#ecf0f1" font-size="24" text-anchor="middle" x="175" y="185">f</text><rect x="350" y="150" width="150" height="60" fill="rgba(52,152,219,0.2)" stroke="#3498db" stroke-width="2" rx="10"></rect><text fill="#ecf0f1" font-size="24" text-anchor="middle" x="425" y="185">g</text><text fill="#f39c12" font-size="30" text-anchor="middle" x="300" y="190">Â±</text><line x1="300" y1="210" x2="300" y2="270" stroke="#f39c12" stroke-width="3"></line><text fill="#ecf0f1" font-size="20" text-anchor="middle" x="300" y="350">f' Â± g'</text><rect x="100" y="310" width="400" height="80" fill="rgba(241,196,15,0.2)" stroke="#f39c12" stroke-width="3" rx="10"></rect><text fill="#ecf0f1" font-size="22" text-anchor="middle" x="300" y="355">åˆ†å¼€æ±‚å¯¼ï¼Œå†ç»„åˆ</text></svg>
                </div>
            </div>
        </div>

        <!-- ç¬¬11é¡µ:å››åˆ™è¿ç®—æ³•åˆ™2-ä¹˜æ³• -->
        <div class="slide">
            <div class="slide-content">
                <div class="chalkboard">
                    <h2>æ±‚å¯¼çš„å››åˆ™è¿ç®—æ³•åˆ™</h2>
                    <h3>2. ä¹˜æ³•æ³•åˆ™</h3>
                    <div class="math-formula">
                        $$(f(x) \\cdot g(x))' = f'(x)g(x) + f(x)g'(x)$$
                    </div>
                    <p><strong>å£è¯€:</strong> "å‰å¯¼åä¸å¯¼ï¼ŒåŠ ä¸Šå‰ä¸å¯¼åå¯¼"</p>
                    <p><strong>æ³¨æ„:</strong> å®ƒä¸æ˜¯ç®€å•åœ°æŠŠä¸¤ä¸ªå¯¼æ•°ç›¸ä¹˜ï¼è€Œæ˜¯æœ‰ä¸¤é¡¹ç›¸åŠ ã€‚</p>
                </div>
                <div class="visualization">
                     <svg viewBox="0 0 600 500" style="width: 100%; height: 100%;"><defs><marker id="arrow2" markerWidth="10" markerHeight="10" refX="9" refY="3" orient="auto" markerUnits="strokeWidth"><path d="M0,0 L0,6 L9,3 z" fill="#f39c12"></path></marker></defs><text fill="#f39c12" font-size="26" text-anchor="middle" x="300" y="50">ä¹˜æ³•æ³•åˆ™å›¾è§£</text><rect x="100" y="100" width="150" height="60" fill="rgba(231,76,60,0.2)" stroke="#e74c3c" stroke-width="2" rx="10"></rect><text fill="#ecf0f1" font-size="24" text-anchor="middle" x="175" y="135">f</text><rect x="350" y="100" width="150" height="60" fill="rgba(52,152,219,0.2)" stroke="#3498db" stroke-width="2" rx="10"></rect><text fill="#ecf0f1" font-size="24" text-anchor="middle" x="425" y="135">g</text><text fill="#f39c12" font-size="30" text-anchor="middle" x="300" y="140">Ã—</text><line x1="175" y1="160" x2="175" y2="220" stroke="#f39c12" stroke-width="3" marker-end="url(#arrow2)"></line><line x1="425" y1="160" x2="425" y2="220" stroke="#f39c12" stroke-width="3" marker-end="url(#arrow2)"></line><rect x="75" y="240" width="200" height="70" fill="rgba(46,204,113,0.2)" stroke="#2ecc71" stroke-width="2" rx="10"></rect><text fill="#ecf0f1" font-size="20" text-anchor="middle" x="175" y="280">f' Â· g</text><text fill="#f39c12" font-size="30" text-anchor="middle" x="300" y="280">+</text><rect x="325" y="240" width="200" height="70" fill="rgba(155,89,182,0.2)" stroke="#9b59b6" stroke-width="2" rx="10"></rect><text fill="#ecf0f1" font-size="20" text-anchor="middle" x="425" y="280">f Â· g'</text><rect x="150" y="350" width="300" height="80" fill="rgba(241,196,15,0.2)" stroke="#f39c12" stroke-width="3" rx="10"></rect><text fill="#ecf0f1" font-size="22" text-anchor="middle" x="300" y="395">(f Â· g)' = f'g + fg'</text></svg>
                </div>
            </div>
        </div>
        
        <!-- ç¬¬12é¡µ:å››åˆ™è¿ç®—æ³•åˆ™3-é™¤æ³• -->
        <div class="slide">
            <div class="slide-content">
                <div class="chalkboard">
                    <h2>æ±‚å¯¼çš„å››åˆ™è¿ç®—æ³•åˆ™</h2>
                    <h3>3. é™¤æ³•æ³•åˆ™</h3>
                    <div class="math-formula">
                        $$\\left(\\frac{f(x)}{g(x)}\\right)' = \\frac{f'(x)g(x) - f(x)g'(x)}{[g(x)]^2}$$
                    </div>
                    <p><strong>å£è¯€:</strong> "ä¸Šå¯¼ä¸‹ä¸å¯¼ï¼Œå‡å»ä¸Šä¸å¯¼ä¸‹å¯¼ï¼Œå†é™¤ä»¥åˆ†æ¯çš„å¹³æ–¹"</p>
                    <p><strong>å…³é”®ç‚¹:</strong></p>
                    <ul style="margin-left: 30px;">
                        <li>åˆ†å­æ˜¯<strong>å‡å·</strong>ï¼Œä¸æ˜¯åŠ å·ï¼</li>
                        <li>åˆ†æ¯è¦<strong>å¹³æ–¹</strong>ï¼(è¿™ä¸ªæœ€å®¹æ˜“å¿˜)</li>
                    </ul>
                </div>
                <div class="visualization">
                    <svg viewBox="0 0 600 500" style="width: 100%; height: 100%;"><defs><marker id="arrow3" markerWidth="10" markerHeight="10" refX="9" refY="3" orient="auto" markerUnits="strokeWidth"><path d="M0,0 L0,6 L9,3 z" fill="#f39c12"></path></marker></defs><text fill="#f39c12" font-size="26" text-anchor="middle" x="300" y="50">é™¤æ³•æ³•åˆ™è®°å¿†</text><rect x="150" y="100" width="300" height="80" fill="rgba(52,152,219,0.1)" stroke="#3498db" stroke-width="3" rx="10"></rect><text fill="#ecf0f1" font-size="24" text-anchor="middle" x="300" y="150"><tspan x="300">f</tspan><tspan dy="-10" font-size="18">â”€</tspan></text><text fill="#ecf0f1" font-size="24" text-anchor="middle" x="300" y="170">g</text><line x1="300" y1="180" x2="300" y2="240" stroke="#f39c12" stroke-width="3" marker-end="url(#arrow3)"></line><text fill="#f39c12" font-size="18" x="310" y="215">æ±‚å¯¼</text><rect x="100" y="260" width="400" height="150" fill="rgba(46,204,113,0.1)" stroke="#2ecc71" stroke-width="3" rx="10"></rect><text fill="#ecf0f1" font-size="20" text-anchor="middle" x="300" y="300"><tspan x="300">f'g - fg'</tspan><tspan dy="-8" font-size="18">â”€â”€â”€â”€â”€</tspan></text><text fill="#ecf0f1" font-size="24" text-anchor="middle" x="300" y="330">gÂ²</text><text fill="#f39c12" font-size="18" text-anchor="middle" x="300" y="395">åˆ†æ¯å¹³æ–¹!</text></svg>
                </div>
            </div>
        </div>

        <!-- ç¬¬13é¡µ:ç»¼åˆç»ƒä¹ 1-ä¹˜æ³• -->
        <div class="slide">
            <div class="slide-content">
                <div class="chalkboard">
                    <h2>ç»¼åˆç»ƒä¹  1: ä¹˜æ³•æ³•åˆ™</h2>
                    <p>æ±‚ $y = x^2 \\cdot e^x$ çš„å¯¼æ•°</p>

                    <p style="margin-top: 15px;"><strong>è§£:</strong></p>
                    <p style="margin-left: 30px;">ä»¤ $f(x) = x^2$, $g(x) = e^x$</p>
                    <p style="margin-left: 30px;">åˆ™ $f'(x) = 2x$, $g'(x) = e^x$</p>
                    <p>æ ¹æ®å…¬å¼ $(fg)' = f'g + fg'$</p>
                    <div class="math-formula">
                        $$y' = (2x) \\cdot (e^x) + (x^2) \\cdot (e^x)$$
                    </div>
                     <div class="math-formula">
                        $$= (2x + x^2)e^x$$
                    </div>
                </div>
                <div class="visualization">
                    <svg viewBox="0 0 600 500" style="width: 100%; height: 100%;">
                        <text fill="#f39c12" font-size="26" text-anchor="middle" x="300" y="50">ä¾‹é¢˜1 æ¼”ç®—è¿‡ç¨‹</text>
                        <g opacity="1">
                            <rect x="80" y="100" width="440" height="60" fill="rgba(52,152,219,0.1)" stroke="#3498db" stroke-width="2" rx="8"></rect>
                            <text fill="#ecf0f1" font-size="20" x="100" y="135">y = xÂ² Â· e^x</text>
                        </g>
                        <g opacity="1">
                            <rect x="80" y="180" width="440" height="60" fill="rgba(231,76,60,0.1)" stroke="#e74c3c" stroke-width="2" rx="8"></rect>
                            <text fill="#ecf0f1" font-size="20" x="100" y="215">f'g = (2x) Â· e^x</text>
                        </g>
                        <text fill="#f39c12" font-size="30" text-anchor="middle" x="300" y="275" opacity="1">+</text>
                        <g opacity="1">
                            <rect x="80" y="290" width="440" height="60" fill="rgba(46,204,113,0.1)" stroke="#2ecc71" stroke-width="2" rx="8"></rect>
                            <text fill="#ecf0f1" font-size="20" x="100" y="325">fg' = xÂ² Â· e^x</text>
                        </g>
                        <line x1="100" y1="370" x2="500" y2="370" stroke="#f39c12" stroke-width="2" opacity="1"></line>
                        <g opacity="1">
                            <rect x="80" y="390" width="440" height="70" fill="rgba(241,196,15,0.2)" stroke="#f39c12" stroke-width="3" rx="8"></rect>
                            <text fill="#ecf0f1" font-size="22" text-anchor="middle" x="300" y="435">y' = (2x + xÂ²)e^x</text>
                        </g>
                    </svg>
                </div>
            </div>
        </div>
        
        <!-- ç¬¬14é¡µ:ç»¼åˆç»ƒä¹ 2-é™¤æ³• -->
        <div class="slide">
            <div class="slide-content">
                <div class="chalkboard">
                    <h2>ç»¼åˆç»ƒä¹  2: é™¤æ³•æ³•åˆ™</h2>
                    <p>æ±‚ $y = \\frac{\\sin x}{x}$ çš„å¯¼æ•°</p>
                     <p style="margin-top: 15px;"><strong>è§£:</strong></p>
                    <p style="margin-left: 30px;">ä»¤ $f(x) = \\sin x$, $g(x) = x$</p>
                    <p style="margin-left: 30px;">åˆ™ $f'(x) = \\cos x$, $g'(x) = 1$</p>
                    <p>æ ¹æ®å…¬å¼ $(\\frac{f}{g})' = \\frac{f'g - fg'}{g^2}$</p>
                    <div class="math-formula">
                        $$y' = \\frac{(\\cos x) \\cdot x - (\\sin x) \\cdot 1}{x^2}$$
                    </div>
                     <div class="math-formula">
                        $$= \\frac{x\\cos x - \\sin x}{x^2}$$
                    </div>
                </div>
                <div class="visualization">
                     <svg viewBox="0 0 600 500" style="width: 100%; height: 100%;"><text fill="#f39c12" font-size="26" text-anchor="middle" x="300" y="50">ä¾‹é¢˜2 æ¼”ç®—è¿‡ç¨‹</text><g><rect x="80" y="90" width="440" height="60" fill="rgba(52,152,219,0.1)" stroke="#3498db" stroke-width="2" rx="8"></rect><text fill="#ecf0f1" font-size="20" x="100" y="125">åˆ†å­ f'g = (cos x) Â· x</text></g><g><rect x="80" y="170" width="440" height="60" fill="rgba(231,76,60,0.1)" stroke="#e74c3c" stroke-width="2" rx="8"></rect><text fill="#ecf0f1" font-size="20" x="100" y="205">åˆ†å­ fg' = (sin x) Â· 1</text></g><g><rect x="80" y="250" width="440" height="60" fill="rgba(46,204,113,0.1)" stroke="#2ecc71" stroke-width="2" rx="8"></rect><text fill="#ecf0f1" font-size="20" x="100" y="285">åˆ†æ¯ gÂ² = xÂ²</text></g><line x1="100" y1="330" x2="500" y2="330" stroke="#f39c12" stroke-width="2"></line><g><rect x="80" y="350" width="440" height="90" fill="rgba(241,196,15,0.2)" stroke="#f39c12" stroke-width="3" rx="8"></rect><text fill="#ecf0f1" font-size="22" text-anchor="middle" x="300" y="400">y' = (x cos x - sin x) / xÂ²</text></g></svg>
                </div>
            </div>
        </div>

        <!-- ç¬¬15é¡µ:ç»¼åˆç»ƒä¹ 3-é™¤æ³•ä¸åŒ–ç®€ -->
        <div class="slide">
            <div class="slide-content">
                <div class="chalkboard">
                    <h2>ç»¼åˆç»ƒä¹  3: é™¤æ³•ä¸åŒ–ç®€</h2>
                    <p>æ±‚ $y = \\frac{\\ln x}{x^2}$ çš„å¯¼æ•°</p>

                    <p style="margin-top: 15px;"><strong>è§£:</strong></p>
                    <p style="margin-left: 30px;">$f=\\ln x, f'=\\frac{1}{x}$</p>
                    <p style="margin-left: 30px;">$g=x^2, g'=2x$</p>

                    <div class="math-formula">
                        $$y' = \\frac{(\\frac{1}{x}) \\cdot x^2 - (\\ln x) \\cdot 2x}{(x^2)^2} = \\frac{x - 2x\\ln x}{x^4}$$
                    </div>
                    <p><strong>é‡è¦ä¸€æ­¥: åŒ–ç®€ï¼</strong> åˆ†å­åˆ†æ¯å¯ä»¥çº¦æ‰ä¸€ä¸ª $x$</p>
                    <div class="math-formula">
                        $$= \\frac{x(1 - 2\\ln x)}{x^4} = \\frac{1 - 2\\ln x}{x^3}$$
                    </div>
                </div>
                 <div class="visualization">
                    <svg viewBox="0 0 600 500" style="width: 100%; height: 100%;"><text fill="#f39c12" font-size="26" text-anchor="middle" x="300" y="50">åˆ«å¿˜äº†åŒ–ç®€</text><text fill="#ecf0f1" font-size="32" text-anchor="middle" x="300" y="150">(x - 2x ln x)</text><line x1="150" y1="170" x2="450" y2="170" stroke="#ecf0f1" stroke-width="2"></line><text fill="#ecf0f1" font-size="40" text-anchor="middle" x="300" y="220">xâ´</text><text fill="#f39c12" font-size="60" text-anchor="middle" x="300" y="320">â†’</text><text fill="#e74c3c" font-size="24" text-anchor="middle" x="300" y="270">æå–å…¬å› å¼ x</text><text fill="#2ecc71" font-size="32" text-anchor="middle" x="300" y="390">(1 - 2 ln x)</text><line x1="150" y1="410" x2="450" y2="410" stroke="#2ecc71" stroke-width="2"></line><text fill="#2ecc71" font-size="40" text-anchor="middle" x="300" y="460">xÂ³</text></svg>
                </div>
            </div>
        </div>

        <!-- ç¬¬16é¡µ:æ€»ç»“1-å…¬å¼ -->
        <div class="slide">
            <div class="slide-content">
                <div class="chalkboard">
                    <h2>æœ¬èŠ‚æ€»ç»“ (1)</h2>
                    <h3>åŸºæœ¬å…¬å¼ (å¿…é¡»è®°ä½!)</h3>
                    <ul style="margin-left: 30px; line-height: 2.5;">
                        <li>$(C)' = 0$</li>
                        <li>$(x^n)' = nx^{n-1}$</li>
                        <li>$(e^x)' = e^x$, $(a^x)' = a^x \\ln a$</li>
                        <li>$(\\ln x)' = \\frac{1}{x}$</li>
                        <li>$(\\sin x)' = \\cos x$, $(\\cos x)' = -\\sin x$</li>
                    </ul>
                </div>
                <div class="visualization">
                    <svg viewBox="0 0 600 500" style="width: 100%; height: 100%;"><text fill="#f39c12" font-size="32" text-anchor="middle" x="300" y="80">æ ¸å¿ƒå…¬å¼å·¥å…·ç®±</text><circle cx="150" cy="200" r="60" fill="rgba(231,76,60,0.2)" stroke="#e74c3c" stroke-width="3"><animate attributeName="r" dur="3s" values="60;70;60" repeatCount="indefinite"></animate></circle><text fill="#ecf0f1" font-size="18" text-anchor="middle" x="150" y="205">å¹‚å‡½æ•°</text><circle cx="450" cy="200" r="60" fill="rgba(52,152,219,0.2)" stroke="#3498db" stroke-width="3"><animate attributeName="r" dur="3s" values="60;70;60" repeatCount="indefinite" begin="0.5s"></animate></circle><text fill="#ecf0f1" font-size="18" text-anchor="middle" x="450" y="205">æŒ‡å¯¹æ•°</text><circle cx="300" cy="380" r="60" fill="rgba(46,204,113,0.2)" stroke="#2ecc71" stroke-width="3"><animate attributeName="r" dur="3s" values="60;70;60" repeatCount="indefinite" begin="1s"></animate></circle><text fill="#ecf0f1" font-size="18" text-anchor="middle" x="300" y="385">ä¸‰è§’</text></svg>
                </div>
            </div>
        </div>
        
        <!-- ç¬¬17é¡µ:æ€»ç»“2-æ³•åˆ™ -->
        <div class="slide">
            <div class="slide-content">
                <div class="chalkboard">
                    <h2>æœ¬èŠ‚æ€»ç»“ (2)</h2>
                    <h3>å››åˆ™è¿ç®—æ³•åˆ™</h3>
                    <ul style="margin-left: 30px; line-height: 2.5;">
                        <li><strong>å’Œå·®:</strong> $(f \\pm g)' = f' \\pm g'$</li>
                        <li><strong>ä¹˜æ³•:</strong> $(fg)' = f'g + fg'$</li>
                        <li><strong>é™¤æ³•:</strong> $(\\frac{f}{g})' = \\frac{f'g - fg'}{g^2}$</li>
                    </ul>

                    <p style="margin-top: 25px; color: #f39c12;"><strong>ä¸‹èŠ‚é¢„å‘Š:</strong></p>
                    <p>é“¾å¼æ³•åˆ™ â€” å¤åˆå‡½æ•°æ±‚å¯¼çš„åˆ©å™¨!</p>
                </div>
                <div class="visualization">
                     <svg viewBox="0 0 600 500" style="width: 100%; height: 100%;"><text fill="#f39c12" font-size="32" text-anchor="middle" x="300" y="80">è¿ç®—æ³•åˆ™</text><rect x="100" y="150" width="400" height="70" fill="rgba(46,204,113,0.1)" stroke="#2ecc71" stroke-width="2" rx="10"></rect><text fill="#ecf0f1" font-size="20" text-anchor="middle" x="300" y="190">å’Œå·®æ³•åˆ™ (åŠ å‡)</text><rect x="100" y="250" width="400" height="70" fill="rgba(52,152,219,0.1)" stroke="#3498db" stroke-width="2" rx="10"></rect><text fill="#ecf0f1" font-size="20" text-anchor="middle" x="300" y="290">ä¹˜æ³•æ³•åˆ™ (ç›¸ä¹˜)</text><rect x="100" y="350" width="400" height="70" fill="rgba(155,89,182,0.1)" stroke="#9b59b6" stroke-width="2" rx="10"></rect><text fill="#ecf0f1" font-size="20" text-anchor="middle" x="300" y="390">é™¤æ³•æ³•åˆ™ (ç›¸é™¤)</text></svg>
                </div>
            </div>
        </div>
    </div>

    <div class="subtitle-area" id="subtitleArea">
        æ¬¢è¿å­¦ä¹ åŸºæœ¬æ±‚å¯¼å…¬å¼ä¸å››åˆ™è¿ç®—!ç‚¹å‡»å¼€å§‹è®²è¯¾å¯åŠ¨è™šæ‹Ÿäººè®²å¸ˆã€‚
    </div>

    <div class="control-bar">
        <div style="color: #f1c40f; font-weight: bold; margin-bottom: 15px; text-align: center;">
            ç¬¬ <span id="currentSlide">1</span> / <span id="totalSlides">17</span> é¡µ
        </div>
        <button class="btn" id="prevBtn" onclick="previousSlide()">â¬…ï¸ ä¸Šä¸€é¡µ</button>
        <button class="btn primary" id="startBtn" onclick="startTeaching()">ğŸ€ å¼€å§‹è®²è¯¾</button>
        <button class="btn" id="nextBtn" onclick="nextSlide()">ä¸‹ä¸€é¡µ â¡ï¸</button>
        <button class="btn" onclick="restart()">ğŸ”„ é‡æ–°å¼€å§‹</button>
        <button class="btn" id="autoPlayBtn" onclick="startAutoPlay()">ğŸ¬ è‡ªåŠ¨æ’­æ”¾</button>
    </div>

    <script type="module">
        window.playbackFinished = false;

        try {
            // æ³¨æ„ï¼šè¿™é‡Œçš„è·¯å¾„éœ€è¦æ ¹æ®æ‚¨çš„å®é™…æ–‡ä»¶ç»“æ„è¿›è¡Œè°ƒæ•´
            const { default: AvatarPlatform } = await import('./avatar-sdk-web_3.1.2.1002/index.js');
            window.AvatarPlatform = AvatarPlatform;
            console.log('âœ… è®¯é£SDKæ¨¡å—å·²åŠ è½½');
        } catch (error) {
            console.error('âŒ SDKåŠ è½½å¤±è´¥:', error);
            alert('è®¯é£è™šæ‹ŸäººSDKåŠ è½½å¤±è´¥ï¼Œè¯·æ£€æŸ¥è·¯å¾„æˆ–ç½‘ç»œè¿æ¥ã€‚è™šæ‹ŸäººåŠŸèƒ½å°†ä¸å¯ç”¨ã€‚');
        }
        window.dispatchEvent(new CustomEvent('sdkReady'));
    </script>

    <script>
        const lessonTitle = "åŸºæœ¬æ±‚å¯¼å…¬å¼ä¸å››åˆ™è¿ç®—";

        const subtitleScript = {
            "1": "åŒå­¦ä»¬å¥½!ä¸ŠèŠ‚è¯¾æˆ‘ä»¬å­¦ä¹ äº†å¯¼æ•°çš„å®šä¹‰ã€‚ä½†å¦‚æœæ¯æ¬¡éƒ½ç”¨å®šä¹‰æ¥æ±‚å¯¼,ä¼šéå¸¸å¤æ‚!æ¯”å¦‚æ±‚xçš„100æ¬¡æ–¹,è®¡ç®—é‡å·¨å¤§!æ‰€ä»¥æˆ‘ä»¬éœ€è¦æ›´é«˜æ•ˆçš„æ–¹æ³•,è¿™å°±æ˜¯ä»Šå¤©è¦å­¦ä¹ çš„åŸºæœ¬æ±‚å¯¼å…¬å¼ã€‚",
            "2": "é¦–å…ˆæ¥çœ‹å¹‚å‡½æ•°çš„æ±‚å¯¼å…¬å¼ï¼šxçš„næ¬¡æ–¹æ±‚å¯¼,ç­‰äºnä¹˜ä»¥xçš„nå‡1æ¬¡æ–¹ã€‚è®°å¿†æ–¹æ³•å¾ˆç®€å•:æŠŠæŒ‡æ•°næ‹¿ä¸‹æ¥ä½œä¸ºç³»æ•°,ç„¶åæŒ‡æ•°å‡1ã€‚è¿™æ˜¯æˆ‘ä»¬æ±‚å¯¼å·¥å…·ç®±é‡Œæœ€åŸºç¡€çš„å·¥å…·ã€‚",
            "3": "æˆ‘ä»¬æ¥çœ‹æœ€ç®€å•çš„ä¸¤ç§æƒ…å†µã€‚ä»»ä½•å¸¸æ•°Cçš„å¯¼æ•°éƒ½æ˜¯0ï¼Œå› ä¸ºå¸¸æ•°å‡½æ•°å›¾åƒæ˜¯ä¸€æ¡æ°´å¹³çº¿ï¼Œæ²¡æœ‰ä»»ä½•å˜åŒ–ã€‚å¯¹äºå‡½æ•°yç­‰äºxï¼Œå®ƒçš„å¯¼æ•°æ˜¯1ï¼Œå› ä¸ºå®ƒçš„å›¾åƒæ˜¯ä¸€æ¡æ–œç‡ä¸º1çš„ç›´çº¿ã€‚",
            "4": "å†æ¥ç»ƒä¹ ä¸¤ä¸ªå¸¸è§çš„ä¾‹å­ã€‚xå¹³æ–¹çš„å¯¼æ•°ï¼Œå°±æ˜¯æŠŠæŒ‡æ•°2æ‹¿ä¸‹æ¥ï¼Œç„¶åæŒ‡æ•°2å‡1ï¼Œå¾—åˆ°2xã€‚åŒæ ·ï¼Œxç«‹æ–¹çš„å¯¼æ•°ï¼Œå°±æ˜¯æŠŠæŒ‡æ•°3æ‹¿ä¸‹æ¥ï¼ŒæŒ‡æ•°3å‡1ï¼Œå¾—åˆ°3xçš„å¹³æ–¹ã€‚",
            "5": "è¿™ä¸ªå¹‚å‡½æ•°å…¬å¼éå¸¸å¼ºå¤§ï¼Œå®ƒå¯¹è´Ÿæ•°å’Œåˆ†æ•°æŒ‡æ•°åŒæ ·é€‚ç”¨ã€‚æ¯”å¦‚æ±‚xåˆ†ä¹‹1çš„å¯¼æ•°ï¼Œå¯ä»¥å…ˆæŠŠå®ƒå†™æˆxçš„è´Ÿ1æ¬¡æ–¹ï¼Œå¥—ç”¨å…¬å¼å°±å¾—åˆ°è´Ÿçš„xçš„è´Ÿ2æ¬¡æ–¹ã€‚æ±‚æ ¹å·xçš„å¯¼æ•°ä¹Ÿæ˜¯ä¸€æ ·çš„é“ç†ã€‚",
            "6": "æ¥ä¸‹æ¥çœ‹æŒ‡æ•°å‡½æ•°çš„æ±‚å¯¼ã€‚è‡ªç„¶æŒ‡æ•°å‡½æ•°eçš„xæ¬¡æ–¹æœ‰ä¸€ä¸ªç¥å¥‡çš„æ€§è´¨ï¼šå®ƒçš„å¯¼æ•°è¿˜æ˜¯å®ƒè‡ªå·±ï¼è¿™ä¸ªæ€§è´¨éå¸¸é‡è¦ã€‚å¯¹äºä¸€èˆ¬çš„æŒ‡æ•°å‡½æ•°açš„xæ¬¡æ–¹ï¼Œå®ƒçš„å¯¼æ•°ç­‰äºå®ƒæœ¬èº«å†ä¹˜ä»¥ln aã€‚",
            "7": "ç„¶åæ˜¯å¯¹æ•°å‡½æ•°ã€‚è‡ªç„¶å¯¹æ•°ln xçš„å¯¼æ•°ï¼Œæ˜¯xåˆ†ä¹‹1ã€‚ä»å‡ ä½•ä¸Šçœ‹ï¼Œè¿™æ„å‘³ç€ln xå›¾åƒåœ¨æŸä¸€ç‚¹çš„åˆ‡çº¿æ–œç‡ï¼Œæ­£å¥½æ˜¯è¯¥ç‚¹æ¨ªåæ ‡çš„å€’æ•°ã€‚ä¸€èˆ¬å¯¹æ•°log a xçš„å¯¼æ•°åˆ™æ˜¯åœ¨åˆ†æ¯ä¸Šå¤šä¹˜ä»¥ä¸€ä¸ªln aã€‚",
            "8": "ä¸‰è§’å‡½æ•°çš„æ±‚å¯¼ä¹Ÿå¾ˆæœ‰è§„å¾‹ã€‚é¦–å…ˆæ˜¯æ­£å¼¦å’Œä½™å¼¦ï¼Œæ­£å¼¦å‡½æ•°sin xçš„å¯¼æ•°æ˜¯cos xï¼Œè€Œä½™å¼¦å‡½æ•°cos xçš„å¯¼æ•°æ˜¯è´Ÿçš„sin xã€‚è®°å¿†æ—¶è¦ç‰¹åˆ«æ³¨æ„ï¼Œcosæ±‚å¯¼åä¼šå¤šä¸€ä¸ªè´Ÿå·ã€‚",
            "9": "æ­£åˆ‡å‡½æ•°tan xçš„å¯¼æ•°æ˜¯secçš„å¹³æ–¹xã€‚è¿™ä¸ªå…¬å¼å¯ä»¥ç”±tan xç­‰äºsin xé™¤ä»¥cos xï¼Œå†åˆ©ç”¨æˆ‘ä»¬åé¢è¦è®²çš„é™¤æ³•æ³•åˆ™æ¨å¯¼å‡ºæ¥ã€‚å¦å¤–ï¼Œè¿ç»­å¯¹sin xæ±‚å¯¼ï¼Œä¼šå½¢æˆä¸€ä¸ªæœ‰è¶£çš„å››æ­¥å¾ªç¯ã€‚",
            "10": "æŒæ¡äº†åŸºæœ¬å…¬å¼ï¼Œæˆ‘ä»¬è¿˜éœ€è¦è¿ç®—æ³•åˆ™æ¥å¤„ç†æ›´å¤æ‚çš„å‡½æ•°ã€‚é¦–å…ˆæ˜¯å’Œå·®æ³•åˆ™ï¼Œä¹Ÿå«çº¿æ€§æ€§è´¨ã€‚ç®€å•è¯´ï¼Œå°±æ˜¯å¯ä»¥æŠŠå¸¸æ•°ç³»æ•°æ‹¿å‡ºæ¥ï¼Œç„¶åå¯¹æ¯ä¸€é¡¹åˆ†åˆ«æ±‚å¯¼ï¼Œæœ€åå†ç›¸åŠ æˆ–ç›¸å‡ã€‚",
            "11": "ç„¶åæ˜¯ä¹˜æ³•æ³•åˆ™ã€‚ä¸¤ä¸ªå‡½æ•°ç›¸ä¹˜çš„å¯¼æ•°ï¼Œä¸ç­‰äºå®ƒä»¬å¯¼æ•°çš„ä¹˜ç§¯ï¼æ­£ç¡®çš„æ³•åˆ™æ˜¯ï¼šç¬¬ä¸€ä¸ªå‡½æ•°çš„å¯¼æ•°ä¹˜ä»¥ç¬¬äºŒä¸ªå‡½æ•°ï¼ŒåŠ ä¸Šç¬¬ä¸€ä¸ªå‡½æ•°ä¹˜ä»¥ç¬¬äºŒä¸ªå‡½æ•°çš„å¯¼æ•°ã€‚å£è¯€æ˜¯ï¼šå‰å¯¼åä¸å¯¼ï¼ŒåŠ å‰ä¸å¯¼åå¯¼ã€‚",
            "12": "æœ€åæ˜¯é™¤æ³•æ³•åˆ™ã€‚ä¸¤ä¸ªå‡½æ•°ç›¸é™¤çš„å¯¼æ•°ï¼Œå…¬å¼ç¨å¾®å¤æ‚ä¸€ç‚¹ã€‚åˆ†å­æ˜¯'ä¸Šå¯¼ä¸‹ä¸å¯¼'å‡å»'ä¸Šä¸å¯¼ä¸‹å¯¼'ï¼Œåˆ†æ¯æ˜¯åŸæ¥åˆ†æ¯çš„å¹³æ–¹ã€‚è¦ç‰¹åˆ«æ³¨æ„ï¼Œåˆ†å­æ˜¯å‡å·ï¼Œå¹¶ä¸”åˆ†æ¯ä¸€å®šè¦è®°å¾—å¹³æ–¹ï¼",
            "13": "æˆ‘ä»¬æ¥ç»ƒä¹ ä¸€ä¸‹ä¹˜æ³•æ³•åˆ™ã€‚æ±‚yç­‰äºxå¹³æ–¹ä¹˜ä»¥eçš„xæ¬¡æ–¹çš„å¯¼æ•°ã€‚æˆ‘ä»¬æŠŠxå¹³æ–¹çœ‹ä½œfï¼Œeçš„xæ¬¡æ–¹çœ‹ä½œgã€‚åˆ†åˆ«æ±‚å¯¼åï¼Œä»£å…¥ä¹˜æ³•æ³•åˆ™å…¬å¼ï¼Œfæ’‡gåŠ ä¸Šfgæ’‡ï¼Œæœ€ååˆå¹¶åŒç±»é¡¹å³å¯ã€‚",
            "14": "æ¥ä¸‹æ¥æ˜¯é™¤æ³•æ³•åˆ™çš„ç»ƒä¹ ã€‚æ±‚yç­‰äºsin xé™¤ä»¥xçš„å¯¼æ•°ã€‚æˆ‘ä»¬æŠŠsin xçœ‹ä½œåˆ†å­fï¼Œxçœ‹ä½œåˆ†æ¯gã€‚åˆ†åˆ«æ±‚å¯¼åï¼Œä»£å…¥é™¤æ³•æ³•åˆ™å…¬å¼ï¼Œ(fæ’‡gå‡fgæ’‡)é™¤ä»¥gçš„å¹³æ–¹ï¼Œå°±å¾—åˆ°äº†æœ€ç»ˆç»“æœã€‚",
            "15": "å†çœ‹ä¸€é“é™¤æ³•æ³•åˆ™çš„é¢˜ç›®ï¼Œæ±‚ln xé™¤ä»¥xå¹³æ–¹çš„å¯¼æ•°ã€‚æŒ‰ç…§å…¬å¼è®¡ç®—åï¼Œæˆ‘ä»¬å¾—åˆ°åˆ†å­æ˜¯xå‡2x ln xï¼Œåˆ†æ¯æ˜¯xçš„å››æ¬¡æ–¹ã€‚è¿™æ—¶ä¸€å®šä¸è¦å¿˜è®°åŒ–ç®€ï¼Œåˆ†å­åˆ†æ¯å¯ä»¥çº¦æ‰ä¸€ä¸ªxï¼Œå¾—åˆ°æœ€ç®€ç»“æœã€‚",
            "16": "å¥½çš„ï¼Œæˆ‘ä»¬æ¥æ€»ç»“ä¸€ä¸‹ä»Šå¤©å­¦ä¹ çš„æ ¸å¿ƒå†…å®¹ã€‚é¦–å…ˆæ˜¯å¿…é¡»ç‰¢è®°çš„åŸºæœ¬æ±‚å¯¼å…¬å¼ï¼ŒåŒ…æ‹¬å¸¸æ•°ã€å¹‚å‡½æ•°ã€æŒ‡æ•°å¯¹æ•°å‡½æ•°ä»¥åŠæ­£ä½™å¼¦å‡½æ•°ã€‚è¿™äº›æ˜¯æ‰€æœ‰å¤æ‚æ±‚å¯¼çš„åŸºç¡€ï¼Œä¸€å®šè¦åšåˆ°æ»šç“œçƒ‚ç†Ÿã€‚",
            "17": "ç„¶åæ˜¯å››åˆ™è¿ç®—æ³•åˆ™ï¼šå’Œå·®ã€ä¹˜æ³•å’Œé™¤æ³•ã€‚å®ƒä»¬å‘Šè¯‰æˆ‘ä»¬å¦‚ä½•ç»„åˆè¿™äº›åŸºæœ¬å…¬å¼æ¥å¤„ç†æ›´å¤æ‚çš„å‡½æ•°ã€‚ç†Ÿç»ƒæŒæ¡è¿™äº›å…¬å¼å’Œæ³•åˆ™åï¼Œæ±‚å¯¼å°±ä¼šå˜å¾—åƒåŠ å‡ä¹˜é™¤ä¸€æ ·ç®€å•ã€‚ä¸‹èŠ‚è¯¾æˆ‘ä»¬å°†å­¦ä¹ æ›´å¼ºå¤§çš„é“¾å¼æ³•åˆ™ï¼Œå†è§ï¼"
        };
        
        const actionMap = {
            "1": "A_RLH_welcome_O", "2": "A_RH_point_O", "3": "A_LH_introduced_O",
            "4": "A_RH_point_O", "5": "A_LH_introduced_O", "6": "A_RH_point_O",
            "7": "A_LH_introduced_O", "8": "A_RH_point_O", "9": "A_LH_introduced_O",
            "10": "A_RH_point_O", "11": "A_LH_introduced_O", "12": "A_RH_point_O",
            "13": "A_LH_introduced_O", "14": "A_RH_point_O", "15": "A_LH_introduced_O",
            "16": "A_RLH_welcome_O", "17": "A_RLH_goodbye_O"
        };


        let currentSlide = 0;
        const totalSlides = 17; // *** ä¿®æ”¹æ€»é¡µæ•° ***
        let avatarPlatform = null;
        let isConnected = false;
        let isTeaching = false;
        let isAutoPlaying = false;
        let speechFinishedResolve = null;

        const slides = document.querySelectorAll('.slide');

        function showSlide(index) {
            slides.forEach((slide, i) => slide.classList.toggle('active', i === index));
            currentSlide = index;
            document.getElementById('currentSlide').textContent = index + 1;

            if (window.MathJax && window.MathJax.typesetPromise) {
                window.MathJax.typesetPromise([slides[index]]).catch(err => console.error(err));
            }

            document.getElementById('prevBtn').disabled = index === 0;
            document.getElementById('nextBtn').disabled = index === totalSlides - 1;
            updateSubtitle(index + 1);
        }

        function nextSlide() {
            if (currentSlide < totalSlides - 1) {
                showSlide(currentSlide + 1);
                if (!isAutoPlaying) speakContent(currentSlide + 1);
            }
        }

        function previousSlide() {
            if (currentSlide > 0) {
                showSlide(currentSlide - 1);
                if (!isAutoPlaying) speakContent(currentSlide + 1);
            }
        }

        function restart() {
            showSlide(0);
            if (avatarPlatform) {
                avatarPlatform.stop();
            }
            isConnected = false;
            isTeaching = false;
            isAutoPlaying = false;
        }

        function updateSubtitle(slideNum) {
            const subtitleArea = document.getElementById('subtitleArea');
            subtitleArea.textContent = subtitleScript[slideNum] || '';
        }

        async function speakContent(slideNum) {
            if (!isTeaching || !isConnected || !avatarPlatform) {
                console.log('âš ï¸ è™šæ‹Ÿäººæœªè¿æ¥');
                return;
            }

            const content = subtitleScript[slideNum];
            if (!content) return;

            try {
                const action = actionMap[slideNum];
                if (action) {
                    await avatarPlatform.writeCmd("action", action);
                }

                await avatarPlatform.writeText(content, { nlp: false });
                updateSubtitle(slideNum);
            } catch (error) {
                console.error('âŒ è®²è§£å¤±è´¥:', error);
            }
        }

        function updateStatus(message, type = 'normal') {
            const indicator = document.getElementById('statusIndicator');
            if (indicator) {
                indicator.textContent = message;
                indicator.className = 'status-indicator';
                if (type === 'connected') indicator.classList.add('connected');
                else if (type === 'error') indicator.classList.add('error');
                else if (type === 'connecting') indicator.classList.add('connecting');
            }
        }

        function waitForSDK() {
            return new Promise((resolve, reject) => {
                if (window.AvatarPlatform) {
                    resolve();
                    return;
                }

                const timeout = setTimeout(() => {
                    reject(new Error('SDKåŠ è½½è¶…æ—¶'));
                }, 10000);

                window.addEventListener('sdkReady', function handler() {
                    clearTimeout(timeout);
                    window.removeEventListener('sdkReady', handler);
                    resolve();
                });
            });
        }

        async function startTeaching() {
            const startBtn = document.getElementById('startBtn');
            startBtn.textContent = 'ğŸ”„ å¯åŠ¨ä¸­...';
            startBtn.disabled = true;

            try {
                updateStatus('ç­‰å¾…SDK...', 'connecting');
                await waitForSDK();

                if(avatarPlatform) {
                    avatarPlatform.destroy();
                }

                avatarPlatform = new window.AvatarPlatform({ useInlinePlayer: true });

                avatarPlatform
                    .on('connected', (initResp) => {
                        console.log('ğŸ‰ è¿æ¥æˆåŠŸ');
                        isConnected = true;
                        isTeaching = true;
                        updateStatus('å·²è¿æ¥', 'connected');
                        startBtn.textContent = 'ğŸ’– è™šæ‹Ÿäººå·²å°±ç»ª';

                        setTimeout(() => {
                            speakContent(currentSlide + 1);
                        }, 1000);
                    })
                    .on('frame_stop', (data) => {
                        console.log('âœ… è™šæ‹Ÿäººè®²è§£å®Œæˆ frame_stop:', data);
                        if (isAutoPlaying && speechFinishedResolve) {
                            console.log('ğŸ¬ é€šçŸ¥è‡ªåŠ¨æ’­æ”¾ï¼šè™šæ‹Ÿäººè®²è§£å®Œæˆ');
                            speechFinishedResolve();
                            speechFinishedResolve = null;
                        }
                    })
                    .on('disconnected', (err) => {
                        isConnected = false;
                        updateStatus('è¿æ¥æ–­å¼€', 'error');
                    })
                    .on('error', (error) => {
                        console.error('âŒ é”™è¯¯:', error);
                        updateStatus('é”™è¯¯', 'error');
                        startBtn.textContent = 'âŒ è¿æ¥å¤±è´¥';
                        startBtn.disabled = false;
                        isTeaching = false;
                    });

                avatarPlatform.setApiInfo({
                    appId: '1af9f6ce',
                    apiKey: 'fb9e639101a96b2e8f55ff7598947a4d',
                    apiSecret: 'YTY3ODBiYTUwODViOWRjZjc5NWQ0YWNm',
                    sceneId: '238962977817104384',
                    serverUrl: 'wss://avatar.cn-huadong-1.xf-yun.com/v1/interact'
                });

                avatarPlatform.setGlobalParams({
                    stream: { protocol: 'xrtc', alpha: 1, bitrate: 1000000, fps: 25 },
                    avatar: { avatar_id: '110332017', width: 1920, height: 1080, scale: 1, move_h: 0, move_v: 0, audio_format: 1 },
                    tts: { vcn: 'x4_yiting', speed: 50, pitch: 50, volume: 100 },
                    avatar_dispatch: { interactive_mode: 1, content_analysis: 0 }
                });

                await avatarPlatform.start({ wrapper: document.getElementById('avatarWrapper') });
            } catch (error) {
                console.error('âŒ å¯åŠ¨å¤±è´¥:', error);
                updateStatus('å¯åŠ¨å¤±è´¥', 'error');
                startBtn.textContent = 'ğŸ€ å¼€å§‹è®²è¯¾';
                startBtn.disabled = false;
            }
        }

        async function startAutoPlay() {
            if (!avatarPlatform || !isConnected) {
                await startTeaching();
                await new Promise(resolve => setTimeout(resolve, 2000));
            }

            isAutoPlaying = true;
            document.getElementById('autoPlayBtn').disabled = true;

            for (let slide = currentSlide + 1; slide <= totalSlides; slide++) {
                if (!isAutoPlaying) break;

                console.log(`\nğŸ¬ === å¼€å§‹æ’­æ”¾ç¬¬${slide}é¡µ/${totalSlides}é¡µ ===`);
                showSlide(slide - 1);

                if (isConnected && isTeaching && avatarPlatform) {
                    try {
                        await new Promise(resolve => setTimeout(resolve, 800));

                        const speechPromise = new Promise(resolve => {
                            speechFinishedResolve = resolve;
                        });

                        await speakContent(slide);
                        console.log(`â³ ç­‰å¾…è™šæ‹Ÿäººè®²è§£ç¬¬${slide}é¡µå®Œæˆ...`);

                        const timeoutDuration = (subtitleScript[slide].length / 4) * 1000 + 5000;
                        const timeoutPromise = new Promise((resolve, reject) =>
                            setTimeout(() => {
                                console.log(`âš ï¸ ç¬¬${slide}é¡µè®²è§£è¶…æ—¶ï¼Œç»§ç»­ä¸‹ä¸€é¡µ`);
                                if (speechFinishedResolve) {
                                   speechFinishedResolve = null; // æ¸…é™¤æ—§çš„ resolver
                                }
                                resolve(); // è¶…æ—¶åæ­£å¸¸ç»§ç»­
                            }, timeoutDuration)
                        );

                        await Promise.race([speechPromise, timeoutPromise]);
                        console.log(`âœ… ç¬¬${slide}é¡µè®²è§£å®Œæˆ`);

                        if (slide < totalSlides) {
                            await new Promise(resolve => setTimeout(resolve, 1500));
                        }
                    } catch (error) {
                        console.error(`âŒ ç¬¬${slide}é¡µæ’­æ”¾å‡ºé”™:`, error);
                    }
                } else {
                    console.log('âš ï¸ è™šæ‹Ÿäººæœªè¿æ¥ï¼Œä½¿ç”¨å›ºå®šå»¶æ—¶');
                    const duration = (subtitleScript[slide].length / 4) * 1000 + 3000;
                    await new Promise(resolve => setTimeout(resolve, duration));
                }
            }

            isAutoPlaying = false;
            document.getElementById('autoPlayBtn').disabled = false;
            window.playbackFinished = true;
            document.title = "PLAYBACK_FINISHED";
            console.log('ğŸ‰ æ’­æ”¾å®Œæˆ');
        }

        document.addEventListener('keydown', (e) => {
            if (e.key === 'ArrowRight' || e.key === ' ') {
                e.preventDefault();
                nextSlide();
            } else if (e.key === 'ArrowLeft') {
                e.preventDefault();
                previousSlide();
            } else if (e.key === 'Enter') {
                e.preventDefault();
                speakContent(currentSlide + 1);
            }
        });

        document.getElementById('totalSlides').textContent = totalSlides;
        showSlide(0);

        setTimeout(() => {
            console.log('ğŸš€ è‡ªåŠ¨å¯åŠ¨æ’­æ”¾...');
            startAutoPlay();
        }, 3000);
    </script>
</body>
</html>