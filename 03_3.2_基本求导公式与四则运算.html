<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=1920, initial-scale=1.0">
    <title>03_3.2_åŸºæœ¬æ±‚å¯¼å…¬å¼ä¸å››åˆ™è¿ç®—</title>

    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Serif+SC:wght@400;600;700&display=swap" rel="stylesheet">

    <script>
        window.MathJax = {
            tex: {
                inlineMath: [['$', '$'], ['\\(', '\\)']],
                displayMath: [['$$', '$$'], ['\\[', '\\]']],
                processEscapes: true,
                processEnvironments: true
            },
            svg: { fontCache: 'global' },
            startup: {
                pageReady: () => {
                    return MathJax.startup.defaultPageReady().then(() => {
                        console.log('âœ… MathJaxå·²åŠ è½½');
                    });
                }
            }
        };
    </script>
    <script async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>

    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        html, body { width: 100%; height: 100%; margin: 0; padding: 0; }
        body { font-family: 'Noto Serif SC', serif; background: #1a1a2e; overflow: hidden; height: 100vh; width: 100vw; }
        .blackboard { width: 100vw; height: 100vh; background: #1a1a2e; position: relative; border: 10px solid #795548; margin: 0; }

        .avatar-container {
            position: fixed;
            top: 60%;
            left: 50%;
            transform: translate(-50%, -50%);
            width: 975px;
            height: 1105px;
            overflow: hidden;
            z-index: 50;
            pointer-events: none;
            background: transparent;
        }

        .wrapper { width: 100%; height: 100%; background: transparent; pointer-events: auto; }

        .slide-container { width: 100%; height: 100%; position: relative; }
        .slide {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            opacity: 0;
            visibility: hidden;
            transition: opacity 0.6s ease-in-out;
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 2rem;
            background-color: transparent;
        }
        .slide.active { opacity: 1; visibility: visible; }

        .slide-content { display: flex; flex-direction: row; gap: 2rem; width: 100%; height: 95%; }

        .chalkboard {
            flex: 0 0 45%;
            padding: 20px;
            display: flex;
            flex-direction: column;
            justify-content: center;
            overflow-y: auto;
        }

        .chalkboard h2 {
            color: #f1c40f;
            border-bottom: 2px solid #f39c12;
            font-size: 28px;
            padding-bottom: 10px;
            margin-bottom: 20px;
        }

        .chalkboard h3 {
            color: #1abc9c;
            font-size: 22px;
            margin-top: 20px;
            margin-bottom: 10px;
        }

        .chalkboard p, .chalkboard li {
            color: #e0e0e0;
            font-size: 18px;
            line-height: 1.8;
            margin: 8px 0;
        }

        .chalkboard strong { color: #e74c3c; }

        .math-formula {
            background-color: rgba(0,0,0,0.2);
            padding: 15px;
            border-radius: 5px;
            border-left: 4px solid #f39c12;
            font-size: 20px;
            color: #1abc9c;
            text-align: center;
            margin: 15px 0;
        }

        .visualization {
            flex: 1;
            padding: 20px;
            display: flex;
            justify-content: center;
            align-items: center;
            overflow: hidden;
        }

        .control-bar {
            position: fixed;
            left: -9999px;
            top: 50%;
            transform: translateY(-50%);
            width: 270px;
            background: rgba(255, 255, 255, 0.15);
            backdrop-filter: blur(15px);
            display: flex;
            flex-direction: column;
            gap: 12px;
            z-index: 200;
            border-radius: 0 20px 20px 0;
            padding: 25px 20px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.2);
            border: 1px solid rgba(255, 255, 255, 0.2);
        }

        .btn {
            padding: 14px 22px;
            background: rgba(255, 255, 255, 0.25);
            color: #333;
            border: 1px solid rgba(255, 255, 255, 0.3);
            border-radius: 12px;
            cursor: pointer;
            font-size: 14px;
            font-weight: 600;
            width: 100%;
            text-align: center;
        }

        .btn.primary {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: #fff;
        }

        .subtitle-area {
            position: absolute;
            bottom: 20px;
            left: 50px;
            right: 50px;
            min-height: 50px;
            background: rgba(0,0,0,0.8);
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 60;
            color: white;
            font-size: 23px;
            text-align: center;
            padding: 15px 20px;
            line-height: 1.4;
        }

        .status-indicator {
            position: absolute;
            top: 10px;
            right: 10px;
            padding: 5px 10px;
            background: rgba(0,0,0,0.5);
            color: white;
            border-radius: 5px;
            font-size: 16px;
            z-index: 100;
            display: none;
        }

        .status-indicator.connected { background: rgba(76, 175, 80, 0.8); display: block; }
        .status-indicator.error { background: rgba(244, 67, 54, 0.8); display: block; }
        .status-indicator.connecting { background: rgba(255, 152, 0, 0.8); display: block; }
    </style>
</head>
<body class="blackboard">
    <div class="status-indicator" id="statusIndicator">ç­‰å¾…è¿æ¥</div>

    <div class="avatar-container">
        <div class="wrapper" id="avatarWrapper"></div>
    </div>

    <div class="slide-container">
        <!-- ç¬¬1é¡µï¼šå¼•å…¥ - ä¸ºä»€ä¹ˆéœ€è¦æ±‚å¯¼å…¬å¼ -->
        <div class="slide active">
            <div class="slide-content">
                <div class="chalkboard">
                    <h2>ä¸ºä»€ä¹ˆéœ€è¦æ±‚å¯¼å…¬å¼?</h2>
                    <p>ä¸ŠèŠ‚è¯¾æˆ‘ä»¬å­¦ä¹ äº†å¯¼æ•°çš„<strong>å®šä¹‰</strong>:</p>
                    <div class="math-formula">
                        $$f'(x) = \\lim_{h \\to 0} \\frac{f(x+h) - f(x)}{h}$$
                    </div>
                    <p>ä½†æ˜¯,å¦‚æœæ¯æ¬¡éƒ½ç”¨å®šä¹‰æ¥æ±‚å¯¼...</p>
                    <h3>é—®é¢˜æ¥äº†!</h3>
                    <p>å¯¹äº $f(x) = x^{100}$,ç”¨å®šä¹‰æ±‚å¯¼éœ€è¦å±•å¼€:</p>
                    <div class="math-formula">
                        $(x+h)^{100} = x^{100} + 100x^{99}h + \\cdots$
                    </div>
                    <p><strong>å¤ªæ…¢äº†!</strong> æˆ‘ä»¬éœ€è¦æ›´é«˜æ•ˆçš„æ–¹æ³• â€” æ±‚å¯¼å…¬å¼!</p>
                </div>
                <div class="visualization">
                    <svg viewBox="0 0 600 500" style="width: 100%; height: 100%;">
                        <defs>
                            <linearGradient id="grad1" x1="0%" y1="0%" x2="100%" y2="0%">
                                <stop offset="0%" style="stop-color:#e74c3c;stop-opacity:1" />
                                <stop offset="100%" style="stop-color:#f39c12;stop-opacity:1" />
                            </linearGradient>
                        </defs>

                        <!-- å¤æ‚è®¡ç®—ç¤ºæ„ -->
                        <text fill="#f39c12" font-size="32" text-anchor="middle" x="300" y="80">ç”¨å®šä¹‰å¤ªæ…¢...</text>

                        <circle cx="150" cy="200" r="40" fill="none" stroke="#e74c3c" stroke-width="3">
                            <animate attributeName="r" dur="2s" values="40;50;40" repeatCount="indefinite"/>
                        </circle>
                        <text fill="#ecf0f1" font-size="18" text-anchor="middle" x="150" y="210">(x+h)^100</text>

                        <text fill="#f39c12" font-size="60" text-anchor="middle" x="300" y="220">â†’</text>

                        <circle cx="450" cy="200" r="40" fill="none" stroke="#2ecc71" stroke-width="3">
                            <animate attributeName="r" dur="2s" values="40;50;40" repeatCount="indefinite" begin="0.5s"/>
                        </circle>
                        <text fill="#ecf0f1" font-size="18" text-anchor="middle" x="450" y="210">å…¬å¼</text>

                        <text fill="#3498db" font-size="24" text-anchor="middle" x="300" y="350">éœ€è¦æ›´é«˜æ•ˆçš„å·¥å…·!</text>

                        <path d="M 100 400 Q 200 350 500 400" fill="none" stroke="url(#grad1)" stroke-width="4">
                            <animate attributeName="d" dur="3s"
                                values="M 100 400 Q 200 350 500 400;
                                        M 100 400 Q 200 420 500 400;
                                        M 100 400 Q 200 350 500 400"
                                repeatCount="indefinite"/>
                        </path>
                    </svg>
                </div>
            </div>
        </div>

        <!-- ç¬¬2é¡µ:å¹‚å‡½æ•°æ±‚å¯¼å…¬å¼ -->
        <div class="slide">
            <div class="slide-content">
                <div class="chalkboard">
                    <h2>åŸºç¡€å…¬å¼ä¸€:å¹‚å‡½æ•°</h2>
                    <h3>æ ¸å¿ƒå…¬å¼</h3>
                    <div class="math-formula">
                        $$(x^n)' = nx^{n-1}$$
                    </div>
                    <p><strong>è®°å¿†æ–¹æ³•:</strong> æŒ‡æ•°å˜æˆç³»æ•°,æŒ‡æ•°å‡1</p>

                    <h3>ç‰¹æ®Šæƒ…å†µ</h3>
                    <ul style="margin-left: 30px;">
                        <li>å¸¸æ•°: $(C)' = 0$ (ä¸å˜çš„ä¸œè¥¿å¯¼æ•°ä¸º0)</li>
                        <li>$x$: $(x)' = 1$</li>
                        <li>$x^2$: $(x^2)' = 2x$</li>
                        <li>$x^3$: $(x^3)' = 3x^2$</li>
                        <li>$\\frac{1}{x} = x^{-1}$: $(\\frac{1}{x})' = -\\frac{1}{x^2}$</li>
                    </ul>

                    <p style="margin-top: 20px;"><strong>æ¨å¹¿:</strong> å¯¹æ‰€æœ‰å®æ•° $n$ éƒ½æˆç«‹!</p>
                </div>
                <div class="visualization">
                    <svg viewBox="0 0 600 500" style="width: 100%; height: 100%;">
                        <text fill="#f39c12" font-size="28" text-anchor="middle" x="300" y="60">å¹‚å‡½æ•°æ±‚å¯¼è§„å¾‹</text>

                        <!-- åŠ¨ç”»æ¼”ç¤º x^3 çš„å¯¼æ•° -->
                        <g opacity="0">
                            <rect x="100" y="100" width="400" height="80" fill="rgba(52,152,219,0.1)" stroke="#3498db" stroke-width="2" rx="10"/>
                            <text fill="#ecf0f1" font-size="24" x="150" y="145">xÂ³ â†’ 3xÂ²</text>
                            <animate attributeName="opacity" dur="8s" values="0;1;1;1;1" repeatCount="indefinite"/>
                        </g>

                        <g opacity="0">
                            <circle cx="200" cy="140" r="15" fill="#e74c3c"/>
                            <text fill="#fff" font-size="14" text-anchor="middle" x="200" y="145">3</text>
                            <text fill="#f39c12" font-size="16" x="220" y="145">æŒ‡æ•°ä¸‹æ¥</text>
                            <animate attributeName="opacity" dur="8s" values="0;0;1;1;1" repeatCount="indefinite"/>
                        </g>

                        <g opacity="0">
                            <rect x="100" y="220" width="400" height="80" fill="rgba(46,204,113,0.1)" stroke="#2ecc71" stroke-width="2" rx="10"/>
                            <text fill="#ecf0f1" font-size="24" x="150" y="265">xâ´ â†’ 4xÂ³</text>
                            <animate attributeName="opacity" dur="8s" values="0;0;0;1;1" repeatCount="indefinite"/>
                        </g>

                        <g opacity="0">
                            <rect x="100" y="340" width="400" height="80" fill="rgba(155,89,182,0.1)" stroke="#9b59b6" stroke-width="2" rx="10"/>
                            <text fill="#ecf0f1" font-size="24" x="150" y="385">1/x â†’ -1/xÂ²</text>
                            <animate attributeName="opacity" dur="8s" values="0;0;0;0;1" repeatCount="indefinite"/>
                        </g>
                    </svg>
                </div>
            </div>
        </div>

        <!-- ç¬¬3é¡µ:æŒ‡æ•°ä¸å¯¹æ•°å‡½æ•° -->
        <div class="slide">
            <div class="slide-content">
                <div class="chalkboard">
                    <h2>åŸºç¡€å…¬å¼äºŒ:æŒ‡æ•°ä¸å¯¹æ•°</h2>
                    <h3>æŒ‡æ•°å‡½æ•°</h3>
                    <div class="math-formula">
                        $$(e^x)' = e^x$$
                    </div>
                    <p><strong>æƒŠäººçš„æ€§è´¨:</strong> $e^x$ çš„å¯¼æ•°è¿˜æ˜¯è‡ªå·±!</p>
                    <div class="math-formula">
                        $$(a^x)' = a^x \\ln a$$
                    </div>

                    <h3>å¯¹æ•°å‡½æ•°</h3>
                    <div class="math-formula">
                        $$(\\ln x)' = \\frac{1}{x}$$
                    </div>
                    <p><strong>å‡ ä½•æ„ä¹‰:</strong> $\\ln x$ çš„åˆ‡çº¿æ–œç‡ = $\\frac{1}{x}$</p>
                    <div class="math-formula">
                        $$(\\log_a x)' = \\frac{1}{x \\ln a}$$
                    </div>
                </div>
                <div class="visualization">
                    <svg viewBox="0 0 600 500" style="width: 100%; height: 100%;">
                        <defs>
                            <linearGradient id="grad2" x1="0%" y1="0%" x2="0%" y2="100%">
                                <stop offset="0%" style="stop-color:#3498db;stop-opacity:1" />
                                <stop offset="100%" style="stop-color:#2ecc71;stop-opacity:1" />
                            </linearGradient>
                        </defs>

                        <text fill="#f39c12" font-size="26" text-anchor="middle" x="300" y="60">e^x çš„ç¥å¥‡æ€§è´¨</text>

                        <!-- åæ ‡ç³» -->
                        <line x1="100" y1="350" x2="500" y2="350" stroke="#ecf0f1" stroke-width="2"/>
                        <line x1="150" y1="100" x2="150" y2="400" stroke="#ecf0f1" stroke-width="2"/>

                        <!-- e^x æ›²çº¿ -->
                        <path d="M 150 350 Q 250 250 350 150 Q 400 100 450 80"
                              fill="none" stroke="url(#grad2)" stroke-width="3">
                            <animate attributeName="opacity" dur="2s" values="0;1;1" repeatCount="indefinite"/>
                        </path>

                        <!-- æ ‡æ³¨ -->
                        <text fill="#3498db" font-size="18" x="380" y="120">y = e^x</text>
                        <text fill="#2ecc71" font-size="18" x="380" y="150">y' = e^x</text>

                        <circle cx="300" cy="200" r="8" fill="#e74c3c">
                            <animate attributeName="r" dur="2s" values="8;12;8" repeatCount="indefinite"/>
                        </circle>

                        <text fill="#f39c12" font-size="20" text-anchor="middle" x="300" y="450">å¯¼æ•° = åŸå‡½æ•°!</text>
                    </svg>
                </div>
            </div>
        </div>

        <!-- ç¬¬4é¡µ:ä¸‰è§’å‡½æ•°æ±‚å¯¼ -->
        <div class="slide">
            <div class="slide-content">
                <div class="chalkboard">
                    <h2>åŸºç¡€å…¬å¼ä¸‰:ä¸‰è§’å‡½æ•°</h2>
                    <h3>æ ¸å¿ƒå…¬å¼</h3>
                    <div class="math-formula">
                        $$(\\sin x)' = \\cos x$$
                    </div>
                    <div class="math-formula">
                        $$(\\cos x)' = -\\sin x$$
                    </div>
                    <p><strong>è®°å¿†æŠ€å·§:</strong> sin â†’ cos (æ­£å˜ä½™)</p>
                    <p style="margin-left: 30px;">cos â†’ -sin (ä½™å˜è´Ÿæ­£)</p>

                    <h3>å…¶ä»–ä¸‰è§’å‡½æ•°</h3>
                    <div class="math-formula">
                        $$(\\tan x)' = \\sec^2 x = \\frac{1}{\\cos^2 x}$$
                    </div>
                    <p style="color: #95a5a6; font-size: 16px;">æç¤º: tan = sin/cos,ç”¨é™¤æ³•æ³•åˆ™å¯æ¨å¯¼</p>
                </div>
                <div class="visualization">
                    <svg viewBox="0 0 600 500" style="width: 100%; height: 100%;">
                        <text fill="#f39c12" font-size="26" text-anchor="middle" x="300" y="50">ä¸‰è§’å‡½æ•°å¯¼æ•°å…³ç³»</text>

                        <!-- sin x å’Œ cos x çš„å…³ç³» -->
                        <circle cx="200" cy="200" r="70" fill="rgba(231,76,60,0.2)" stroke="#e74c3c" stroke-width="3"/>
                        <text fill="#ecf0f1" font-size="20" text-anchor="middle" x="200" y="205">sin x</text>

                        <line x1="270" y1="200" x2="330" y2="200" stroke="#f39c12" stroke-width="3" marker-end="url(#arrow)"/>
                        <text fill="#f39c12" font-size="18" text-anchor="middle" x="300" y="180">æ±‚å¯¼</text>

                        <circle cx="400" cy="200" r="70" fill="rgba(52,152,219,0.2)" stroke="#3498db" stroke-width="3"/>
                        <text fill="#ecf0f1" font-size="20" text-anchor="middle" x="400" y="205">cos x</text>

                        <!-- cos x åˆ° -sin x -->
                        <line x1="400" y1="270" x2="400" y2="330" stroke="#f39c12" stroke-width="3" marker-end="url(#arrow)"/>
                        <text fill="#f39c12" font-size="18" x="410" y="305">æ±‚å¯¼</text>

                        <circle cx="400" cy="400" r="70" fill="rgba(155,89,182,0.2)" stroke="#9b59b6" stroke-width="3"/>
                        <text fill="#ecf0f1" font-size="20" text-anchor="middle" x="400" y="405">-sin x</text>

                        <!-- -sin x åˆ° -cos x -->
                        <line x1="330" y1="400" x2="270" y2="400" stroke="#f39c12" stroke-width="3" marker-end="url(#arrow)"/>
                        <text fill="#f39c12" font-size="18" text-anchor="middle" x="300" y="420">æ±‚å¯¼</text>

                        <circle cx="200" cy="400" r="70" fill="rgba(46,204,113,0.2)" stroke="#2ecc71" stroke-width="3"/>
                        <text fill="#ecf0f1" font-size="20" text-anchor="middle" x="200" y="405">-cos x</text>

                        <!-- -cos x å›åˆ° sin x -->
                        <line x1="200" y1="330" x2="200" y2="270" stroke="#f39c12" stroke-width="3" marker-end="url(#arrow)"/>
                        <text fill="#f39c12" font-size="18" x="210" y="305">æ±‚å¯¼</text>

                        <defs>
                            <marker id="arrow" markerWidth="10" markerHeight="10" refX="9" refY="3" orient="auto" markerUnits="strokeWidth">
                                <path d="M0,0 L0,6 L9,3 z" fill="#f39c12"/>
                            </marker>
                        </defs>
                    </svg>
                </div>
            </div>
        </div>

        <!-- ç¬¬5é¡µ:å››åˆ™è¿ç®—æ³•åˆ™ -->
        <div class="slide">
            <div class="slide-content">
                <div class="chalkboard">
                    <h2>æ±‚å¯¼çš„å››åˆ™è¿ç®—æ³•åˆ™</h2>
                    <h3>1. çº¿æ€§æ€§è´¨(å’Œå·®æ³•åˆ™)</h3>
                    <div class="math-formula">
                        $$(af(x) \\pm bg(x))' = af'(x) \\pm bg'(x)$$
                    </div>
                    <p>å¸¸æ•°å¯ä»¥æå–,å’Œå·®åˆ†åˆ«æ±‚å¯¼</p>

                    <h3>2. ä¹˜æ³•æ³•åˆ™</h3>
                    <div class="math-formula">
                        $$(f \\cdot g)' = f' \\cdot g + f \\cdot g'$$
                    </div>
                    <p><strong>å£è¯€:</strong> "å‰å¯¼åä¸å¯¼ + å‰ä¸å¯¼åå¯¼"</p>

                    <h3>3. é™¤æ³•æ³•åˆ™</h3>
                    <div class="math-formula">
                        $$\\left(\\frac{f}{g}\\right)' = \\frac{f' \\cdot g - f \\cdot g'}{g^2}$$
                    </div>
                    <p><strong>æ³¨æ„:</strong> åˆ†æ¯è¦å¹³æ–¹! åˆ†å­æ˜¯"ä¸Šå¯¼ä¸‹ - ä¸Šä¸‹å¯¼"</p>
                </div>
                <div class="visualization">
                    <svg viewBox="0 0 600 500" style="width: 100%; height: 100%;">
                        <text fill="#f39c12" font-size="26" text-anchor="middle" x="300" y="50">ä¹˜æ³•æ³•åˆ™å›¾è§£</text>

                        <!-- f å’Œ g -->
                        <rect x="100" y="100" width="150" height="60" fill="rgba(231,76,60,0.2)" stroke="#e74c3c" stroke-width="2" rx="10"/>
                        <text fill="#ecf0f1" font-size="24" text-anchor="middle" x="175" y="135">f</text>

                        <rect x="350" y="100" width="150" height="60" fill="rgba(52,152,219,0.2)" stroke="#3498db" stroke-width="2" rx="10"/>
                        <text fill="#ecf0f1" font-size="24" text-anchor="middle" x="425" y="135">g</text>

                        <text fill="#f39c12" font-size="30" text-anchor="middle" x="300" y="140">Ã—</text>

                        <!-- æ±‚å¯¼ç®­å¤´ -->
                        <line x1="175" y1="160" x2="175" y2="220" stroke="#f39c12" stroke-width="3" marker-end="url(#arrow2)"/>
                        <line x1="425" y1="160" x2="425" y2="220" stroke="#f39c12" stroke-width="3" marker-end="url(#arrow2)"/>

                        <!-- ç»“æœ -->
                        <rect x="75" y="240" width="200" height="70" fill="rgba(46,204,113,0.2)" stroke="#2ecc71" stroke-width="2" rx="10"/>
                        <text fill="#ecf0f1" font-size="20" text-anchor="middle" x="175" y="280">f' Â· g</text>

                        <text fill="#f39c12" font-size="30" text-anchor="middle" x="300" y="280">+</text>

                        <rect x="325" y="240" width="200" height="70" fill="rgba(155,89,182,0.2)" stroke="#9b59b6" stroke-width="2" rx="10"/>
                        <text fill="#ecf0f1" font-size="20" text-anchor="middle" x="425" y="280">f Â· g'</text>

                        <!-- æœ€ç»ˆç»“æœ -->
                        <rect x="150" y="350" width="300" height="80" fill="rgba(241,196,15,0.2)" stroke="#f39c12" stroke-width="3" rx="10"/>
                        <text fill="#ecf0f1" font-size="22" text-anchor="middle" x="300" y="395">(f Â· g)' = f'g + fg'</text>

                        <defs>
                            <marker id="arrow2" markerWidth="10" markerHeight="10" refX="9" refY="3" orient="auto" markerUnits="strokeWidth">
                                <path d="M0,0 L0,6 L9,3 z" fill="#f39c12"/>
                            </marker>
                        </defs>
                    </svg>
                </div>
            </div>
        </div>

        <!-- ç¬¬6é¡µ:ç»¼åˆç»ƒä¹ 1 -->
        <div class="slide">
            <div class="slide-content">
                <div class="chalkboard">
                    <h2>ç»¼åˆç»ƒä¹  1</h2>
                    <h3>ä¾‹é¢˜1: ä¹˜æ³•æ³•åˆ™</h3>
                    <p>æ±‚ $y = x^2 \\cdot e^x$ çš„å¯¼æ•°</p>

                    <p style="margin-top: 15px;"><strong>è§£:</strong> ä½¿ç”¨ä¹˜æ³•æ³•åˆ™ $(fg)' = f'g + fg'$</p>
                    <p style="margin-left: 30px;">ä»¤ $f = x^2$, $g = e^x$</p>
                    <p style="margin-left: 30px;">åˆ™ $f' = 2x$, $g' = e^x$</p>

                    <div class="math-formula">
                        $$y' = 2x \\cdot e^x + x^2 \\cdot e^x = (2x + x^2)e^x$$
                    </div>

                    <h3 style="margin-top: 25px;">ä¾‹é¢˜2: é™¤æ³•æ³•åˆ™</h3>
                    <p>æ±‚ $y = \\frac{\\sin x}{x}$ çš„å¯¼æ•°</p>

                    <p style="margin-top: 15px;"><strong>è§£:</strong> ä½¿ç”¨é™¤æ³•æ³•åˆ™</p>
                    <div class="math-formula">
                        $$y' = \\frac{\\cos x \\cdot x - \\sin x \\cdot 1}{x^2} = \\frac{x\\cos x - \\sin x}{x^2}$$
                    </div>
                </div>
                <div class="visualization">
                    <svg viewBox="0 0 600 500" style="width: 100%; height: 100%;">
                        <text fill="#f39c12" font-size="26" text-anchor="middle" x="300" y="50">ä¾‹é¢˜1 æ¼”ç®—è¿‡ç¨‹</text>

                        <!-- æ­¥éª¤å±•ç¤º -->
                        <g opacity="0">
                            <rect x="80" y="100" width="440" height="60" fill="rgba(52,152,219,0.1)" stroke="#3498db" stroke-width="2" rx="8"/>
                            <text fill="#ecf0f1" font-size="20" x="100" y="135">y = xÂ² Â· e^x</text>
                            <animate attributeName="opacity" dur="10s" values="0;1;1;1;1;1" repeatCount="indefinite"/>
                        </g>

                        <g opacity="0">
                            <rect x="80" y="180" width="440" height="60" fill="rgba(231,76,60,0.1)" stroke="#e74c3c" stroke-width="2" rx="8"/>
                            <text fill="#ecf0f1" font-size="20" x="100" y="215">f' Â· g = 2x Â· e^x</text>
                            <animate attributeName="opacity" dur="10s" values="0;0;1;1;1;1" repeatCount="indefinite"/>
                        </g>

                        <text fill="#f39c12" font-size="30" text-anchor="middle" x="300" y="275" opacity="0">
                            +
                            <animate attributeName="opacity" dur="10s" values="0;0;0;1;1;1" repeatCount="indefinite"/>
                        </text>

                        <g opacity="0">
                            <rect x="80" y="290" width="440" height="60" fill="rgba(46,204,113,0.1)" stroke="#2ecc71" stroke-width="2" rx="8"/>
                            <text fill="#ecf0f1" font-size="20" x="100" y="325">f Â· g' = xÂ² Â· e^x</text>
                            <animate attributeName="opacity" dur="10s" values="0;0;0;1;1;1" repeatCount="indefinite"/>
                        </g>

                        <line x1="100" y1="370" x2="500" y2="370" stroke="#f39c12" stroke-width="2" opacity="0">
                            <animate attributeName="opacity" dur="10s" values="0;0;0;0;1;1" repeatCount="indefinite"/>
                        </line>

                        <g opacity="0">
                            <rect x="80" y="390" width="440" height="70" fill="rgba(241,196,15,0.2)" stroke="#f39c12" stroke-width="3" rx="8"/>
                            <text fill="#ecf0f1" font-size="22" text-anchor="middle" x="300" y="435">y' = (2x + xÂ²)e^x</text>
                            <animate attributeName="opacity" dur="10s" values="0;0;0;0;0;1" repeatCount="indefinite"/>
                        </g>
                    </svg>
                </div>
            </div>
        </div>

        <!-- ç¬¬7é¡µ:ç»¼åˆç»ƒä¹ 2 -->
        <div class="slide">
            <div class="slide-content">
                <div class="chalkboard">
                    <h2>ç»¼åˆç»ƒä¹  2</h2>
                    <h3>ä¾‹é¢˜3: ç»¼åˆåº”ç”¨</h3>
                    <p>æ±‚ $y = \\frac{\\ln x}{x^2}$ çš„å¯¼æ•°</p>

                    <p style="margin-top: 15px;"><strong>è§£:</strong> ä½¿ç”¨é™¤æ³•æ³•åˆ™</p>
                    <p style="margin-left: 30px;">$f = \\ln x$, $f' = \\frac{1}{x}$</p>
                    <p style="margin-left: 30px;">$g = x^2$, $g' = 2x$</p>

                    <div class="math-formula">
                        $$y' = \\frac{\\frac{1}{x} \\cdot x^2 - \\ln x \\cdot 2x}{(x^2)^2} = \\frac{x - 2x\\ln x}{x^4}$$
                    </div>

                    <div class="math-formula">
                        $$= \\frac{1 - 2\\ln x}{x^3}$$
                    </div>

                    <p style="margin-top: 20px; color: #95a5a6;"><strong>æŠ€å·§:</strong> åŒ–ç®€æ—¶çº¦æ‰å…¬å› å­ $x$</p>
                </div>
                <div class="visualization">
                    <svg viewBox="0 0 600 500" style="width: 100%; height: 100%;">
                        <text fill="#f39c12" font-size="26" text-anchor="middle" x="300" y="50">é™¤æ³•æ³•åˆ™è®°å¿†</text>

                        <rect x="150" y="100" width="300" height="80" fill="rgba(52,152,219,0.1)" stroke="#3498db" stroke-width="3" rx="10"/>
                        <text fill="#ecf0f1" font-size="24" text-anchor="middle" x="300" y="150">
                            <tspan x="300">f</tspan>
                            <tspan dy="-10" font-size="18">â”€</tspan>
                        </text>
                        <text fill="#ecf0f1" font-size="24" text-anchor="middle" x="300" y="170">g</text>

                        <line x1="300" y1="180" x2="300" y2="240" stroke="#f39c12" stroke-width="3" marker-end="url(#arrow3)"/>
                        <text fill="#f39c12" font-size="18" x="310" y="215">æ±‚å¯¼</text>

                        <rect x="100" y="260" width="400" height="150" fill="rgba(46,204,113,0.1)" stroke="#2ecc71" stroke-width="3" rx="10"/>
                        <text fill="#ecf0f1" font-size="20" text-anchor="middle" x="300" y="300">
                            <tspan x="300">f'g - fg'</tspan>
                            <tspan dy="-8" font-size="18">â”€â”€â”€â”€â”€</tspan>
                        </text>
                        <text fill="#ecf0f1" font-size="24" text-anchor="middle" x="300" y="330">gÂ²</text>

                        <text fill="#e74c3c" font-size="18" x="120" y="370">â†‘</text>
                        <text fill="#e74c3c" font-size="16" x="135" y="370">ä¸Šå¯¼ä¸‹</text>

                        <text fill="#e74c3c" font-size="18" x="220" y="370">-</text>

                        <text fill="#e74c3c" font-size="18" x="250" y="370">â†‘</text>
                        <text fill="#e74c3c" font-size="16" x="265" y="370">ä¸Šä¸‹å¯¼</text>

                        <text fill="#f39c12" font-size="18" text-anchor="middle" x="300" y="395">åˆ†æ¯å¹³æ–¹!</text>

                        <defs>
                            <marker id="arrow3" markerWidth="10" markerHeight="10" refX="9" refY="3" orient="auto" markerUnits="strokeWidth">
                                <path d="M0,0 L0,6 L9,3 z" fill="#f39c12"/>
                            </marker>
                        </defs>
                    </svg>
                </div>
            </div>
        </div>

        <!-- ç¬¬8é¡µ:æ€»ç»“ -->
        <div class="slide">
            <div class="slide-content">
                <div class="chalkboard">
                    <h2>æœ¬èŠ‚æ€»ç»“</h2>
                    <h3>åŸºæœ¬å…¬å¼(å¿…é¡»è®°ä½!)</h3>
                    <ul style="margin-left: 30px;">
                        <li>$(x^n)' = nx^{n-1}$</li>
                        <li>$(e^x)' = e^x$, $(a^x)' = a^x \\ln a$</li>
                        <li>$(\\ln x)' = \\frac{1}{x}$</li>
                        <li>$(\\sin x)' = \\cos x$, $(\\cos x)' = -\\sin x$</li>
                    </ul>

                    <h3 style="margin-top: 20px;">å››åˆ™è¿ç®—æ³•åˆ™</h3>
                    <ul style="margin-left: 30px;">
                        <li>$(af \\pm bg)' = af' \\pm bg'$ (çº¿æ€§)</li>
                        <li>$(fg)' = f'g + fg'$ (ä¹˜æ³•)</li>
                        <li>$(\\frac{f}{g})' = \\frac{f'g - fg'}{g^2}$ (é™¤æ³•)</li>
                    </ul>

                    <p style="margin-top: 25px; color: #f39c12;"><strong>ä¸‹èŠ‚é¢„å‘Š:</strong></p>
                    <p>é“¾å¼æ³•åˆ™ â€” å¤åˆå‡½æ•°æ±‚å¯¼çš„åˆ©å™¨!</p>
                </div>
                <div class="visualization">
                    <svg viewBox="0 0 600 500" style="width: 100%; height: 100%;">
                        <text fill="#f39c12" font-size="32" text-anchor="middle" x="300" y="80">å…¬å¼å…¨å®¶ç¦</text>

                        <circle cx="150" cy="200" r="60" fill="rgba(231,76,60,0.2)" stroke="#e74c3c" stroke-width="3">
                            <animate attributeName="r" dur="3s" values="60;70;60" repeatCount="indefinite"/>
                        </circle>
                        <text fill="#ecf0f1" font-size="18" text-anchor="middle" x="150" y="205">å¹‚å‡½æ•°</text>

                        <circle cx="450" cy="200" r="60" fill="rgba(52,152,219,0.2)" stroke="#3498db" stroke-width="3">
                            <animate attributeName="r" dur="3s" values="60;70;60" repeatCount="indefinite" begin="0.5s"/>
                        </circle>
                        <text fill="#ecf0f1" font-size="18" text-anchor="middle" x="450" y="205">æŒ‡å¯¹æ•°</text>

                        <circle cx="150" cy="380" r="60" fill="rgba(46,204,113,0.2)" stroke="#2ecc71" stroke-width="3">
                            <animate attributeName="r" dur="3s" values="60;70;60" repeatCount="indefinite" begin="1s"/>
                        </circle>
                        <text fill="#ecf0f1" font-size="18" text-anchor="middle" x="150" y="385">ä¸‰è§’</text>

                        <circle cx="450" cy="380" r="60" fill="rgba(155,89,182,0.2)" stroke="#9b59b6" stroke-width="3">
                            <animate attributeName="r" dur="3s" values="60;70;60" repeatCount="indefinite" begin="1.5s"/>
                        </circle>
                        <text fill="#ecf0f1" font-size="18" text-anchor="middle" x="450" y="385">å››åˆ™</text>

                        <circle cx="300" cy="290" r="80" fill="rgba(241,196,15,0.3)" stroke="#f39c12" stroke-width="4">
                            <animate attributeName="r" dur="3s" values="80;90;80" repeatCount="indefinite" begin="2s"/>
                        </circle>
                        <text fill="#f1c40f" font-size="22" text-anchor="middle" x="300" y="295">å¯¼æ•°</text>
                        <text fill="#f1c40f" font-size="22" text-anchor="middle" x="300" y="320">å·¥å…·ç®±</text>
                    </svg>
                </div>
            </div>
        </div>
    </div>

    <div class="subtitle-area" id="subtitleArea">
        æ¬¢è¿å­¦ä¹ åŸºæœ¬æ±‚å¯¼å…¬å¼ä¸å››åˆ™è¿ç®—!ç‚¹å‡»å¼€å§‹è®²è¯¾å¯åŠ¨è™šæ‹Ÿäººè®²å¸ˆã€‚
    </div>

    <div class="control-bar">
        <div style="color: #f1c40f; font-weight: bold; margin-bottom: 15px; text-align: center;">
            ç¬¬ <span id="currentSlide">1</span> / <span id="totalSlides">8</span> é¡µ
        </div>
        <button class="btn" id="prevBtn" onclick="previousSlide()">â¬…ï¸ ä¸Šä¸€é¡µ</button>
        <button class="btn primary" id="startBtn" onclick="startTeaching()">ğŸ€ å¼€å§‹è®²è¯¾</button>
        <button class="btn" id="nextBtn" onclick="nextSlide()">ä¸‹ä¸€é¡µ â¡ï¸</button>
        <button class="btn" onclick="restart()">ğŸ”„ é‡æ–°å¼€å§‹</button>
        <button class="btn" id="autoPlayBtn" onclick="startAutoPlay()">ğŸ¬ è‡ªåŠ¨æ’­æ”¾</button>
    </div>

    <script type="module">
        window.playbackFinished = false;

        try {
            const { default: AvatarPlatform, SDKEvents, PlayerEvents, RecorderEvents, UserMedia } = await import('./avatar-sdk-web_3.1.2.1002/index.js');
            window.AvatarPlatform = AvatarPlatform;
            window.SDKEvents = SDKEvents;
            window.PlayerEvents = PlayerEvents;
            window.RecorderEvents = RecorderEvents;
            window.UserMedia = UserMedia;
            console.log('âœ… è®¯é£SDKæ¨¡å—å·²åŠ è½½');
        } catch (error) {
            console.error('âŒ SDKåŠ è½½å¤±è´¥:', error);
        }
        window.dispatchEvent(new CustomEvent('sdkReady'));
    </script>

    <script>
        const lessonTitle = "åŸºæœ¬æ±‚å¯¼å…¬å¼ä¸å››åˆ™è¿ç®—";

        const subtitleScript = {
            "1": "åŒå­¦ä»¬å¥½!ä¸ŠèŠ‚è¯¾æˆ‘ä»¬å­¦ä¹ äº†å¯¼æ•°çš„å®šä¹‰:fæ’‡xç­‰äºå½“hè¶‹äº0æ—¶,fæ‹¬å·xåŠ hå‡fæ‹¬å·x,å…¨éƒ¨é™¤ä»¥hçš„æé™ã€‚ä½†æ˜¯å¦‚æœæ¯æ¬¡éƒ½ç”¨å®šä¹‰æ¥æ±‚å¯¼,ä¼šéå¸¸å¤æ‚!æ¯”å¦‚è¦æ±‚xçš„100æ¬¡æ–¹çš„å¯¼æ•°,å°±è¦å±•å¼€æ‹¬å·xåŠ hçš„100æ¬¡æ–¹,è¿™éœ€è¦ç”¨äºŒé¡¹å¼å®šç†,è®¡ç®—é‡å·¨å¤§!æ‰€ä»¥æˆ‘ä»¬è¿«åˆ‡éœ€è¦æ›´é«˜æ•ˆçš„æ–¹æ³•,è¿™å°±æ˜¯ä»Šå¤©è¦å­¦ä¹ çš„åŸºæœ¬æ±‚å¯¼å…¬å¼ã€‚æœ‰äº†è¿™äº›å…¬å¼,æ±‚å¯¼å°±åƒæŸ¥è¡¨ä¸€æ ·ç®€å•å¿«æ·!",
            "2": "é¦–å…ˆæ¥çœ‹å¹‚å‡½æ•°çš„æ±‚å¯¼å…¬å¼ã€‚è¿™æ˜¯æœ€åŸºç¡€ä¹Ÿæ˜¯æœ€é‡è¦çš„å…¬å¼:xçš„næ¬¡æ–¹æ±‚å¯¼,ç­‰äºnä¹˜ä»¥xçš„nå‡1æ¬¡æ–¹ã€‚è®°å¿†æ–¹æ³•å¾ˆç®€å•:æŠŠæŒ‡æ•°næ‹¿ä¸‹æ¥ä½œä¸ºç³»æ•°,ç„¶åæŒ‡æ•°å‡1ã€‚è®©æˆ‘ä»¬çœ‹å‡ ä¸ªä¾‹å­ã€‚å¸¸æ•°Cçš„å¯¼æ•°æ˜¯0,å› ä¸ºå¸¸æ•°ä¸å˜åŒ–ã€‚xçš„å¯¼æ•°æ˜¯1,å¯ä»¥çœ‹ä½œxçš„1æ¬¡æ–¹,æŒ‡æ•°1ä¸‹æ¥,xçš„0æ¬¡æ–¹ç­‰äº1ã€‚xå¹³æ–¹çš„å¯¼æ•°æ˜¯2x,xç«‹æ–¹çš„å¯¼æ•°æ˜¯3xå¹³æ–¹ã€‚ç‰¹åˆ«æ³¨æ„,è¿™ä¸ªå…¬å¼å¯¹æ‰€æœ‰å®æ•°néƒ½æˆç«‹!æ¯”å¦‚1é™¤ä»¥xå¯ä»¥å†™æˆxçš„è´Ÿ1æ¬¡æ–¹,å¯¼æ•°å°±æ˜¯è´Ÿ1ä¹˜ä»¥xçš„è´Ÿ2æ¬¡æ–¹,ä¹Ÿå°±æ˜¯è´Ÿçš„1é™¤ä»¥xå¹³æ–¹ã€‚æ ¹å·xæ˜¯xçš„äºŒåˆ†ä¹‹ä¸€æ¬¡æ–¹,å¯¼æ•°æ˜¯äºŒåˆ†ä¹‹ä¸€ä¹˜ä»¥xçš„è´ŸäºŒåˆ†ä¹‹ä¸€æ¬¡æ–¹ã€‚",
            "3": "æ¥ä¸‹æ¥çœ‹æŒ‡æ•°å‡½æ•°å’Œå¯¹æ•°å‡½æ•°çš„æ±‚å¯¼å…¬å¼ã€‚æŒ‡æ•°å‡½æ•°ä¸­,eçš„xæ¬¡æ–¹æœ€ä¸ºç‰¹æ®Š,å®ƒæœ‰ä¸€ä¸ªç¥å¥‡çš„æ€§è´¨:eçš„xæ¬¡æ–¹æ±‚å¯¼è¿˜æ˜¯eçš„xæ¬¡æ–¹!è¿™ä¸ªæ€§è´¨ä½¿å¾—eæˆä¸ºè‡ªç„¶å¯¹æ•°çš„åº•,åœ¨å¾®ç§¯åˆ†ä¸­æœ‰æå…¶é‡è¦çš„åœ°ä½ã€‚å¦‚æœåº•æ•°ä¸æ˜¯e,è€Œæ˜¯ä¸€èˆ¬çš„a,é‚£ä¹ˆaçš„xæ¬¡æ–¹æ±‚å¯¼ç­‰äºaçš„xæ¬¡æ–¹ä¹˜ä»¥ln aã€‚å¯¹æ•°å‡½æ•°æ–¹é¢,è‡ªç„¶å¯¹æ•°ln xçš„å¯¼æ•°ç­‰äº1é™¤ä»¥xã€‚ä»å‡ ä½•æ„ä¹‰ç†è§£,ln xå›¾åƒåœ¨xå¤„çš„åˆ‡çº¿æ–œç‡å°±æ˜¯1é™¤ä»¥xã€‚xè¶Šå¤§,åˆ‡çº¿è¶Šå¹³ç¼“ã€‚ä¸€èˆ¬å¯¹æ•°logä»¥aä¸ºåº•xçš„å¯¼æ•°,ç­‰äº1é™¤ä»¥æ‹¬å·xä¹˜ä»¥ln aã€‚è®°ä½è¿™äº›å…¬å¼çš„å…³é”®æ˜¯ç†è§£eå’Œlnçš„ç‰¹æ®Šå…³ç³»ã€‚",
            "4": "ä¸‰è§’å‡½æ•°çš„æ±‚å¯¼å…¬å¼ä¹Ÿæœ‰è§„å¾‹å¯å¾ªã€‚æ­£å¼¦å‡½æ•°sin xçš„å¯¼æ•°æ˜¯cos x,ä½™å¼¦å‡½æ•°cos xçš„å¯¼æ•°æ˜¯è´Ÿçš„sin xã€‚è®°å¿†å£è¯€æ˜¯:æ­£å¼¦å˜ä½™å¼¦,ä½™å¼¦å˜è´Ÿæ­£å¼¦ã€‚ä¸ºä»€ä¹ˆä¼šæœ‰è¿™ä¸ªè§„å¾‹å‘¢?ä»å›¾åƒä¸Šçœ‹,sin xçš„åˆ‡çº¿æ–œç‡å˜åŒ–æ°å¥½å¯¹åº”cos xçš„å€¼ã€‚åœ¨xç­‰äº0å¤„,sin xçš„åˆ‡çº¿æ–œç‡æœ€å¤§,è€Œcos 0ç­‰äº1ã€‚å†çœ‹tan x,å®ƒçš„å¯¼æ•°æ˜¯secå¹³æ–¹x,ä¹Ÿå°±æ˜¯1é™¤ä»¥coså¹³æ–¹xã€‚è¿™å¯ä»¥ç”¨é™¤æ³•æ³•åˆ™ä»tan xç­‰äºsin xé™¤ä»¥cos xæ¨å¯¼å‡ºæ¥ã€‚å¦‚æœä½ è¿ç»­å¯¹sin xæ±‚å¯¼,ä¼šå‘ç°:sinæ±‚å¯¼å¾—cos,cosæ±‚å¯¼å¾—è´Ÿsin,è´Ÿsinæ±‚å¯¼å¾—è´Ÿcos,è´Ÿcosæ±‚å¯¼åˆå›åˆ°sin,å½¢æˆäº†ä¸€ä¸ªå¾ªç¯!",
            "5": "æŒæ¡äº†åŸºæœ¬å…¬å¼å,æˆ‘ä»¬éœ€è¦å­¦ä¹ å››åˆ™è¿ç®—æ³•åˆ™,è¿™æ ·æ‰èƒ½å¤„ç†æ›´å¤æ‚çš„å‡½æ•°ã€‚é¦–å…ˆæ˜¯çº¿æ€§æ€§è´¨,ä¹Ÿå«å’Œå·®æ³•åˆ™:aå€çš„fåŠ å‡bå€çš„g,æ±‚å¯¼ç­‰äºaå€çš„fæ’‡åŠ å‡bå€çš„gæ’‡ã€‚è¿™è¯´æ˜å¸¸æ•°å¯ä»¥æå–å‡ºæ¥,å’Œå·®å¯ä»¥åˆ†åˆ«æ±‚å¯¼ã€‚ä¹˜æ³•æ³•åˆ™ç¨å¾®å¤æ‚ä¸€ç‚¹:fä¹˜ä»¥gçš„å¯¼æ•°,ç­‰äºfæ’‡ä¹˜ä»¥g,åŠ ä¸Šfä¹˜ä»¥gæ’‡ã€‚å£è¯€æ˜¯"å‰å¯¼åä¸å¯¼,åŠ ä¸Šå‰ä¸å¯¼åå¯¼"ã€‚æ³¨æ„æœ‰ä¸¤é¡¹!é™¤æ³•æ³•åˆ™æ˜¯:fé™¤ä»¥gçš„å¯¼æ•°,ç­‰äºæ‹¬å·fæ’‡ä¹˜ä»¥gå‡å»fä¹˜ä»¥gæ’‡,å…¨éƒ¨é™¤ä»¥gçš„å¹³æ–¹ã€‚åˆ†å­æ˜¯"ä¸Šå¯¼ä¸‹å‡ä¸Šä¸‹å¯¼",åˆ†æ¯æ˜¯gçš„å¹³æ–¹ã€‚ä¸€å®šè¦è®°ä½åˆ†æ¯è¦å¹³æ–¹!è¿™ä¸ªå¾ˆå®¹æ˜“å¿˜è®°ã€‚",
            "6": "è®©æˆ‘ä»¬é€šè¿‡å…·ä½“ä¾‹é¢˜æ¥ç»ƒä¹ ä¹˜æ³•æ³•åˆ™å’Œé™¤æ³•æ³•åˆ™ã€‚ä¾‹é¢˜1:æ±‚yç­‰äºxå¹³æ–¹ä¹˜ä»¥eçš„xæ¬¡æ–¹çš„å¯¼æ•°ã€‚è¿™æ˜¯ä¸¤ä¸ªå‡½æ•°ç›¸ä¹˜,ç”¨ä¹˜æ³•æ³•åˆ™ã€‚è®¾fç­‰äºxå¹³æ–¹,gç­‰äºeçš„xæ¬¡æ–¹,é‚£ä¹ˆfæ’‡ç­‰äº2x,gæ’‡ç­‰äºeçš„xæ¬¡æ–¹ã€‚æ ¹æ®ä¹˜æ³•æ³•åˆ™,yæ’‡ç­‰äº2xä¹˜ä»¥eçš„xæ¬¡æ–¹,åŠ ä¸Šxå¹³æ–¹ä¹˜ä»¥eçš„xæ¬¡æ–¹ã€‚å¯ä»¥æå–å…¬å› å­eçš„xæ¬¡æ–¹,å¾—åˆ°æ‹¬å·2xåŠ xå¹³æ–¹ä¹˜ä»¥eçš„xæ¬¡æ–¹ã€‚ä¾‹é¢˜2:æ±‚yç­‰äºsin xé™¤ä»¥xçš„å¯¼æ•°ã€‚è¿™æ˜¯é™¤æ³•,ç”¨é™¤æ³•æ³•åˆ™ã€‚fç­‰äºsin x,fæ’‡ç­‰äºcos x;gç­‰äºx,gæ’‡ç­‰äº1ã€‚ä»£å…¥å…¬å¼:yæ’‡ç­‰äºæ‹¬å·cos xä¹˜ä»¥xå‡å»sin xä¹˜ä»¥1,å…¨éƒ¨é™¤ä»¥xå¹³æ–¹,ç»“æœæ˜¯x cos xå‡sin x,é™¤ä»¥xå¹³æ–¹ã€‚",
            "7": "å†çœ‹ä¸€é“ç»¼åˆæ€§æ›´å¼ºçš„ä¾‹é¢˜ã€‚ä¾‹é¢˜3:æ±‚yç­‰äºln xé™¤ä»¥xå¹³æ–¹çš„å¯¼æ•°ã€‚è¿™ä¹Ÿæ˜¯é™¤æ³•æ³•åˆ™çš„åº”ç”¨ã€‚fç­‰äºln x,fæ’‡ç­‰äº1é™¤ä»¥x;gç­‰äºxå¹³æ–¹,gæ’‡ç­‰äº2xã€‚æ ¹æ®é™¤æ³•æ³•åˆ™,yæ’‡ç­‰äº1é™¤ä»¥xä¹˜ä»¥xå¹³æ–¹,å‡å»ln xä¹˜ä»¥2x,å…¨éƒ¨é™¤ä»¥xå¹³æ–¹çš„å¹³æ–¹,ä¹Ÿå°±æ˜¯xçš„å››æ¬¡æ–¹ã€‚åˆ†å­æ˜¯xå‡å»2x ln x,åˆ†æ¯æ˜¯xçš„å››æ¬¡æ–¹ã€‚ç°åœ¨æ³¨æ„åŒ–ç®€æŠ€å·§:åˆ†å­åˆ†æ¯åŒæ—¶çº¦å»ä¸€ä¸ªx,å¾—åˆ°1å‡2 ln x,å…¨éƒ¨é™¤ä»¥xçš„ä¸‰æ¬¡æ–¹ã€‚è¿™å°±æ˜¯æœ€ç»ˆç­”æ¡ˆã€‚åšé™¤æ³•æ³•åˆ™çš„é¢˜ç›®æ—¶,ä¸€å®šè¦æ³¨æ„:ç¬¬ä¸€,åˆ†å­çš„ç¬¦å·,æ˜¯å‡å·ä¸æ˜¯åŠ å·;ç¬¬äºŒ,åˆ†æ¯è¦å¹³æ–¹;ç¬¬ä¸‰,æœ€åè¦åŒ–ç®€åˆ°æœ€ç®€å½¢å¼ã€‚",
            "8": "å¥½,ä»Šå¤©çš„è¯¾ç¨‹æˆ‘ä»¬å°±è®²åˆ°è¿™é‡Œã€‚è®©æˆ‘ä»¬å›é¡¾ä¸€ä¸‹å­¦ä¹ çš„å†…å®¹ã€‚åŸºæœ¬æ±‚å¯¼å…¬å¼æœ‰ä¸‰ç±»:ç¬¬ä¸€ç±»æ˜¯å¹‚å‡½æ•°,xçš„næ¬¡æ–¹å¯¼æ•°ç­‰äºnxçš„nå‡1æ¬¡æ–¹;ç¬¬äºŒç±»æ˜¯æŒ‡æ•°å¯¹æ•°,eçš„xæ¬¡æ–¹å¯¼æ•°æ˜¯eçš„xæ¬¡æ–¹,ln xå¯¼æ•°æ˜¯1é™¤ä»¥x;ç¬¬ä¸‰ç±»æ˜¯ä¸‰è§’å‡½æ•°,sin xå¯¼æ•°æ˜¯cos x,cos xå¯¼æ•°æ˜¯è´Ÿsin xã€‚å››åˆ™è¿ç®—æ³•åˆ™åŒ…æ‹¬:å’Œå·®æ³•åˆ™å¯ä»¥åˆ†åˆ«æ±‚å¯¼,ä¹˜æ³•æ³•åˆ™æ˜¯å‰å¯¼åä¸å¯¼åŠ å‰ä¸å¯¼åå¯¼,é™¤æ³•æ³•åˆ™æ˜¯ä¸Šå¯¼ä¸‹å‡ä¸Šä¸‹å¯¼é™¤ä»¥gå¹³æ–¹ã€‚è¿™äº›å…¬å¼ä¸€å®šè¦ç†Ÿè®°äºå¿ƒ,å› ä¸ºå®ƒä»¬æ˜¯åç»­å­¦ä¹ çš„åŸºç¡€!ç†Ÿç»ƒæŒæ¡å,æ±‚å¯¼å°±ä¼šå˜å¾—åƒå››åˆ™è¿ç®—ä¸€æ ·ç®€å•ã€‚ä¸‹èŠ‚è¯¾æˆ‘ä»¬è¦å­¦ä¹ é“¾å¼æ³•åˆ™,é‚£æ˜¯å¤„ç†å¤åˆå‡½æ•°æ±‚å¯¼çš„å¼ºå¤§å·¥å…·,æ¯”å¦‚eçš„xå¹³æ–¹ã€sinçš„2xè¿™ç±»å‡½æ•°éƒ½è¦ç”¨é“¾å¼æ³•åˆ™ã€‚ä»Šå¤©çš„è¯¾å°±åˆ°è¿™é‡Œ,åŒå­¦ä»¬è¯¾åä¸€å®šè¦å¤šåšç»ƒä¹ ,æŠŠå…¬å¼è®°ç‰¢!å†è§!"
        };

        const actionMap = {
            "1": "A_RLH_welcome_O",
            "2": "A_RH_point_O",
            "3": "A_LH_introduced_O",
            "4": "A_RH_point_O",
            "5": "A_LH_introduced_O",
            "6": "A_RH_point_O",
            "7": "A_RH_point_O",
            "8": "A_RLH_welcome_O"
        };

        let currentSlide = 0;
        const totalSlides = 8;
        let avatarPlatform = null;
        let isConnected = false;
        let isTeaching = false;
        let isAutoPlaying = false;
        let speechFinishedResolve = null;

        const slides = document.querySelectorAll('.slide');

        function showSlide(index) {
            slides.forEach((slide, i) => slide.classList.toggle('active', i === index));
            currentSlide = index;
            document.getElementById('currentSlide').textContent = index + 1;

            if (window.MathJax && window.MathJax.typesetPromise) {
                window.MathJax.typesetPromise([slides[index]]).catch(err => console.error(err));
            }

            document.getElementById('prevBtn').disabled = index === 0;
            document.getElementById('nextBtn').disabled = index === totalSlides - 1;
            updateSubtitle(index + 1);
        }

        function nextSlide() {
            if (currentSlide < totalSlides - 1) {
                showSlide(currentSlide + 1);
                if (!isAutoPlaying) speakContent(currentSlide + 1);
            }
        }

        function previousSlide() {
            if (currentSlide > 0) {
                showSlide(currentSlide - 1);
                if (!isAutoPlaying) speakContent(currentSlide + 1);
            }
        }

        function restart() {
            showSlide(0);
            if (avatarPlatform) {
                avatarPlatform.stop();
            }
            isConnected = false;
            isTeaching = false;
            isAutoPlaying = false;
        }

        function updateSubtitle(slideNum) {
            const subtitleArea = document.getElementById('subtitleArea');
            subtitleArea.textContent = subtitleScript[slideNum] || '';
        }

        async function speakContent(slideNum) {
            if (!isTeaching || !isConnected || !avatarPlatform) {
                console.log('âš ï¸ è™šæ‹Ÿäººæœªè¿æ¥');
                return;
            }

            const content = subtitleScript[slideNum];
            if (!content) return;

            try {
                const action = actionMap[slideNum];
                if (action) {
                    await avatarPlatform.writeCmd("action", action);
                }

                await avatarPlatform.writeText(content, { nlp: false });
                updateSubtitle(slideNum);
            } catch (error) {
                console.error('âŒ è®²è§£å¤±è´¥:', error);
            }
        }

        function updateStatus(message, type = 'normal') {
            const indicator = document.getElementById('statusIndicator');
            if (indicator) {
                indicator.textContent = message;
                indicator.className = 'status-indicator';
                if (type === 'connected') indicator.classList.add('connected');
                else if (type === 'error') indicator.classList.add('error');
                else if (type === 'connecting') indicator.classList.add('connecting');
            }
        }

        function waitForSDK() {
            return new Promise((resolve, reject) => {
                if (typeof AvatarPlatform !== 'undefined') {
                    resolve();
                    return;
                }

                const timeout = setTimeout(() => {
                    reject(new Error('SDKåŠ è½½è¶…æ—¶'));
                }, 10000);

                window.addEventListener('sdkReady', function handler() {
                    clearTimeout(timeout);
                    window.removeEventListener('sdkReady', handler);
                    resolve();
                });
            });
        }

        async function startTeaching() {
            const startBtn = document.getElementById('startBtn');
            startBtn.textContent = 'ğŸ”„ å¯åŠ¨ä¸­...';
            startBtn.disabled = true;

            try {
                updateStatus('ç­‰å¾…SDK...', 'connecting');
                await waitForSDK();

                if(avatarPlatform) {
                    avatarPlatform.destroy();
                }

                avatarPlatform = new AvatarPlatform({ useInlinePlayer: true });

                avatarPlatform
                    .on('connected', (initResp) => {
                        console.log('ğŸ‰ è¿æ¥æˆåŠŸ');
                        isConnected = true;
                        isTeaching = true;
                        updateStatus('å·²è¿æ¥', 'connected');
                        startBtn.textContent = 'ğŸ’– è™šæ‹Ÿäººå·²å°±ç»ª';

                        setTimeout(() => {
                            speakContent(currentSlide + 1);
                        }, 1000);
                    })
                    .on('frame_stop', (data) => {
                        console.log('âœ… è™šæ‹Ÿäººè®²è§£å®Œæˆ frame_stop:', data);
                        if (isAutoPlaying && speechFinishedResolve) {
                            console.log('ğŸ¬ é€šçŸ¥è‡ªåŠ¨æ’­æ”¾ï¼šè™šæ‹Ÿäººè®²è§£å®Œæˆ');
                            speechFinishedResolve();
                            speechFinishedResolve = null;
                        }
                    })
                    .on('disconnected', (err) => {
                        isConnected = false;
                        updateStatus('è¿æ¥æ–­å¼€', 'error');
                    })
                    .on('error', (error) => {
                        console.error('âŒ é”™è¯¯:', error);
                        updateStatus('é”™è¯¯', 'error');
                        startBtn.textContent = 'âŒ è¿æ¥å¤±è´¥';
                        startBtn.disabled = false;
                        isTeaching = false;
                    });

                avatarPlatform.setApiInfo({
                    appId: 'e8c180ed',
                    apiKey: 'e0c44f0e2ef0f47582ffa7e864da0d9b',
                    apiSecret: 'MDZkNDNiZWU4NDkzNWM5MDQzMTY4N2Nh',
                    sceneId: '237415046114840576',
                    serverUrl: 'wss://avatar.cn-huadong-1.xf-yun.com/v1/interact'
                });

                avatarPlatform.setGlobalParams({
                    stream: { protocol: 'xrtc', alpha: 1, bitrate: 1000000, fps: 25 },
                    avatar: { avatar_id: '110332017', width: 1920, height: 1080, scale: 1, move_h: 0, move_v: 0, audio_format: 1 },
                    tts: { vcn: 'x4_yiting', speed: 50, pitch: 50, volume: 100 },
                    avatar_dispatch: { interactive_mode: 1, content_analysis: 0 }
                });

                await avatarPlatform.start({ wrapper: document.getElementById('avatarWrapper') });
            } catch (error) {
                console.error('âŒ å¯åŠ¨å¤±è´¥:', error);
                updateStatus('å¯åŠ¨å¤±è´¥', 'error');
                startBtn.textContent = 'ğŸ€ å¼€å§‹è®²è¯¾';
                startBtn.disabled = false;
            }
        }

        async function startAutoPlay() {
            if (!avatarPlatform || !isConnected) {
                await startTeaching();
                await new Promise(resolve => setTimeout(resolve, 2000));
            }

            isAutoPlaying = true;
            document.getElementById('autoPlayBtn').disabled = true;

            for (let slide = currentSlide + 1; slide <= totalSlides; slide++) {
                if (!isAutoPlaying) break;

                console.log(`\nğŸ¬ === å¼€å§‹æ’­æ”¾ç¬¬${slide}é¡µ/${totalSlides}é¡µ ===`);
                showSlide(slide - 1);

                // å¦‚æœè™šæ‹Ÿäººå·²è¿æ¥ï¼Œä½¿ç”¨frame_stopäº‹ä»¶åŒæ­¥
                if (isConnected && isTeaching && avatarPlatform) {
                    try {
                        // å…ˆç¨ä½œç­‰å¾…ç¡®ä¿çŠ¶æ€ç¨³å®š
                        await new Promise(resolve => setTimeout(resolve, 800));

                        // åˆ›å»ºPromiseç­‰å¾…è™šæ‹Ÿäººè®²è§£å®Œæˆ
                        const speechPromise = new Promise(resolve => {
                            speechFinishedResolve = resolve;
                        });

                        await speakContent(slide);
                        console.log(`â³ ç­‰å¾…è™šæ‹Ÿäººè®²è§£ç¬¬${slide}é¡µå®Œæˆ...`);

                        // ç­‰å¾…è™šæ‹Ÿäººè®²è§£å®Œæˆï¼Œæˆ–è¶…æ—¶ï¼ˆé˜²æ­¢å¡ä½ï¼‰
                        const timeoutDuration = (subtitleScript[slide].length / 4) * 1000 + 5000;
                        const timeoutPromise = new Promise(resolve =>
                            setTimeout(() => {
                                console.log(`âš ï¸ ç¬¬${slide}é¡µè®²è§£è¶…æ—¶ï¼Œç»§ç»­ä¸‹ä¸€é¡µ`);
                                resolve();
                            }, timeoutDuration)
                        );

                        await Promise.race([speechPromise, timeoutPromise]);
                        console.log(`âœ… ç¬¬${slide}é¡µè®²è§£å®Œæˆ`);

                        // é¡µé¢é—´ç­‰å¾…æ—¶é—´
                        if (slide < totalSlides) {
                            await new Promise(resolve => setTimeout(resolve, 1500));
                        }
                    } catch (error) {
                        console.error(`âŒ ç¬¬${slide}é¡µæ’­æ”¾å‡ºé”™:`, error);
                    }
                } else {
                    // è™šæ‹Ÿäººæœªè¿æ¥ï¼Œä½¿ç”¨å›ºå®šå»¶æ—¶
                    console.log('âš ï¸ è™šæ‹Ÿäººæœªè¿æ¥ï¼Œä½¿ç”¨å›ºå®šå»¶æ—¶');
                    const duration = (subtitleScript[slide].length / 4) * 1000 + 3000;
                    await new Promise(resolve => setTimeout(resolve, duration));
                }
            }

            isAutoPlaying = false;
            document.getElementById('autoPlayBtn').disabled = false;
            window.playbackFinished = true;
            document.title = "PLAYBACK_FINISHED";
            console.log('ğŸ‰ æ’­æ”¾å®Œæˆ');
        }

        document.addEventListener('keydown', (e) => {
            if (e.key === 'ArrowRight' || e.key === ' ') {
                e.preventDefault();
                nextSlide();
            } else if (e.key === 'ArrowLeft') {
                e.preventDefault();
                previousSlide();
            } else if (e.key === 'Enter') {
                e.preventDefault();
                speakContent(currentSlide + 1);
            }
        });

        document.getElementById('totalSlides').textContent = totalSlides;
        showSlide(0);

        setTimeout(() => {
            console.log('ğŸš€ è‡ªåŠ¨å¯åŠ¨æ’­æ”¾...');
            startAutoPlay();
        }, 3000);
    </script>
</body>
</html>
