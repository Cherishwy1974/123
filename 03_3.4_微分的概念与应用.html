<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=1920, initial-scale=1.0">
    <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate">
    <meta http-equiv="Pragma" content="no-cache">
    <meta http-equiv="Expires" content="0">
    <title>03_3.4_å¾®åˆ†çš„æ¦‚å¿µä¸åº”ç”¨ v2.0</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Serif+SC:wght@400;600;700&display=swap" rel="stylesheet">
    <script>
        window.MathJax = {
            tex: {
                inlineMath: [['$', '$'], ['\\(', '\\)']],
                displayMath: [['$$', '$$'], ['\\[', '\\]']],
                processEscapes: true,
                processEnvironments: true
            },
            startup: {
                pageReady: () => {
                    return MathJax.startup.defaultPageReady().then(() => {
                        console.log('âœ… MathJaxå·²åŠ è½½');
                    });
                }
            }
        };
    </script>
    <!-- ä¼˜åŒ–ï¼šä½¿ç”¨ chtml ç‰ˆæœ¬ï¼Œé€šå¸¸æ€§èƒ½æ›´å¥½ -->
    <script async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        html, body { width: 100%; height: 100%; margin: 0; padding: 0; }
        body { font-family: 'Noto Serif SC', serif; background: #1a1a2e; overflow: hidden; height: 100vh; width: 100vw; }
        .blackboard { width: 100vw; height: 100vh; background: #1a1a2e; position: relative; border: 10px solid #795548; margin: 0; }
        .avatar-container { position: fixed; top: 60%; left: 50%; transform: translate(-50%, -50%); width: 975px; height: 1105px; overflow: hidden; z-index: 50; pointer-events: none; background: transparent; }
        .wrapper { width: 100%; height: 100%; background: transparent; pointer-events: auto; }
        .slide-container { width: 100%; height: 100%; position: relative; }
        .slide { position: absolute; top: 0; left: 0; width: 100%; height: 100%; opacity: 0; visibility: hidden; transition: opacity 0.6s ease-in-out; display: flex; justify-content: center; align-items: center; padding: 2rem; background-color: transparent; }
        .slide.active { opacity: 1; visibility: visible; }
        .slide-content { display: flex; flex-direction: row; gap: 2rem; width: 100%; height: 95%; }
        .chalkboard { flex: 0 0 45%; padding: 20px; display: flex; flex-direction: column; justify-content: center; overflow-y: auto; }
        .chalkboard h2 { color: #f1c40f; border-bottom: 2px solid #f39c12; font-size: 28px; padding-bottom: 10px; margin-bottom: 20px; }
        .chalkboard h3 { color: #1abc9c; font-size: 22px; margin-top: 20px; margin-bottom: 10px; }
        .chalkboard p, .chalkboard li { color: #e0e0e0; font-size: 18px; line-height: 1.8; margin: 8px 0; }
        .chalkboard strong { color: #e74c3c; }
        /* ä¿®å¤ï¼šä½¿ç”¨ DIV ä½œä¸ºå—çº§å®¹å™¨æ¥æ‰¿è½½å—çº§å…¬å¼ */
        .math-formula-box {
            background-color: rgba(0,0,0,0.2);
            padding: 15px;
            border-radius: 5px;
            border-left: 4px solid #f39c12;
            font-size: 20px;
            color: #1abc9c;
            text-align: center;
            margin: 15px 0;
        }
        .visualization { flex: 1; padding: 20px; display: flex; justify-content: center; align-items: center; overflow: hidden; }
        .control-bar { position: fixed; left: -9999px; top: 50%; transform: translateY(-50%); width: 270px; background: rgba(255, 255, 255, 0.15); backdrop-filter: blur(15px); display: flex; flex-direction: column; gap: 12px; z-index: 200; border-radius: 0 20px 20px 0; padding: 25px 20px; box-shadow: 0 8px 32px rgba(0, 0, 0, 0.2); border: 1px solid rgba(255, 255, 255, 0.2); }
        .btn { padding: 14px 22px; background: rgba(255, 255, 255, 0.25); color: #333; border: 1px solid rgba(255, 255, 255, 0.3); border-radius: 12px; cursor: pointer; font-size: 14px; font-weight: 600; width: 100%; text-align: center; }
        .btn.primary { background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: #fff; }
        .subtitle-area { position: absolute; bottom: 20px; left: 50px; right: 50px; min-height: 50px; background: rgba(0,0,0,0.8); border-radius: 8px; display: flex; align-items: center; justify-content: center; z-index: 60; color: white; font-size: 23px; text-align: center; padding: 15px 20px; line-height: 1.4; }
        .status-indicator { position: absolute; top: 10px; right: 10px; padding: 5px 10px; background: rgba(0,0,0,0.5); color: white; border-radius: 5px; font-size: 16px; z-index: 100; display: none; }
        .status-indicator.connected { background: rgba(76, 175, 80, 0.8); display: block; }
        .status-indicator.error { background: rgba(244, 67, 54, 0.8); display: block; }
        .status-indicator.connecting { background: rgba(255, 152, 0, 0.8); display: block; }
    </style>
</head>
<body class="blackboard">
    <div class="status-indicator" id="statusIndicator">ç­‰å¾…è¿æ¥</div>
    <div class="avatar-container"><div class="wrapper" id="avatarWrapper"></div></div>
    <div class="slide-container">
        <!-- ç¬¬1é¡µ:è¯¾ç¨‹å¼•å…¥ - å¯¼æ•°å›é¡¾ -->
        <div class="slide active">
            <div class="slide-content">
                <div class="chalkboard">
                    <h2>å›é¡¾ï¼šå¯¼æ•°çš„æ¦‚å¿µ</h2>
                    <p>æˆ‘ä»¬å·²ç»å­¦ä¹ äº†<strong>å¯¼æ•°</strong>çš„æ¦‚å¿µï¼š</p>
                    <div class="math-formula-box">\[f'(x) = \lim_{\Delta x \to 0} \frac{\Delta y}{\Delta x}\]</div>
                    <p>å¯¼æ•°æè¿°äº†å‡½æ•°çš„<strong>å˜åŒ–ç‡</strong>ã€‚</p>
                    <p style="margin-top: 20px; color: #95a5a6;">ä»Šå¤©æˆ‘ä»¬è¦å­¦ä¹ ä¸€ä¸ªæ–°æ¦‚å¿µâ€”â€”<strong>å¾®åˆ†</strong>ã€‚</p>
                </div>
                <div class="visualization">
                    <svg viewBox="0 0 600 500" style="width: 100%; height: 100%;">
                        <text fill="#f39c12" font-size="32" text-anchor="middle" x="300" y="80">å¾®åˆ†çš„æ¦‚å¿µä¸åº”ç”¨</text>
                        <circle cx="300" cy="250" r="100" fill="rgba(231,76,60,0.2)" stroke="#e74c3c" stroke-width="4">
                            <animate attributeName="r" dur="2s" values="100;110;100" repeatCount="indefinite"/>
                        </circle>
                        <text fill="#ecf0f1" font-size="28" text-anchor="middle" x="300" y="245">å¯¼æ•°</text>
                        <text fill="#ecf0f1" font-size="20" text-anchor="middle" x="300" y="275">f'(x)</text>
                        <text fill="#f39c12" font-size="60" text-anchor="middle" x="300" y="400">?</text>
                        <text fill="#1abc9c" font-size="24" text-anchor="middle" x="300" y="450">å¾®åˆ†æ˜¯ä»€ä¹ˆ?</text>
                    </svg>
                </div>
            </div>
        </div>

        <!-- ç¬¬2é¡µ:æå‡ºé—®é¢˜ -->
        <div class="slide">
            <div class="slide-content">
                <div class="chalkboard">
                    <h2>ä¸€ä¸ªæ–°é—®é¢˜</h2>
                    <p>å½“è‡ªå˜é‡ \(x\) æœ‰ä¸€ä¸ª<strong>å¾®å°å˜åŒ–</strong> \(\Delta x\) æ—¶ï¼Œ</p>
                    <p>å‡½æ•° \(y\) ä¼šå˜åŒ–å¤šå°‘ï¼Ÿ</p>
                    <p style="margin-top: 25px;">ä»å¯¼æ•°çš„å®šä¹‰ï¼Œå½“ \(\Delta x\) å¾ˆå°æ—¶ï¼š</p>
                    <div class="math-formula-box">\[\Delta y \approx f'(x) \cdot \Delta x\]</div>
                </div>
                <div class="visualization">
                    <svg viewBox="0 0 600 500" style="width: 100%; height: 100%;">
                        <text fill="#f39c12" font-size="26" text-anchor="middle" x="300" y="50">å˜åŒ–é‡çš„å…³ç³»</text>
                        <rect x="100" y="150" width="150" height="80" fill="rgba(241,196,15,0.2)" stroke="#f39c12" stroke-width="3" rx="10"/>
                        <text fill="#ecf0f1" font-size="24" text-anchor="middle" x="175" y="200">Î”x</text>
                        <line x1="250" y1="190" x2="350" y2="190" stroke="#e74c3c" stroke-width="4" marker-end="url(#arrowhead)"/>
                        <text fill="#e74c3c" font-size="20" text-anchor="middle" x="300" y="170">Ã—f'(x)</text>
                        <rect x="350" y="150" width="150" height="80" fill="rgba(52,152,219,0.2)" stroke="#3498db" stroke-width="3" rx="10"/>
                        <text fill="#ecf0f1" font-size="24" text-anchor="middle" x="425" y="200">Î”y</text>
                        <rect x="150" y="300" width="300" height="100" fill="rgba(46,204,113,0.2)" stroke="#2ecc71" stroke-width="3" rx="10"/>
                        <text fill="#ecf0f1" font-size="20" text-anchor="middle" x="300" y="340">è¿‘ä¼¼å…³ç³»</text>
                        <text fill="#1abc9c" font-size="24" text-anchor="middle" x="300" y="375">Î”y â‰ˆ f'(x) Â· Î”x</text>
                        <defs>
                            <marker id="arrowhead" markerWidth="10" markerHeight="10" refX="9" refY="3" orient="auto" markerUnits="strokeWidth">
                                <path d="M0,0 L0,6 L9,3 z" fill="#e74c3c"/>
                            </marker>
                        </defs>
                    </svg>
                </div>
            </div>
        </div>

        <!-- ç¬¬3é¡µ:å¼•å‡ºå¾®åˆ†æ¦‚å¿µ -->
        <div class="slide">
            <div class="slide-content">
                <div class="chalkboard">
                    <h2>å¾®åˆ†çš„å¼•å…¥</h2>
                    <p><strong>å¾®åˆ†</strong>ä¸“é—¨ç ”ç©¶å‡½æ•°å¢é‡çš„çº¿æ€§è¿‘ä¼¼å…³ç³»ã€‚</p>
                    <p style="margin-top: 20px; color: #e74c3c;">å®ƒæ˜¯å¯¼æ•°æ¦‚å¿µçš„å»¶ä¼¸å’Œåº”ç”¨ï¼</p>
                    <p style="color: #1abc9c;">ç”¨ç®€å•çš„çº¿æ€§å…³ç³»ä»£æ›¿å¤æ‚çš„å‡½æ•°å˜åŒ–ã€‚</p>
                </div>
                <div class="visualization">
                    <svg viewBox="0 0 600 500" style="width: 100%; height: 100%;">
                        <text fill="#f39c12" font-size="28" text-anchor="middle" x="300" y="50">å¯¼æ•° â†’ å¾®åˆ†</text>
                        <circle cx="150" cy="200" r="70" fill="rgba(231,76,60,0.2)" stroke="#e74c3c" stroke-width="3">
                            <animate attributeName="r" dur="2s" values="70;80;70" repeatCount="indefinite"/>
                        </circle>
                        <text fill="#ecf0f1" font-size="20" text-anchor="middle" x="150" y="195">å¯¼æ•°</text>
                        <text fill="#ecf0f1" font-size="16" text-anchor="middle" x="150" y="215">f'(x)</text>
                        <line x1="220" y1="200" x2="380" y2="200" stroke="#f39c12" stroke-width="4" marker-end="url(#arrowhead2)"/>
                        <text fill="#f39c12" font-size="18" text-anchor="middle" x="300" y="180">åº”ç”¨</text>
                        <circle cx="450" cy="200" r="70" fill="rgba(52,152,219,0.2)" stroke="#3498db" stroke-width="3">
                            <animate attributeName="r" dur="2s" values="70;80;70" repeatCount="indefinite" begin="0.5s"/>
                        </circle>
                        <text fill="#ecf0f1" font-size="20" text-anchor="middle" x="450" y="195">å¾®åˆ†</text>
                        <text fill="#ecf0f1" font-size="16" text-anchor="middle" x="450" y="215">dy</text>
                        <rect x="100" y="320" width="400" height="100" fill="rgba(155,89,182,0.2)" stroke="#9b59b6" stroke-width="3" rx="10"/>
                        <text fill="#ecf0f1" font-size="20" text-anchor="middle" x="300" y="360">å¾®åˆ†æ˜¯å¯¼æ•°çš„å»¶ä¼¸</text>
                        <text fill="#1abc9c" font-size="18" text-anchor="middle" x="300" y="390">ç”¨äºä¼°è®¡å‡½æ•°çš„å˜åŒ–é‡</text>
                        <defs>
                            <marker id="arrowhead2" markerWidth="10" markerHeight="10" refX="9" refY="3" orient="auto" markerUnits="strokeWidth">
                                <path d="M0,0 L0,6 L9,3 z" fill="#f39c12"/>
                            </marker>
                        </defs>
                    </svg>
                </div>
            </div>
        </div>

        <!-- ç¬¬4é¡µ:å¾®åˆ†çš„å®šä¹‰ -->
        <div class="slide">
            <div class="slide-content">
                <div class="chalkboard">
                    <h2>å¾®åˆ†çš„å®šä¹‰</h2>
                    <p>è®¾å‡½æ•° \(y = f(x)\) åœ¨ç‚¹ \(x\) å¯å¯¼ï¼Œåˆ™ï¼š</p>
                    <div class="math-formula-box">\[dy = f'(x) \cdot dx\]</div>
                    <p style="margin-top: 15px;">å…¶ä¸­ï¼š</p>
                    <p>â€¢ \(dx = \Delta x\) æ˜¯è‡ªå˜é‡çš„å¾®åˆ†</p>
                    <p>â€¢ \(dy\) æ˜¯å‡½æ•° \(y\) çš„å¾®åˆ†</p>
                </div>
                <div class="visualization">
                    <svg viewBox="0 0 600 500" style="width: 100%; height: 100%;">
                        <text fill="#f39c12" font-size="26" text-anchor="middle" x="300" y="50">å¾®åˆ†çš„å®šä¹‰</text>
                        <rect x="100" y="150" width="400" height="80" fill="rgba(52,152,219,0.1)" stroke="#3498db" stroke-width="3" rx="10"/>
                        <text fill="#ecf0f1" font-size="28" text-anchor="middle" x="300" y="200">dy = f'(x) Â· dx</text>
                        <rect x="100" y="300" width="400" height="80" fill="rgba(241,196,15,0.2)" stroke="#f39c12" stroke-width="3" rx="10"/>
                        <text fill="#ecf0f1" font-size="18" text-anchor="middle" x="300" y="350">å¾®åˆ† = å¯¼æ•° Ã— è‡ªå˜é‡å¢é‡</text>
                    </svg>
                </div>
            </div>
        </div>

        <!-- ç¬¬5é¡µ:å¾®åˆ†ä¸å¯¼æ•°çš„å…³ç³» -->
        <div class="slide">
            <div class="slide-content">
                <div class="chalkboard">
                    <h2>å¾®åˆ†ä¸å¯¼æ•°çš„å…³ç³»</h2>
                    <p>ä» \(dy = f'(x) \cdot dx\) å¯å¾—ï¼š</p>
                    <div class="math-formula-box">\[f'(x) = \frac{dy}{dx}\]</div>
                    <p style="margin-top: 20px;"><strong>å¯¼æ•°æ˜¯å¾®åˆ†ä¹‹å•†ï¼</strong></p>
                    <p style="color: #95a5a6;">\(\frac{dy}{dx}\) å¯ä»¥çœŸæ­£ç†è§£ä¸º \(dy\) é™¤ä»¥ \(dx\)ã€‚</p>
                </div>
                <div class="visualization">
                    <svg viewBox="0 0 600 500" style="width: 100%; height: 100%;">
                        <text fill="#f39c12" font-size="26" text-anchor="middle" x="300" y="50">å¯¼æ•°ä¸å¾®åˆ†</text>
                        <rect x="100" y="120" width="400" height="80" fill="rgba(52,152,219,0.2)" stroke="#3498db" stroke-width="3" rx="10"/>
                        <text fill="#ecf0f1" font-size="24" text-anchor="middle" x="300" y="170">dy = f'(x) Â· dx</text>
                        <text fill="#f39c12" font-size="40" text-anchor="middle" x="300" y="250">â‡…</text>
                        <rect x="100" y="280" width="400" height="80" fill="rgba(46,204,113,0.2)" stroke="#2ecc71" stroke-width="3" rx="10"/>
                        <text fill="#ecf0f1" font-size="24" text-anchor="middle" x="300" y="330">f'(x) = dy/dx</text>
                        <rect x="100" y="400" width="400" height="60" fill="rgba(241,196,15,0.2)" stroke="#f39c12" stroke-width="2" rx="8"/>
                        <text fill="#1abc9c" font-size="18" text-anchor="middle" x="300" y="440">ä¸¤ç§è¡¨è¾¾ï¼ŒåŒä¸€ä¸ªæ¦‚å¿µï¼</text>
                    </svg>
                </div>
            </div>
        </div>

        <!-- ç¬¬6é¡µ:ä¸¤ç§å¢é‡ -->
        <div class="slide">
            <div class="slide-content">
                <div class="chalkboard">
                    <h2>ä¸¤ç§å¢é‡</h2>
                    <p>å½“è‡ªå˜é‡ä» \(x\) å˜åˆ° \(x + \Delta x\) æ—¶ï¼š</p>
                    <p style="margin-top: 15px;"><strong>1. æ›²çº¿å®é™…å¢é‡ \(\Delta y\)ï¼š</strong></p>
                    <div class="math-formula-box">\[\Delta y = f(x + \Delta x) - f(x)\]</div>
                    <p><strong>2. åˆ‡çº¿å¢é‡ \(dy\)ï¼š</strong></p>
                    <div class="math-formula-box">\[dy = f'(x) \cdot \Delta x\]</div>
                </div>
                <div class="visualization">
                    <svg viewBox="0 0 600 500" style="width: 100%; height: 100%;">
                        <text fill="#f39c12" font-size="26" text-anchor="middle" x="300" y="40">ä¸¤ç§å¢é‡</text>
                        <line x1="100" y1="400" x2="550" y2="400" stroke="#ecf0f1" stroke-width="2"/>
                        <line x1="100" y1="100" x2="100" y2="400" stroke="#ecf0f1" stroke-width="2"/>
                        <text fill="#ecf0f1" font-size="14" x="560" y="405">x</text>
                        <text fill="#ecf0f1" font-size="14" x="105" y="90">y</text>
                        <path d="M 150 350 Q 250 200 350 250 Q 450 300 500 200" fill="none" stroke="#3498db" stroke-width="3"/>
                        <text fill="#3498db" font-size="16" x="450" y="180">y = f(x)</text>
                        <circle cx="250" cy="230" r="5" fill="#e74c3c"/>
                        <text fill="#e74c3c" font-size="14" x="215" y="220">(x, f(x))</text>
                        <line x1="150" y1="290" x2="400" y2="170" stroke="#2ecc71" stroke-width="2" stroke-dasharray="5,5"/>
                        <text fill="#2ecc71" font-size="14" x="380" y="160">åˆ‡çº¿</text>
                        <line x1="250" y1="405" x2="350" y2="405" stroke="#f39c12" stroke-width="3"/>
                        <line x1="250" y1="400" x2="250" y2="410" stroke="#f39c12" stroke-width="2"/>
                        <line x1="350" y1="400" x2="350" y2="410" stroke="#f39c12" stroke-width="2"/>
                        <text fill="#f39c12" font-size="16" text-anchor="middle" x="300" y="430">Î”x</text>
                        <line x1="355" y1="200" x2="355" y2="250" stroke="#2ecc71" stroke-width="3"/>
                        <text fill="#2ecc71" font-size="16" x="365" y="230">dy</text>
                        <line x1="345" y1="230" x2="345" y2="250" stroke="#e74c3c" stroke-width="3"/>
                        <text fill="#e74c3c" font-size="16" x="320" y="245">Î”y</text>
                        <circle cx="350" cy="250" r="5" fill="#e74c3c"/>
                    </svg>
                </div>
            </div>
        </div>

        <!-- ç¬¬7é¡µ:å¾®åˆ†çš„è®¡ç®— -->
        <div class="slide">
            <div class="slide-content">
                <div class="chalkboard">
                    <h2>å¾®åˆ†çš„è®¡ç®—</h2>
                    <p>ç”±äº \(dy = f'(x) \cdot dx\),</p>
                    <p><strong>å¾®åˆ†è®¡ç®— = å¯¼æ•°è®¡ç®—!</strong></p>

                    <h3>åŸºæœ¬å¾®åˆ†å…¬å¼</h3>
                    <div class="math-formula-box">\[d(x^n) = nx^{n-1}dx\]</div>
                    <div class="math-formula-box">\[d(\sin x) = \cos x \, dx\]</div>
                    <div class="math-formula-box">\[d(e^x) = e^x dx\]</div>
                    <div class="math-formula-box">\[d(\ln x) = \frac{1}{x} dx\]</div>

                    <h3>å¾®åˆ†è¿ç®—æ³•åˆ™</h3>
                    <p>å’Œå¯¼æ•°è¿ç®—æ³•åˆ™<strong>å®Œå…¨ä¸€è‡´</strong>!</p>
                    <div class="math-formula-box">\[d(u \pm v) = du \pm dv\]</div>
                    <div class="math-formula-box">\[d(uv) = u \, dv + v \, du\]</div>
                </div>
                <div class="visualization">
                    <svg viewBox="0 0 600 500" style="width: 100%; height: 100%;">
                        <text fill="#f39c12" font-size="26" text-anchor="middle" x="300" y="50">å¾®åˆ† â†” å¯¼æ•°</text>

                        <!-- å¯¹åº”å…³ç³»å±•ç¤º -->
                        <g>
                            <rect x="80" y="100" width="200" height="60" fill="rgba(231,76,60,0.2)" stroke="#e74c3c" stroke-width="2" rx="8"/>
                            <text fill="#ecf0f1" font-size="18" text-anchor="middle" x="180" y="138">(xÂ²)' = 2x</text>
                        </g>

                        <line x1="280" y1="130" x2="320" y2="130" stroke="#f39c12" stroke-width="3"/>
                        <text fill="#f39c12" font-size="20" text-anchor="middle" x="300" y="125">â†”</text>

                        <g>
                            <rect x="320" y="100" width="200" height="60" fill="rgba(52,152,219,0.2)" stroke="#3498db" stroke-width="2" rx="8"/>
                            <text fill="#ecf0f1" font-size="18" text-anchor="middle" x="420" y="138">d(xÂ²) = 2x dx</text>
                        </g>

                        <!-- ç¬¬äºŒç»„ -->
                        <g opacity="0">
                            <rect x="80" y="200" width="200" height="60" fill="rgba(231,76,60,0.2)" stroke="#e74c3c" stroke-width="2" rx="8"/>
                            <text fill="#ecf0f1" font-size="18" text-anchor="middle" x="180" y="238">(sin x)' = cos x</text>
                            <animate attributeName="opacity" dur="8s" values="0;0;1;1" repeatCount="indefinite"/>
                        </g>

                        <line x1="280" y1="230" x2="320" y2="230" stroke="#f39c12" stroke-width="3" opacity="0">
                            <animate attributeName="opacity" dur="8s" values="0;0;1;1" repeatCount="indefinite"/>
                        </line>

                        <g opacity="0">
                            <rect x="320" y="200" width="200" height="60" fill="rgba(52,152,219,0.2)" stroke="#3498db" stroke-width="2" rx="8"/>
                            <text fill="#ecf0f1" font-size="16" text-anchor="middle" x="420" y="238">d(sin x) = cos x dx</text>
                            <animate attributeName="opacity" dur="8s" values="0;0;1;1" repeatCount="indefinite"/>
                        </g>

                        <!-- ç»“è®º -->
                        <rect x="100" y="320" width="400" height="100" fill="rgba(46,204,113,0.2)" stroke="#2ecc71" stroke-width="3" rx="10"/>
                        <text fill="#ecf0f1" font-size="20" text-anchor="middle" x="300" y="360">å¾®åˆ†å…¬å¼ = å¯¼æ•°å…¬å¼ Ã— dx</text>
                        <text fill="#1abc9c" font-size="18" text-anchor="middle" x="300" y="395">å½¢å¼ä¸Šå®Œå…¨ä¸€è‡´!</text>
                    </svg>
                </div>
            </div>
        </div>

        <!-- ç¬¬8é¡µ:å¾®åˆ†çš„å½¢å¼ä¸å˜æ€§ -->
        <div class="slide">
            <div class="slide-content">
                <div class="chalkboard">
                    <h2>å¾®åˆ†çš„å½¢å¼ä¸å˜æ€§</h2>
                    <p>è¿™æ˜¯å¾®åˆ†çš„<strong>é‡è¦æ€§è´¨</strong>!</p>

                    <h3>å®šç†</h3>
                    <p>æ— è®º \(u\) æ˜¯<strong>è‡ªå˜é‡</strong>è¿˜æ˜¯<strong>ä¸­é—´å˜é‡</strong>,</p>
                    <div class="math-formula-box">\[d(f(u)) = f'(u) \, du\]</div>
                    <p>è¿™ä¸ªå½¢å¼<strong>ä¿æŒä¸å˜</strong>!</p>

                    <h3>ä¾‹å­</h3>
                    <p>1. è‹¥ \(u = x\) (è‡ªå˜é‡):</p>
                    <div class="math-formula-box">\[d(\sin x) = \cos x \, dx\]</div>

                    <p>2. è‹¥ \(u = x^2\) (ä¸­é—´å˜é‡):</p>
                    <div class="math-formula-box">\[d(\sin x^2) = \cos(x^2) \, d(x^2)\]</div>
                    <p style="margin-left: 30px;">\(= \cos(x^2) \cdot 2x \, dx\)</p>

                    <p style="margin-top: 20px; color: #e74c3c;"><strong>å½¢å¼ä¸å˜!</strong> è¿™è®©è®¡ç®—æ›´ç®€å•!</p>
                </div>
                <div class="visualization">
                    <svg viewBox="0 0 600 500" style="width: 100%; height: 100%;">
                        <text fill="#f39c12" font-size="26" text-anchor="middle" x="300" y="50">å½¢å¼ä¸å˜æ€§</text>

                        <!-- è‡ªå˜é‡æƒ…å†µ -->
                        <rect x="100" y="100" width="400" height="80" fill="rgba(52,152,219,0.1)" stroke="#3498db" stroke-width="3" rx="10"/>
                        <text fill="#ecf0f1" font-size="20" text-anchor="middle" x="300" y="130">u = x (è‡ªå˜é‡)</text>
                        <text fill="#1abc9c" font-size="22" text-anchor="middle" x="300" y="165">d(sin u) = cos u Â· du</text>

                        <text fill="#f39c12" font-size="30" text-anchor="middle" x="300" y="220">â†“</text>
                        <text fill="#f39c12" font-size="18" text-anchor="middle" x="300" y="250">å½¢å¼ä¸å˜</text>
                        <text fill="#f39c12" font-size="30" text-anchor="middle" x="300" y="280">â†“</text>

                        <!-- ä¸­é—´å˜é‡æƒ…å†µ -->
                        <rect x="100" y="300" width="400" height="120" fill="rgba(155,89,182,0.1)" stroke="#9b59b6" stroke-width="3" rx="10"/>
                        <text fill="#ecf0f1" font-size="20" text-anchor="middle" x="300" y="330">u = xÂ² (ä¸­é—´å˜é‡)</text>
                        <text fill="#1abc9c" font-size="22" text-anchor="middle" x="300" y="365">d(sin u) = cos u Â· du</text>
                        <text fill="#e74c3c" font-size="18" text-anchor="middle" x="300" y="395">= cos(xÂ²) Â· 2x dx</text>

                        <!-- å¼ºè°ƒ -->
                        <circle cx="550" cy="140" r="30" fill="none" stroke="#e74c3c" stroke-width="3">
                            <animate attributeName="r" dur="2s" values="30;35;30" repeatCount="indefinite"/>
                        </circle>
                        <text fill="#e74c3c" font-size="24" text-anchor="middle" x="550" y="150">!</text>
                    </svg>
                </div>
            </div>
        </div>

        <!-- ç¬¬9é¡µ:å¾®åˆ†çš„åº”ç”¨1 - è¿‘ä¼¼è®¡ç®— -->
        <div class="slide">
            <div class="slide-content">
                <div class="chalkboard">
                    <h2>åº”ç”¨ä¸€:è¿‘ä¼¼è®¡ç®—</h2>
                    <p>åˆ©ç”¨å¾®åˆ†å¯ä»¥è¿›è¡Œ<strong>è¿‘ä¼¼è®¡ç®—</strong>:</p>
                    <div class="math-formula-box">\[f(x + \Delta x) \approx f(x) + f'(x) \Delta x\]</div>

                    <h3>ä¾‹é¢˜</h3>
                    <p>è®¡ç®— \(\sqrt{4.02}\) çš„è¿‘ä¼¼å€¼</p>

                    <p><strong>è§£:</strong> ä»¤ \(f(x) = \sqrt{x}\), \(x = 4\), \(\Delta x = 0.02\)</p>
                    <p style="margin-left: 30px;">\(f'(x) = \frac{1}{2\sqrt{x}}\)</p>
                    <p style="margin-left: 30px;">\(f'(4) = \frac{1}{2\sqrt{4}} = \frac{1}{4}\)</p>

                    <div class="math-formula-box">\[\sqrt{4.02} \approx \sqrt{4} + \frac{1}{4} \times 0.02\]</div>
                    <div class="math-formula-box">\[= 2 + 0.005 = 2.005\]</div>

                    <p style="margin-top: 15px; color: #95a5a6;">å®é™…å€¼: 2.00499... (è¯¯å·®æå°!)</p>
                </div>
                <div class="visualization">
                    <svg viewBox="0 0 600 500" style="width: 100%; height: 100%;">
                        <text fill="#f39c12" font-size="26" text-anchor="middle" x="300" y="40">è¿‘ä¼¼è®¡ç®—åŸç†</text>

                        <!-- åæ ‡ç³» -->
                        <line x1="100" y1="350" x2="550" y2="350" stroke="#ecf0f1" stroke-width="2"/>
                        <line x1="150" y1="100" x2="150" y2="400" stroke="#ecf0f1" stroke-width="2"/>

                        <!-- æ›²çº¿ y = âˆšx -->
                        <path d="M 150 350 Q 250 200 350 150 Q 450 120 520 100"
                              fill="none" stroke="#3498db" stroke-width="3"/>
                        <text fill="#3498db" font-size="16" x="480" y="85">y = âˆšx</text>

                        <!-- ç‚¹ (4, 2) -->
                        <circle cx="300" cy="200" r="6" fill="#e74c3c"/>
                        <text fill="#e74c3c" font-size="14" x="260" y="190">(4, 2)</text>
                        <line x1="300" y1="350" x2="300" y2="355" stroke="#e74c3c" stroke-width="2"/>
                        <text fill="#e74c3c" font-size="14" text-anchor="middle" x="300" y="375">4</text>

                        <!-- åˆ‡çº¿ -->
                        <line x1="250" y1="212.5" x2="400" y2="187.5" stroke="#2ecc71" stroke-width="2" stroke-dasharray="5,5"/>
                        <text fill="#2ecc71" font-size="14" x="380" y="180">åˆ‡çº¿</text>

                        <!-- Î”x -->
                        <line x1="300" y1="355" x2="350" y2="355" stroke="#f39c12" stroke-width="3"/>
                        <text fill="#f39c12" font-size="14" text-anchor="middle" x="325" y="375">Î”x=0.02</text>

                        <!-- è¿‘ä¼¼ç‚¹ -->
                        <circle cx="350" cy="195" r="6" fill="#2ecc71"/>
                        <text fill="#2ecc71" font-size="14" x="360" y="195">â‰ˆ 2.005</text>

                        <!-- å®é™…ç‚¹ -->
                        <circle cx="350" cy="175" r="6" fill="#3498db"/>
                        <text fill="#3498db" font-size="14" x="360" y="170">å®é™…å€¼</text>

                        <!-- è¯´æ˜ -->
                        <rect x="100" y="420" width="400" height="60" fill="rgba(241,196,15,0.2)" stroke="#f39c12" stroke-width="2" rx="8"/>
                        <text fill="#ecf0f1" font-size="16" text-anchor="middle" x="300" y="450">ç”¨åˆ‡çº¿è¿‘ä¼¼æ›²çº¿</text>
                        <text fill="#1abc9c" font-size="16" text-anchor="middle" x="300" y="470">Î”x è¶Šå°,è¶Šå‡†ç¡®!</text>
                    </svg>
                </div>
            </div>
        </div>

        <!-- ç¬¬10é¡µ:å¾®åˆ†çš„åº”ç”¨2 - è¯¯å·®ä¼°è®¡ -->
        <div class="slide">
            <div class="slide-content">
                <div class="chalkboard">
                    <h2>åº”ç”¨äºŒ:è¯¯å·®ä¼°è®¡</h2>
                    <p>æµ‹é‡å­˜åœ¨è¯¯å·®æ—¶,å¯ç”¨å¾®åˆ†ä¼°è®¡ç»“æœè¯¯å·®</p>

                    <h3>åŸç†</h3>
                    <p>è‹¥ \(y = f(x)\),æµ‹é‡ \(x\) æ—¶è¯¯å·®ä¸º \(\Delta x\),</p>
                    <p>åˆ™ \(y\) çš„<strong>ç»å¯¹è¯¯å·®</strong>çº¦ä¸º:</p>
                    <div class="math-formula-box">\[|\Delta y| \approx |dy| = |f'(x)| \cdot |\Delta x|\]</div>

                    <p><strong>ç›¸å¯¹è¯¯å·®</strong>çº¦ä¸º:</p>
                    <div class="math-formula-box">\[\frac{|\Delta y|}{|y|} \approx \frac{|f'(x)| \cdot |\Delta x|}{|f(x)|}\]</div>

                    <h3>ä¾‹é¢˜</h3>
                    <p>æµ‹é‡åœ†çš„åŠå¾„ \(r = 10\)cm,è¯¯å·®ä¸è¶…è¿‡ 0.05cm,</p>
                    <p>ä¼°è®¡é¢ç§¯ \(S = \pi r^2\) çš„è¯¯å·®ã€‚</p>

                    <p><strong>è§£:</strong> \(S' = 2\pi r\), å½“ \(r = 10\) æ—¶:</p>
                    <div class="math-formula-box">\[|\Delta S| \approx 2\pi \times 10 \times 0.05 = \pi \approx 3.14 \text{ cm}^2\]</div>
                </div>
                <div class="visualization">
                    <svg viewBox="0 0 600 500" style="width: 100%; height: 100%;">
                        <text fill="#f39c12" font-size="26" text-anchor="middle" x="300" y="40">è¯¯å·®ä¼ æ’­</text>

                        <!-- åœ†çš„ç¤ºæ„å›¾ -->
                        <circle cx="200" cy="220" r="80" fill="rgba(52,152,219,0.2)" stroke="#3498db" stroke-width="3"/>
                        <circle cx="200" cy="220" r="85" fill="none" stroke="#e74c3c" stroke-width="2" stroke-dasharray="5,5"/>

                        <!-- åŠå¾„ -->
                        <line x1="200" y1="220" x2="280" y2="220" stroke="#2ecc71" stroke-width="3"/>
                        <text fill="#2ecc71" font-size="16" text-anchor="middle" x="240" y="210">r</text>

                        <!-- è¯¯å·®æ ‡æ³¨ -->
                        <line x1="280" y1="220" x2="285" y2="220" stroke="#e74c3c" stroke-width="3"/>
                        <text fill="#e74c3c" font-size="14" x="290" y="220">Î”r</text>

                        <!-- è¯¯å·®å…¬å¼æ¡† -->
                        <rect x="320" y="100" width="250" height="250" fill="rgba(0,0,0,0.3)" stroke="#f39c12" stroke-width="2" rx="10"/>

                        <text fill="#f1c40f" font-size="20" text-anchor="middle" x="445" y="135">è¯¯å·®ä¼°è®¡</text>

                        <text fill="#ecf0f1" font-size="16" x="340" y="170">è¾“å…¥è¯¯å·®:</text>
                        <text fill="#e74c3c" font-size="18" x="340" y="195">|Î”r| â‰¤ 0.05 cm</text>

                        <line x1="340" y1="210" x2="550" y2="210" stroke="#f39c12" stroke-width="1"/>

                        <text fill="#ecf0f1" font-size="16" x="340" y="235">è¾“å‡ºè¯¯å·®:</text>
                        <text fill="#2ecc71" font-size="18" x="340" y="260">|Î”S| â‰ˆ |S'| Â· |Î”r|</text>
                        <text fill="#2ecc71" font-size="18" x="340" y="285">= 2Ï€r Â· |Î”r|</text>
                        <text fill="#1abc9c" font-size="18" x="340" y="310">â‰ˆ 3.14 cmÂ²</text>

                        <!-- åº•éƒ¨è¯´æ˜ -->
                        <rect x="100" y="400" width="400" height="60" fill="rgba(46,204,113,0.2)" stroke="#2ecc71" stroke-width="2" rx="8"/>
                        <text fill="#ecf0f1" font-size="16" text-anchor="middle" x="300" y="435">å¾®åˆ†å¸®åŠ©æˆ‘ä»¬ä¼°è®¡è¯¯å·®ä¼ æ’­!</text>
                    </svg>
                </div>
            </div>
        </div>

        <!-- ç¬¬11é¡µ:æ€»ç»“ -->
        <div class="slide">
            <div class="slide-content">
                <div class="chalkboard">
                    <h2>æœ¬èŠ‚æ€»ç»“</h2>
                    <h3>å¾®åˆ†çš„æ ¸å¿ƒæ¦‚å¿µ</h3>
                    <ul style="margin-left: 30px;">
                        <li><strong>å®šä¹‰:</strong> \(dy = f'(x) \cdot dx\)</li>
                        <li><strong>å‡ ä½•æ„ä¹‰:</strong> åˆ‡çº¿çš„å¢é‡</li>
                        <li><strong>ä¸å¯¼æ•°çš„å…³ç³»:</strong> \(f'(x) = \frac{dy}{dx}\)</li>
                    </ul>

                    <h3 style="margin-top: 20px;">é‡è¦æ€§è´¨</h3>
                    <ul style="margin-left: 30px;">
                        <li>å½¢å¼ä¸å˜æ€§</li>
                        <li>è¿ç®—æ³•åˆ™ä¸å¯¼æ•°ä¸€è‡´</li>
                    </ul>

                    <h3 style="margin-top: 20px;">ä¸¤å¤§åº”ç”¨</h3>
                    <ul style="margin-left: 30px;">
                        <li><strong>è¿‘ä¼¼è®¡ç®—:</strong> \(f(x+\Delta x) \approx f(x) + f'(x)\Delta x\)</li>
                        <li><strong>è¯¯å·®ä¼°è®¡:</strong> \(|\Delta y| \approx |f'(x)| \cdot |\Delta x|\)</li>
                    </ul>

                    <p style="margin-top: 25px; color: #f39c12;"><strong>æ ¸å¿ƒæ€æƒ³:</strong></p>
                    <p>å¾®åˆ† = ç”¨<strong>ç›´çº¿ä»£æ›¿æ›²çº¿</strong>çš„è‰ºæœ¯!</p>
                </div>
                <div class="visualization">
                    <svg viewBox="0 0 600 500" style="width: 100%; height: 100%;">
                        <text fill="#f39c12" font-size="32" text-anchor="middle" x="300" y="60">å¾®åˆ†çŸ¥è¯†ä½“ç³»</text>

                        <!-- ä¸­å¿ƒåœ† -->
                        <circle cx="300" cy="250" r="80" fill="rgba(241,196,15,0.3)" stroke="#f39c12" stroke-width="4">
                            <animate attributeName="r" dur="3s" values="80;90;80" repeatCount="indefinite"/>
                        </circle>
                        <text fill="#f1c40f" font-size="24" text-anchor="middle" x="300" y="245">å¾®åˆ†</text>
                        <text fill="#f1c40f" font-size="20" text-anchor="middle" x="300" y="270">dy = f'dx</text>

                        <!-- å®šä¹‰ -->
                        <circle cx="150" cy="150" r="60" fill="rgba(231,76,60,0.2)" stroke="#e74c3c" stroke-width="3">
                            <animate attributeName="r" dur="3s" values="60;70;60" repeatCount="indefinite" begin="0.5s"/>
                        </circle>
                        <text fill="#ecf0f1" font-size="18" text-anchor="middle" x="150" y="145">å®šä¹‰</text>
                        <text fill="#ecf0f1" font-size="14" text-anchor="middle" x="150" y="165">dy=f'dx</text>
                        <line x1="210" y1="190" x2="260" y2="220" stroke="#f39c12" stroke-width="2"/>

                        <!-- å‡ ä½•æ„ä¹‰ -->
                        <circle cx="450" cy="150" r="60" fill="rgba(52,152,219,0.2)" stroke="#3498db" stroke-width="3">
                            <animate attributeName="r" dur="3s" values="60;70;60" repeatCount="indefinite" begin="1s"/>
                        </circle>
                        <text fill="#ecf0f1" font-size="16" text-anchor="middle" x="450" y="145">å‡ ä½•</text>
                        <text fill="#ecf0f1" font-size="14" text-anchor="middle" x="450" y="165">åˆ‡çº¿å¢é‡</text>
                        <line x1="390" y1="190" x2="340" y2="220" stroke="#f39c12" stroke-width="2"/>

                        <!-- è¿‘ä¼¼è®¡ç®— -->
                        <circle cx="150" cy="380" r="60" fill="rgba(46,204,113,0.2)" stroke="#2ecc71" stroke-width="3">
                            <animate attributeName="r" dur="3s" values="60;70;60" repeatCount="indefinite" begin="1.5s"/>
                        </circle>
                        <text fill="#ecf0f1" font-size="16" text-anchor="middle" x="150" y="375">è¿‘ä¼¼</text>
                        <text fill="#ecf0f1" font-size="14" text-anchor="middle" x="150" y="395">è®¡ç®—</text>
                        <line x1="210" y1="340" x2="260" y2="300" stroke="#f39c12" stroke-width="2"/>

                        <!-- è¯¯å·®ä¼°è®¡ -->
                        <circle cx="450" cy="380" r="60" fill="rgba(155,89,182,0.2)" stroke="#9b59b6" stroke-width="3">
                            <animate attributeName="r" dur="3s" values="60;70;60" repeatCount="indefinite" begin="2s"/>
                        </circle>
                        <text fill="#ecf0f1" font-size="16" text-anchor="middle" x="450" y="375">è¯¯å·®</text>
                        <text fill="#ecf0f1" font-size="14" text-anchor="middle" x="450" y="395">ä¼°è®¡</text>
                        <line x1="390" y1="340" x2="340" y2="300" stroke="#f39c12" stroke-width="2"/>
                    </svg>
                </div>
            </div>
        </div>
    </div>
    <div class="subtitle-area" id="subtitleArea">æ¬¢è¿å­¦ä¹ å¾®åˆ†çš„æ¦‚å¿µä¸åº”ç”¨!</div>
    <div class="control-bar">
        <div style="color: #f1c40f; font-weight: bold; margin-bottom: 15px; text-align: center;">ç¬¬ <span id="currentSlide">1</span> / <span id="totalSlides">11</span> é¡µ</div>
        <button class="btn" id="prevBtn" onclick="previousSlide()">â¬…ï¸ ä¸Šä¸€é¡µ</button>
        <button class="btn primary" id="startBtn" onclick="startTeaching()">ğŸ€ å¼€å§‹è®²è¯¾</button>
        <button class="btn" id="nextBtn" onclick="nextSlide()">ä¸‹ä¸€é¡µ â¡ï¸</button>
        <button class="btn" onclick="restart()">ğŸ”„ é‡æ–°å¼€å§‹</button>
        <button class="btn" id="autoPlayBtn" onclick="startAutoPlay()">ğŸ¬ è‡ªåŠ¨æ’­æ”¾</button>
    </div>
    <script type="module">
        window.playbackFinished = false;
        try { const { default: AvatarPlatform, SDKEvents, PlayerEvents, RecorderEvents, UserMedia } = await import('./avatar-sdk-web_3.1.2.1002/index.js'); window.AvatarPlatform = AvatarPlatform; window.SDKEvents = SDKEvents; window.PlayerEvents = PlayerEvents; window.RecorderEvents = RecorderEvents; window.UserMedia = UserMedia; console.log('âœ… è®¯é£SDKæ¨¡å—å·²åŠ è½½'); } catch (error) { console.error('âŒ SDKåŠ è½½å¤±è´¥:', error); } window.dispatchEvent(new CustomEvent('sdkReady'));
    </script>
    <script>
        // å­—å¹•æ–‡æœ¬ï¼ˆä¸“ä¸šè§„èŒƒï¼‰
        const subtitleScript = {
            "1": "å¯¼æ•° f'(x) æè¿°å‡½æ•°å˜åŒ–ç‡ | å¾®åˆ†ç ”ç©¶å‡½æ•°å¢é‡çš„çº¿æ€§è¿‘ä¼¼",
            "2": "å½“ Î”x å¾ˆå°æ—¶ï¼ŒÎ”y â‰ˆ f'(x)Â·Î”x | å¾®åˆ†ä¸“é—¨ç ”ç©¶è¿™ä¸€è¿‘ä¼¼å…³ç³»",
            "3": "å¾®åˆ†æ˜¯å¯¼æ•°æ¦‚å¿µçš„å»¶ä¼¸ | ç”¨äºä¼°è®¡å‡½æ•°å˜åŒ–é‡",
            "4": "å®šä¹‰ï¼šdy = f'(x)Â·dx | dx = Î”x ä¸ºè‡ªå˜é‡å¾®åˆ†ï¼Œdy ä¸ºå‡½æ•°å¾®åˆ†",
            "5": "å¯¼æ•° f'(x) = dy/dx | å¯¼æ•°æ˜¯å¾®åˆ†ä¹‹å•†",
            "6": "Î”yï¼šæ›²çº¿å®é™…å¢é‡ = f(x+Î”x) - f(x) | dyï¼šåˆ‡çº¿å¢é‡ = f'(x)Â·Î”x",
            "7": "åŸºæœ¬å…¬å¼ï¼šd(x^n) = nx^(n-1)dx | d(sin x) = cos x dx | è¿ç®—æ³•åˆ™ï¼šd(uÂ±v) = duÂ±dv",
            "8": "å½¢å¼ä¸å˜æ€§ï¼šd[f(u)] = f'(u)du | æ— è®º u æ˜¯è‡ªå˜é‡è¿˜æ˜¯ä¸­é—´å˜é‡",
            "9": "è¿‘ä¼¼è®¡ç®—ï¼šf(x+Î”x) â‰ˆ f(x) + f'(x)Î”x | ä¾‹ï¼šâˆš4.02 â‰ˆ 2.005",
            "10": "è¯¯å·®ä¼°è®¡ï¼š|Î”y| â‰ˆ |f'(x)|Â·|Î”x| | ä¾‹ï¼šåœ†åŠå¾„è¯¯å·® Â±0.05cm â†’ é¢ç§¯è¯¯å·® â‰ˆ Ï€ cmÂ²",
            "11": "å¾®åˆ†æ ¸å¿ƒï¼šdy = f'(x)dx | åº”ç”¨ï¼šè¿‘ä¼¼è®¡ç®—ä¸è¯¯å·®ä¼°è®¡ | æ ¸å¿ƒæ€æƒ³ï¼šä»¥ç›´ä»£æ›²"
        };

        // å‘éŸ³æ–‡æœ¬ï¼ˆå£è¯­åŒ–ï¼‰
        const speechScript = {
            "1": "åŒå­¦ä»¬å¥½!æˆ‘ä»¬å·²ç»å­¦è¿‡å¯¼æ•°äº†ã€‚å¯¼æ•°fæ’‡xæè¿°çš„æ˜¯å‡½æ•°çš„å˜åŒ–ç‡ã€‚ä»Šå¤©æˆ‘ä»¬è¦å­¦ä¹ ä¸€ä¸ªæ–°æ¦‚å¿µ,å«åšå¾®åˆ†ã€‚",
            "2": "å…ˆæ¥çœ‹ä¸€ä¸ªé—®é¢˜:å½“è‡ªå˜é‡xæœ‰ä¸€ä¸ªå¾ˆå°çš„å˜åŒ–delta xæ—¶,å‡½æ•°yä¼šå˜åŒ–å¤šå°‘å‘¢?ä»å¯¼æ•°çš„å®šä¹‰æˆ‘ä»¬çŸ¥é“,å½“delta xå¾ˆå°çš„æ—¶å€™,delta yå¤§çº¦ç­‰äºfæ’‡xä¹˜ä»¥delta xã€‚å¾®åˆ†å°±æ˜¯ä¸“é—¨ç ”ç©¶è¿™ä¸ªè¿‘ä¼¼å…³ç³»çš„!",
            "3": "å¾®åˆ†æ˜¯å¯¼æ•°æ¦‚å¿µçš„å»¶ä¼¸å’Œåº”ç”¨ã€‚å®ƒå¯ä»¥å¸®åŠ©æˆ‘ä»¬ä¼°è®¡å‡½æ•°çš„å˜åŒ–é‡,åœ¨å®é™…è®¡ç®—ä¸­éå¸¸æœ‰ç”¨ã€‚",
            "4": "å¾®åˆ†çš„å®šä¹‰æ˜¯è¿™æ ·çš„:è®¾å‡½æ•°yç­‰äºfæ‹¬å·xåœ¨ç‚¹xå¯å¯¼,é‚£ä¹ˆdyç­‰äºfæ’‡xä¹˜ä»¥dxã€‚è¿™é‡Œ,dxç­‰äºdelta x,æ˜¯è‡ªå˜é‡çš„å¾®å°å¢é‡,æˆ‘ä»¬å«å®ƒè‡ªå˜é‡çš„å¾®åˆ†ã€‚dyå‘¢,å°±å«åšå‡½æ•°yçš„å¾®åˆ†ã€‚",
            "5": "å¾®åˆ†å’Œå¯¼æ•°æœ‰ä»€ä¹ˆå…³ç³»å‘¢?ä»å®šä¹‰å¼dyç­‰äºfæ’‡xä¹˜ä»¥dxå¯ä»¥çœ‹å‡º,fæ’‡xç­‰äºdyé™¤ä»¥dxã€‚è¿™è¯´æ˜å¯¼æ•°å°±æ˜¯å¾®åˆ†ä¹‹å•†!ä»¥å‰æˆ‘ä»¬æŠŠdyé™¤ä»¥dxçœ‹ä½œä¸€ä¸ªæ•´ä½“ç¬¦å·,ç°åœ¨æœ‰äº†å¾®åˆ†çš„æ¦‚å¿µ,å®ƒå¯ä»¥çœŸæ­£ç†è§£ä¸ºdyé™¤ä»¥dxäº†ã€‚",
            "6": "å¾®åˆ†æœ‰æ¸…æ™°çš„å‡ ä½•æ„ä¹‰ã€‚è€ƒè™‘æ›²çº¿yç­‰äºfæ‹¬å·x,å½“è‡ªå˜é‡ä»xå˜åˆ°xåŠ delta xæ—¶,æœ‰ä¸¤ç§å¢é‡ã€‚ç¬¬ä¸€ç§æ˜¯delta y,å®ƒæ˜¯æ›²çº¿ä¸Šçš„å®é™…å¢é‡,ç­‰äºfæ‹¬å·xåŠ delta xå‡fæ‹¬å·xã€‚ç¬¬äºŒç§æ˜¯dy,å®ƒæ˜¯åˆ‡çº¿ä¸Šçš„å¢é‡,ç­‰äºfæ’‡xä¹˜ä»¥delta xã€‚ä»å›¾åƒä¸Šçœ‹,å½“delta xå¾ˆå°æ—¶,æ›²çº¿çš„è¿™ä¸€å°æ®µå‡ ä¹å¯ä»¥ç”¨åˆ‡çº¿æ¥ä»£æ›¿!dyå°±æ˜¯åˆ‡çº¿çš„ç«–ç›´å¢é‡,delta yæ˜¯æ›²çº¿çš„ç«–ç›´å¢é‡ã€‚å½“delta xè¶Šæ¥è¶Šå°æ—¶,dyè¶Šæ¥è¶Šæ¥è¿‘delta yã€‚è¿™å°±æ˜¯å¾®åˆ†çš„å‡ ä½•æ„ä¹‰:ç”¨åˆ‡çº¿ä»£æ›¿æ›²çº¿ã€‚",
            "7": "å¾®åˆ†çš„è®¡ç®—å…¶å®å¾ˆç®€å•,å› ä¸ºå¾®åˆ†è®¡ç®—å°±æ˜¯å¯¼æ•°è®¡ç®—!æ‰€æœ‰çš„åŸºæœ¬å¾®åˆ†å…¬å¼éƒ½å¯ä»¥ä»å¯¼æ•°å…¬å¼å¾—åˆ°ã€‚æ¯”å¦‚xçš„næ¬¡æ–¹çš„å¾®åˆ†,ç­‰äºnä¹˜ä»¥xçš„nå‡1æ¬¡æ–¹ä¹˜ä»¥dxã€‚sin xçš„å¾®åˆ†ç­‰äºcos xä¹˜ä»¥dxã€‚å¾®åˆ†çš„è¿ç®—æ³•åˆ™å’Œå¯¼æ•°è¿ç®—æ³•åˆ™å®Œå…¨ä¸€è‡´!uåŠ å‡vçš„å¾®åˆ†ç­‰äºduåŠ å‡dvã€‚uä¹˜ä»¥vçš„å¾®åˆ†ç­‰äºuä¹˜ä»¥dvåŠ vä¹˜ä»¥duã€‚æ‰€ä»¥æŒæ¡äº†å¯¼æ•°,å°±ç­‰äºæŒæ¡äº†å¾®åˆ†,åªéœ€åœ¨ç»“æœåé¢ä¹˜ä»¥dxå°±è¡Œäº†!",
            "8": "å¾®åˆ†æœ‰ä¸€ä¸ªéå¸¸é‡è¦çš„æ€§è´¨,å«åšå½¢å¼ä¸å˜æ€§ã€‚è¿™ä¸ªæ€§è´¨è¯´çš„æ˜¯:æ— è®ºuæ˜¯è‡ªå˜é‡è¿˜æ˜¯ä¸­é—´å˜é‡,dæ‹¬å·fæ‹¬å·uçš„å½¢å¼æ€»æ˜¯fæ’‡uä¹˜ä»¥du,è¿™ä¸ªå½¢å¼ä¿æŒä¸å˜!è®©æˆ‘ä»¬çœ‹ä¸€ä¸ªä¾‹å­ã€‚å¦‚æœuç­‰äºxå¹³æ–¹æ˜¯ä¸­é—´å˜é‡,é‚£ä¹ˆdæ‹¬å·sin xå¹³æ–¹,ä»ç„¶å¯ä»¥å†™æˆcos xå¹³æ–¹ä¹˜ä»¥dæ‹¬å·xå¹³æ–¹,å†æŠŠdæ‹¬å·xå¹³æ–¹ç®—å‡ºæ¥ç­‰äº2x dx,æ‰€ä»¥æœ€ç»ˆç»“æœæ˜¯cos xå¹³æ–¹ä¹˜ä»¥2x dxã€‚çœ‹åˆ°äº†å—?å½¢å¼ä¸å˜æ€§ä½¿å¾—å¾®åˆ†è®¡ç®—å˜å¾—éå¸¸ç®€å•!",
            "9": "å¾®åˆ†çš„ç¬¬ä¸€ä¸ªé‡è¦åº”ç”¨æ˜¯è¿‘ä¼¼è®¡ç®—ã€‚æ ¹æ®å¾®åˆ†çš„å®šä¹‰,fæ‹¬å·xåŠ delta xçº¦ç­‰äºfæ‹¬å·xåŠ fæ’‡xä¹˜ä»¥delta x,å½“delta xå¾ˆå°æ—¶ã€‚æˆ‘ä»¬å¯ä»¥ç”¨è¿™ä¸ªå…¬å¼è¿›è¡Œè¿‘ä¼¼è®¡ç®—ã€‚æ¥çœ‹ä¸€ä¸ªä¾‹é¢˜:è®¡ç®—æ ¹å·4ç‚¹02çš„è¿‘ä¼¼å€¼ã€‚æˆ‘ä»¬ä»¤fæ‹¬å·xç­‰äºæ ¹å·x,å–xç­‰äº4,delta xç­‰äº0ç‚¹02ã€‚é¦–å…ˆæ±‚å¯¼æ•°:fæ’‡xç­‰äº1é™¤ä»¥2å€æ ¹å·x,æ‰€ä»¥fæ’‡4ç­‰äºå››åˆ†ä¹‹ä¸€ã€‚ä»£å…¥å…¬å¼:æ ¹å·4ç‚¹02çº¦ç­‰äº2åŠ 0ç‚¹005,ç­‰äº2ç‚¹005ã€‚ç”¨è®¡ç®—å™¨éªŒè¯,å®é™…å€¼æ˜¯2ç‚¹00499,è¯¯å·®æå°!",
            "10": "å¾®åˆ†çš„ç¬¬äºŒä¸ªåº”ç”¨æ˜¯è¯¯å·®ä¼°è®¡ã€‚åœ¨å®é™…æµ‹é‡ä¸­,æ€»ä¼šæœ‰è¯¯å·®ã€‚å¦‚æœæµ‹é‡xæ—¶æœ‰è¯¯å·®delta x,é‚£ä¹ˆé€šè¿‡è®¡ç®—å¾—åˆ°çš„yä¼šæœ‰å¤šå¤§è¯¯å·®å‘¢?æ ¹æ®å¾®åˆ†,delta yçš„ç»å¯¹å€¼çº¦ç­‰äºfæ’‡xçš„ç»å¯¹å€¼ä¹˜ä»¥delta xçš„ç»å¯¹å€¼ã€‚è®©æˆ‘ä»¬çœ‹ä¸€ä¸ªä¾‹é¢˜:æµ‹é‡åœ†çš„åŠå¾„rç­‰äº10å˜ç±³,è¯¯å·®ä¸è¶…è¿‡0ç‚¹05å˜ç±³,é—®é¢ç§¯çš„è¯¯å·®æœ‰å¤šå¤§?é¦–å…ˆæ±‚å¯¼æ•°:Sæ’‡ç­‰äº2Ï€ä¹˜ä»¥rã€‚å½“rç­‰äº10æ—¶,delta Sçš„ç»å¯¹å€¼çº¦ç­‰äºÏ€,çº¦ç­‰äº3ç‚¹14å¹³æ–¹å˜ç±³ã€‚è¿™è¯´æ˜åŠå¾„çš„å¾®å°è¯¯å·®ä¼šé€šè¿‡å…¬å¼æ”¾å¤§ã€‚",
            "11": "å¥½,è®©æˆ‘ä»¬æ€»ç»“ä¸€ä¸‹å¾®åˆ†çš„æ ¸å¿ƒå†…å®¹ã€‚ç¬¬ä¸€,å¾®åˆ†çš„å®šä¹‰æ˜¯dyç­‰äºfæ’‡xä¹˜ä»¥dxã€‚ç¬¬äºŒ,å¾®åˆ†çš„å‡ ä½•æ„ä¹‰æ˜¯åˆ‡çº¿çš„å¢é‡ã€‚ç¬¬ä¸‰,å¾®åˆ†æœ‰é‡è¦çš„å½¢å¼ä¸å˜æ€§ã€‚ç¬¬å››,å¾®åˆ†æœ‰ä¸¤å¤§åº”ç”¨:ä¸€æ˜¯è¿‘ä¼¼è®¡ç®—,äºŒæ˜¯è¯¯å·®ä¼°è®¡ã€‚å¾®åˆ†çš„æ ¸å¿ƒæ€æƒ³å°±æ˜¯ä»¥ç›´ä»£æ›²ã€ä»¥ç®€åŒ–ç¹ã€‚æŒæ¡äº†å¾®åˆ†,æˆ‘ä»¬å°±å¤šäº†ä¸€ä¸ªå¼ºå¤§çš„æ•°å­¦å·¥å…·!ä»Šå¤©çš„è¯¾å°±åˆ°è¿™é‡Œ,åŒå­¦ä»¬å†è§!"
        };

        const actionMap = {
            "1": "A_RLH_welcome_O", "2": "A_RH_point_O", "3": "A_LH_introduced_O",
            "4": "A_RH_point_O", "5": "A_LH_introduced_O", "6": "A_RH_point_O",
            "7": "A_LH_introduced_O", "8": "A_RH_point_O", "9": "A_LH_introduced_O",
            "10": "A_RH_point_O", "11": "A_RLH_welcome_O"
        };

        let currentSlide = 0; const totalSlides = 11; let avatarPlatform = null; let isConnected = false; let isTeaching = false; let isAutoPlaying = false; let speechFinishedResolve = null; let isSpeaking = false; const slides = document.querySelectorAll('.slide');

        function showSlide(index) {
            slides.forEach((slide, i) => slide.classList.toggle('active', i === index));
            currentSlide = index;
            document.getElementById('currentSlide').textContent = index + 1;
            if (window.MathJax && window.MathJax.typesetPromise) {
                window.MathJax.typesetPromise([slides[index]]).catch(err => console.error(err));
            }
            document.getElementById('prevBtn').disabled = index === 0;
            document.getElementById('nextBtn').disabled = index === totalSlides - 1;
            updateSubtitle(index + 1);
        }

        async function nextSlide() {
            if (currentSlide < totalSlides - 1) {
                // æ³¨æ„ï¼šä¸è°ƒç”¨ stop()ï¼Œé¿å…æ–­å¼€è¿æ¥
                // ç›´æ¥ç¿»é¡µï¼Œæ–°çš„è®²è§£ä¼šè¦†ç›–æ—§çš„
                showSlide(currentSlide + 1);
                if (!isAutoPlaying && isTeaching && isConnected) {
                    await speakContent(currentSlide + 1);
                }
            }
        }

        async function previousSlide() {
            if (currentSlide > 0) {
                // æ³¨æ„ï¼šä¸è°ƒç”¨ stop()ï¼Œé¿å…æ–­å¼€è¿æ¥
                // ç›´æ¥ç¿»é¡µï¼Œæ–°çš„è®²è§£ä¼šè¦†ç›–æ—§çš„
                showSlide(currentSlide - 1);
                if (!isAutoPlaying && isTeaching && isConnected) {
                    await speakContent(currentSlide + 1);
                }
            }
        }
        function restart() {
            showSlide(0);
            // æ³¨æ„ï¼šä¸è°ƒç”¨ stop()ï¼Œé¿å…æ–­å¼€è¿æ¥
            // åªé‡ç½®çŠ¶æ€æ ‡å¿—
            isAutoPlaying = false;
            isSpeaking = false;
            speechFinishedResolve = null;
        }
        function updateSubtitle(slideNum) {
            const subtitleArea = document.getElementById('subtitleArea');
            subtitleArea.textContent = subtitleScript[slideNum] || '';
        }

        async function speakContent(slideNum) {
            if (!isTeaching || !isConnected || !avatarPlatform) {
                console.log('âš ï¸ è™šæ‹Ÿäººæœªè¿æ¥');
                return;
            }
            const content = speechScript[slideNum];
            if (!content) return;

            try {
                // æ³¨æ„ï¼šä¸è¦è°ƒç”¨ stop()ï¼Œå› ä¸ºä¼šå¯¼è‡´æ•´ä¸ªè¿æ¥æ–­å¼€
                // SDKä¼šè‡ªåŠ¨ç®¡ç†è®²è§£é˜Ÿåˆ—

                isSpeaking = true;
                console.log(`[Sync] ğŸ¤ å¼€å§‹è®²è§£ç¬¬${slideNum}é¡µ`);

                const action = actionMap[slideNum];
                if (action) {
                    await avatarPlatform.writeCmd("action", action);
                }
                await avatarPlatform.writeText(content, { nlp: false });
                updateSubtitle(slideNum);
            } catch (error) {
                console.error('âŒ è®²è§£å¤±è´¥:', error);
                isSpeaking = false;
                // å¦‚æœè®²è§£å¤±è´¥ï¼Œä¹Ÿéœ€è¦é€šçŸ¥è‡ªåŠ¨æ’­æ”¾ç»§ç»­
                if (isAutoPlaying && speechFinishedResolve) {
                    speechFinishedResolve();
                    speechFinishedResolve = null;
                }
            }
        }
        // è®¡ç®—å•é¡µæ’­æ”¾æ—¶é•¿ï¼ˆç”¨äºè¶…æ—¶fallbackï¼‰
        // æ³¨æ„ï¼šspeechScriptä¸­çš„å†…å®¹å·²ç»æ˜¯å…¬å¼éŸ³è¯‘åçš„æ±‰å­—ï¼Œç›´æ¥è®¡ç®—å­—æ•°å³å¯
        // è¿™ä¸ªæ—¶é—´åªç”¨äºç½‘ç»œå¼‚å¸¸æ—¶çš„ä¿æŠ¤ï¼Œæ­£å¸¸åŒæ­¥ä¾èµ– frame_stop äº‹ä»¶
        function getSlideDuration(slideNum) {
            const speech = speechScript[slideNum];
            if (!speech) return 10000;
            // æ¯ä¸ªæ±‰å­—æŒ‰150æ¯«ç§’è®¡ç®—ï¼ˆæ­£å¸¸è¯­é€Ÿï¼‰ + 3ç§’ç¼“å†²æ—¶é—´
            return speech.length * 150 + 3000;
        }
        function updateStatus(message, type = 'normal') { const indicator = document.getElementById('statusIndicator'); if (indicator) { indicator.textContent = message; indicator.className = 'status-indicator'; if (type === 'connected') indicator.classList.add('connected'); else if (type === 'error') indicator.classList.add('error'); else if (type === 'connecting') indicator.classList.add('connecting'); } }
        function waitForSDK() { return new Promise((resolve, reject) => { if (typeof AvatarPlatform !== 'undefined') { resolve(); return; } const timeout = setTimeout(() => { reject(new Error('SDKåŠ è½½è¶…æ—¶')); }, 10000); window.addEventListener('sdkReady', function handler() { clearTimeout(timeout); window.removeEventListener('sdkReady', handler); resolve(); }); }); }
        async function startTeaching() {
            const startBtn = document.getElementById('startBtn');
            startBtn.textContent = 'ğŸ”„ å¯åŠ¨ä¸­...';
            startBtn.disabled = true;

            try {
                updateStatus('ç­‰å¾…SDK...', 'connecting');
                await waitForSDK();
                console.log('âœ… SDKå·²å°±ç»ªï¼Œå¼€å§‹åˆå§‹åŒ–è™šæ‹Ÿäºº...');

                if(avatarPlatform) {
                    console.log('ğŸ”„ é”€æ¯æ—§çš„è™šæ‹Ÿäººå®ä¾‹...');
                    avatarPlatform.destroy();
                }

                console.log('ğŸ­ åˆ›å»ºæ–°çš„è™šæ‹Ÿäººå®ä¾‹...');
                avatarPlatform = new AvatarPlatform({ useInlinePlayer: true });

                avatarPlatform.on('connected', (initResp) => {
                    console.log('ğŸ‰ è¿æ¥æˆåŠŸ');
                    isConnected = true;
                    isTeaching = true;
                    updateStatus('å·²è¿æ¥', 'connected');
                    startBtn.textContent = 'ğŸ’– è™šæ‹Ÿäººå·²å°±ç»ª';
                    // ç­‰å¾…2ç§’è®©è¿æ¥ç¨³å®šåå†å¼€å§‹è®²è§£
                    setTimeout(() => {
                        if (isConnected && !isAutoPlaying) {
                            speakContent(currentSlide + 1);
                        }
                    }, 2000);
                }).on('disconnected', (err) => {
                    console.error('âŒ è™šæ‹Ÿäººè¿æ¥æ–­å¼€:', err);
                    isConnected = false;
                    isSpeaking = false;
                    updateStatus('è¿æ¥æ–­å¼€', 'error');
                    startBtn.textContent = 'ğŸ”„ é‡æ–°è¿æ¥';
                    startBtn.disabled = false;
                }).on('error', (error) => {
                    console.error('âŒ è™šæ‹ŸäººSDKé”™è¯¯:', error);
                    console.error('é”™è¯¯è¯¦æƒ…:', JSON.stringify(error, null, 2));
                    updateStatus('é”™è¯¯: ' + (error.message || 'æœªçŸ¥é”™è¯¯'), 'error');
                    startBtn.textContent = 'âŒ è¿æ¥å¤±è´¥';
                    startBtn.disabled = false;
                    isTeaching = false;
                    isSpeaking = false;
                }).on('frame_stop', (data) => {
                    console.log(`[Sync] âœ… æ”¶åˆ° 'frame_stop' ä¿¡å·ï¼Œè®²è§£å®Œæˆ`);
                    isSpeaking = false;

                    if (isAutoPlaying && speechFinishedResolve) {
                        console.log('[Sync] ğŸ¬ é€šçŸ¥è‡ªåŠ¨æ’­æ”¾ï¼šå¯ä»¥è¿›å…¥ä¸‹ä¸€é¡µ');
                        speechFinishedResolve();
                        speechFinishedResolve = null;
                    }
                });

                console.log('ğŸ”‘ è®¾ç½®APIä¿¡æ¯...');
                avatarPlatform.setApiInfo({
                    appId: 'e8c180ed',
                    apiKey: 'e0c44f0e2ef0f47582ffa7e864da0d9b',
                    apiSecret: 'MDZkNDNiZWU4NDkzNWM5MDQzMTY4N2Nh',
                    sceneId: '237415046114840576',
                    serverUrl: 'wss://avatar.cn-huadong-1.xf-yun.com/v1/interact'
                });

                console.log('âš™ï¸ è®¾ç½®å…¨å±€å‚æ•°...');
                avatarPlatform.setGlobalParams({
                    stream: { protocol: 'xrtc', alpha: 1, bitrate: 1000000, fps: 25 },
                    avatar: { avatar_id: '110332017', width: 1920, height: 1080, scale: 1, move_h: 0, move_v: 0, audio_format: 1 },
                    tts: { vcn: 'x4_yiting', speed: 50, pitch: 50, volume: 100 },
                    avatar_dispatch: { interactive_mode: 1, content_analysis: 0 }
                });

                console.log('ğŸš€ å¯åŠ¨è™šæ‹Ÿäººè¿æ¥...');
                await avatarPlatform.start({ wrapper: document.getElementById('avatarWrapper') });
            } catch (error) {
                console.error('âŒ å¯åŠ¨å¤±è´¥:', error);
                console.error('é”™è¯¯å †æ ˆ:', error.stack);
                updateStatus('å¯åŠ¨å¤±è´¥: ' + (error.message || 'æœªçŸ¥é”™è¯¯'), 'error');
                startBtn.textContent = 'ğŸ€ å¼€å§‹è®²è¯¾';
                startBtn.disabled = false;
            }
        }
        async function startAutoPlay() {
            if (!avatarPlatform || !isConnected) {
                await startTeaching();
                // ç­‰å¾…3ç§’è®©è™šæ‹Ÿäººè¿æ¥å®Œå…¨ç¨³å®š
                await new Promise(resolve => setTimeout(resolve, 3000));

                // å†æ¬¡æ£€æŸ¥è¿æ¥çŠ¶æ€
                if (!isConnected) {
                    console.error('âŒ è™šæ‹Ÿäººè¿æ¥å¤±è´¥ï¼Œæ— æ³•è‡ªåŠ¨æ’­æ”¾');
                    alert('è™šæ‹Ÿäººè¿æ¥å¤±è´¥ï¼Œè¯·æ£€æŸ¥ç½‘ç»œåé‡è¯•');
                    return;
                }
            }

            isAutoPlaying = true;
            document.getElementById('autoPlayBtn').disabled = true;

            try {
                for (let i = currentSlide; i < totalSlides; i++) {
                    if (!isAutoPlaying) {
                        console.log('ğŸ›‘ è‡ªåŠ¨æ’­æ”¾è¢«åœæ­¢');
                        break;
                    }

                    console.log(`\nğŸ¬ === å¼€å§‹æ’­æ”¾ç¬¬${i + 1}é¡µ/${totalSlides}é¡µ ===`);

                    // å…ˆç¿»é¡µ
                    showSlide(i);

                    // ç­‰å¾…ä¸€å°æ®µæ—¶é—´è®©é¡µé¢æ¸²æŸ“
                    await new Promise(resolve => setTimeout(resolve, 300));

                    if (isConnected && isTeaching && avatarPlatform) {
                        try {
                            // åˆ›å»ºä¸€ä¸ªPromiseç­‰å¾…è®²è§£å®Œæˆ
                            const speechPromise = new Promise(resolve => {
                                speechFinishedResolve = resolve;
                            });

                            // å¼€å§‹è®²è§£
                            await speakContent(i + 1);
                            const expectedDuration = getSlideDuration(i + 1);
                            console.log(`â³ ç­‰å¾…è™šæ‹Ÿäººè®²è§£ç¬¬${i + 1}é¡µå®Œæˆ... (é¢„è®¡æœ€é•¿${(expectedDuration/1000).toFixed(1)}ç§’)`);

                            // è®¾ç½®è¶…æ—¶ä¿æŠ¤ï¼ˆä»…ä½œä¸ºå…œåº•ï¼Œæ­£å¸¸åº”è¯¥ç”±frame_stopè§¦å‘ï¼‰
                            const startTime = Date.now();
                            const timeoutPromise = new Promise(resolve => setTimeout(() => {
                                const elapsed = ((Date.now() - startTime) / 1000).toFixed(1);
                                console.log(`âš ï¸ ç¬¬${i + 1}é¡µè®²è§£è¶…æ—¶(${elapsed}ç§’),ç»§ç»­ä¸‹ä¸€é¡µ`);
                                isSpeaking = false;
                                speechFinishedResolve = null;
                                resolve();
                            }, expectedDuration));

                            // ç­‰å¾…è®²è§£å®Œæˆæˆ–è¶…æ—¶
                            await Promise.race([speechPromise, timeoutPromise]);
                            const elapsed = ((Date.now() - startTime) / 1000).toFixed(1);
                            console.log(`âœ… ç¬¬${i + 1}é¡µè®²è§£å®Œæˆ (å®é™…ç”¨æ—¶${elapsed}ç§’)`);

                            // è®²è§£å®Œæˆåç«‹å³ç¿»é¡µï¼Œä¸éœ€è¦é¢å¤–ç­‰å¾…
                            // frame_stopäº‹ä»¶è§¦å‘ååº”è¯¥ç«‹å³è¿›å…¥ä¸‹ä¸€é¡µ
                        } catch (error) {
                            console.error(`âŒ ç¬¬${i + 1}é¡µè®²è§£å¼‚å¸¸:`, error);
                            isSpeaking = false;
                        }
                    } else {
                        console.log('âš ï¸ è™šæ‹Ÿäººæœªè¿æ¥,ä½¿ç”¨å›ºå®šå»¶æ—¶');
                        await new Promise(resolve => setTimeout(resolve, getSlideDuration(i + 1)));
                    }
                }

                if (isAutoPlaying) {
                    await new Promise(resolve => setTimeout(resolve, 3000));
                }
            } catch (error) {
                console.error('âŒ è‡ªåŠ¨æ’­æ”¾å¤±è´¥:', error);
            } finally {
                isAutoPlaying = false;
                isSpeaking = false;
                document.getElementById('autoPlayBtn').disabled = false;
                window.playbackFinished = true;
                document.title = "PLAYBACK_FINISHED";
                console.log('ğŸ‰ æ’­æ”¾å®Œæˆ');
            }
        }
        document.addEventListener('keydown', (e) => { if (e.key === 'ArrowRight' || e.key === ' ') { e.preventDefault(); nextSlide(); } else if (e.key === 'ArrowLeft') { e.preventDefault(); previousSlide(); } else if (e.key === 'Enter') { e.preventDefault(); speakContent(currentSlide + 1); } });
        document.getElementById('totalSlides').textContent = totalSlides; showSlide(0);
        setTimeout(() => { console.log('ğŸš€ è‡ªåŠ¨å¯åŠ¨æ’­æ”¾...'); startAutoPlay(); }, 3000);
    </script>
</body>
</html>
