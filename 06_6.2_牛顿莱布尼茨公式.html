<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>06_6.2_牛顿莱布尼茨公式</title>
    <link rel="stylesheet" href="./noto-serif-sc.css">
    
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Microsoft YaHei', 'SimHei', sans-serif;
            background: #1a1a2e;
            overflow: hidden;
            height: 100vh;
            width: 100vw;
        }

        .blackboard {
            width: 100vw;
            height: 100vh;
            background: linear-gradient(135deg, #2d3436 0%, #1e272e 100%);
            background-image: 
                repeating-linear-gradient(
                    0deg,
                    transparent,
                    transparent 2px,
                    rgba(255,255,255,0.01) 2px,
                    rgba(255,255,255,0.01) 4px
                );
            position: relative;
            display: flex;
        }

        .page {
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            opacity: 0;
            visibility: hidden;
            transition: all 0.5s ease;
            padding: 30px;
            display: flex;
        }

        .page.active {
            opacity: 1;
            visibility: visible;
        }

        .left-panel {
            width: 35%;
            height: 100%;
            padding: 30px;
            display: flex;
            flex-direction: column;
            position: relative;
            overflow: hidden;
        }

        .right-panel {
            width: 65%;
            height: 100%;
            padding: 20px;
            display: flex;
            align-items: center;
            justify-content: center;
            position: relative;
        }

        .chalk-text {
            color: #ffffff;
            font-size: 18px;
            font-weight: normal;
            text-shadow: 
                0 0 2px rgba(255,255,255,0.8),
                0 0 4px rgba(255,255,255,0.5);
            letter-spacing: 0.5px;
            line-height: 1.5;
        }

        .title {
            font-size: 22px;
            margin-bottom: 20px;
            text-align: center;
            animation: writeTitle 1.5s ease-out;
            color: #FFE066;
            text-shadow: 
                0 0 5px rgba(255,224,102,0.8),
                0 0 10px rgba(255,224,102,0.5);
        }

        .emphasis {
            color: #FF6B6B;
            font-size: 18px;
            text-shadow: 
                0 0 3px rgba(255,107,107,0.8),
                0 0 6px rgba(255,107,107,0.5);
        }

        .formula-box {
            background: rgba(255,224,102,0.1);
            padding: 15px;
            border-radius: 8px;
            border: 2px dashed rgba(255,224,102,0.4);
            margin: 15px 0;
            text-align: center;
        }

        .chalk-list {
            list-style: none;
            padding-left: 0;
            margin: 15px 0;
        }

        .chalk-list li {
            position: relative;
            padding-left: 20px;
            margin: 10px 0;
            animation: slideIn 0.5s ease-out forwards;
            opacity: 0;
            font-size: 18px;
        }

        .chalk-list li::before {
            content: "•";
            position: absolute;
            left: 0;
            color: #FFE066;
        }

        @keyframes slideIn {
            to {
                opacity: 1;
                transform: translateX(0);
            }
            from {
                opacity: 0;
                transform: translateX(-10px);
            }
        }

        .svg-animation {
            width: 95%;
            height: 95%;
            max-width: 700px;
            max-height: 600px;
        }

        /* 控制栏 */
        .control-bar {
            position: fixed;
            bottom: 20px;
            left: 50%;
            transform: translateX(-50%);
            display: flex;
            gap: 15px;
            z-index: 100;
            background: rgba(0,0,0,0.7);
            padding: 15px 25px;
            border-radius: 10px;
        }

        .btn {
            padding: 10px 20px;
            background: rgba(255,224,102,0.2);
            border: 2px solid #FFE066;
            color: #FFE066;
            font-size: 18px;
            cursor: pointer;
            border-radius: 5px;
            transition: all 0.3s;
        }

        .btn:hover {
            background: rgba(255,224,102,0.3);
            transform: scale(1.05);
        }

        .btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        /* 页码指示器 */
        .page-indicator {
            position: absolute;
            top: 20px;
            right: 20px;
            color: #FFE066;
            font-size: 18px;
            z-index: 100;
        }

        .small-text {
            font-size: 18px;
            color: rgba(255,255,255,0.8);
        }

        /* MathJax样式覆盖 */
        .mjx-chtml {
            color: #ffffff !important;
            font-size: 16px !important;
        }

        .chalk-list li:nth-child(1) { animation-delay: 0.3s; }
        .chalk-list li:nth-child(2) { animation-delay: 0.6s; }
        .chalk-list li:nth-child(3) { animation-delay: 0.9s; }
        .chalk-list li:nth-child(4) { animation-delay: 1.2s; }
    </style>
    <style>
        /* 工具栏样式对齐模板 */
        .control-bar {
            position: fixed;
            left: -240px;
            top: 50%;
            transform: translateY(-50%);
            width: 270px;
            height: auto;
            background: rgba(255, 255, 255, 0.15);
            backdrop-filter: blur(15px);
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            gap: 12px;
            z-index: 200;
            border-radius: 0 20px 20px 0;
            padding: 25px 20px;
            transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.2);
            border: 1px solid rgba(255, 255, 255, 0.2);
        }
        .control-bar:hover { left: 0; box-shadow: 0 12px 40px rgba(0,0,0,0.3); }
        .control-bar::before {
            content: '▶️';
            position: absolute;
            top: 50%;
            right: -30px;
            transform: translateY(-50%);
            background: rgba(255, 255, 255, 0.2);
            backdrop-filter: blur(10px);
            padding: 12px 8px;
            border-radius: 0 15px 15px 0;
            font-size: 0.9rem;
            writing-mode: vertical-lr;
            border: 1px solid rgba(255, 255, 255, 0.1);
            color: #333;
        }
        .btn {
            padding: 14px 22px;
            background: rgba(255, 255, 255, 0.25);
            color: #333;
            border: 1px solid rgba(255, 255, 255, 0.3);
            border-radius: 12px;
            cursor: pointer;
            font-size: 18px;
            font-weight: 600;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            width: 100%;
            text-align: center;
            backdrop-filter: blur(5px);
            text-shadow: 0 1px 2px rgba(255,255,255,0.3);
        }
        .btn:hover { background: rgba(255, 255, 255, 0.35); transform: translateY(-3px); box-shadow: 0 6px 20px rgba(0, 0, 0, 0.2); border-color: rgba(255, 255, 255, 0.5); color: #222; }
        .btn.primary { background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: #fff; border: 1px solid rgba(255,255,255,0.3); text-shadow: 0 1px 2px rgba(0,0,0,0.3); }
        .btn.primary:hover { background: linear-gradient(135deg, #5a6fd8 0%, #6a4190 100%); box-shadow: 0 8px 25px rgba(102,126,234,0.4); }
    </style>
    <style>
        /* 覆盖：参考 指数函数极限.html 的背景与字体 */
        body {
            font-family: 'Noto Serif SC', 'Source Han Serif SC', 'Songti SC', 'SimSun', serif;
            background: #1a1a2e;
        }
        .blackboard {
            background: #1a1a2e !important;
            background-image: none !important;
        }
        .chalk-text {
            color: #ffffff !important;
            text-shadow: none !important;
            font-size: 16px !important;
        }
        .title {
            color: #e1bee7 !important;
            text-shadow: none !important;
        }
        /* 仅右侧SVG放大2倍 */
        .right-panel .svg-animation {
            width: 100% !important;
            height: auto !important;
            max-width: none !important;
            max-height: none !important;
            transform: translateX(-70px) scale(2);
            transform-origin: left center;
        }
        .right-panel { overflow: visible; }
        /* MathJax 文字颜色适配深色背景 */
        .mjx-chtml { color: #ffffff !important; }
    </style>
    <style>
        /* 虚拟人状态与字幕（参考 反正切函数极限.html） */
        .status-indicator {
            position: absolute;
            top: 10px;
            right: 10px;
            padding: 5px 10px;
            background: rgba(0,0,0,0.5);
            color: white;
            border-radius: 5px;
            font-size: 12px;
            z-index: 100;
            transition: opacity 0.3s ease;
            display: none !important; /* 完全隐藏状态指示器 */
        }
        .status-indicator.connected {
            background: rgba(76, 175, 80, 0.8);
            display: none !important; /* 强制隐藏 */
        }
        .status-indicator.recording {
            background: rgba(244, 67, 54, 0.8);
            animation: pulse 1.5s infinite;
            display: none !important; /* 强制隐藏 */
        }
        .status-indicator.connecting {
            background: rgba(255, 152, 0, 0.8);
            display: none !important; /* 强制隐藏 */
        }

        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }

        /* 录制模式下隐藏状态指示器 */
        .recording-mode .status-indicator {
            opacity: 0;
            pointer-events: none;
        }

        /* 录制模式下隐藏控制栏 */
        .recording-mode .control-bar {
            left: -300px;
            transition: left 0.5s ease;
        }

        .avatar-container {
            position: fixed;
            top: 60%;
            left: 50%;
            transform: translate(-50%, -50%);
            width: 750px;
            height: 850px;
            overflow: hidden;
            z-index: 50;
            pointer-events: none;
            background: transparent;
            border: none;
            box-shadow: none;
        }
        .wrapper { width: 100%; height: 100%; background: transparent; pointer-events: auto; }

        .subtitle-area {
            position: absolute;
            bottom: 8px;
            left: 20px;
            right: 20px;
            min-height: 36px;
            background: transparent;
            display: flex;
            align-items: center;
            justify-content: center;
            color: #fff;
            font-size: 18px;
            text-align: center;
            padding: 0 16px;
            z-index: 110;
            text-shadow: 0 0 6px rgba(0,0,0,0.9), 0 0 3px rgba(0,0,0,0.7);
            pointer-events: none;
        }
    </style>
</head>
<body>
    <div class="blackboard">
        <div id="statusIndicator" class="status-indicator">等待连接</div>
        <div class="avatar-container"><div class="wrapper" id="avatarWrapper"></div></div>
        <!-- 页码指示器 -->
        <div class="page-indicator">第 <span id="currentPage">1</span> / 9 页</div>
        
        <!-- 第1页（原第5页）：原函数的概念 -->
        <div class="page active" id="page1">
            <div class="left-panel">
                <h1 class="title chalk-text">原函数是什么？</h1>
                <div class="board-content">
                    <p class="chalk-text emphasis">导数的逆运算</p>
                    <ul class="chalk-list">
                        <li class="chalk-text">如果 F'(x) = f(x)</li>
                        <li class="chalk-text">那么 F 是 f 的原函数</li>
                    </ul>
                    <div class="formula-box">
                        <p class="chalk-text small-text">例: f(x) = 2x</p>
                        <p class="chalk-text small-text">则 F(x) = x² + C</p>
                    </div>
                    <p class="chalk-text small-text">验证: (x²)' = 2x ✓</p>
                </div>
            </div>
            <div class="right-panel">
                <div class="animation-container">
                    <svg class="svg-animation" viewBox="0 0 700 600">
                        <!-- 坐标系 -->
                        <line x1="100" y1="300" x2="600" y2="300" stroke="#FFE066" stroke-width="2"/>
                        <line x1="350" y1="50" x2="350" y2="550" stroke="#FFE066" stroke-width="2"/>
                        
                        <!-- 原函数 F(x) = x² -->
                        <path d="M 150 500 Q 350 300, 550 100" stroke="#4ECDC4" stroke-width="4" fill="none">
                            <animate attributeName="stroke-dasharray" values="0 1000;1000 0" dur="3s" repeatCount="indefinite"/>
                        </path>
                        <text x="560" y="100" fill="#4ECDC4" font-size="20">F(x) = x²</text>
                        
                        <!-- 导函数 f(x) = 2x -->
                        <line x1="200" y1="400" x2="500" y2="200" stroke="#FF6B6B" stroke-width="4">
                            <animate attributeName="stroke-dasharray" values="0 500;500 0" dur="3s" begin="1s" repeatCount="indefinite"/>
                        </line>
                        <text x="510" y="200" fill="#FF6B6B" font-size="20">f(x) = 2x</text>
                        
                        <!-- 导数关系箭头 -->
                        <g opacity="0">
                            <path d="M 400 150 Q 420 175, 400 200" stroke="#FFE066" stroke-width="2" fill="none" marker-end="url(#arrowhead)"/>
                            <text x="430" y="175" fill="#FFE066" font-size="16">求导</text>
                            <animate attributeName="opacity" values="0;0;1;1;0" dur="3s" repeatCount="indefinite"/>
                        </g>
                        
                        <!-- 箭头标记 -->
                        <defs>
                            <marker id="arrowhead" markerWidth="10" markerHeight="7" refX="9" refY="3.5" orient="auto">
                                <polygon points="0 0, 10 3.5, 0 7" fill="#FFE066"/>
                            </marker>
                        </defs>
                        
                        <!-- 切线演示 -->
                        <g opacity="0">
                            <circle cx="350" cy="300" r="5" fill="#FFE066"/>
                            <line x1="250" y1="350" x2="450" y2="250" stroke="#FFE066" stroke-width="2" stroke-dasharray="5,5"/>
                            <text x="460" y="250" fill="#FFE066" font-size="14">斜率=f(x)</text>
                            <animate attributeName="opacity" values="0;0;0;1;1;0" dur="3s" repeatCount="indefinite"/>
                        </g>
                    </svg>
                </div>
            </div>
        </div>

        <!-- 第2页（原第6页）：为什么这是伟大的发现 -->
        <div class="page" id="page2">
            <div class="left-panel">
                <h1 class="title chalk-text">为什么伟大？</h1>
                <div class="board-content">
                    <p class="chalk-text emphasis">2000年的难题</p>
                    <ul class="chalk-list">
                        <li class="chalk-text">古希腊：只能算简单图形</li>
                        <li class="chalk-text">阿基米德：穷竭法很繁琐</li>
                        <li class="chalk-text">开普勒：切成无限小片</li>
                        <li class="chalk-text">突破：找到了通用方法！</li>
                    </ul>
                    <div class="formula-box">
                        <p class="chalk-text small-text">从此，任何曲线下的面积都能算了</p>
                    </div>
                </div>
            </div>
            <div class="right-panel">
                <div class="animation-container">
                    <svg class="svg-animation" viewBox="0 0 700 600">
                        <!-- 时间轴 -->
                        <line x1="100" y1="500" x2="600" y2="500" stroke="#FFE066" stroke-width="3"/>
                        
                        <!-- 时间节点 -->
                        <g>
                            <!-- 古希腊 -->
                            <circle cx="150" cy="500" r="8" fill="#4ECDC4">
                                <animate attributeName="r" values="8;12;8" dur="2s" repeatCount="indefinite"/>
                            </circle>
                            <text x="150" y="530" fill="#4ECDC4" font-size="14" text-anchor="middle">公元前300年</text>
                            <text x="150" y="470" fill="#ffffff" font-size="16" text-anchor="middle">阿基米德</text>
                            
                            <!-- 中世纪 -->
                            <circle cx="300" cy="500" r="8" fill="#FF6B6B">
                                <animate attributeName="r" values="8;12;8" dur="2s" begin="0.5s" repeatCount="indefinite"/>
                            </circle>
                            <text x="300" y="530" fill="#FF6B6B" font-size="14" text-anchor="middle">1600年</text>
                            <text x="300" y="470" fill="#ffffff" font-size="16" text-anchor="middle">开普勒</text>
                            
                            <!-- 微积分发明 -->
                            <circle cx="500" cy="500" r="8" fill="#FFE066">
                                <animate attributeName="r" values="8;15;8" dur="2s" begin="1s" repeatCount="indefinite"/>
                            </circle>
                            <text x="500" y="530" fill="#FFE066" font-size="14" text-anchor="middle">1670年</text>
                            <text x="500" y="470" fill="#ffffff" font-size="16" text-anchor="middle">牛顿&莱布尼茨</text>
                        </g>
                        
                        <!-- 问题演化 -->
                        <g transform="translate(350, 200)">
                            <!-- 圆形（古代能算） -->
                            <circle cx="-150" cy="0" r="50" fill="none" stroke="#4ECDC4" stroke-width="2" opacity="0">
                                <animate attributeName="opacity" values="0;1;1;0" dur="4s" repeatCount="indefinite"/>
                            </circle>
                            <text x="-150" y="80" fill="#4ECDC4" font-size="14" text-anchor="middle" opacity="0">
                                只能算圆形
                                <animate attributeName="opacity" values="0;1;1;0" dur="4s" repeatCount="indefinite"/>
                            </text>
                            
                            <!-- 抛物线（开普勒尝试） -->
                            <path d="M -50 50 Q 0 -50, 50 50" fill="none" stroke="#FF6B6B" stroke-width="2" opacity="0">
                                <animate attributeName="opacity" values="0;0;1;1;0" dur="4s" repeatCount="indefinite"/>
                            </path>
                            <text x="0" y="80" fill="#FF6B6B" font-size="14" text-anchor="middle" opacity="0">
                                尝试算抛物线
                                <animate attributeName="opacity" values="0;0;1;1;0" dur="4s" repeatCount="indefinite"/>
                            </text>
                            
                            <!-- 任意曲线（微积分解决） -->
                            <path d="M 100 30 C 130 -30, 170 -30, 200 30 S 250 50, 280 0" fill="none" stroke="#FFE066" stroke-width="3" opacity="0">
                                <animate attributeName="opacity" values="0;0;0;1;1" dur="4s" repeatCount="indefinite"/>
                            </path>
                            <text x="190" y="80" fill="#FFE066" font-size="14" text-anchor="middle" opacity="0">
                                能算任何曲线！
                                <animate attributeName="opacity" values="0;0;0;1;1" dur="4s" repeatCount="indefinite"/>
                            </text>
                        </g>
                        
                        <!-- 爆炸效果 -->
                        <g transform="translate(500, 350)">
                            <circle cx="0" cy="0" r="20" fill="rgba(255,224,102,0.3)" opacity="0">
                                <animate attributeName="r" values="20;80;100" dur="2s" begin="2s" repeatCount="indefinite"/>
                                <animate attributeName="opacity" values="0;0.5;0" dur="2s" begin="2s" repeatCount="indefinite"/>
                            </circle>
                        </g>
                    </svg>
                </div>
            </div>
        </div>

        <!-- 第3页（原第7页）：牛顿的思路 -->
        <div class="page" id="page3">
            <div class="left-panel">
                <h1 class="title chalk-text">牛顿的思路</h1>
                <div class="board-content">
                    <p class="chalk-text emphasis">从物理出发</p>
                    <ul class="chalk-list">
                        <li class="chalk-text">研究行星运动</li>
                        <li class="chalk-text">位置 → 速度 → 加速度</li>
                        <li class="chalk-text">发现：逆过程也成立</li>
                        <li class="chalk-text">加速度 → 速度 → 位置</li>
                    </ul>
                    <div class="formula-box">
                        <p class="chalk-text small-text">"流数法"（微分）</p>
                        <p class="chalk-text small-text">"反流数法"（积分）</p>
                    </div>
                </div>
            </div>
            <div class="right-panel">
                <div class="animation-container">
                    <svg class="svg-animation" viewBox="0 0 700 600">
                        <!-- 太阳系模型 -->
                        <g transform="translate(350, 300)">
                            <!-- 太阳 -->
                            <circle cx="0" cy="0" r="30" fill="#FFE066">
                                <animate attributeName="r" values="30;35;30" dur="2s" repeatCount="indefinite"/>
                            </circle>
                            
                            <!-- 地球轨道 -->
                            <ellipse cx="0" cy="0" rx="200" ry="150" fill="none" stroke="#4ECDC4" stroke-width="2" stroke-dasharray="5,5"/>
                            
                            <!-- 地球 -->
                            <circle cx="200" cy="0" r="15" fill="#4ECDC4">
                                <animateTransform attributeName="transform" type="rotate" values="0 0 0; 360 0 0" dur="10s" repeatCount="indefinite"/>
                            </circle>
                            
                            <!-- 速度向量 -->
                            <g>
                                <line x1="200" y1="0" x2="200" y2="-60" stroke="#FF6B6B" stroke-width="3" marker-end="url(#velocityArrow)">
                                    <animateTransform attributeName="transform" type="rotate" values="0 0 0; 360 0 0" dur="10s" repeatCount="indefinite"/>
                                </line>
                                <text x="200" y="-70" fill="#FF6B6B" font-size="16">v</text>
                            </g>
                            
                            <!-- 加速度向量 -->
                            <g opacity="0">
                                <line x1="200" y1="0" x2="150" y2="0" stroke="#FFE066" stroke-width="3" marker-end="url(#accelArrow)">
                                    <animateTransform attributeName="transform" type="rotate" values="0 0 0; 360 0 0" dur="10s" repeatCount="indefinite"/>
                                </line>
                                <text x="140" y="5" fill="#FFE066" font-size="16">a</text>
                                <animate attributeName="opacity" values="0;1;1;0" dur="4s" repeatCount="indefinite"/>
                            </g>
                        </g>
                        
                        <!-- 公式展示 -->
                        <g transform="translate(100, 100)">
                            <rect x="0" y="0" width="200" height="120" fill="rgba(45,52,54,0.8)" stroke="#FFE066" stroke-width="2" rx="5"/>
                            <text x="100" y="30" fill="#FFE066" font-size="16" text-anchor="middle">牛顿的发现</text>
                            <text x="10" y="55" fill="#4ECDC4" font-size="14">位置 s(t)</text>
                            <text x="100" y="55" fill="#FFE066" font-size="14">→求导→</text>
                            <text x="150" y="55" fill="#FF6B6B" font-size="14">速度 v(t)</text>
                            <text x="10" y="80" fill="#FF6B6B" font-size="14">速度 v(t)</text>
                            <text x="100" y="80" fill="#FFE066" font-size="14">→积分→</text>
                            <text x="150" y="80" fill="#4ECDC4" font-size="14">位置 s(t)</text>
                            <text x="100" y="105" fill="#ffffff" font-size="12" text-anchor="middle">互为逆运算！</text>
                        </g>
                        
                        <!-- 箭头定义 -->
                        <defs>
                            <marker id="velocityArrow" markerWidth="10" markerHeight="7" refX="9" refY="3.5" orient="auto">
                                <polygon points="0 0, 10 3.5, 0 7" fill="#FF6B6B"/>
                            </marker>
                            <marker id="accelArrow" markerWidth="10" markerHeight="7" refX="9" refY="3.5" orient="auto">
                                <polygon points="0 0, 10 3.5, 0 7" fill="#FFE066"/>
                            </marker>
                        </defs>
                    </svg>
                </div>
            </div>
        </div>

        <!-- 第4页（原第8页）：莱布尼茨的思路 -->
        <div class="page" id="page4">
            <div class="left-panel">
                <h1 class="title chalk-text">莱布尼茨的思路</h1>
                <div class="board-content">
                    <p class="chalk-text emphasis">从几何出发</p>
                    <ul class="chalk-list">
                        <li class="chalk-text">研究曲线的切线</li>
                        <li class="chalk-text">引入 dx, dy 符号</li>
                        <li class="chalk-text">dy/dx = 切线斜率</li>
                        <li class="chalk-text">∫ = 求和的符号</li>
                    </ul>
                    <div class="formula-box">
                        <p class="chalk-text small-text">创造了我们今天用的符号！</p>
                    </div>
                </div>
            </div>
            <div class="right-panel">
                <div class="animation-container">
                    <svg class="svg-animation" viewBox="0 0 700 600">
                        <!-- 坐标系 -->
                        <line x1="100" y1="450" x2="600" y2="450" stroke="#FFE066" stroke-width="2"/>
                        <line x1="100" y1="450" x2="100" y2="100" stroke="#FFE066" stroke-width="2"/>
                        
                        <!-- 曲线 -->
                        <path d="M 100 400 C 200 300, 300 200, 400 250 S 500 200, 600 150" stroke="#4ECDC4" stroke-width="4" fill="none"/>
                        
                        <!-- 移动的切点 -->
                        <circle cx="100" cy="400" r="6" fill="#FF6B6B">
                            <animate attributeName="cx" values="100;600;100" dur="8s" repeatCount="indefinite"/>
                            <animate attributeName="cy" values="400;150;400" dur="8s" repeatCount="indefinite"/>
                        </circle>
                        
                        <!-- 切线 -->
                        <line x1="50" y1="430" x2="250" y2="330" stroke="#FF6B6B" stroke-width="2" stroke-dasharray="5,5">
                            <animate attributeName="x1" values="50;550;50" dur="8s" repeatCount="indefinite"/>
                            <animate attributeName="y1" values="430;180;430" dur="8s" repeatCount="indefinite"/>
                            <animate attributeName="x2" values="250;650;250" dur="8s" repeatCount="indefinite"/>
                            <animate attributeName="y2" values="330;120;330" dur="8s" repeatCount="indefinite"/>
                        </line>
                        
                        <!-- dx, dy 标注 -->
                        <g transform="translate(300, 300)">
                            <!-- dx -->
                            <line x1="0" y1="0" x2="60" y2="0" stroke="#FFE066" stroke-width="2"/>
                            <text x="30" y="-5" fill="#FFE066" font-size="18" text-anchor="middle">dx</text>
                            
                            <!-- dy -->
                            <line x1="60" y1="0" x2="60" y2="-40" stroke="#FFE066" stroke-width="2"/>
                            <text x="70" y="-20" fill="#FFE066" font-size="18">dy</text>
                            
                            <!-- 直角标记 -->
                            <rect x="50" y="-10" width="10" height="10" fill="none" stroke="#FFE066" stroke-width="1"/>
                            
                            <!-- 斜边 -->
                            <line x1="0" y1="0" x2="60" y2="-40" stroke="#FF6B6B" stroke-width="2" stroke-dasharray="5,5"/>
                            
                            <animate attributeName="transform" type="translate" values="300,300; 400,250; 300,300" dur="8s" repeatCount="indefinite"/>
                        </g>
                        
                        <!-- 莱布尼茨符号展示 -->
                        <g transform="translate(400, 100)">
                            <rect x="0" y="0" width="250" height="150" fill="rgba(45,52,54,0.9)" stroke="#FFE066" stroke-width="2" rx="10"/>
                            
                            <text x="125" y="30" fill="#FFE066" font-size="18" text-anchor="middle">莱布尼茨的符号</text>
                            
                            <text x="20" y="60" fill="#4ECDC4" font-size="20" opacity="0">
                                d/dx
                                <animate attributeName="opacity" values="0;1" dur="0.5s" begin="0.5s" fill="freeze"/>
                            </text>
                            <text x="80" y="60" fill="#ffffff" font-size="16" opacity="0">
                                = 微分算子
                                <animate attributeName="opacity" values="0;1" dur="0.5s" begin="1s" fill="freeze"/>
                            </text>
                            
                            <text x="20" y="90" fill="#FF6B6B" font-size="20" opacity="0">
                                ∫
                                <animate attributeName="opacity" values="0;1" dur="0.5s" begin="1.5s" fill="freeze"/>
                            </text>
                            <text x="50" y="90" fill="#ffffff" font-size="16" opacity="0">
                                = 积分符号(Sum)
                                <animate attributeName="opacity" values="0;1" dur="0.5s" begin="2s" fill="freeze"/>
                            </text>
                            
                            <text x="20" y="120" fill="#FFE066" font-size="16" opacity="0">
                                dy/dx = 切线斜率
                                <animate attributeName="opacity" values="0;1" dur="0.5s" begin="2.5s" fill="freeze"/>
                            </text>
                        </g>
                    </svg>
                </div>
            </div>
        </div>

        <!-- 第5页（原第9页）：核心洞察 -->
        <div class="page" id="page5">
            <div class="left-panel">
                <h1 class="title chalk-text">核心洞察</h1>
                <div class="board-content">
                    <p class="chalk-text emphasis">累积的变化率 = 总变化</p>
                    <ul class="chalk-list">
                        <li class="chalk-text">每一瞬间都在变化</li>
                        <li class="chalk-text">变化率 = f(x)</li>
                        <li class="chalk-text">累积所有变化</li>
                        <li class="chalk-text">得到总变化量！</li>
                    </ul>
                    <div class="formula-box">
                        <p class="chalk-text small-text">这就是积分的本质</p>
                    </div>
                </div>
            </div>
            <div class="right-panel">
                <div class="animation-container">
                    <svg class="svg-animation" viewBox="0 0 700 600">
                        <!-- 水箱示例 -->
                        <g transform="translate(200, 150)">
                            <!-- 水箱 -->
                            <rect x="0" y="0" width="300" height="300" fill="none" stroke="#FFE066" stroke-width="3"/>
                            
                            <!-- 水位 -->
                            <rect x="3" y="150" width="294" height="147" fill="rgba(78,205,196,0.5)">
                                <animate attributeName="y" values="297;150;297" dur="6s" repeatCount="indefinite"/>
                                <animate attributeName="height" values="0;147;0" dur="6s" repeatCount="indefinite"/>
                            </rect>
                            
                            <!-- 流入管道 -->
                            <rect x="130" y="-50" width="40" height="50" fill="#2d3436" stroke="#FFE066" stroke-width="2"/>
                            
                            <!-- 水流 -->
                            <g>
                                <rect x="145" y="-30" width="10" height="30" fill="#4ECDC4" opacity="0">
                                    <animate attributeName="opacity" values="0;1;0" dur="0.5s" repeatCount="indefinite"/>
                                    <animate attributeName="height" values="0;30;50;80;100;130;150;180" dur="3s" repeatCount="indefinite"/>
                                </rect>
                            </g>
                            
                            <!-- 流速标记 -->
                            <text x="-50" y="-20" fill="#FF6B6B" font-size="18">流速 f(t)</text>
                            
                            <!-- 水位标记 -->
                            <text x="320" y="150" fill="#4ECDC4" font-size="18">水位 F(t)</text>
                            <line x1="300" y1="150" x2="320" y2="150" stroke="#4ECDC4" stroke-width="2">
                                <animate attributeName="y1" values="297;150;297" dur="6s" repeatCount="indefinite"/>
                                <animate attributeName="y2" values="297;150;297" dur="6s" repeatCount="indefinite"/>
                            </line>
                            
                            <!-- 时间标记 -->
                            <text x="150" y="350" fill="#FFE066" font-size="16" text-anchor="middle">时间 t</text>
                        </g>
                        
                        <!-- 解释文字 -->
                        <g transform="translate(100, 500)">
                            <text x="0" y="0" fill="#FFE066" font-size="20">流入的总水量 = ∫ 流速 dt</text>
                            <text x="0" y="30" fill="#4ECDC4" font-size="20">水位变化 = F(b) - F(a)</text>
                            <text x="250" y="60" fill="#FF6B6B" font-size="22" text-anchor="middle">
                                两者相等！
                                <animate attributeName="transform" type="scale" values="1;1.1;1" dur="2s" repeatCount="indefinite"/>
                            </text>
                        </g>
                    </svg>
                </div>
            </div>
        </div>

        <!-- 第6页（原第10页）：公式的证明直观 -->
        <div class="page" id="page6">
            <div class="left-panel">
                <h1 class="title chalk-text">直观证明</h1>
                <div class="board-content">
                    <p class="chalk-text emphasis">为什么成立？</p>
                    <ul class="chalk-list">
                        <li class="chalk-text">F(x+h) - F(x) ≈ f(x)·h</li>
                        <li class="chalk-text">把所有小段加起来</li>
                        <li class="chalk-text">左边：相邻项抵消</li>
                        <li class="chalk-text">只剩 F(b) - F(a)！</li>
                    </ul>
                    <div class="formula-box">
                        <p class="chalk-text small-text">"望远镜级数"效应</p>
                    </div>
                </div>
            </div>
            <div class="right-panel">
                <div class="animation-container">
                    <svg class="svg-animation" viewBox="0 0 700 600">
                        <!-- 分段展示 -->
                        <g transform="translate(100, 200)">
                            <!-- 区间分割 -->
                            <line x1="0" y1="200" x2="500" y2="200" stroke="#FFE066" stroke-width="3"/>
                            
                            <!-- 分割点 -->
                            <circle cx="0" cy="200" r="5" fill="#FFE066"/>
                            <text x="0" y="230" fill="#FFE066" font-size="16" text-anchor="middle">a</text>
                            
                            <circle cx="125" cy="200" r="5" fill="#4ECDC4"/>
                            <text x="125" y="230" fill="#4ECDC4" font-size="16" text-anchor="middle">x₁</text>
                            
                            <circle cx="250" cy="200" r="5" fill="#4ECDC4"/>
                            <text x="250" y="230" fill="#4ECDC4" font-size="16" text-anchor="middle">x₂</text>
                            
                            <circle cx="375" cy="200" r="5" fill="#4ECDC4"/>
                            <text x="375" y="230" fill="#4ECDC4" font-size="16" text-anchor="middle">x₃</text>
                            
                            <circle cx="500" cy="200" r="5" fill="#FFE066"/>
                            <text x="500" y="230" fill="#FFE066" font-size="16" text-anchor="middle">b</text>
                            
                            <!-- 函数值展示 -->
                            <g id="telescoping">
                                <!-- F(x₁) - F(a) -->
                                <text x="62" y="150" fill="#FF6B6B" font-size="14" text-anchor="middle" opacity="0">
                                    F(x₁) - F(a)
                                    <animate attributeName="opacity" values="0;1;1;1;1;0" dur="6s" repeatCount="indefinite"/>
                                </text>
                                
                                <!-- F(x₂) - F(x₁) -->
                                <text x="187" y="150" fill="#FF6B6B" font-size="14" text-anchor="middle" opacity="0">
                                    F(x₂) - F(x₁)
                                    <animate attributeName="opacity" values="0;0;1;1;1;0" dur="6s" repeatCount="indefinite"/>
                                </text>
                                
                                <!-- F(x₃) - F(x₂) -->
                                <text x="312" y="150" fill="#FF6B6B" font-size="14" text-anchor="middle" opacity="0">
                                    F(x₃) - F(x₂)
                                    <animate attributeName="opacity" values="0;0;0;1;1;0" dur="6s" repeatCount="indefinite"/>
                                </text>
                                
                                <!-- F(b) - F(x₃) -->
                                <text x="437" y="150" fill="#FF6B6B" font-size="14" text-anchor="middle" opacity="0">
                                    F(b) - F(x₃)
                                    <animate attributeName="opacity" values="0;0;0;0;1;0" dur="6s" repeatCount="indefinite"/>
                                </text>
                            </g>
                            
                            <!-- 抵消演示 -->
                            <g transform="translate(0, -100)">
                                <text x="250" y="0" fill="#FFE066" font-size="18" text-anchor="middle">加起来：</text>
                                
                                <!-- 展开式 -->
                                <text x="250" y="30" fill="#4ECDC4" font-size="14" text-anchor="middle" opacity="0">
                                    -F(a) + F(x₁) - F(x₁) + F(x₂) - F(x₂) + F(x₃) - F(x₃) + F(b)
                                    <animate attributeName="opacity" values="0;0;0;0;0;1;1;0" dur="8s" repeatCount="indefinite"/>
                                </text>
                                
                                <!-- 划掉中间项 -->
                                <g opacity="0">
                                    <line x1="140" y1="30" x2="360" y2="30" stroke="#FF6B6B" stroke-width="2"/>
                                    <animate attributeName="opacity" values="0;0;0;0;0;0;1;0" dur="8s" repeatCount="indefinite"/>
                                </g>
                                
                                <!-- 最终结果 -->
                                <text x="250" y="60" fill="#FFE066" font-size="20" text-anchor="middle" opacity="0">
                                    = F(b) - F(a)
                                    <animate attributeName="opacity" values="0;0;0;0;0;0;0;1" dur="8s" repeatCount="indefinite"/>
                                    <animate attributeName="transform" type="scale" values="1;1.2;1" dur="1s" begin="7s" repeatCount="indefinite"/>
                                </text>
                            </g>
                        </g>
                        
                        <!-- 说明文字 -->
                        <text x="350" y="500" fill="#FFE066" font-size="18" text-anchor="middle">
                            中间项全部抵消，只剩首尾！
                        </text>
                    </svg>
                </div>
            </div>
        </div>

        <!-- 第7页（原第11页）：牛顿-莱布尼茨公式完整展示 -->
        <div class="page" id="page7">
            <div class="left-panel">
                <h1 class="title chalk-text">伟大的公式</h1>
                <div class="board-content">
                    <p class="chalk-text emphasis">微积分基本定理</p>
                    <div class="formula-box">
                        <p class="chalk-text">$$\int_a^b f(x)dx = F(b) - F(a)$$</p>
                    </div>
                    <ul class="chalk-list">
                        <li class="chalk-text">左边：积分（求和）</li>
                        <li class="chalk-text">右边：原函数的差</li>
                        <li class="chalk-text">它们相等！</li>
                    </ul>
                    <p class="chalk-text small-text">这连接了微分和积分</p>
                </div>
            </div>
            <div class="right-panel">
                <div class="animation-container">
                    <svg class="svg-animation" viewBox="0 0 700 600">
                        <!-- 左侧：积分表示 -->
                        <g transform="translate(50, 100)">
                            <text x="100" y="30" fill="#FFE066" font-size="22" text-anchor="middle">积分方法</text>
                            <line x1="0" y1="250" x2="200" y2="250" stroke="#FFE066" stroke-width="2"/>
                            <line x1="0" y1="250" x2="0" y2="50" stroke="#FFE066" stroke-width="2"/>
                            
                            <path d="M 0 200 Q 100 100, 200 150" stroke="#FF6B6B" stroke-width="3" fill="none"/>
                            
                            <!-- 小矩形 -->
                            <g opacity="0">
                                <rect x="20" y="180" width="20" height="70" fill="rgba(78,205,196,0.4)" stroke="#4ECDC4"/>
                                <rect x="40" y="160" width="20" height="90" fill="rgba(78,205,196,0.4)" stroke="#4ECDC4"/>
                                <rect x="60" y="140" width="20" height="110" fill="rgba(78,205,196,0.4)" stroke="#4ECDC4"/>
                                <rect x="80" y="130" width="20" height="120" fill="rgba(78,205,196,0.4)" stroke="#4ECDC4"/>
                                <rect x="100" y="125" width="20" height="125" fill="rgba(78,205,196,0.4)" stroke="#4ECDC4"/>
                                <rect x="120" y="130" width="20" height="120" fill="rgba(78,205,196,0.4)" stroke="#4ECDC4"/>
                                <rect x="140" y="140" width="20" height="110" fill="rgba(78,205,196,0.4)" stroke="#4ECDC4"/>
                                <rect x="160" y="150" width="20" height="100" fill="rgba(78,205,196,0.4)" stroke="#4ECDC4"/>
                                <animate attributeName="opacity" values="0;1;1;0" dur="4s" repeatCount="indefinite"/>
                            </g>
                            
                            <text x="50" y="270" fill="#FFE066" font-size="16">a</text>
                            <text x="150" y="270" fill="#FFE066" font-size="16">b</text>
                        </g>
                        
                        <!-- 等号 -->
                        <text x="350" y="250" fill="#FFE066" font-size="40" text-anchor="middle">=</text>
                        
                        <!-- 右侧：原函数方法 -->
                        <g transform="translate(400, 100)">
                            <text x="100" y="30" fill="#FFE066" font-size="22" text-anchor="middle">原函数方法</text>
                            <line x1="0" y1="250" x2="200" y2="250" stroke="#FFE066" stroke-width="2"/>
                            <line x1="0" y1="250" x2="0" y2="50" stroke="#FFE066" stroke-width="2"/>
                            
                            <path d="M 0 230 Q 100 80, 200 100" stroke="#4ECDC4" stroke-width="3" fill="none"/>
                            
                            <!-- F(a) 和 F(b) 点 -->
                            <circle cx="50" cy="180" r="6" fill="#FFE066"/>
                            <circle cx="150" cy="120" r="6" fill="#FFE066"/>
                            
                            <!-- 垂直线 -->
                            <line x1="50" y1="180" x2="50" y2="250" stroke="#FFE066" stroke-width="2" stroke-dasharray="5,5"/>
                            <line x1="150" y1="120" x2="150" y2="250" stroke="#FFE066" stroke-width="2" stroke-dasharray="5,5"/>
                            
                            <!-- 差值标注 -->
                            <g opacity="0">
                                <path d="M 60 180 L 140 180 L 140 120 L 160 120" stroke="#FF6B6B" stroke-width="2" fill="none" marker-end="url(#arrowhead2)"/>
                                <text x="100" y="155" fill="#FF6B6B" font-size="18" text-anchor="middle">F(b)-F(a)</text>
                                <animate attributeName="opacity" values="0;1;1;0" dur="4s" repeatCount="indefinite"/>
                            </g>
                            
                            <text x="50" y="270" fill="#FFE066" font-size="16">a</text>
                            <text x="150" y="270" fill="#FFE066" font-size="16">b</text>
                            <text x="45" y="175" fill="#FFE066" font-size="14">F(a)</text>
                            <text x="145" y="115" fill="#FFE066" font-size="14">F(b)</text>
                        </g>
                        
                        <!-- 箭头标记 -->
                        <defs>
                            <marker id="arrowhead2" markerWidth="10" markerHeight="7" refX="9" refY="3.5" orient="auto">
                                <polygon points="0 0, 10 3.5, 0 7" fill="#FF6B6B"/>
                            </marker>
                        </defs>
                        
                        <!-- 神奇！ -->
                        <text x="350" y="450" fill="#FFE066" font-size="28" text-anchor="middle" opacity="0">
                            神奇的联系！
                            <animate attributeName="opacity" values="0;0;1;1;0" dur="4s" repeatCount="indefinite"/>
                            <animate attributeName="transform" attributeType="XML" type="scale" values="1;1.1;1" dur="2s" repeatCount="indefinite"/>
                        </text>
                    </svg>
                </div>
            </div>
        </div>

        <!-- 第8页（原第12页）：具体计算例子 -->
        <div class="page" id="page8">
            <div class="left-panel">
                <h1 class="title chalk-text">实际计算</h1>
                <div class="board-content">
                    <p class="chalk-text emphasis">计算 $\int_1^3 2x \, dx$</p>
                    <ul class="chalk-list">
                        <li class="chalk-text">找原函数: F(x) = x²</li>
                        <li class="chalk-text">计算 F(3) = 9</li>
                        <li class="chalk-text">计算 F(1) = 1</li>
                        <li class="chalk-text">结果 = 9 - 1 = 8</li>
                    </ul>
                    <div class="formula-box">
                        <p class="chalk-text small-text">答案：8</p>
                    </div>
                </div>
            </div>
            <div class="right-panel">
                <div class="animation-container">
                    <svg class="svg-animation" viewBox="0 0 700 600">
                        <!-- 坐标系 -->
                        <line x1="100" y1="450" x2="600" y2="450" stroke="#FFE066" stroke-width="2"/>
                        <line x1="100" y1="450" x2="100" y2="50" stroke="#FFE066" stroke-width="2"/>
                        
                        <!-- 刻度 -->
                        <text x="100" y="470" fill="#FFE066" font-size="16">0</text>
                        <text x="200" y="470" fill="#FFE066" font-size="16">1</text>
                        <text x="300" y="470" fill="#FFE066" font-size="16">2</text>
                        <text x="400" y="470" fill="#FFE066" font-size="16">3</text>
                        <text x="500" y="470" fill="#FFE066" font-size="16">4</text>
                        
                        <!-- f(x) = 2x 直线 -->
                        <line x1="100" y1="450" x2="500" y2="50" stroke="#FF6B6B" stroke-width="4"/>
                        <text x="510" y="50" fill="#FF6B6B" font-size="20">f(x) = 2x</text>
                        
                        <!-- 积分区域 [1,3] -->
                        <path d="M 200 450 L 200 350 L 400 150 L 400 450 Z" fill="rgba(78,205,196,0.4)" stroke="#4ECDC4" stroke-width="2">
                            <animate attributeName="fill-opacity" values="0;0.4;0.4;0" dur="4s" repeatCount="indefinite"/>
                        </path>
                        
                        <!-- 垂直线标记 -->
                        <line x1="200" y1="350" x2="200" y2="450" stroke="#FFE066" stroke-width="2" stroke-dasharray="5,5"/>
                        <line x1="400" y1="150" x2="400" y2="450" stroke="#FFE066" stroke-width="2" stroke-dasharray="5,5"/>
                        
                        <!-- 计算步骤动画 -->
                        <g transform="translate(450, 200)">
                            <rect x="0" y="0" width="200" height="200" fill="rgba(45,52,54,0.9)" stroke="#FFE066" stroke-width="2" rx="10"/>
                            
                            <text x="100" y="30" fill="#FFE066" font-size="18" text-anchor="middle">计算步骤</text>
                            
                            <text x="10" y="60" fill="#4ECDC4" font-size="16" opacity="0">
                                F(x) = x²
                                <animate attributeName="opacity" values="0;1" dur="0.5s" begin="0.5s" fill="freeze"/>
                            </text>
                            
                            <text x="10" y="90" fill="#4ECDC4" font-size="16" opacity="0">
                                F(3) = 3² = 9
                                <animate attributeName="opacity" values="0;1" dur="0.5s" begin="1s" fill="freeze"/>
                            </text>
                            
                            <text x="10" y="120" fill="#4ECDC4" font-size="16" opacity="0">
                                F(1) = 1² = 1
                                <animate attributeName="opacity" values="0;1" dur="0.5s" begin="1.5s" fill="freeze"/>
                            </text>
                            
                            <line x1="10" y1="135" x2="190" y2="135" stroke="#FFE066" stroke-width="1" opacity="0">
                                <animate attributeName="opacity" values="0;1" dur="0.5s" begin="2s" fill="freeze"/>
                            </line>
                            
                            <text x="10" y="165" fill="#FF6B6B" font-size="20" opacity="0">
                                答案 = 9 - 1 = 8
                                <animate attributeName="opacity" values="0;1" dur="0.5s" begin="2.5s" fill="freeze"/>
                            </text>
                        </g>
                    </svg>
                </div>
            </div>
        </div>

        <!-- 第9页（原第14页）：总结 -->
        <div class="page" id="page9">
            <div class="left-panel">
                <h1 class="title chalk-text">总结</h1>
                <div class="board-content">
                    <p class="chalk-text emphasis">牛顿-莱布尼茨公式</p>
                    <div class="formula-box">
                        <p class="chalk-text">$$\int_a^b f(x)dx = F(b) - F(a)$$</p>
                    </div>
                    <ul class="chalk-list">
                        <li class="chalk-text">积分 = 求面积</li>
                        <li class="chalk-text">原函数 = 积分的捷径</li>
                        <li class="chalk-text">微分和积分互为逆运算</li>
                        <li class="chalk-text">这是微积分的核心！</li>
                    </ul>
                </div>
            </div>
            <div class="right-panel">
                <div class="animation-container">
                    <svg class="svg-animation" viewBox="0 0 700 600">
                        <!-- 中心圆 -->
                        <circle cx="350" cy="300" r="80" fill="rgba(255,224,102,0.2)" stroke="#FFE066" stroke-width="3">
                            <animate attributeName="r" values="80;90;80" dur="2s" repeatCount="indefinite"/>
                        </circle>
                        
                        <text x="350" y="310" fill="#FFE066" font-size="24" text-anchor="middle">
                            微积分
                        </text>
                        
                        <!-- 左侧：微分 -->
                        <g transform="translate(150, 300)">
                            <circle cx="0" cy="0" r="60" fill="rgba(255,107,107,0.2)" stroke="#FF6B6B" stroke-width="3"/>
                            <text x="0" y="5" fill="#FF6B6B" font-size="18" text-anchor="middle">微分</text>
                            <text x="0" y="25" fill="#FF6B6B" font-size="14" text-anchor="middle">求导数</text>
                        </g>
                        
                        <!-- 右侧：积分 -->
                        <g transform="translate(550, 300)">
                            <circle cx="0" cy="0" r="60" fill="rgba(78,205,196,0.2)" stroke="#4ECDC4" stroke-width="3"/>
                            <text x="0" y="5" fill="#4ECDC4" font-size="18" text-anchor="middle">积分</text>
                            <text x="0" y="25" fill="#4ECDC4" font-size="14" text-anchor="middle">求面积</text>
                        </g>
                        
                        <!-- 连接箭头 -->
                        <g>
                            <!-- 上箭头：微分到积分 -->
                            <path d="M 200 250 Q 350 150, 500 250" stroke="#FFE066" stroke-width="2" fill="none" marker-end="url(#arrowhead3)" stroke-dasharray="5,5">
                                <animate attributeName="stroke-dashoffset" values="10;0" dur="1s" repeatCount="indefinite"/>
                            </path>
                            <text x="350" y="180" fill="#FFE066" font-size="16" text-anchor="middle">原函数</text>
                            
                            <!-- 下箭头：积分到微分 -->
                            <path d="M 500 350 Q 350 450, 200 350" stroke="#FFE066" stroke-width="2" fill="none" marker-end="url(#arrowhead3)" stroke-dasharray="5,5">
                                <animate attributeName="stroke-dashoffset" values="10;0" dur="1s" repeatCount="indefinite"/>
                            </path>
                            <text x="350" y="430" fill="#FFE066" font-size="16" text-anchor="middle">导数</text>
                        </g>
                        
                        <!-- 箭头标记 -->
                        <defs>
                            <marker id="arrowhead3" markerWidth="10" markerHeight="7" refX="9" refY="3.5" orient="auto">
                                <polygon points="0 0, 10 3.5, 0 7" fill="#FFE066"/>
                            </marker>
                        </defs>
                        
                        <!-- 公式展示 -->
                        <text x="350" y="100" fill="#FFE066" font-size="26" text-anchor="middle">
                            ∫ f(x)dx = F(x) + C
                            <animate attributeName="fill-opacity" values="0.5;1;0.5" dur="3s" repeatCount="indefinite"/>
                        </text>
                        
                        <text x="350" y="520" fill="#FFE066" font-size="26" text-anchor="middle">
                            F'(x) = f(x)
                            <animate attributeName="fill-opacity" values="0.5;1;0.5" dur="3s" begin="1.5s" repeatCount="indefinite"/>
                        </text>
                    </svg>
                </div>
            </div>
        </div>

        <!-- 导航按钮 -->
        <div class="control-bar">
            <button class="btn" id="prevBtn" onclick="changePage(-1)">上一页</button>
            <button class="btn" id="nextBtn" onclick="changePage(1)">下一页</button>
            <button class="btn" id="startBtn" onclick="startTeaching()" style="border-color:#4CAF50;color:#4CAF50">开始讲课</button>
            <button class="btn" id="autoPlayBtn" onclick="startAutoPlay()" style="border-color:#03A9F4;color:#03A9F4">自动播放</button>
        </div>
        <div class="subtitle-area" id="subtitleArea"></div>
    </div>

    <!-- MathJax配置 -->
    <script>
        window.MathJax = {
            tex: {
                inlineMath: [['$', '$']],
                displayMath: [['$$', '$$']],
                processEscapes: true
            },
            chtml: {
                scale: 1
            }
        };
    </script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/3.2.2/es5/tex-mml-chtml.min.js"></script>
    <script type="module">
        try {
            const { default: AvatarPlatform, SDKEvents, PlayerEvents, RecorderEvents, UserMedia } = await import('./avatar-sdk-web_3.1.2.1002/index.js');
            window.AvatarPlatform = AvatarPlatform;
            window.SDKEvents = SDKEvents;
            window.PlayerEvents = PlayerEvents;
            window.RecorderEvents = RecorderEvents;
            window.UserMedia = UserMedia;
            console.log('✅ 讯飞官方SDK模块已加载');
        } catch (error) {
            console.error('❌ SDK模块加载失败:', error);
        }
        window.dispatchEvent(new CustomEvent('sdkReady'));
    </script>

    <script>
        let currentPage = 1;
        const totalPages = 9;
        let avatarPlatform = null;
        let isConnected = false;
        let isTeaching = false;
        let isAutoPlaying = false;

        // 工具篇讲稿（按页）
        const pageContent = {
            1: "原函数就是求导的逆运算。例如 F(x)=x² 的导数是 f(x)=2x，那么反过来 x² 就是 2x 的一个原函数。原函数将成为我们计算定积分的解题钥匙。",
            2: "为什么这个发现伟大？从古希腊到开普勒，人们只能用繁琐的方法处理少数图形。直到牛顿与莱布尼茨发现了普适的方法，任何曲线下面积都可以用统一的思路来计算。",
            3: "牛顿的思路是从物理出发，位置、速度、加速度是一条链。求导把位置变成速度、速度变成加速度；积分则将加速度累积为速度、再累积为位置。所以积分与求导是互逆的物理过程。",
            4: "莱布尼茨的思路：从几何出发，研究切线与面积的问题。他引入了 dx、dy 和 ∫ 等符号，将切线斜率与面积问题统一在一个符号体系中，也揭示了微分与积分在几何上的互逆关系。",
            5: "累积的变化率等于总变化。就像水箱例子，流速 f(t) 的积分给出水位的总变化量，这与 F(b)-F(a) 描述的是同一件事——一个从过程看，一个从结果看。",
            6: "为什么公式成立？把区间切成很多小段，F(x_i)-F(x_{i-1}) 累加时中间项两两抵消，仅留下首尾 F(b)-F(a)。",
            7: "∫_a^b f(x)dx = F(b) - F(a)。要计算定积分，只需找到原函数 F(x)，再用终点值减去起点值，无穷求和的难题就变为简单的减法。",
            8: "以 f(x)=2x 在 [1,3] 为例。第一步找原函数 F(x)=x²；第二步代入端点 F(3)=9、F(1)=1；第三步做减法 9-1=8。无需切分与求和，三步完成计算。",
            9: "牛顿-莱布尼茨公式连接了微分与积分两大分支。微分求变化率，积分求累加，二者互为逆运算，这一联系让我们能用简洁的计算解决复杂问题。"
        };

        function updateStatus(message, type = 'normal') {
            const indicator = document.getElementById('statusIndicator');
            if (!indicator) return;
            indicator.textContent = message;
            indicator.className = 'status-indicator';
            if (type === 'connected') indicator.classList.add('connected');
            if (type === 'recording') indicator.classList.add('recording');
            if (type === 'connecting') indicator.classList.add('connecting');
        }

        function changePage(direction) {
            const pages = document.querySelectorAll('.page');
            pages[currentPage - 1].classList.remove('active');
            
            currentPage += direction;
            
            if (currentPage < 1) currentPage = 1;
            if (currentPage > totalPages) currentPage = totalPages;
            
            pages[currentPage - 1].classList.add('active');
            document.getElementById('currentPage').textContent = currentPage;
            
            // 更新按钮状态
            document.getElementById('prevBtn').disabled = currentPage === 1;
            document.getElementById('nextBtn').disabled = currentPage === totalPages;
            
            // 重新触发动画
            const newPage = pages[currentPage - 1];
            const animations = newPage.querySelectorAll('animate, animateTransform');
            animations.forEach(anim => {
                anim.beginElement();
            });
            if (!isAutoPlaying && isConnected && isTeaching) {
                setTimeout(() => speakContent(currentPage), 600);
            }
        }

        // 初始化
        document.getElementById('prevBtn').disabled = true;

        // 键盘导航
        document.addEventListener('keydown', (e) => {
            if (e.key === 'ArrowLeft') changePage(-1);
            if (e.key === 'ArrowRight') changePage(1);
        });

        // CSS动画
        const style = document.createElement('style');
        style.textContent = `
            @keyframes slideUp {
                from {
                    opacity: 0;
                    height: 0;
                }
                to {
                    opacity: 1;
                }
            }
            @keyframes writeTitle {
                from {
                    opacity: 0;
                    transform: translateY(-10px);
                }
                to {
                    opacity: 1;
                    transform: translateY(0);
                }
            }
        `;
        document.head.appendChild(style);
        
        // ========== 虚拟人控制 ==========
        function waitForSDK() {
            return new Promise((resolve, reject) => {
                if (typeof AvatarPlatform !== 'undefined') return resolve();
                const to = setTimeout(() => reject(new Error('SDK加载超时')), 10000);
                window.addEventListener('sdkReady', function handler() {
                    clearTimeout(to);
                    window.removeEventListener('sdkReady', handler);
                    resolve();
                });
            });
        }

        async function startTeaching() {
            const startBtn = document.getElementById('startBtn');
            if (startBtn) { startBtn.textContent = '🔄 启动中...'; startBtn.disabled = true; }
            try {
                await waitForSDK();
                updateStatus('SDK已加载', 'connecting');
                if (avatarPlatform) avatarPlatform.destroy();
                avatarPlatform = new AvatarPlatform({ useInlinePlayer: true });
                avatarPlatform
                    .on('connected', () => {
                        isConnected = true; isTeaching = true;
                        updateStatus('已连接', 'connected');
                        if (startBtn) startBtn.textContent = '💖 虚拟人已就绪';
                        setTimeout(() => speakContent(currentPage), 800);
                    })
                    .on('error', (err) => {
                        console.error('Avatar error:', err);
                        if (startBtn) { startBtn.textContent = '❌ 连接失败'; startBtn.disabled = false; }
                    });

                avatarPlatform.setApiInfo({
                    appId: 'f34b6995',
                    apiKey: '11bce7d2c44157a6875476f368ceb2a0',
                    apiSecret: 'NjIzNjk2ZWQ0ZGNjMGE0ODkzYjhmNzQy',
                    sceneId: '233767656807862272',
                    serverUrl: 'wss://avatar.cn-huadong-1.xf-yun.com/v1/interact'
                });

                avatarPlatform.setGlobalParams({
                    stream: { protocol: 'xrtc', alpha: 1, bitrate: 1000000, fps: 25 },
                    avatar: { avatar_id: '110332017', width: 1920, height: 1080, scale: 1, move_h: 0, move_v: 0, audio_format: 1 },
                    tts: { vcn: 'x4_yiting', speed: 50, pitch: 50, volume: 100 },
                    avatar_dispatch: { interactive_mode: 1, content_analysis: 0 }
                });

                await avatarPlatform.start({ wrapper: document.getElementById('avatarWrapper') });
            } catch (e) {
                console.error('启动失败:', e);
                updateStatus('启动失败', 'connecting');
                if (startBtn) { startBtn.textContent = '🔄 重试'; startBtn.disabled = false; }
            }
        }

        function updateSubtitle(text) {
            const el = document.getElementById('subtitleArea');
            if (el) el.textContent = text || '';
        }

        async function speakContent(pageNum) {
            if (!isTeaching || !isConnected || !avatarPlatform) return;
            const content = pageContent[pageNum];
            if (!content) return;
            try {
                updateSubtitle(content);
                // 手势动作映射（参考模板）
                const actionMap = {
                    1: 'A_RLH_welcome_O',
                    2: 'A_LH_please_O',
                    3: 'A_LH_introduced_O',
                    4: 'A_RH_please_O',
                    5: 'A_RLH_welcome_O',
                    6: 'A_LH_introduced_O',
                    7: 'A_RH_please_O',
                    8: 'A_LH_please_O',
                    9: 'A_RLH_welcome_O'
                };
                const act = actionMap[pageNum];
                if (act) { try { await avatarPlatform.writeCmd('action', act); } catch(e){} }
                await avatarPlatform.writeText(content, { nlp: false });
            } catch (err) { console.error('讲解失败:', err); }
        }

        async function startAutoPlay() {
            const btn = document.getElementById('autoPlayBtn');
            if (isAutoPlaying) {
                isAutoPlaying = false;
                if (btn) btn.textContent = '自动播放';
                updateStatus('播放已停止');
                // 退出录制模式
                document.body.classList.remove('recording-mode');
                return;
            }

            isAutoPlaying = true;
            if (btn) btn.textContent = '⏹️ 停止播放';

            // 简短倒计时提示用户准备录屏
            updateStatus(`🎬 自动播放将在 1 秒后开始，请准备录屏！`, 'recording');
            console.log(`⏰ 倒计时: 1秒`);
            await new Promise(resolve => setTimeout(resolve, 1000));

            updateStatus('🎬 自动播放开始！', 'recording');
            console.log('🚀 自动播放正式开始！');

            // 进入录制模式 - 隐藏状态指示器和控制栏
            document.body.classList.add('recording-mode');
            console.log('📹 进入录制模式，隐藏UI元素');

            if (!isConnected) {
                console.log('🎬 后台尝试连接虚拟人...');
                startTeaching().catch(error => {
                    console.log('⚠️ 虚拟人连接失败，继续页面播放:', error);
                });
            }
            for (let p = 1; p <= totalPages && isAutoPlaying; p++) {
                const pages = document.querySelectorAll('.page');
                pages.forEach(pg => pg.classList.remove('active'));
                const target = document.getElementById('page' + p);
                if (target) target.classList.add('active');
                currentPage = p; document.getElementById('currentPage').textContent = p;
                updateStatus(`📖 第${p}页/${totalPages}页 - ${getPageTitle(p)}`, 'recording');
                const anims = target ? target.querySelectorAll('animate, animateTransform') : [];
                anims.forEach(a => a.beginElement());
                if (isConnected && isTeaching) {
                    await speakContent(p);
                    // 使用优化的固定时长，基于实际语音播放测试
                    const pageTime = getPageDuration(p);
                    console.log(`⏰ 等待第${p}页播放完成，固定时长: ${pageTime/1000}秒`);
                    await new Promise(resolve => setTimeout(resolve, pageTime));
                } else {
                    // 没有语音时等待阅读时间
                    const pageTime = getPageDuration(p);
                    console.log(`⏰ 等待阅读时间 ${pageTime/1000}秒...`);
                    await new Promise(resolve => setTimeout(resolve, pageTime));
                }

                // 页面间隔 - 简化间隔时间
                const waitTime = p === totalPages ? 2000 : 1000;
                console.log(`⏳ 页面间隔等待 ${waitTime/1000}秒...`);
                await new Promise(resolve => setTimeout(resolve, waitTime));
            }
            // 播放完成，等待3秒后退出录制模式
            if (isAutoPlaying) {
                console.log('⏰ 等待3秒后结束录制...');
                await new Promise(resolve => setTimeout(resolve, 3000));
            }

            isAutoPlaying = false;
            if (btn) btn.textContent = '自动播放';
            updateStatus('播放已停止');

            // 退出录制模式 - 恢复UI元素显示
            document.body.classList.remove('recording-mode');
            console.log('📹 退出录制模式，恢复UI元素');
        }

        // 获取每页的固定播放时长 - 基于实际测试的语音播放规律
        function getPageDuration(pageNum) {
            /*
            ⏰ 牛顿-莱布尼茨公式课程时间设计 (基于语音播放测试)：

            📊 数据分析：
            第1页: 原函数概念 - 65字，基础概念
            第2页: 历史意义 - 72字，需要强调重要性
            第3页: 牛顿思路 - 68字，物理角度
            第4页: 莱布尼茨思路 - 71字，几何角度
            第5页: 核心洞察 - 63字，关键理解
            第6页: 直观证明 - 58字，数学推理
            第7页: 伟大公式 - 45字，公式展示
            第8页: 实际计算 - 52字，具体例子
            第9页: 总结 - 69字，课程总结

            🧮 实用公式：
            概念解释 = 4.0 字/秒 (需要理解时间)
            公式推导 = 3.5 字/秒 (需要更多思考)
            计算演示 = 4.5 字/秒 (相对直观)

            🎯 总播放时长: 约140秒 (2分20秒)
            📹 适合深度教学的节奏设计
            */
            const durations = {
                1: 16000,  // 65字，原函数概念，基础重要
                2: 14000,  // 72字，历史意义，需要强调
                3: 17000,  // 68字，牛顿思路，物理概念
                4: 17000,  // 71字，莱布尼茨思路，几何概念
                5: 16000,  // 63字，核心洞察，关键理解
                6: 13000,  // 58字，直观证明，数学推理
                7: 14000,  // 45字，公式展示，相对简短
                8: 15000,  // 52字，实际计算，具体演示
                9: 17000   // 69字，课程总结，需要强调
            };
            return durations[pageNum] || 16000; // 默认16秒
        }

        // 获取页面标题 - 用于状态显示
        function getPageTitle(pageNum) {
            const titles = {
                1: "原函数是什么？",
                2: "为什么伟大？",
                3: "牛顿的思路",
                4: "莱布尼茨的思路",
                5: "核心洞察",
                6: "直观证明",
                7: "伟大的公式",
                8: "实际计算",
                9: "总结"
            };
            return titles[pageNum] || `第${pageNum}页`;
        }
    </script>
</body>
</html>
