<!DOCTYPE html>

<html lang="zh-CN">
<head>
<meta charset="utf-8"/>
<meta content="width=device-width, initial-scale=1.0" name="viewport"/>
<title>06_6.4_本章回顾与习题精讲</title>
<link href="./assets/noto-serif-sc.css" rel="stylesheet"/>
<style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: 'Noto Serif SC', 'Source Han Serif SC', 'Songti SC', 'SimSun', serif; background: #1a1a2e; overflow: hidden; height: 100vh; width: 100vw; }
        .blackboard { width: 100vw; height: 100vh; background: #1a1a2e; position: relative; display: flex; }
        .page { position: absolute; top: 0; left: 0; right: 0; bottom: 0; opacity: 0; visibility: hidden; transition: all 0.5s ease; padding: 30px; display: flex; }
        .page.active { opacity: 1; visibility: visible; }
        .left-panel { width: 35%; height: 100%; padding: 30px; display: flex; flex-direction: column; position: relative; overflow-y: auto; }
        .right-panel { width: 65%; height: 100%; padding: 20px; display: flex; align-items: center; justify-content: center; position: relative; overflow: visible; }
        .chalk-text { color: #ffffff; font-size: 24px; font-weight: normal; letter-spacing: 0.5px; line-height: 1.5; }
        .title { font-size: 32px; margin-bottom: 20px; text-align: center; color: #e1bee7; }
        .emphasis { color: #FF6B6B; font-size: 26px; }
        .formula-box { background: rgba(255,224,102,0.1); padding: 15px; border-radius: 8px; border: 2px dashed rgba(255,224,102,0.4); margin: 15px 0; text-align: center; }
        .chalk-list { list-style: none; padding-left: 0; margin: 15px 0; }
        .chalk-list li { position: relative; padding-left: 20px; margin: 10px 0; font-size: 24px; }
        .chalk-list li::before { content: "•"; position: absolute; left: 0; color: #FFE066; }
        .svg-animation { width: 100%; height: auto; max-width: none; max-height: none; transform: translateX(-70px) scale(2); transform-origin: left center; }
        .page-indicator { position: absolute; top: 20px; right: 20px; color: #FFE066; font-size: 22px; z-index: 100; }
        .small-text { font-size: 20px; color: rgba(255,255,255,0.8); }
        .mjx-chtml { color: #ffffff !important; font-size: 22px !important; }
        .status-indicator { position: absolute; top: 10px; right: 10px; padding: 5px 10px; background: rgba(0,0,0,0.5); color: white; border-radius: 5px; font-size: 12px; z-index: 100; display: none !important; }
.avatar-container { position: fixed; top: 50%; left: 50%; transform: translate(-50%, -50%); width: 600px; height: 700px; overflow: hidden; z-index: 50; pointer-events: none; background: transparent; }
        .wrapper { width: 100%; height: 100%; background: transparent; pointer-events: auto; }
        .subtitle-area { position: absolute; bottom: 8px; left: 20px; right: 20px; min-height: 36px; background: transparent; display: flex; align-items: center; justify-content: center; color: #fff; font-size: 28px; text-align: center; padding: 0 16px; z-index: 110; text-shadow: 0 0 6px rgba(0,0,0,0.9), 0 0 3px rgba(0,0,0,0.7); pointer-events: none; }
        .control-bar { position: fixed; left: -9999px; top: 50%; transform: translateY(-50%); width: 270px; height: auto; background: rgba(255, 255, 255, 0.15); backdrop-filter: blur(15px); display: flex; flex-direction: column; align-items: center; justify-content: center; gap: 12px; z-index: 200; border-radius: 0 20px 20px 0; padding: 25px 20px; transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1); box-shadow: 0 8px 32px rgba(0, 0, 0, 0.2); border: 1px solid rgba(255, 255, 255, 0.2); }
        .control-bar:hover { left: -9999px; box-shadow: 0 12px 40px rgba(0,0,0,0.3); }
        .control-bar::before { content: '▶️'; position: absolute; top: 50%; right: -30px; transform: translateY(-50%); background: rgba(255, 255, 255, 0.2); backdrop-filter: blur(10px); padding: 12px 8px; border-radius: 0 15px 15px 0; font-size: 0.9rem; writing-mode: vertical-lr; border: 1px solid rgba(255, 255, 255, 0.1); color: #ecf0f1; }
        .btn { padding: 14px 22px; background: rgba(255, 255, 255, 0.25); color: #ecf0f1; border: 1px solid rgba(255, 255, 255, 0.3); border-radius: 12px; cursor: pointer; font-size: 14px; font-weight: 600; transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1); width: 100%; text-align: center; backdrop-filter: blur(5px); text-shadow: 0 1px 2px rgba(0,0,0,0.3); }
        .btn:hover { background: rgba(255, 255, 255, 0.35); transform: translateY(-3px); box-shadow: 0 6px 20px rgba(0, 0, 0, 0.2); }
        .btn.primary { background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: #fff; text-shadow: 0 1px 2px rgba(0,0,0,0.3); }
        .btn.primary:hover { background: linear-gradient(135deg, #5a6fd8 0%, #6a4190 100%); box-shadow: 0 8px 25px rgba(102,126,234,0.4); }
        .recording-mode .control-bar { left: -9999px; transition: left 0.5s ease; }
        .left-panel::-webkit-scrollbar { width: 6px; }
        .left-panel::-webkit-scrollbar-track { background: rgba(255,255,255,0.1); border-radius: 3px; }
        .left-panel::-webkit-scrollbar-thumb { background: rgba(255,255,255,0.3); border-radius: 3px; }
        .left-panel::-webkit-scrollbar-thumb:hover { background: rgba(255,255,255,0.5); }
    
        /* 封面页样式覆盖 */
        .page.cover-page {
            display: flex !important;
            padding: 0 !important;
            align-items: center !important;
            justify-content: center !important;
        }
        .page.cover-page > div {
            display: flex !important;
        }
    </style>
<script>
        window.MathJax = {
            tex: { inlineMath: [['$', '$'], ['\\(', '\\)']], displayMath: [['$$', '$$'], ['\\[', '\\]']], packages: ['base', 'ams'], processEscapes: true, processEnvironments: true },
            startup: { pageReady: () => { console.log('MathJax is ready.'); return MathJax.startup.defaultPageReady(); } },
            options: { processHtmlClass: 'tex2jax_process', ignoreHtmlClass: 'tex2jax_ignore' }
        };
    </script>
<script async="" id="MathJax-script" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
</head>
<body>
<div class="blackboard">
<div class="status-indicator" id="statusIndicator">等待连接</div>
<div class="avatar-container"><div class="wrapper" id="avatarWrapper"></div></div>
<div class="page-indicator">第 <span id="currentPage">1</span> / 10 页</div>
<!-- 第1页：封面 -->
<div class="page active cover-page" data-page="1" id="page1">
<div style="display: flex; width: 100%; height: 100%; align-items: center; justify-content: center;">
<div style="flex: 1; text-align: center; padding: 2rem;">
<h1 style="font-size: 2.2rem; font-weight: bold; color: #f1c40f; text-shadow: 0 0 8px rgba(241, 196, 15, 0.5); margin-bottom: 1rem;">
本章回顾与习题精讲
</h1>
<p style="font-size: 1.1rem; color: #9ca3af; margin-bottom: 1.5rem;">
第6章 视频 6.4
</p>
<div style="display: inline-block; text-align: left; margin-top: 1.5rem;">
<p style="font-size: 0.95rem; color: #e0e0e0; margin: 0.6rem 0;">✓ 核心概念回顾</p>
<p style="font-size: 0.95rem; color: #e0e0e0; margin: 0.6rem 0;">✓ 重要公式总结</p>
<p style="font-size: 0.95rem; color: #e0e0e0; margin: 0.6rem 0;">✓ 典型题型分析</p>
<p style="font-size: 0.95rem; color: #e0e0e0; margin: 0.6rem 0;">✓ 易错点提醒</p>
</div>
</div>
<div style="flex: 1; display: flex; align-items: center; justify-content: center;">
<svg style="width: 100%; max-width: 500px; height: 400px;" viewbox="0 0 600 500">
<defs>
<lineargradient id="grad1" x1="0%" x2="0%" y1="0%" y2="100%">
<stop offset="0%" style="stop-color:#2ecc71;stop-opacity:0.8"></stop>
<stop offset="100%" style="stop-color:#27ae60;stop-opacity:0.3"></stop>
</lineargradient>
</defs>
<text fill="#2ecc71" font-family="serif" font-size="70" text-anchor="middle" x="300" y="80">
∫
<animate attributename="opacity" dur="3s" repeatcount="indefinite" values="0;1;1;0.7"></animate>
</text>
<path d="M 150 350 Q 200 200 250 250 T 350 300 T 450 320" fill="none" stroke="#3498db" stroke-width="3"></path>
<path d="M 150 350 Q 200 200 250 250 T 350 300 T 450 320 L 450 350 L 150 350 Z" fill="url(#grad1)">
<animate attributename="opacity" dur="4s" repeatcount="indefinite" values="0;0.7;0.7;0.3"></animate>
</path>
<line stroke="#666" stroke-width="2" x1="150" x2="150" y1="150" y2="350"></line>
<line stroke="#666" stroke-dasharray="5,5" stroke-width="2" x1="450" x2="450" y1="150" y2="350"></line>
</svg>
</div>
</div>
</div>
<!-- 第2页：定积分概念回顾 -->
<div class="page" id="page2">
<div class="left-panel">
<h1 class="title chalk-text">定积分概念回顾</h1>
<div class="board-content">
<p class="chalk-text emphasis">四个步骤</p>
<ul class="chalk-list">
<li class="chalk-text"><strong style="color: #81c784;">分割：</strong>把区间分成n个小段</li>
<li class="chalk-text"><strong style="color: #81c784;">近似：</strong>用小矩形近似曲边梯形</li>
<li class="chalk-text"><strong style="color: #81c784;">求和：</strong>把所有小矩形面积加起来</li>
<li class="chalk-text"><strong style="color: #81c784;">取极限：</strong>n趋向无穷得到精确值</li>
</ul>
<div class="formula-box">
<p class="chalk-text small-text" style="color: #ffab40;">以直代曲，无限细分后累加</p>
</div>
</div>
</div>
<div class="right-panel">
<div class="animation-container">
<svg class="svg-animation" viewBox="0 0 700 600">
<text x="350" y="280" text-anchor="middle" fill="#FFE066" font-size="24" font-weight="bold">定积分的本质</text>
<text x="350" y="340" text-anchor="middle" fill="#95E1D3" font-size="18">分割→近似→求和→极限</text>
</svg>
</div>
</div>
</div>
<!-- 第3页：牛顿莱布尼茨公式 -->
<div class="page" id="page3">
<div class="left-panel">
<h1 class="title chalk-text">牛顿莱布尼茨公式</h1>
<div class="board-content">
<p class="chalk-text emphasis">微积分基本定理</p>
<div class="formula-box">
<p class="chalk-text">$$\int_a^b f(x)dx = F(b) - F(a)$$</p>
<p class="chalk-text small-text">其中 $F'(x) = f(x)$</p>
</div>
<ul class="chalk-list">
<li class="chalk-text">定积分 = 原函数在上下限的差值</li>
<li class="chalk-text">无穷求和 → 简单减法</li>
<li class="chalk-text">微积分最伟大的发现</li>
</ul>
</div>
</div>
<div class="right-panel">
<div class="animation-container">
<svg class="svg-animation" viewBox="0 0 700 600">
<text x="350" y="260" text-anchor="middle" fill="#FFE066" font-size="24" font-weight="bold">牛顿莱布尼茨公式</text>
<text x="350" y="330" text-anchor="middle" fill="#95E1D3" font-size="18">∫ f(x)dx = F(b) - F(a)</text>
</svg>
</div>
</div>
</div>
<!-- 第4页：换元积分法 -->
<div class="page" id="page4">
<div class="left-panel">
<h1 class="title chalk-text">换元积分法</h1>
<div class="board-content">
<p class="chalk-text emphasis">处理复杂积分的技巧</p>
<ul class="chalk-list">
<li class="chalk-text">选择合适的替换变量 $u=g(x)$</li>
<li class="chalk-text">计算 $du = g'(x)dx$</li>
<li class="chalk-text">转换积分上下限</li>
<li class="chalk-text">记得同步变换所有元素</li>
</ul>
<div class="formula-box">
<p class="chalk-text small-text" style="color: #ffab40;">常见替换：三角、指数、对数</p>
</div>
</div>
</div>
<div class="right-panel">
<div class="animation-container">
<svg class="svg-animation" viewBox="0 0 700 600">
<text x="350" y="280" text-anchor="middle" fill="#FFE066" font-size="24" font-weight="bold">换元积分法</text>
<text x="350" y="340" text-anchor="middle" fill="#95E1D3" font-size="16">u = g(x), du = g'(x)dx</text>
</svg>
</div>
</div>
</div>
<!-- 第5页：例题1 · 题目 -->
<div class="page" id="page5">
<div class="left-panel">
<h1 class="title chalk-text">例题1 · 题目</h1>
<div class="board-content">
<p class="chalk-text emphasis">定积分计算</p>
<div class="formula-box">
<p class="chalk-text">$$\int_0^1 \frac{x}{1+x^2} dx$$</p>
</div>
<p class="chalk-text">观察：分子是 $x$，分母是 $1+x^2$</p>
<p class="chalk-text">这种结构提示我们使用换元法</p>
</div>
</div>
<div class="right-panel">
<div class="animation-container">
<svg class="svg-animation" viewBox="0 0 700 600">
<text x="350" y="280" text-anchor="middle" fill="#FFE066" font-size="24" font-weight="bold">例题1</text>
<text x="350" y="340" text-anchor="middle" fill="#95E1D3" font-size="18">∫₀¹ x/(1+x²) dx</text>
</svg>
</div>
</div>
</div>
<!-- 第6页：例题1 · 思路 -->
<div class="page" id="page6">
<div class="left-panel">
<h1 class="title chalk-text">例题1 · 思路</h1>
<div class="board-content">
<p class="chalk-text emphasis">换元法分析</p>
<ul class="chalk-list">
<li class="chalk-text">令 $u = 1+x^2$</li>
<li class="chalk-text">则 $du = 2x\,dx$</li>
<li class="chalk-text">所以 $x\,dx = \frac{1}{2}du$</li>
</ul>
<p class="chalk-text emphasis">上下限变换</p>
<ul class="chalk-list">
<li class="chalk-text">$x=0$ 时，$u=1$</li>
<li class="chalk-text">$x=1$ 时，$u=2$</li>
</ul>
</div>
</div>
<div class="right-panel">
<div class="animation-container">
<svg class="svg-animation" viewBox="0 0 700 600">
<text x="350" y="260" text-anchor="middle" fill="#FFE066" font-size="22" font-weight="bold">换元思路</text>
<text x="350" y="330" text-anchor="middle" fill="#95E1D3" font-size="16">u = 1+x², du = 2x dx</text>
</svg>
</div>
</div>
</div>
<!-- 第7页：例题1 · 计算 -->
<div class="page" id="page7">
<div class="left-panel">
<h1 class="title chalk-text">例题1 · 计算</h1>
<div class="board-content">
<p class="chalk-text emphasis">换元后的积分</p>
<div class="formula-box">
<p class="chalk-text">$$\int_0^1 \frac{x}{1+x^2} dx = \frac{1}{2}\int_1^2 \frac{du}{u}$$</p>
</div>
<p class="chalk-text emphasis">计算结果</p>
<div class="formula-box">
<p class="chalk-text">$$= \frac{1}{2}[\ln u]_1^2 = \frac{1}{2}(\ln 2 - \ln 1)$$</p>
<p class="chalk-text">$$= \frac{1}{2}\ln 2$$</p>
</div>
</div>
</div>
<div class="right-panel">
<div class="animation-container">
<svg class="svg-animation" viewBox="0 0 700 600">
<text x="350" y="280" text-anchor="middle" fill="#FFE066" font-size="24" font-weight="bold">计算过程</text>
<text x="350" y="340" text-anchor="middle" fill="#F38181" font-size="18">= (1/2) ln 2</text>
</svg>
</div>
</div>
</div>
<!-- 第8页：例题1 · 总结 -->
<div class="page" id="page8">
<div class="left-panel">
<h1 class="title chalk-text">例题1 · 总结</h1>
<div class="board-content">
<p class="chalk-text emphasis">关键要点</p>
<ul class="chalk-list">
<li class="chalk-text">✓ 识别换元结构</li>
<li class="chalk-text">✓ 上下限同步变换</li>
<li class="chalk-text">✓ 系数不要遗漏</li>
<li class="chalk-text">✓ 最终结果：$\frac{1}{2}\ln 2$</li>
</ul>
<div class="formula-box">
<p class="chalk-text small-text" style="color: #ffab40;">定积分换元法的核心：变量、微分、上下限三者同步</p>
</div>
</div>
</div>
<div class="right-panel">
<div class="animation-container">
<svg class="svg-animation" viewBox="0 0 700 600">
<text x="350" y="280" text-anchor="middle" fill="#FFE066" font-size="24" font-weight="bold">✓ 完成</text>
<text x="350" y="340" text-anchor="middle" fill="#95E1D3" font-size="16">答案：(1/2) ln 2</text>
</svg>
</div>
</div>
</div>
<!-- 第9页：例题2 · 题目 -->
<div class="page" id="page9">
<div class="left-panel">
<h1 class="title chalk-text">例题2 · 题目</h1>
<div class="board-content">
<p class="chalk-text emphasis">面积计算</p>
<div class="formula-box">
<p class="chalk-text">求 $y=\sin x$ 与 $x$ 轴在 $[0,\pi]$ 间的面积</p>
</div>
<p class="chalk-text">分析：</p>
<ul class="chalk-list">
<li class="chalk-text">先画图确认区间</li>
<li class="chalk-text">确认函数符号（正/负）</li>
<li class="chalk-text">在 $[0,\pi]$ 内，$\sin x \geq 0$</li>
</ul>
</div>
</div>
<div class="right-panel">
<div class="animation-container">
<svg class="svg-animation" viewBox="0 0 700 600">
<text x="350" y="260" text-anchor="middle" fill="#FFE066" font-size="24" font-weight="bold">例题2</text>
<text x="350" y="330" text-anchor="middle" fill="#95E1D3" font-size="16">y = sin x, [0,π]</text>
</svg>
</div>
</div>
</div>
<!-- 第10页：例题2 · 思路 -->
<div class="page" id="page10">
<div class="left-panel">
<h1 class="title chalk-text">例题2 · 思路</h1>
<div class="board-content">
<p class="chalk-text emphasis">设定积分</p>
<div class="formula-box">
<p class="chalk-text">$$S = \int_0^{\pi} \sin x\,dx$$</p>
</div>
<p class="chalk-text">因为在 $[0,\pi]$ 区间内：</p>
<ul class="chalk-list">
<li class="chalk-text">$\sin x \geq 0$（非负）</li>
<li class="chalk-text">可以直接积分</li>
<li class="chalk-text">不需要分段处理</li>
</ul>
</div>
</div>
<div class="right-panel">
<div class="animation-container">
<svg class="svg-animation" viewBox="0 0 700 600">
<text x="350" y="280" text-anchor="middle" fill="#FFE066" font-size="22" font-weight="bold">设定积分</text>
<text x="350" y="340" text-anchor="middle" fill="#95E1D3" font-size="16">S = ∫₀^π sin x dx</text>
</svg>
</div>
</div>
</div>
<!-- 第11页：例题2 · 计算 -->
<div class="page" id="page11">
<div class="left-panel">
<h1 class="title chalk-text">例题2 · 计算</h1>
<div class="board-content">
<p class="chalk-text emphasis">求原函数</p>
<div class="formula-box">
<p class="chalk-text">$$\int \sin x\,dx = -\cos x + C$$</p>
</div>
<p class="chalk-text emphasis">代入上下限</p>
<div class="formula-box">
<p class="chalk-text">$$S = [-\cos x]_0^{\pi}$$</p>
<p class="chalk-text">$$= -\cos\pi - (-\cos 0)$$</p>
<p class="chalk-text">$$= -(-1) - (-1) = 1 + 1 = 2$$</p>
</div>
</div>
</div>
<div class="right-panel">
<div class="animation-container">
<svg class="svg-animation" viewBox="0 0 700 600">
<text x="350" y="260" text-anchor="middle" fill="#FFE066" font-size="24" font-weight="bold">计算过程</text>
<text x="350" y="330" text-anchor="middle" fill="#F38181" font-size="18">S = 2</text>
</svg>
</div>
</div>
</div>
<!-- 第12页：例题2 · 总结 -->
<div class="page" id="page12">
<div class="left-panel">
<h1 class="title chalk-text">例题2 · 总结</h1>
<div class="board-content">
<p class="chalk-text emphasis">关键要点</p>
<ul class="chalk-list">
<li class="chalk-text">✓ 画图确认区间</li>
<li class="chalk-text">✓ 判断函数符号</li>
<li class="chalk-text">✓ 正弦函数的原函数是负余弦</li>
<li class="chalk-text">✓ 最终面积：$S = 2$</li>
</ul>
<div class="formula-box">
<p class="chalk-text small-text" style="color: #ffab40;">面积题关键：确定区间与函数符号，防止负面积</p>
</div>
</div>
</div>
<div class="right-panel">
<div class="animation-container">
<svg class="svg-animation" viewBox="0 0 700 600">
<text x="350" y="280" text-anchor="middle" fill="#FFE066" font-size="24" font-weight="bold">✓ 完成</text>
<text x="350" y="340" text-anchor="middle" fill="#95E1D3" font-size="16">面积 = 2</text>
</svg>
</div>
</div>
</div>
<!-- 第13页：定积分的应用 -->
<div class="page" id="page13">
<div class="left-panel">
<h1 class="title chalk-text">定积分的应用</h1>
<div class="board-content">
<p class="chalk-text emphasis">广泛的应用领域</p>
<ul class="chalk-list">
<li class="chalk-text"><strong style="color: #81c784;">几何：</strong>面积、体积、弧长</li>
<li class="chalk-text"><strong style="color: #81c784;">物理：</strong>功、质心、转动惯量</li>
<li class="chalk-text"><strong style="color: #81c784;">工程：</strong>流量、压力、应力</li>
<li class="chalk-text"><strong style="color: #81c784;">经济：</strong>消费者剩余、总收益</li>
</ul>
<div class="formula-box">
<p class="chalk-text small-text" style="color: #ffab40;">定积分是解决实际问题的强大工具</p>
</div>
</div>
</div>
<div class="right-panel">
<div class="animation-container">
<svg class="svg-animation" viewBox="0 0 700 600">
<text x="350" y="280" text-anchor="middle" fill="#FFE066" font-size="24" font-weight="bold">应用领域</text>
<text x="350" y="340" text-anchor="middle" fill="#95E1D3" font-size="16">几何·物理·工程·经济</text>
</svg>
</div>
</div>
</div>
<!-- 第14页：易错点提醒 -->
<div class="page" id="page14">
<div class="left-panel">
<h1 class="title chalk-text">易错点提醒</h1>
<div class="board-content">
<p class="chalk-text emphasis">常见错误</p>
<ul class="chalk-list">
<li class="chalk-text">❌ 换元后忘记变换上下限</li>
<li class="chalk-text">❌ 系数计算错误</li>
<li class="chalk-text">❌ 面积题忘记取绝对值</li>
<li class="chalk-text">❌ 原函数求错</li>
</ul>
<div class="formula-box">
<p class="chalk-text" style="color: #ffab40; font-weight: 600;">细心检查每一步，避免低级错误！</p>
</div>
</div>
</div>
<div class="right-panel">
<div class="animation-container">
<svg class="svg-animation" viewBox="0 0 700 600">
<text x="350" y="260" text-anchor="middle" fill="#F38181" font-size="24" font-weight="bold">⚠️ 易错点</text>
<text x="350" y="330" text-anchor="middle" fill="#FFE066" font-size="16">细心检查每一步</text>
</svg>
</div>
</div>
</div>
<!-- 第15页：本章总结 -->
<div class="page" id="page15">
<div class="left-panel">
<h1 class="title chalk-text">本章总结</h1>
<div class="board-content">
<p class="chalk-text emphasis">定积分的力量</p>
<ul class="chalk-list">
<li class="chalk-text">✓ 定积分概念：分割→近似→求和→极限</li>
<li class="chalk-text">✓ 牛顿莱布尼茨公式：$\int_a^b f(x)dx = F(b)-F(a)$</li>
<li class="chalk-text">✓ 换元积分法：变量、微分、上下限同步</li>
<li class="chalk-text">✓ 应用：面积、体积、物理、工程</li>
</ul>
<div class="formula-box">
<p class="chalk-text" style="color: #ffab40; font-weight: 600;">多做练习，熟练掌握！下章：微分方程</p>
</div>
</div>
</div>
<div class="right-panel">
<div class="animation-container">
<svg class="svg-animation" viewBox="0 0 700 600">
<text x="350" y="220" text-anchor="middle" fill="#FFE066" font-size="28" font-weight="bold">🎓 第6章完成</text>
<text x="350" y="290" text-anchor="middle" fill="#95E1D3" font-size="18">定积分</text>
<circle cx="350" cy="370" r="60" fill="none" stroke="#F38181" stroke-width="3"/>
<text x="350" y="380" text-anchor="middle" fill="#F38181" font-size="24">✓</text>
<text x="350" y="480" text-anchor="middle" fill="#FFE066" font-size="16">下一章：微分方程</text>
</svg>
</div>
</div>
</div>
</div>
<div class="control-bar">
<div style="color: #ecf0f1; margin-bottom: 1rem; text-align: center; font-size: 12px;">
            第 <span id="currentPageControl">1</span> 页 / 共 15 页
        </div>
<button class="btn" onclick="previousPage()">⬅️ 上一页</button>
<button class="btn primary" onclick="nextPage()">下一页 ➡️</button>
<button class="btn" onclick="startTeaching()">🎤 开始讲解</button>
<button class="btn" id="autoPlayBtn" onclick="startAutoPlay()">🎬 自动播放</button>
</div>
<div class="subtitle-area" id="subtitleArea">欢迎学习第六章知识点回顾与习题精讲！</div>
<!-- 讯飞官方SDK -->
<script type="module">
        // 播放完成标记（供OBS检测）
        window.playbackFinished = false;

        try {
            const { default: AvatarPlatform, SDKEvents, PlayerEvents, RecorderEvents, UserMedia } = await import('./avatar-sdk-web_3.1.2.1002/index.js');
            window.AvatarPlatform = AvatarPlatform;
            window.SDKEvents = SDKEvents;
            window.PlayerEvents = PlayerEvents;
            window.RecorderEvents = RecorderEvents;
            window.UserMedia = UserMedia;
            console.log('✅ SDK加载成功');
        } catch (error) {
            console.error('❌ SDK加载失败:', error);
        }
        window.dispatchEvent(new CustomEvent('sdkReady'));
    </script>
<script>
        let avatarPlatform = null;
        let isConnected = false;
        let isTeaching = false;
        let currentPage = 1;
        const totalPages = 15;
        let isAutoPlaying = false;
        let speechFinishedResolve = null;

        const subtitleScript = {
            1: "欢迎来到本章回顾与习题精讲。本节我们将系统回顾定积分的核心概念，包括定积分的定义、牛顿莱布尼茨公式、换元积分法，并通过两道典型例题，帮助大家掌握定积分的计算技巧和应用方法。让我们开始吧！",
            2: "首先回顾定积分的概念。定积分是曲边梯形面积的精确值，通过四个步骤得到：分割、近似、求和、取极限。分割是把区间分成n个小段，近似是用小矩形近似曲边梯形，求和是把所有小矩形面积加起来，取极限是让n趋向无穷得到精确值。这体现了以直代曲的思想。",
            3: "牛顿莱布尼茨公式，也叫微积分基本定理。公式是：积分a到b的f(x)dx等于F(b)减F(a)，其中F是f的原函数。这个公式把无穷求和问题转化为简单的减法，是微积分最伟大的发现之一。它建立了微分和积分的联系。",
            4: "换元积分法是处理复杂积分的重要技巧。关键是选择合适的替换变量u等于g(x)，计算du等于g撇(x)dx，然后转换积分上下限。常见的替换包括三角替换、指数替换和对数替换。记得同步变换所有元素：变量、微分、上下限。",
            5: "例题一：定积分计算。题目是计算从零到一的x除以一加x平方的定积分。观察这个积分式，分子是x，分母是一加x平方。这种结构提示我们可以使用换元法。关键是找到合适的替换变量。",
            6: "例题一的思路。令u等于一加x平方，则du等于二x dx，所以x dx等于二分之一du。上下限变换：当x等于零时，u等于一；当x等于一时，u等于二。这样就把原积分转化为基本积分形式。",
            7: "例题一的计算过程。换元后的积分是二分之一乘以积分一到二的一除以u du。一除以u的原函数是ln u，代入上下限得到ln二减ln一等于ln二。所以原积分等于二分之一乘以ln二。",
            8: "例题一的总结。关键要点有三个：第一，识别换元结构；第二，上下限同步变换；第三，系数不要遗漏。最终结果是二分之一ln二。定积分换元法的核心是变量、微分、上下限三者同步变换。",
            9: "例题二：面积计算。题目是求y等于正弦x与x轴在零到派之间围成的面积。这是定积分的几何应用题。首先要画图确认区间和函数的符号。在零到派区间内，正弦x大于等于零，所以面积就等于定积分。",
            10: "例题二的思路。面积可以表示为定积分：S等于积分零到派正弦x dx。因为在零到派区间内，正弦x非负，所以可以直接积分，不需要分段处理。如果函数在某些区间为负，需要分段处理，取绝对值后再积分。",
            11: "例题二的计算过程。正弦x的原函数是负余弦x。代入上下限：负余弦派减去负余弦零，等于负的负一减去负的一，等于一加一等于二。所以面积S等于二。",
            12: "例题二的总结。关键要点有三个：第一，画图确认区间；第二，判断函数符号；第三，正弦函数的原函数是负余弦。最终面积等于二。面积题的关键是确定区间与函数符号，防止把负面积算入。",
            13: "定积分的应用非常广泛。在几何中，可以求面积、体积、弧长。在物理中，可以求功、质心、转动惯量。在工程中，可以求流量、压力、应力。在经济学中，可以求消费者剩余、总收益。定积分是解决实际问题的强大工具。",
            14: "易错点提醒。常见错误有四个：第一，换元后忘记变换上下限；第二，系数计算错误；第三，面积题忘记取绝对值；第四，原函数求错。细心检查每一步，避免低级错误！",
            15: "本章总结。定积分的核心内容包括：定积分概念，通过分割、近似、求和、取极限得到；牛顿莱布尼茨公式，积分a到b的f(x)dx等于F(b)减F(a)；换元积分法，变量、微分、上下限同步变换；应用包括面积、体积、物理、工程等。多做练习，熟练掌握这个强大工具！下一章我们将学习微分方程。"
        };

        // durations computed dynamically via getPageDuration()

        function updateSubtitle(text) {
            const area = document.getElementById('subtitleArea');
            if (area) area.textContent = text;
        }

        function switchToPage(pageNum, shouldSpeak = true) {
            if (pageNum < 1 || pageNum > totalPages) return;
            currentPage = pageNum;
            
            document.querySelectorAll('.page').forEach((p, i) => {
                p.classList.toggle('active', i === pageNum - 1);
            });
            
            document.getElementById('currentPage').textContent = pageNum;
            document.getElementById('currentPageControl').textContent = pageNum;
            updateSubtitle(subtitleScript[pageNum] || '');
            
            if (window.MathJax && typeof window.MathJax.typeset === 'function') {
                window.MathJax.typeset();
            }
            
            if (shouldSpeak && !isAutoPlaying) {
                speakContent(pageNum);
            }
        }

        function nextPage() {
            if (currentPage < totalPages) {
                switchToPage(currentPage + 1);
            }
        }

        function previousPage() {
            if (currentPage > 1) {
                switchToPage(currentPage - 1);
            }
        }

        function waitForSDK() {
            return new Promise((resolve, reject) => {
                if (typeof AvatarPlatform !== 'undefined') {
                    resolve();
                    return;
                }
                const timeout = setTimeout(() => {
                    reject(new Error('SDK加载超时'));
                }, 10000);
                window.addEventListener('sdkReady', function handler() {
                    clearTimeout(timeout);
                    window.removeEventListener('sdkReady', handler);
                    resolve();
                });
            });
        }

        async function startTeaching() {
            const startBtn = document.querySelector('.btn.primary');
            if (!startBtn) return;
            startBtn.textContent = '🔄 启动中...';
            startBtn.disabled = true;

            try {
                await waitForSDK();
                if (avatarPlatform) {
                    avatarPlatform.destroy();
                }

                avatarPlatform = new AvatarPlatform({ useInlinePlayer: true });

                avatarPlatform.on('connected', () => {
                        isConnected = true;
                        isTeaching = true;
                        startBtn.textContent = '💖 虚拟人已就绪';
                    setTimeout(() => speakContent(currentPage), 1000);
                }).on('disconnected', () => {
                        isConnected = false;
                        isTeaching = false;
                    startBtn.textContent = '🎤 开始讲解';
                        startBtn.disabled = false;
                }).on('error', (error) => {
                    console.error('❌ 错误:', error);
                    startBtn.textContent = '❌ 连接失败';
                        startBtn.disabled = false;
                    }).on('frame_stop', (data) => {
                        console.log('✅ 虚拟人讲解完成');
                        if (speechFinishedResolve) {
                            speechFinishedResolve('speech_finished');
                            speechFinishedResolve = null;
                        }
                    });

                avatarPlatform.setApiInfo({
                    appId: '1af9f6ce',
                    apiKey: 'fb9e639101a96b2e8f55ff7598947a4d',
                    apiSecret: 'YTY3ODBiYTUwODViOWRjZjc5NWQ0YWNm',
                    sceneId: '238962977817104384',
                    serverUrl: 'wss://avatar.cn-huadong-1.xf-yun.com/v1/interact'
                });

                avatarPlatform.setGlobalParams({
                    stream: { protocol: 'xrtc', alpha: 1, bitrate: 1000000, fps: 25 },
                    avatar: { avatar_id: '110332017', width: 1920, height: 1080, scale: 1, move_h: 0, move_v: 0, audio_format: 1 },
                    tts: { vcn: 'x4_yiting', speed: 50, pitch: 50, volume: 100 },
                    avatar_dispatch: { interactive_mode: 1, content_analysis: 0 }
                });

                await avatarPlatform.start({ wrapper: document.getElementById('avatarWrapper') });
            } catch (error) {
                console.error('❌ 启动失败:', error);
                startBtn.textContent = '🎤 开始讲解';
                startBtn.disabled = false;
            }
        }

        async function speakContent(pageNum) {
            if (!isTeaching || !isConnected || !avatarPlatform) return;
            const raw = subtitleScript[pageNum];
            const content = translateMathToSpeech(raw);
            if (!content) return;

            try {
                const actionMap = {
                    1: "A_RLH_welcome_O",
                    2: "A_LH_introduced_O",
                    3: "A_RH_point_O",
                    4: "A_RLH_welcome_O"
                };
                const action = actionMap[pageNum];
                if (action) {
                    await avatarPlatform.writeCmd("action", action);
                }
                await avatarPlatform.writeText(content, { nlp: false });
            } catch (error) {
                console.error('❌ 讲解失败:', error);
            }
        }

        async function startAutoPlay() {
            if (isAutoPlaying) {
                stopAutoPlay();
                return;
            }

            if (!avatarPlatform || !isConnected) {
                await startTeaching();
                await new Promise(resolve => setTimeout(resolve, 3000));
                if (!isConnected) {
                    console.error("启动虚拟人失败，自动播放已取消。");
                    return;
                }
            }

            isAutoPlaying = true;
            const autoPlayBtn = document.getElementById('autoPlayBtn');
            autoPlayBtn.textContent = '⏹️ 停止播放';
            autoPlayBtn.style.background = 'linear-gradient(135deg, #f44336, #d32f2f)';

            try {
                for (let page = 1; page <= totalPages; page++) {
                    if (!isAutoPlaying) break;

                    console.log(`\n🎬 === 准备播放第 ${page}/${totalPages} 页 ===`);
                    switchToPage(page);
                    await new Promise(resolve => setTimeout(resolve, 200));

                    const speechPromise = new Promise(resolve => { speechFinishedResolve = resolve; });
                    speakContent(page);

                    const timeoutPromise = new Promise(resolve => setTimeout(() => resolve('timeout'), getPageDuration(page)));

                    console.log(`[Sync] ⏳ 等待讲解完成或超时...`);
                    const result = await Promise.race([speechPromise, timeoutPromise]);

                    if (!isAutoPlaying) break;

                    if (result === 'timeout') {
                        console.warn(`[Sync] ⚠️ 第 ${page} 页讲解超时! 继续下一页。`);
                    } else {
                        console.log(`[Sync] ✅ 第 ${page} 页讲解正常完成。`);
                    }
                    await new Promise(resolve => setTimeout(resolve, 500));
                }
            } catch (error) {
                console.error('❌ 自动播放流程出现严重错误:', error);
            } finally {
                if (isAutoPlaying) {
                    console.log('🎉 自动播放流程已全部完成');
                    window.playbackFinished = true;
                    document.title = "PLAYBACK_FINISHED";
                }
                stopAutoPlay();
            }
        }

        function stopAutoPlay() {
            isAutoPlaying = false;
            const autoPlayBtn = document.getElementById('autoPlayBtn');
            if (autoPlayBtn) {
                autoPlayBtn.textContent = '🎬 自动播放';
                autoPlayBtn.style.background = '';
            }
        }

        // 键盘控制
        document.addEventListener('keydown', (e) => {
            if (e.key === 'ArrowRight' || e.key === ' ') {
                e.preventDefault();
                nextPage();
            } else if (e.key === 'ArrowLeft') {
                e.preventDefault();
                previousPage();
            } else if (e.key === 'Enter') {
                e.preventDefault();
                speakContent(currentPage);
            }
        });

        // 鼠标滚轮控制
        let wheelTimeout;
        document.addEventListener('wheel', (e) => {
            clearTimeout(wheelTimeout);
            wheelTimeout = setTimeout(() => {
                if (e.deltaY > 0) {
                    nextPage();
                } else if (e.deltaY < 0) {
                    previousPage();
                }
            }, 50);
        }, { passive: true });

        // 初始化
        document.addEventListener('DOMContentLoaded', () => {
            switchToPage(1, false);
            setTimeout(() => {
                console.log('🚀 3秒后自动启动播放...');
                startAutoPlay();
            }, 3000);
        });

        // 数学公式音译为中文（用于字数统计与TTS）
        function translateMathToSpeech(text){
            if(!text) return '';
            let r=text;
            const rep=(pat,to)=>{ r=r.replace(new RegExp(pat,'g'),to); };
            rep("f''\\(x\\)",'f两撇x'); rep("f'\\(x\\)",'f撇x');
            rep("x_0",'x零'); rep("x_1",'x一'); rep("x_2",'x二'); rep("x_n",'x n');
            rep("\\\\lim",'极限'); rep("\\\\to",'趋向于'); rep("\\\\infty",'无穷大');
            rep("\\\\int",'积分'); rep("\\\\sum",'求和'); rep("\\\\sqrt",'根号');
            r=r.replace(new RegExp("\\\\frac\\s*{([^}]*)}\\s*{([^}]*)}",'g'),function(_,a,b){return a+'分之'+b;});
            rep(">",'大于'); rep("<",'小于'); rep("=",'等于');
            r=r.replace(new RegExp("\\$",'g'),'').replace(new RegExp("\\\\",'g'),'').replace(new RegExp("[{}]",'g'),'');
            return r;
        }

        function getPageDuration(pageNum){
            const speech = subtitleScript[pageNum];
            if(!speech) return 6000;
            const translated = translateMathToSpeech(speech);
            const charCount = translated.length;
            const duration = Math.max(6000, charCount * 400); // 每字400ms，确保虚拟人有足够时间讲完
            console.log(`第${pageNum}页: ${charCount}字 → ${duration}ms`);
            return duration;
        }
    </script>
</body>
</html>
