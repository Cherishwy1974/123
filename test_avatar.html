<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=1920, initial-scale=1.0">
    <title>è™šæ‹Ÿäººæµ‹è¯•é¡µé¢</title>
    <style>
        body {
            background: #1a1a2e;
            color: white;
            font-family: Arial, sans-serif;
            padding: 20px;
        }
        .test-info {
            background: rgba(255,255,255,0.1);
            padding: 20px;
            margin: 10px 0;
            border-radius: 8px;
        }
        .avatar-container {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            width: 975px;
            height: 1105px;
            background: rgba(255,0,0,0.1);
            border: 2px dashed #ff0;
        }
        .wrapper {
            width: 100%;
            height: 100%;
        }
        #log {
            background: #000;
            padding: 10px;
            height: 200px;
            overflow-y: auto;
            font-family: monospace;
            font-size: 12px;
        }
        .log-line {
            margin: 2px 0;
        }
        .log-error { color: #f44336; }
        .log-success { color: #4caf50; }
        .log-info { color: #2196f3; }
    </style>
</head>
<body>
    <h1>è™šæ‹Ÿäººæ˜¾ç¤ºæµ‹è¯•</h1>

    <div class="test-info">
        <h2>æµ‹è¯•çŠ¶æ€</h2>
        <div id="status">æ­£åœ¨æ£€æŸ¥...</div>
    </div>

    <div class="test-info">
        <h2>æ§åˆ¶å°æ—¥å¿—</h2>
        <div id="log"></div>
    </div>

    <button onclick="testAvatar()" style="padding: 10px 20px; font-size: 16px; cursor: pointer;">
        ğŸ§ª æµ‹è¯•è™šæ‹Ÿäººè¿æ¥
    </button>

    <!-- è™šæ‹Ÿäººå®¹å™¨ -->
    <div class="avatar-container">
        <div class="wrapper" id="avatarWrapper"></div>
    </div>

    <!-- SDKåŠ è½½ -->
    <script type="module">
        const log = (msg, type = 'info') => {
            const logDiv = document.getElementById('log');
            const line = document.createElement('div');
            line.className = `log-line log-${type}`;
            line.textContent = `[${new Date().toLocaleTimeString()}] ${msg}`;
            logDiv.appendChild(line);
            logDiv.scrollTop = logDiv.scrollHeight;
            console.log(msg);
        };

        const updateStatus = (msg) => {
            document.getElementById('status').textContent = msg;
            log(msg, 'info');
        };

        updateStatus('å¼€å§‹åŠ è½½SDK...');

        try {
            const { default: AvatarPlatform, SDKEvents, PlayerEvents, RecorderEvents, UserMedia } = await import('./avatar-sdk-web_3.1.2.1002/index.js');
            window.AvatarPlatform = AvatarPlatform;
            window.SDKEvents = SDKEvents;
            window.PlayerEvents = PlayerEvents;
            window.RecorderEvents = RecorderEvents;
            window.UserMedia = UserMedia;
            log('âœ… SDKæ¨¡å—åŠ è½½æˆåŠŸ', 'success');
            log(`SDKç‰ˆæœ¬: ${AvatarPlatform.getVersion()}`, 'success');
            updateStatus('âœ… SDKåŠ è½½æˆåŠŸ');
        } catch (error) {
            log('âŒ SDKåŠ è½½å¤±è´¥: ' + error.message, 'error');
            log('é”™è¯¯è¯¦æƒ…: ' + error.stack, 'error');
            updateStatus('âŒ SDKåŠ è½½å¤±è´¥');
        }

        window.testAvatar = async function() {
            log('å¼€å§‹æµ‹è¯•è™šæ‹Ÿäººè¿æ¥...', 'info');

            if (typeof AvatarPlatform === 'undefined') {
                log('âŒ AvatarPlatform æœªå®šä¹‰,SDKæœªæ­£ç¡®åŠ è½½', 'error');
                return;
            }

            try {
                updateStatus('æ­£åœ¨è¿æ¥è™šæ‹Ÿäºº...');

                const avatarPlatform = new AvatarPlatform({ useInlinePlayer: true });

                avatarPlatform
                    .on('connected', (initResp) => {
                        log('ğŸ‰ è™šæ‹Ÿäººè¿æ¥æˆåŠŸï¼', 'success');
                        log('è¿æ¥å“åº”: ' + JSON.stringify(initResp), 'success');
                        updateStatus('âœ… è™šæ‹Ÿäººè¿æ¥æˆåŠŸ');
                    })
                    .on('disconnected', (err) => {
                        log('ğŸ”Œ è™šæ‹Ÿäººæ–­å¼€è¿æ¥', 'info');
                        if (err) log('æ–­å¼€åŸå› : ' + JSON.stringify(err), 'error');
                    })
                    .on('error', (error) => {
                        log('âŒ è™šæ‹Ÿäººé”™è¯¯: ' + error.message, 'error');
                        log('é”™è¯¯è¯¦æƒ…: ' + JSON.stringify(error), 'error');
                        updateStatus('âŒ è¿æ¥å¤±è´¥');
                    });

                avatarPlatform.setApiInfo({
                    appId: 'f34b6995',
                    apiKey: '11bce7d2c44157a6875476f368ceb2a0',
                    apiSecret: 'NjIzNjk2ZWQ0ZGNjMGE0ODkzYjhmNzQy',
                    sceneId: '233767656807862272',
                    serverUrl: 'wss://avatar.cn-huadong-1.xf-yun.com/v1/interact'
                });

                avatarPlatform.setGlobalParams({
                    stream: { protocol: 'xrtc', alpha: 1, bitrate: 1000000, fps: 25 },
                    avatar: { avatar_id: '110332017', width: 1920, height: 1080, scale: 1 },
                    tts: { vcn: 'x4_yiting', speed: 50, pitch: 50, volume: 100 },
                    avatar_dispatch: { interactive_mode: 1, content_analysis: 0 }
                });

                log('é…ç½®å·²è®¾ç½®ï¼Œå¼€å§‹å¯åŠ¨...', 'info');
                await avatarPlatform.start({wrapper: document.getElementById('avatarWrapper')});
                log('âœ… è™šæ‹Ÿäººå¯åŠ¨å‘½ä»¤å·²æ‰§è¡Œ', 'success');

            } catch (error) {
                log('âŒ æµ‹è¯•å¤±è´¥: ' + error.message, 'error');
                log('é”™è¯¯å †æ ˆ: ' + error.stack, 'error');
                updateStatus('âŒ æµ‹è¯•å¤±è´¥');
            }
        };

        // é¡µé¢åŠ è½½å®Œæˆåçš„æ£€æŸ¥
        window.addEventListener('DOMContentLoaded', () => {
            log('é¡µé¢DOMåŠ è½½å®Œæˆ', 'info');
            log('å½“å‰è·¯å¾„: ' + window.location.pathname, 'info');
            log('avatarWrapperå­˜åœ¨: ' + (document.getElementById('avatarWrapper') ? 'æ˜¯' : 'å¦'), 'info');
        });
    </script>
</body>
</html>
