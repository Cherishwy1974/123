# 自动化课件录制系统 - 使用指南

## 快速开始（5步完成配置）

### 第1步：检查VB-Cable音频
你已经打开了VB-Cable，还需要确认音频路由：

1. **设置系统音频输出**：
   - 右键任务栏音量图标 → "声音设置"
   - 在"输出设备"中选择 **"CABLE Input (VB-Audio Virtual Cable)"**
   - 这样浏览器的声音会输出到VB-Cable，供FFmpeg录制

2. **（可选）监听音频**：
   如果你想在录制时听到声音：
   - 打开"控制面板" → "声音"
   - 切换到"录制"标签
   - 找到"CABLE Output"，右键 → "属性"
   - 切换到"侦听"标签
   - 勾选"侦听此设备"
   - 在下方选择你的扬声器/耳机

### 第2步：检查依赖软件

运行命令检查：
```bash
python --version      # 需要 Python 3.8+
ffmpeg -version       # 需要 FFmpeg
```

如果缺少：
- **Python**: https://www.python.org/downloads/
- **FFmpeg**: https://ffmpeg.org/download.html (下载后添加到PATH)
- **ChromeDriver**: 下载与Chrome浏览器版本匹配的驱动，放到PATH中

### 第3步：安装Python依赖
```bash
pip install selenium pyautogui psutil
```

### 第4步：测试录制

**重要：先测试单个视频**

编辑 `auto_record_courseware.py` 的底部配置：
```python
RECORDING_DURATION = 30  # 先录30秒测试
START_INDEX = 0          # 从第1个URL开始
```

运行测试：
```bash
python auto_record_courseware.py
```

检查输出：
- 查看 `录制视频` 目录
- 播放视频检查画面和声音是否正常

### 第5步：开始批量录制

确认测试无误后，调整配置：
```python
RECORDING_DURATION = 300  # 每个视频5分钟（根据实际调整）
START_INDEX = 0           # 从头开始
```

**方式1：使用快捷脚本**
```bash
双击运行: 开始录制.bat
```

**方式2：直接运行Python**
```bash
python auto_record_courseware.py
```

---

## 关于"后台录制"的说明

### 当前方案的特点

**✅ 不会干扰你的工作**：
- 不锁定鼠标和键盘
- 你可以在其他窗口正常工作
- 录制脚本在后台运行

**⚠️ 浏览器窗口必须可见**：
- 浏览器窗口会打开并显示在屏幕上
- 不能最小化浏览器窗口（会录到黑屏）
- 不能完全遮挡浏览器窗口

### 为什么不能完全后台？

**技术限制**：
1. **Windows渲染机制**：最小化的窗口不会被渲染，FFmpeg录制结果是黑屏
2. **FFmpeg的gdigrab**：只能捕获可见窗口的内容
3. **浏览器优化**：不可见的网页会被浏览器降低渲染优先级

**这不是脚本的bug，而是Windows系统的工作机制。**

### 实用的解决方案

#### 方案A：双显示器（强烈推荐）
如果你有第二个显示器：
1. 运行脚本后，手动将浏览器窗口拖到第二个显示器
2. 在主显示器上正常工作
3. 两者互不干扰

#### 方案B：虚拟桌面
使用Windows 10/11的虚拟桌面功能：
1. Win+Tab 创建新桌面
2. 将录制浏览器移到新桌面
3. 切换回主桌面工作
4. 浏览器仍在后台渲染

#### 方案C：工作区分离
1. 将浏览器窗口缩小，放到屏幕角落
2. 最大化你的工作窗口覆盖大部分屏幕
3. 不要完全遮挡浏览器窗口

---

## 进阶方案：完全后台录制

如果确实需要完全后台，以下是可行的技术方案：

### 方案1：虚拟显示器驱动
使用虚拟显示器，浏览器在虚拟屏幕上运行，物理屏幕看不到。

**实现步骤**：
1. 安装虚拟显示器驱动（如 IddSampleDriver）
2. 配置虚拟显示器分辨率
3. 修改脚本，让浏览器在虚拟显示器上打开
4. FFmpeg录制虚拟显示器内容

**优点**：完全后台，不占用物理屏幕
**缺点**：配置复杂，需要安装驱动

### 方案2：OBS Studio + WebSocket
使用OBS的"浏览器源"功能，可以在后台渲染网页。

**实现步骤**：
1. 安装OBS Studio
2. 安装obs-websocket插件
3. 使用Python控制OBS录制
4. OBS的浏览器源在后台运行

**优点**：配置相对简单，OBS功能强大
**缺点**：需要额外软件，占用一定资源

### 方案3：无头浏览器 + Canvas录制
使用Puppeteer（Node.js）或Playwright，在无头模式下录制。

**优点**：完全后台，轻量级
**缺点**：需要重写脚本，音频捕获复杂

---

## 常见问题

### Q1: 录制的视频没有声音
**排查步骤**：

1. **检查VB-Cable**：
   - 任务栏音量图标 → "声音设置" → 输出设备 = "CABLE Input"

2. **检查FFmpeg音频设备名称**：
   ```bash
   ffmpeg -list_devices true -f dshow -i dummy
   ```
   找到"CABLE Output"的准确名称，确保与脚本中一致。

3. **测试VB-Cable**：
   - 播放一段音乐
   - 打开Windows"声音"设置，查看"CABLE Output"是否有音量指示

### Q2: 找不到播放按钮
脚本会尝试多种方式查找，如果失败：

1. **手动点击**：脚本加载页面后会等待几秒，你可以手动点击播放
2. **自定义选择器**：打开网页，使用浏览器开发者工具（F12）查找播放按钮的选择器，添加到脚本中

### Q3: 如何确定录制时长？
1. 手动打开一个课件，计时完整播放时长
2. 设置 `RECORDING_DURATION = 实际时长 + 10秒缓冲`

### Q4: 录制过程中断了怎么办？
修改 `START_INDEX` 继续录制：
```python
START_INDEX = 10  # 从第11个URL继续
```

### Q5: 可以调整录制质量吗？
可以修改FFmpeg参数：
```python
'-crf', '18',      # 降低CRF值提高画质（18-28，23是默认）
'-preset', 'slow', # 使用慢速编码提高画质（ultrafast/fast/medium/slow）
'-b:a', '256k',    # 提高音频码率（192k/256k/320k）
```

---

## 录制流程

```
[开始]
  ↓
读取URL列表（53个课程）
  ↓
打开浏览器（Chrome）
  ↓
循环每个URL：
  ├─ 加载网页
  ├─ 查找并点击"自动播放"按钮
  ├─ 启动FFmpeg录制（画面+音频）
  ├─ 等待指定时长
  ├─ 停止录制，保存MP4
  └─ 等待5秒，继续下一个
  ↓
[完成]
```

---

## 输出文件

录制完成后，视频保存在 `录制视频` 目录：

```
录制视频/
├── 01_1.1_指数的概念与运算.mp4
├── 01_1.2_对数的概念与运算.mp4
├── 01_1.3_函数的基本概念.mp4
├── ...（共53个视频）
└── 13_13.4_本章总结与综合应用.mp4
```

文件名自动从URL提取，与课件名称对应。

---

## 性能优化建议

### 1. 录制质量 vs 文件大小

**平衡模式**（当前默认）：
```python
'-crf', '23'          # 中等质量
'-preset', 'ultrafast' # 快速编码
```
- 文件大小：约 200-400MB/小时
- 画质：清晰，适合教学视频
- CPU占用：低

**高质量模式**：
```python
'-crf', '18'
'-preset', 'slow'
```
- 文件大小：约 500-800MB/小时
- 画质：高清
- CPU占用：高

### 2. 批量录制优化

**顺序录制**（当前方案）：
- 一次录制一个视频
- 稳定可靠
- 适合长时间运行

**并行录制**（需要改造）：
- 多个浏览器实例
- 需要虚拟显示器
- 速度快但复杂

---

## 总结

### 当前脚本的能力
✅ 自动读取53个课程URL
✅ 自动打开浏览器并点击播放
✅ 录制视频+音频（VB-Cable）
✅ 不锁定鼠标/键盘，可以同时工作
✅ 支持断点续录
✅ 自动保存为MP4文件

### 限制
⚠️ 浏览器窗口必须可见（不能最小化）
⚠️ 需要固定时长录制（无法自动检测播放完成）

### 推荐工作流
1. **测试阶段**：录制1-2个视频，检查画质和音频
2. **调整参数**：根据实际课件时长调整 `RECORDING_DURATION`
3. **批量录制**：使用双显示器或虚拟桌面，让脚本在后台运行
4. **定期检查**：每录制10-20个视频检查一次输出

### 预计时间
- 每个视频5分钟 × 53个 = 265分钟 ≈ **4.5小时**
- 加上加载/切换时间：约 **5-6小时**

建议在不需要使用电脑的时间段运行（如晚上、午休）。

---

## 需要帮助？

如果遇到问题：
1. 查看控制台输出的错误信息
2. 检查 `录制视频` 目录中的输出文件
3. 验证VB-Cable和FFmpeg配置
4. 尝试录制单个视频进行调试

如果需要实现完全后台录制，我可以提供：
- 虚拟显示器方案的详细配置
- OBS自动化录制脚本
- Puppeteer无头浏览器方案

---

**祝录制顺利！🎬**
